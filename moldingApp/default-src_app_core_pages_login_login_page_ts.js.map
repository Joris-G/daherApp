{"version":3,"file":"default-src_app_core_pages_login_login_page_ts.js","mappings":"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","sources":["./src/app/core/pages/login/login.page.ts","./src/app/core/services/applicationUpdates/update-app.service.ts"],"sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { isDevMode } from '@angular/core';\r\n\r\nimport { IonInput, NavController } from '@ionic/angular';\r\n\r\nimport { UpdateAppService } from 'src/app/core/services/applicationUpdates/update-app.service';\r\nimport { AuthService } from 'src/app/core/services/users/auth.service';\r\nimport { environment } from 'src/environments/environment';\r\nimport { LoadingService } from 'src/app/core/services/divers/loading.service';\r\nimport { AlertService } from 'src/app/core/services/divers/alert.service';\r\nimport packageJson from 'package.json';\r\nimport { NoticeService } from 'src/app/core/services/notice/notice.service';\r\n\r\n@Component({\r\n  selector: 'app-login',\r\n  templateUrl: './login.page.html',\r\n  styleUrls: ['./login.page.scss'],\r\n})\r\nexport class LoginPage implements OnInit {\r\n  @ViewChild('userName') userName: IonInput;\r\n  @ViewChild('password') password: IonInput;\r\n  public version: string = packageJson.version;\r\n  public loginForm: FormGroup;\r\n  private reRouteOpts = [\r\n    {\r\n      roles: ['ROLE_MOULEUR', '\tROLE_RESP_MOULAGE', 'ROLE_CE_MOULAGE'],\r\n      route: 'molding'\r\n    },\r\n    {\r\n      roles: ['ROLE_RESP_OUTIL', 'ROLE_CE_OUTIL', 'ROLE_OUTILLEUR'],\r\n      route: 'tooling'\r\n    },\r\n    {\r\n      roles: ['ROLE_ADMIN', 'ROLE_USER', 'ROLE_METHODES'],\r\n      route: 'home'\r\n    },\r\n  ];\r\n\r\n  constructor(\r\n    public authService: AuthService,\r\n    private formBuilder: FormBuilder,\r\n    private loadingService: LoadingService,\r\n    private updateService: UpdateAppService,\r\n    private navControler: NavController,\r\n    private alertService: AlertService,\r\n    private noticeService: NoticeService,\r\n  ) { }\r\n\r\n  showNotice() {\r\n    this.noticeService.presentModal();\r\n  }\r\n\r\n  ionViewWillEnter(): void {\r\n    if (isDevMode()) {\r\n      this.loginForm.setValue({\r\n        userName: environment.username,\r\n        password: environment.password\r\n      });\r\n    }\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.loginForm = this.formBuilder.group({\r\n      userName: ['', Validators.required],\r\n      password: ['']\r\n    });\r\n    // Notification.requestPermission().then((result) => {\r\n    //   if (!('Notification' in window)) {\r\n    //     alert('Ce navigateur ne prend pas en charge la notification de bureau');\r\n    //   }\r\n    //   console.log(result);\r\n    //   const img = 'assets/images/logoDaher.png';\r\n    //   const text = 'Coucou ! Votre tâche \"' + '\" arrive maintenant à échéance.';\r\n    //   const notification = new Notification('Liste de trucs à faire', { body: text, icon: img });\r\n    // });\r\n\r\n  }\r\n\r\n  onSubmit() {\r\n    this.loadingService.startLoading('Patienter pendant la connexion');\r\n    const userName = this.loginForm.get('userName').value.replace(/^0+/, '');\r\n    const password = this.loginForm.get('password').value || userName;\r\n\r\n    this.authService.authenticate(userName, password)\r\n      .subscribe(() => {\r\n        this.afterLoginActions();\r\n      },\r\n        (error) => {\r\n          this.logginError(error);\r\n        },\r\n      );\r\n  }\r\n\r\n  private afterLoginActions() {\r\n    this.loadingService.stopLoading()\r\n      .then(() => {\r\n        this.loginForm.reset();\r\n        this.reRouteUser();\r\n        this.updateService.showUpdates();\r\n      });\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * Trouve la route privilégiée de l'utilisateur. Puis navigue vers la route\r\n   *\r\n   * @private\r\n   * @memberof LoginPage\r\n   */\r\n  private reRouteUser() {\r\n    const prefRoute = this.reRouteOpts.find(\r\n      (curRouteOpt) => this.authService.authUser.roles.some(\r\n        (role) => curRouteOpt.roles.find(roleOpt => roleOpt === role)));\r\n        console.log(prefRoute);\r\n    if (prefRoute !== undefined) {\r\n      this.navControler.navigateRoot(prefRoute.route);\r\n      return;\r\n    }\r\n    this.navControler.navigateRoot('home');\r\n  }\r\n\r\n\r\n  private logginError(error: any) {\r\n    console.error(error);\r\n    this.alertService.simpleAlert(\r\n      'Erreur d\\'authentification',\r\n      '',\r\n      'Le nom d\\'utilisateur ou votre mot de passe n\\'est pas correct',\r\n    );\r\n    this.loadingService.stopLoading();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\nimport { Observable, of } from 'rxjs';\nimport { Update } from 'src/app/_interfaces/update';\nimport { AlertService } from '../divers/alert.service';\nimport { AuthService } from '../users/auth.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class UpdateAppService {\n\n  private tableUpdates = [\n    {\n      id: 1,\n      dateUpdate: new Date(2022, 4, 9),\n      description:\n        'Pour associer un outillage à un moulage il suffit de scanner le numéro d\\'OT dans l\\'OF.' +\n        'Vous devez le scanner comme un kit',\n      title: 'Module Moulage'\n    },\n    {\n      id: 2,\n      dateUpdate: new Date(2022, 4, 9),\n      description: 'Le module outillage est ouvert pour test',\n      title: 'Module Outillage'\n    },\n  ];\n\n  constructor(\n    private authService: AuthService,\n    private alertService: AlertService,\n  ) {\n  }\n\n\n\n  /**\n   *Si la promise retourn true c'est que toutes les updates sont vues\n   *Si la promise return false l'utilisateur reverra les update à sa prochaine connexion\n   *\n   * @return\n   * @memberof UpdateAppService\n   */\n  showUpdates() {\n    this.getUpdatesToShow()\n      .subscribe((updates: Update[]) => {\n        if (updates) {\n          updates.forEach((update: Update) => {\n            this.alertService.simpleAlert('Info sur la mise à jours', update.title, update.description);\n          });\n        }\n      });\n  }\n\n\n\n  private getUpdates(day1?: Date): Update[] | null {\n    const updates = this.tableUpdates.filter(update => update.dateUpdate >= new Date(day1));\n    if (updates.length > 0) {\n      return updates;\n    } else {\n      return null;\n    }\n  }\n\n\n\n  /**\n   * Quand la base des mises à jours sera faites enlever le of\n   *\n   * @private\n   * @return\n   * @memberof UpdateAppService\n   */\n  private getUpdatesToShow(): Observable<Update[]> {\n    const lastConnection = this.authService.authUser.lastCon;\n    return of(this.getUpdates(lastConnection));\n  }\n}\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}