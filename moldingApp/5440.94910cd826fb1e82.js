"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5440],{8190:(A,_,a)=>{a.d(_,{b:()=>h});var p=a(4762),f=a(3668),s=a(1704);let h=(()=>{class g{constructor(c){this.loadingController=c}startLoading(c){this.loadingController.create({cssClass:"my-custom-class",message:c}).then(e=>{e.present()})}stopLoading(){return(0,p.mG)(this,void 0,void 0,function*(){setTimeout(()=>{this.loadingController.dismiss()},100)})}}return g.\u0275fac=function(c){return new(c||g)(f.LFG(s.HT))},g.\u0275prov=f.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},5440:(A,_,a)=>{a.r(_),a.d(_,{CreateMoldingPageModule:()=>z});var p=a(6019),f=a(9133),s=a(1704),h=a(4382),g=a(3736),u=a(4762),c=a(3050),e=a(3668),Z=a(9922),T=a(6188);let b=(()=>{class o{constructor(){}getCoreByBatchNumber(t){return new Promise((n,i)=>{let l=t.substring(5).split("~");console.log(l),l={partNumber:l[0],batch1:l[1],batch2:l[2]};const d={idCore:1,batchNumber:l};console.log(d),n(d)})}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),y=(()=>{class o{constructor(t,n,i){this.kitService=t,this.toolService=n,this.coreService=i}getScanInput(t){return console.log(t),new Promise((n,i)=>{const l=new RegExp("^([0-9]){8}-[0-9]$"),d=new RegExp("^OT([0-9]){6}$"),v=new RegExp("^]C201");t.match(l)?(console.log("kit"),this.kitService.getKitById(t).then(m=>{n(m)},()=>{i()})):t.match(d)?(console.log("tool"),t.startsWith("OT0")&&(t=t.substr(3)),this.toolService.getToolByToolNumber(t).then(m=>{n(m)},()=>{i()}).catch(()=>{console.error("catch get molding Tool ")})):t.match(v)?this.coreService.getCoreByBatchNumber(t).then(m=>{n(m)}):i()})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(Z.e),e.LFG(T.o),e.LFG(b))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var M=a(7143),S=a(8190),k=a(6607),x=a(5243);const P=["scanInput"],U=["scanButton"],q=["kitPanel"];function I(o,r){1&o&&(e.TgZ(0,"ion-text",25),e._uU(1,"(Drap)"),e.qZA())}function N(o,r){1&o&&(e.TgZ(0,"ion-text",25),e._uU(1,"(Pol)"),e.qZA())}function O(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label",22),e._uU(2),e.YNc(3,I,2,0,"ion-text",39),e.YNc(4,N,2,0,"ion-text",39),e.qZA(),e.TgZ(5,"ion-label",22),e._uU(6),e.qZA(),e.TgZ(7,"ion-label"),e._uU(8),e.qZA(),e.TgZ(9,"ion-label",40),e._uU(10),e.ALo(11,"date"),e.qZA(),e.TgZ(12,"ion-label",40),e._uU(13),e.ALo(14,"date"),e.qZA(),e.TgZ(15,"ion-label",40),e._uU(16),e.ALo(17,"date"),e.qZA(),e.TgZ(18,"ion-button",41),e.NdJ("click",function(){const l=e.CHM(t).index;return e.oxw(3).removeKit(l)}),e._UZ(19,"ion-icon",42),e.qZA(),e.qZA()}if(2&o){const t=r.$implicit,n=e.oxw(3);e.xp6(2),e.hij("",t.referenceSAP," "),e.xp6(1),e.Q6J("ngIf",t===n.molding.matDrap),e.xp6(1),e.Q6J("ngIf",t===n.molding.matPolym),e.xp6(2),e.Oqu(t.idMM),e.xp6(2),e.Oqu(t.designationSAP),e.xp6(1),e.Q6J("color",n.kitService.isPerim(t.peremptionMoins18,n.molding.moldingDay)?"danger":"dark"),e.xp6(1),e.Oqu(e.xi3(11,11,t.peremptionMoins18,"dd/MM/yyyy \xe0 HH:mm")),e.xp6(2),e.Q6J("color",n.kitService.isPerim(t.aDrapAv,n.molding.moldingDay)?"danger":"dark"),e.xp6(1),e.Oqu(e.xi3(14,14,t.aDrapAv,"dd/MM/yyyy \xe0 HH:mm")),e.xp6(2),e.Q6J("color",n.kitService.isPerim(t.aCuirAv,n.molding.moldingDay)?"danger":"dark"),e.xp6(1),e.Oqu(e.xi3(17,17,t.aCuirAv,"dd/MM/yyyy \xe0 HH:mm"))}}function E(o,r){if(1&o&&(e.TgZ(0,"ion-list",36),e.TgZ(1,"ion-list-header",37),e.TgZ(2,"ion-label",22),e._uU(3,"R\xe9f\xe9rence Sap"),e.qZA(),e.TgZ(4,"ion-label",22),e._uU(5,"ID-MM"),e.qZA(),e.TgZ(6,"ion-label"),e._uU(7,"D\xe9signation"),e.qZA(),e.TgZ(8,"ion-label"),e._uU(9,"P\xe9remption \xe0 -18\xb0C"),e.qZA(),e.TgZ(10,"ion-label"),e._uU(11,"A draper avant le"),e.qZA(),e.TgZ(12,"ion-label"),e._uU(13,"A cuire avant le"),e.qZA(),e.qZA(),e.YNc(14,O,20,20,"ion-item",38),e.qZA()),2&o){const t=e.oxw(2);e.xp6(14),e.Q6J("ngForOf",t.molding.kits)}}function B(o,r){if(1&o&&(e.TgZ(0,"mat-expansion-panel",32,33),e.TgZ(2,"mat-expansion-panel-header"),e.TgZ(3,"mat-panel-title"),e.TgZ(4,"ion-title",34),e._uU(5," List des Kits"),e.qZA(),e.qZA(),e._UZ(6,"mat-panel-description"),e.qZA(),e.YNc(7,E,15,1,"ion-list",35),e.qZA()),2&o){const t=e.oxw();e.Q6J("expanded",t.molding.kits.length>0),e.xp6(7),e.Q6J("ngIf",null==t.molding?null:t.molding.kits)}}function D(o,r){if(1&o&&(e.TgZ(0,"ion-label"),e._uU(1),e.qZA()),2&o){const t=r.$implicit;e.xp6(1),e.hij(" ",t.batchNumber.batch2," ")}}function L(o,r){if(1&o&&(e.TgZ(0,"mat-expansion-panel"),e.TgZ(1,"mat-expansion-panel-header"),e.TgZ(2,"mat-panel-title"),e._uU(3," Liste des nidas "),e.qZA(),e.TgZ(4,"mat-panel-description"),e._uU(5," Liste des nidas "),e.qZA(),e.qZA(),e.TgZ(6,"ion-list"),e.TgZ(7,"ion-item"),e.YNc(8,D,2,1,"ion-label",38),e.qZA(),e.qZA(),e.qZA()),2&o){const t=e.oxw();e.xp6(8),e.Q6J("ngForOf",t.molding.cores)}}const J=[{path:"",component:(()=>{class o{constructor(t,n,i,l,d,v,m,G,Y,H,w,K){this.scanService=t,this.moldingService=n,this.alertController=i,this.kitService=l,this.router=d,this.navCtrl=v,this.loadingService=m,this.loadingController=G,this.activatedRoute=Y,this.toastController=H,this.authService=w,this.alertService=K,this.expanded=!1,this.molding={id:null,cores:[],kits:[],moldingDay:new Date,outillage:null,createdBy:null},console.log("test");const C=this.activatedRoute.snapshot.paramMap.get("id");C&&this.loadMoldingData(C)}loadMoldingData(t){return(0,u.mG)(this,void 0,void 0,function*(){const n=yield this.loadingController.create({cssClass:"my-custom-class",message:"Patienter pendant le chargement du moulage"});this.moldingService.getMoldingById(t).then(i=>{this.molding=i,this.moldingService.updateDates(this.molding),this.molding.updatedAt=new Date,console.log(this.molding),n.dismiss()})})}ngAfterViewInit(){this.scanButtonText="SCAN INACTIF",this.scanButton.color="danger",this.scanService.scanState=!1,console.log("after view init",this.scanButton)}ngOnInit(){console.log("init")}associateToolClick(){this.associateToolAlertPrompt()}associateCoreClick(){this.alertService.simpleAlert("Message d'information","Fonction inactive","La fonction permettra de lier un nida au moulage")}associateToolAlertPrompt(){return(0,u.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Associer l'outillage de moulage",inputs:[{name:"toolNumber",type:"text",placeholder:"Scannez l'outillage",tabindex:1,id:"toolNumberInput"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"ion-color-secondary",handler:n=>{console.log("Confirm Cancel",n)}},{text:"Valider",cssClass:["ion-color-primary","button","button-solid"],handler:n=>{}}]})).present().then(()=>{const n=document.getElementById("toolNumberInput");n&&n.focus()})})}switchScanState(){this.scanService.scanState=!this.scanService.scanState,this.scanService.scanState&&this.scanInput.setFocus()}inputOnBlur(){this.scanButton.color="danger",this.scanButtonText="SCAN INACTIF",this.scanService.scanState=!1}inputOnFocus(){this.scanButton.color="success",this.scanButtonText="SCAN ACTIF",this.scanService.scanState=!0}onInputChange(t){this.loadingService.startLoading("Patienter pendant le chargement du kit"),this.scanService.getScanInput(t).then(n=>{console.log(n),Object.getOwnPropertyNames(n).includes("idMM")?this.kitService.kitIsInKits(n,this.molding.kits)?(this.presentToast("Le kit a d\xe9j\xe0 \xe9t\xe9 scann\xe9"),console.log("kit en doublon")):(this.molding.kits.unshift(n),this.moldingService.updateDates(this.molding)):Object.getOwnPropertyNames(n).includes("sapToolNumber")?(this.molding.outillage=n,this.presentToast("Outillage associ\xe9 !")):Object.getOwnPropertyNames(n).includes("idCore")&&(this.presentToast("Nida Ajout\xe9 !"),this.molding.cores.unshift(n))}).catch(()=>{console.error("Catch get scan input")}).finally(()=>{this.loadingService.stopLoading().then(()=>{setTimeout(()=>{this.switchScanState(),this.scanInput.value=""},1e3)})})}removeKit(t){try{this.molding.kits.splice(t,1),console.log(`Kit removed ${t}`),this.moldingService.updateDates(this.molding)}catch(n){console.error(n)}}saveMoldingClick(){this.saveMolding().then(()=>{console.log("Kit sauvegard\xe9. Voulez-vous imprimer ?"),this.presentAlertConfirm()},()=>{this.saveMoldingErrorAlert()})}saveMolding(){return new Promise((t,n)=>{this.checkMoldingDatas().then(i=>{console.log("le moulage \xe0 le statut : ",i),i?(this.molding.createdBy=this.authService.authUser,null===this.molding.id?this.moldingService.saveMolding(this.moldingService.toIri(this.molding)).then(l=>{this.molding=this.moldingService.moldingServerToMoldingObject(l),console.log("tout est OK le moulage est sauvegard\xe9",this.molding),t()},()=>{console.log("tout n'est pas Ok la sauvegarde a \xe9chou\xe9e"),n()}):this.moldingService.updateMolding(this.moldingService.toIri(this.molding)).then(l=>{this.molding=l,console.log("tout est OK le moulage est mis \xe0 jour"),t()},()=>{this.alertService.simpleAlert("Message d'erreur","Sauvegarde \xe9chou\xe9e !","La sauvegarde ne sest pas correctement effectu\xe9e. Veuillez recommencer"),console.error("tout n'est pas Ok la mise \xe0 jour du moulage a \xe9chou\xe9e"),n()})):(console.error("sauvegarde abandonn\xe9e"),n())})})}checkMoldingDatas(){return new Promise((t,n)=>{null===this.molding.outillage?(console.log("le moulage n'a pas d'outillage associ\xe9. Voulez-vous continuer sans outillage ?"),this.presentAlertToolMissing().then(i=>{i?(console.log("onResolve : Je veux continuer sans outillage",i),t(!0)):(console.log("onResolve : Je ne veux pas continuer sans outillage",i),t(!1))},i=>{const l="Les donn\xe9es nont pas pu \xeatre contr\xf4l\xe9es. OU Il n'y a pas eu de r\xe9ponse de l'utilisateur";console.log(l,i),n(l)})):0===this.molding.kits.length?(console.log("onResolve : Il n'y a pas de kit"),t(!1)):t(!0)})}presentAlertConfirm(){return(0,u.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Enregistrement effectu\xe9",message:"Voulez-vous imprimer la fiche ?",buttons:[{text:"Non",role:"cancel",cssClass:["ion-color-primary","ion-button"],id:"cancel-button",handler:()=>{console.log("Confirm Cancel: blah")}},{text:"Oui",id:"confirm-button",cssClass:"ion-color-danger",handler:()=>{this.printMolding()}}]})).present()})}presentAlertToolMissing(){return new Promise((t,n)=>{this.alertController.create({cssClass:"my-custom-class",header:"Alerte",message:"L'outillage de moulage n'est pas associ\xe9. voulez-vous continuer sans outillage ?",buttons:[{text:"Non",role:"cancel",cssClass:["ion-color-primary","ion-button"],id:"cancel-button",handler:()=>{console.log("Response false"),t(!1)}},{text:"Oui",id:"confirm-button",cssClass:"ion-color-danger",handler:()=>{console.log("Response true"),t(!0)}}]}).then(i=>{i.present()})})}printMolding(){console.log(this.molding),this.router.navigate(["/printMolding",this.molding.id])}printMoldingClick(){this.saveMolding().then(()=>{this.printMolding()})}wrongKitInputAlert(){return(0,u.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:"Erreur Kit",subHeader:"Kit non conforme",message:"Il semble y avoir un probl\xe8me avec le kit scann\xe9. V\xe9rifier le kit et essayer de nouveau.",buttons:["OK"]});yield t.present(),yield t.onDidDismiss()})}saveMoldingErrorAlert(){return(0,u.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:"Erreur de sauvegarde",subHeader:"Le moulage n'a pas \xe9t\xe9 sauvegard\xe9",message:"Veuillez r\xe9-essayer",buttons:["OK"]});yield t.present(),yield t.onDidDismiss()})}presentToast(t){return(0,u.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:t,duration:1e3,position:"bottom",translucent:!0,animated:!0})).present()})}kitAlertPrompt(){return(0,u.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Scannez un kit",inputs:[{name:"kitnumber",type:"text",placeholder:"Scannez le kit",tabindex:1,id:"kitNumberInput"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"ion-color-secondary",handler:n=>{console.log("Confirm Cancel",n)}},{text:"Valider",cssClass:["ion-color-primary","button","button-solid"],handler:n=>{}}]})).present().then(()=>{})})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(y),e.Y36(M.s),e.Y36(s.Br),e.Y36(Z.e),e.Y36(h.F0),e.Y36(s.SH),e.Y36(S.b),e.Y36(s.HT),e.Y36(h.gz),e.Y36(s.yF),e.Y36(k.e),e.Y36(x.c))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-create-molding"]],viewQuery:function(t,n){if(1&t&&(e.Gf(P,5),e.Gf(U,5),e.Gf(c.pp,5),e.Gf(q,5)),2&t){let i;e.iGM(i=e.CRH())&&(n.scanInput=i.first),e.iGM(i=e.CRH())&&(n.scanButton=i.first),e.iGM(i=e.CRH())&&(n.accordion=i.first),e.iGM(i=e.CRH())&&(n.kitPanel=i.first)}},decls:56,vars:14,consts:[["color","medium",3,"fullscreen"],["color","light",1,"ion-hide-md-down"],["slot","start","size","small","fill","solid","size","default",3,"click"],["scanButton",""],["slot","start","type","text","placeholder","Id du composant",3,"change","focusout","focusin"],["scanInput",""],["size","small","slot","start","fill","clear","size","default",3,"click"],["slot","start","name","link-outline"],["size","small","slot","start","disabled","false","fill","clear","size","default",3,"click"],["size","small","slot","end",3,"click"],["multi","",1,"example-headers-align"],[3,"expanded",4,"ngIf"],[4,"ngIf"],["slot","bottom",1,"ion-hide-md-up"],["tab","schedule"],["name","link"],["tab","speakers",3,"click"],["name","scan"],["tab","map"],["name","print"],["tab","about",3,"click"],["name","save"],[1,"ion-hide-md-down"],[1,"ion-space-between"],["lines","none"],[1,"strong"],["color","light"],["slot","end","collapse","true"],["slot","end","fill","clear",3,"click"],["slot","start","name","save-outline"],["slot","end","fill","solid","color","primary",3,"click"],["slot","start","name","print-outline"],[3,"expanded"],["kitPanel",""],["color","primary"],["class","ion-no-padding",4,"ngIf"],[1,"ion-no-padding"],["lines","inset","color","light"],[4,"ngFor","ngForOf"],["class","strong",4,"ngIf"],[3,"color"],[1,"ion-hide-md-down",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(t,n){if(1&t){const i=e.EpF();e.TgZ(0,"ion-content",0),e.TgZ(1,"ion-toolbar",1),e.TgZ(2,"ion-button",2,3),e.NdJ("click",function(){return n.switchScanState()}),e._uU(4),e.qZA(),e.TgZ(5,"ion-input",4,5),e.NdJ("change",function(){e.CHM(i);const d=e.MAs(6);return n.onInputChange(d.value.toString())})("focusout",function(){return n.inputOnBlur()})("focusin",function(){return n.inputOnFocus()}),e.qZA(),e.TgZ(7,"ion-button",6),e.NdJ("click",function(){return n.associateToolClick()}),e._UZ(8,"ion-icon",7),e._uU(9," OUTILLAGE "),e.qZA(),e.TgZ(10,"ion-button",8),e.NdJ("click",function(){return n.associateCoreClick()}),e._UZ(11,"ion-icon",7),e._uU(12," NIDA "),e.qZA(),e.TgZ(13,"ion-button",9),e.NdJ("click",function(){return(n.expanded=!n.expanded)?n.accordion.openAll():n.accordion.closeAll()}),e._uU(14),e.qZA(),e.qZA(),e.TgZ(15,"mat-accordion",10),e.YNc(16,B,8,2,"mat-expansion-panel",11),e.YNc(17,L,9,1,"mat-expansion-panel",12),e.qZA(),e.qZA(),e.TgZ(18,"ion-tab-bar",13),e.TgZ(19,"ion-tab-button",14),e._UZ(20,"ion-icon",15),e.TgZ(21,"ion-label"),e._uU(22,"Outillage"),e.qZA(),e.TgZ(23,"ion-badge"),e._uU(24,"6"),e.qZA(),e.qZA(),e.TgZ(25,"ion-tab-button",16),e.NdJ("click",function(){return n.kitAlertPrompt()}),e._UZ(26,"ion-icon",17),e.TgZ(27,"ion-label"),e._uU(28,"Scan kit"),e.qZA(),e.qZA(),e.TgZ(29,"ion-tab-button",18),e._UZ(30,"ion-icon",19),e.TgZ(31,"ion-label"),e._uU(32,"Imprimer"),e.qZA(),e.qZA(),e.TgZ(33,"ion-tab-button",20),e.NdJ("click",function(){return n.saveMoldingClick()}),e._UZ(34,"ion-icon",21),e.TgZ(35,"ion-label"),e._uU(36,"Sauvegarder"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(37,"ion-footer",22),e.TgZ(38,"ion-toolbar",23),e.TgZ(39,"ion-item",24),e.TgZ(40,"ion-label"),e._uU(41),e.qZA(),e.TgZ(42,"ion-label",25),e._uU(43),e.ALo(44,"date"),e.qZA(),e.TgZ(45,"ion-label",25),e._uU(46),e.ALo(47,"date"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(48,"ion-toolbar",26),e.TgZ(49,"ion-buttons",27),e.TgZ(50,"ion-button",28),e.NdJ("click",function(){return n.saveMoldingClick()}),e._UZ(51,"ion-icon",29),e._uU(52," SAUVEGARDER "),e.qZA(),e.TgZ(53,"ion-button",30),e.NdJ("click",function(){return n.printMoldingClick()}),e._UZ(54,"ion-icon",31),e._uU(55," IMPRIMER "),e.qZA(),e.qZA(),e.qZA(),e.qZA()}2&t&&(e.Q6J("fullscreen",!0),e.xp6(4),e.hij(" ",n.scanButtonText," "),e.xp6(10),e.Oqu(n.expanded?"Replier tout":"D\xe9velopper tout"),e.xp6(2),e.Q6J("ngIf",(null==n.molding.kits?null:n.molding.kits.length)>0),e.xp6(1),e.Q6J("ngIf",(null==n.molding.cores?null:n.molding.cores.length)>0),e.xp6(24),e.hij("Outillage : ",null==n.molding||null==n.molding.outillage?null:n.molding.outillage.sapToolNumber,""),e.xp6(2),e.hij("A draper avant le : ",e.xi3(44,8,null==n.molding?null:n.molding.aDraperAv,"dd/MM/yyyy \xe0 HH:mm"),""),e.xp6(3),e.hij("A cuire avant le : ",e.xi3(47,11,null==n.molding?null:n.molding.aCuireAv,"dd/MM/yyyy \xe0 HH:mm"),""))},directives:[s.W2,s.sr,s.YG,s.pK,s.j9,s.gu,c.pp,p.O5,s.yq,s.ZU,s.Q$,s.yp,s.fr,s.Ie,s.Sm,c.ib,c.yz,c.yK,s.wd,c.u4,s.q_,s.yh,p.sg,s.yW],pipes:[p.uU],styles:[""]}),o})(),canActivate:[g.a]}];let R=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[h.Bz.forChild(J)],h.Bz]}),o})();var F=a(5523);let z=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[p.ez,f.u5,s.Pc,R,F.A,c.To]]}),o})()}}]);