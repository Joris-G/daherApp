"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8227],{9172:(T,g,r)=>{r.d(g,{b:()=>v});var d=r(655),l=r(5e3),o=r(3349);let v=(()=>{class a{constructor(s){this.loadingController=s}startLoading(s){this.loadingController.create({cssClass:"my-custom-class",message:s}).then(p=>{p.present()})}stopLoading(){return(0,d.mG)(this,void 0,void 0,function*(){setTimeout(()=>{this.loadingController.dismiss()},100)})}}return a.\u0275fac=function(s){return new(s||a)(l.LFG(o.HT))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},8627:(T,g,r)=>{r.d(g,{W:()=>v});var d=r(2340),l=r(5e3),o=r(8219);let v=(()=>{class a{constructor(s){this.requestService=s}getPrograms(){return this.requestService.createGetRequest(d.N.usineApi+"programme_avions")}getIri(s){return"string"==typeof s?s:`/api/programme_avions/${s.id}`}}return a.\u0275fac=function(s){return new(s||a)(l.LFG(o.s))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},181:(T,g,r)=>{r.d(g,{N:()=>a});var d=r(2340),l=r(5e3),o=r(8219);let a=(()=>{class e{constructor(p){this.requestService=p}getRoles(){return this.requestService.createGetRequest(d.N.usineApi+"postes")}getIri(p){return"string"==typeof p?p:`/api/postes/${p.id}`}}return e.\u0275fac=function(p){return new(p||e)(l.LFG(o.s))},e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},4337:(T,g,r)=>{r.d(g,{z:()=>v});var d=r(2340),l=r(5e3),o=r(8219);let v=(()=>{class a{constructor(s){this.requestService=s}getServices(){return this.requestService.createGetRequest(d.N.usineApi+"services")}getIri(s){return"string"==typeof s?s:`/api/services/${s.id}`}}return a.\u0275fac=function(s){return new(s||a)(l.LFG(o.s))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},7847:(T,g,r)=>{r.d(g,{W:()=>v});var d=r(2340),l=r(5e3),o=r(8219);let v=(()=>{class a{constructor(s){this.requestService=s}getUnites(){return this.requestService.createGetRequest(d.N.usineApi+"divisions")}getIri(s){return"string"==typeof s?s:`/api/services/${s.id}`}}return a.\u0275fac=function(s){return new(s||a)(l.LFG(o.s))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},1377:(T,g,r)=>{r.d(g,{f:()=>y});var d=r(655),l=r(2340),o=r(5e3),v=r(8219),a=r(181),e=r(4337),s=r(8627),p=r(7847);let C=(()=>{class m{constructor(){}getIri(i){return"string"==typeof i?i:`/api/services/${i.id}`}}return m.\u0275fac=function(i){return new(i||m)},m.\u0275prov=o.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})(),y=(()=>{class m{constructor(i,U,P,A,S,Z){this.requestService=i,this.roleService=U,this.serviceService=P,this.programService=A,this.uniteService=S,this.usineService=Z}getUserById(i){return this.requestService.createGetRequest(l.N.usineApi+`users/${i}`)}getUsers(i){return this.requestService.createGetRequest(l.N.usineApi+"users")}registerUser(i){return this.requestService.createPostRequest(l.N.usineApi+"users",i)}getIri(i){return"string"==typeof i?i:`/api/users/${i.id}`}getGroups(){return this.requestService.createGetRequest(l.N.usineApi+"groupe_affectations")}createGroup(i){return this.requestService.createPostRequest(l.N.usineApi+"groupe_affectations",i)}updateUser(i){const U={matricule:i.matricule,nom:i.nom,prenom:i.prenom,poste:this.roleService.getIri(i.poste),service:this.serviceService.getIri(i.service),programmeAvion:i.programmeAvion.map(P=>this.programService.getIri(P)),unite:this.uniteService.getIri(i.unite),site:this.usineService.getIri(i.site)};return this.requestService.createPutRequest(l.N.usineApi+`users/${i.id}`,U)}addUserToGroup(i){return new Promise((U,P)=>(0,d.mG)(this,void 0,void 0,function*(){for(const A of i.groupeAffectations){const S={libelle:A.libelle,population:A.population.map(Z=>this.getIri(Z))};S.population.push(this.getIri(i)),yield this.requestService.createPatchRequest(l.N.usineApi+"groupe_affectations/"+A.id+"/addUsers",{population:S.population}).then(Z=>{i.groupeAffectations=Z})}U(i)}))}getUsersByService(i){return this.requestService.createGetRequest(l.N.usineApi+`services/${i}`)}deleteUser(i){return this.requestService.createDeleteRequest(l.N.usineApi+`users/${i}`)}}return m.\u0275fac=function(i){return new(i||m)(o.LFG(v.s),o.LFG(a.N),o.LFG(e.z),o.LFG(s.W),o.LFG(p.W),o.LFG(C))},m.\u0275prov=o.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},8227:(T,g,r)=>{r.r(g),r.d(g,{AdminUserPageModule:()=>F});var d=r(9808),l=r(3075),o=r(3349),v=r(8555),a=r(9356),e=r(5e3),s=r(1377),p=r(9172),C=r(2853),h=r(8402);const y=["newUsers"];function m(t,c){1&t&&(e.TgZ(0,"th",18),e._uU(1," UserName "),e.qZA())}function D(t,c){if(1&t&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&t){const n=c.$implicit;e.xp6(1),e.hij(" ",n.id," ")}}function i(t,c){1&t&&(e.TgZ(0,"th",18),e._uU(1," UserName "),e.qZA())}function U(t,c){if(1&t&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&t){const n=c.$implicit;e.xp6(1),e.hij(" ",n.username," ")}}function P(t,c){1&t&&(e.TgZ(0,"th",18),e._uU(1," Nom "),e.qZA())}function A(t,c){if(1&t&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&t){const n=c.$implicit;e.xp6(1),e.hij(" ",n.nom," ")}}function S(t,c){1&t&&(e.TgZ(0,"th",18),e._uU(1," Pr\xe9nom "),e.qZA())}function Z(t,c){if(1&t&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&t){const n=c.$implicit;e.xp6(1),e.hij(" ",n.prenom," ")}}function I(t,c){1&t&&(e.TgZ(0,"th",18),e._uU(1," Matricule "),e.qZA())}function M(t,c){if(1&t&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&t){const n=c.$implicit;e.xp6(1),e.hij(" ",n.matricule," ")}}function q(t,c){1&t&&(e.TgZ(0,"th",18),e._uU(1," Mail "),e.qZA())}function N(t,c){if(1&t&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&t){const n=c.$implicit;e.xp6(1),e.hij(" ",n.mail," ")}}function x(t,c){1&t&&(e.TgZ(0,"th",18),e._uU(1," Roles "),e.qZA())}function L(t,c){if(1&t&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&t){const n=c.$implicit;e.xp6(1),e.hij(" ",n.roles," ")}}function O(t,c){1&t&&e._UZ(0,"th",18)}function B(t,c){if(1&t){const n=e.EpF();e.TgZ(0,"td",19),e.TgZ(1,"ion-button",20),e.NdJ("click",function(){const _=e.CHM(n).$implicit;return e.oxw().confirmUser(_,!0)}),e._uU(2," Valider "),e.qZA(),e.TgZ(3,"ion-button",21),e.NdJ("click",function(){const _=e.CHM(n).$implicit;return e.oxw().confirmUser(_,!1)}),e._uU(4," Rejeter "),e.qZA(),e.TgZ(5,"ion-button",20),e.NdJ("click",function(){const _=e.CHM(n).$implicit;return e.oxw().deleteUser(_)}),e._UZ(6,"ion-icon",22),e.qZA(),e.qZA()}}function G(t,c){1&t&&e._UZ(0,"tr",23)}function Y(t,c){1&t&&e._UZ(0,"tr",24)}const W=[{path:"",component:(()=>{class t{constructor(n,u,f,_){this.userService=n,this.datePipe=u,this.loadingService=f,this.alertService=_,this.displayedUserInactiveColumns=["id","username","nom","prenom","matricule","mail","roles","commands"],this.weeklyLabels=[],this.weeklyUsers=[]}ngOnInit(){this.userService.getUsers().then(n=>{this.users=n,this.weeklyLabels=this.createWeeklyLabel(),this.weeklyUsers=this.createWeeklyUserData(),console.log(this.weeklyLabels,this.weeklyUsers),this.lineChart=new a.Z(this.newUsersCanvas.nativeElement,{type:"line",data:{labels:this.weeklyLabels,datasets:[{label:"Evolution du nombre d'inscription",fill:!1,backgroundColor:"rgba(75,192,192,0.4)",borderColor:"rgba(75,192,192,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(75,192,192,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:this.weeklyUsers,spanGaps:!1}]}}),this.lineChart.update()})}confirmUser(n,u){console.log(n,u)}createWeeklyLabel(){const n=new Date,u=new Date(2022,0,1),f=[];for(;u<n;)f.push(this.datePipe.transform(u,"dd/MM")),u.setDate(u.getDate()+7);return f}createWeeklyUserData(){const n=new Date;let u=new Date(2022,0,1);const f=[];for(;u<n;){const _=new Date(u);_.setDate(_.getDate()+7),this.users.forEach(R=>{}),console.log(u,_),console.log(this.users);const $=this.users.filter(R=>new Date(R.createdAt)>u&&new Date(R.createdAt)<=_).length;f.push($),u=_}return f}deleteUser(n){this.loadingService.startLoading("Suppression de l'utilisateur"),this.userService.deleteUser(n.id).then(()=>{this.loadingService.stopLoading()}).catch(u=>{this.alertService.simpleAlert("Erreur","Suppression d'un utilisateur","Une erreur est survenue pendant la suppression de l'utilisateur. "+u.message),this.loadingService.stopLoading()})}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(s.f),e.Y36(d.uU),e.Y36(p.b),e.Y36(C.c))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-admin-user"]],viewQuery:function(n,u){if(1&n&&e.Gf(y,5),2&n){let f;e.iGM(f=e.CRH())&&(u.newUsersCanvas=f.first)}},decls:61,vars:3,consts:[["color","light"],["false",""],["size","8"],["mat-table","",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","username"],["matColumnDef","nom"],["matColumnDef","prenom"],["matColumnDef","matricule"],["matColumnDef","mail"],["matColumnDef","roles"],["matColumnDef","commands"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["size","4"],["newUsers",""],["mat-header-cell",""],["mat-cell",""],["size","small",3,"click"],["size","small","color","danger",3,"click"],["slot","icon-only","name","trash-outline"],["mat-header-row",""],["mat-row",""]],template:function(n,u){1&n&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-title"),e._uU(3,"Administration des utilisateurs"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"ion-content",0),e.TgZ(5,"ion-grid",1),e.TgZ(6,"ion-row"),e.TgZ(7,"ion-col",2),e.TgZ(8,"ion-card"),e.TgZ(9,"ion-card-header"),e.TgZ(10,"ion-card-subtitle"),e._uU(11,"Awesome Subtitle"),e.qZA(),e.TgZ(12,"ion-card-title"),e._uU(13,"Utilisateurs non valid\xe9"),e.qZA(),e.qZA(),e.TgZ(14,"ion-card-content"),e.TgZ(15,"table",3),e.ynx(16,4),e.YNc(17,m,2,0,"th",5),e.YNc(18,D,2,1,"td",6),e.BQk(),e.ynx(19,7),e.YNc(20,i,2,0,"th",5),e.YNc(21,U,2,1,"td",6),e.BQk(),e.ynx(22,8),e.YNc(23,P,2,0,"th",5),e.YNc(24,A,2,1,"td",6),e.BQk(),e.ynx(25,9),e.YNc(26,S,2,0,"th",5),e.YNc(27,Z,2,1,"td",6),e.BQk(),e.ynx(28,10),e.YNc(29,I,2,0,"th",5),e.YNc(30,M,2,1,"td",6),e.BQk(),e.ynx(31,11),e.YNc(32,q,2,0,"th",5),e.YNc(33,N,2,1,"td",6),e.BQk(),e.ynx(34,12),e.YNc(35,x,2,0,"th",5),e.YNc(36,L,2,1,"td",6),e.BQk(),e.ynx(37,13),e.YNc(38,O,1,0,"th",5),e.YNc(39,B,7,0,"td",6),e.BQk(),e.YNc(40,G,1,0,"tr",14),e.YNc(41,Y,1,0,"tr",15),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(42,"ion-col",16),e.TgZ(43,"ion-card"),e.TgZ(44,"ion-card-header"),e.TgZ(45,"ion-card-title"),e._uU(46,"Tableau de bord"),e.qZA(),e.qZA(),e.TgZ(47,"ion-card-content"),e.TgZ(48,"ion-card"),e.TgZ(49,"ion-card-header"),e.TgZ(50,"ion-card-subtitle"),e._uU(51,"Nouveaux inscrits"),e.qZA(),e.qZA(),e.TgZ(52,"ion-card-content"),e._UZ(53,"canvas",null,17),e.qZA(),e.qZA(),e.TgZ(55,"ion-card"),e.TgZ(56,"ion-card-header"),e.TgZ(57,"ion-card-subtitle"),e._uU(58,"Nombre de connexions par jour"),e.qZA(),e.qZA(),e.TgZ(59,"ion-card-content"),e._uU(60," GRAPHIQUE ICI "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(15),e.Q6J("dataSource",u.users),e.xp6(25),e.Q6J("matHeaderRowDef",u.displayedUserInactiveColumns),e.xp6(1),e.Q6J("matRowDefColumns",u.displayedUserInactiveColumns))},directives:[o.Gu,o.sr,o.wd,o.W2,o.jY,o.Nd,o.wI,o.PM,o.Zi,o.tO,o.Dq,o.FN,h.BZ,h.w1,h.fO,h.Dz,h.as,h.nj,h.ge,h.ev,o.YG,o.gu,h.XQ,h.Gk],styles:["mat-cell[_ngcontent-%COMP%]{padding:100px!important}"]}),t})()}];let w=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[v.Bz.forChild(W)],v.Bz]}),t})(),F=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[d.uU],imports:[[d.ez,l.u5,o.Pc,w,h.p0]]}),t})()}}]);