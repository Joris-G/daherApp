"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1109],{4655:(T,f,t)=>{t.d(f,{W:()=>P});var h=t(8260),s=t(3668),l=t(3521);let P=(()=>{class u{constructor(a){this.requestService=a}getPrograms(){return this.requestService.createGetRequest(h.N.usineApi+"programme_avions")}getIri(a){return"string"==typeof a?a:`/api/programme_avions/${a.id}`}}return u.\u0275fac=function(a){return new(a||u)(s.LFG(l.s))},u.\u0275prov=s.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},3580:(T,f,t)=>{t.d(f,{C:()=>A});var h=t(4762),s=t(8260),l=t(3668),P=t(3521),u=t(6188),e=t(7914),a=t(6607);let A=(()=>{class c{constructor(n,i,d,o){this.requestService=n,this.toolService=i,this.userService=d,this.authService=o}getType(n){return"string"==typeof n?n:n.controle?"controle":n.maintenance?"maintenance":void 0}createToolRequest(n){return this.requestService.createPostRequest(s.N.toolApi+"demandes",n)}createControlRequest(n){var i;const d={id:null!==(i=n.id)&&void 0!==i?i:null,outillage:n.outillage?this.toolService.getIri(n.outillage):"",dateBesoin:n.dateBesoin,userCreat:this.userService.getIri(this.authService.authUser),refPlan:n.refPlan,indPlan:n.indPlan,cheminCAO:n.cheminCAO,description:n.description,detailsControle:n.detailsControle,tolerances:n.tolerances,dispoOut:n.dispoOut,ligneBudgetaire:n.ligneBudgetaire,typeRapport:n.typeRapport};return this.requestService.createPostRequest(s.N.toolApi+"controles",d)}createAllMaintenaceItems(n){const i=[];return new Promise((d,o)=>{n.itemActionCorrective.forEach(p=>{this.requestService.createPostRequest(s.N.toolApi+"maintenance_items",p).then(E=>{i.push(`/api/maintenance_items/${E.id}`),console.log(i.length,n.itemActionCorrective.length),i.length===n.itemActionCorrective.length&&d(i)})})})}createMaintenanceRequest(n){return new Promise((i,d)=>{this.createAllMaintenaceItems(n).then(o=>{var p;console.log(o);const E={id:null!==(p=n.id)&&void 0!==p?p:null,outillage:n.outillage?this.toolService.getIri(n.outillage):"",dateBesoin:n.dateBesoin,userCreat:this.userService.getIri(this.authService.authUser),rep:n.rep,itemActionCorrective:o};console.log(E),this.requestService.createPostRequest(s.N.toolApi+"maintenances",E).then(S=>{i(S)})})})}updateRequest(n){const i={statut:n.statut,createdAt:n.createdAt,id:n.id};return this.requestService.createPutRequest(s.N.toolApi+"demandes/"+i.id,i)}updateControlRequest(n){var i;const d={id:null!==(i=n.controle.id)&&void 0!==i?i:null,outillage:n.controle.outillage?this.toolService.getIri(n.controle.outillage):"",dateBesoin:n.dateBesoin,userCreat:this.userService.getIri(n.controle.demandeur),refPlan:n.controle.refPlan,indPlan:n.controle.indPlan,cheminCAO:n.controle.cheminCAO,description:n.controle.description,detailsControle:n.controle.detailsControle,tolerances:n.controle.tolerances,dispoOut:n.controle.dispoOut,ligneBudgetaire:n.controle.ligneBudgetaire,interventionDate:n.controle.interventionDate,moyenMesure:n.controle.moyenMesure,infosComplementaire:n.controle.infosComplementaire,visaControleur:n.controle.visaControleur,typeRapport:n.controle.typeRapport};return console.log(d),this.requestService.createPutRequest(s.N.toolApi+"controles/"+d.id,d)}updateMaintenanceItems(n){return(0,h.mG)(this,void 0,void 0,function*(){const i=n.map(d=>d.id?this.requestService.createPutRequest(s.N.toolApi+"maintenance_items/"+d.id,d):this.requestService.createPostRequest(s.N.toolApi+"maintenance_items",d));return Promise.all(i)})}updateMainteanceRequest(n){return new Promise((i,d)=>{this.updateMaintenanceItems(n.maintenance.itemActionCorrective).then(o=>{var p;n.maintenance.itemActionCorrective=o,console.log(n.maintenance.itemActionCorrective);const E=n.maintenance.itemActionCorrective.map(R=>"/api/maintenance_items/"+R.id),S={id:null!==(p=n.maintenance.id)&&void 0!==p?p:null,outillage:n.maintenance.outillage?this.toolService.getIri(n.maintenance.outillage):"",dateBesoin:n.dateBesoin,userCreat:this.userService.getIri(n.maintenance.userCreat),itemActionCorrective:E};console.log(S),i(this.requestService.createPutRequest(s.N.toolApi+"maintenances/"+S.id,S))})})}getToolRequest(n){return this.requestService.createGetRequest(s.N.toolApi+"demandes/"+n)}getToolRequests(){return this.requestService.createGetRequest(s.N.toolApi+"demandes")}getControl(n){return this.requestService.createGetRequest(s.N.toolApi+"controles/"+n)}getMaintenance(n){return this.requestService.createGetRequest(s.N.toolApi+"maintenances/"+n)}removeRequest(n){return new Promise((i,d)=>{this.requestService.createDeleteRequest("demandes/"+n.id)})}}return c.\u0275fac=function(n){return new(n||c)(l.LFG(P.s),l.LFG(u.o),l.LFG(e.f),l.LFG(a.e))},c.\u0275prov=l.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},6188:(T,f,t)=>{t.d(f,{o:()=>e});var h=t(4522),s=t(8260),l=t(3668),P=t(3521),u=t(5243);let e=(()=>{class a{constructor(c,m,n){this.http=c,this.requestService=m,this.alertService=n}getToolByInput(c){return new Promise((m,n)=>{switch(c.length){case 5:this.getToolByToolNumber(c).then(i=>{m(i)},i=>{this.alertService.simpleAlert("Erreur","Le serveur outillage \xe0 renvoy\xe9 une erreur :",i),n()}).catch(i=>{console.error(i)});break;case 7:break;case 8:c.startsWith("OT")&&this.getToolByToolNumber(c.substring(c.length-5)).then(i=>{m(i)},i=>{this.alertService.simpleAlert("Erreur","Le serveur outillage \xe0 renvoy\xe9 une erreur :",i),n()}).catch(i=>{console.error(i)});break;default:this.getToolByIdentification(c).then(i=>{m(i)},i=>{this.alertService.simpleAlert("Erreur","Le serveur outillage \xe0 renvoy\xe9 une erreur :",i),n()}).catch(i=>{console.error(i)})}})}getToolById(c){return this.requestService.createGetRequest(`${s.N.toolApi}tools/${c}`)}getToolByToolNumber(c){return new Promise((m,n)=>{this.requestService.createGetRequest(`${s.N.toolApi}tools?sapToolNumber=${c}`).then(i=>{1===i.length?m(i[0]):n(i.length>1?"Il y a plus d'un outillage correspondant en base de donn\xe9e":"aucun outillage trouv\xe9")},i=>{console.log(i),n("Pas de r\xe9ponse du serveur")})})}getToolByIdentification(c){return new Promise((m,n)=>{this.requestService.createGetRequest(`${s.N.toolApi}tools?identification=${c}`).then(i=>{1===i.length?m(i[0]):n(i.length>1?"Il y a plus d'un outillage correspondant en base de donn\xe9e":"aucun outillage trouv\xe9")},i=>{console.log(i),n("Pas de r\xe9ponse du serveur")})})}getAllTools(){return new Promise((c,m)=>{const n=(new h.WM).append("content-type","application/json");this.http.get(`${s.N.apiServer}molding_tools`,{headers:n}).subscribe(i=>{c(i)},i=>{console.log(i),m()})})}getIri(c){return`/api/tools/${c.id}`}createTool(c){const m=c;return m.sapToolNumber=parseInt(c.sapToolNumber.substring(2),10),this.requestService.createPostRequest(s.N.toolApi+"tools",m)}}return a.\u0275fac=function(c){return new(c||a)(l.LFG(h.eN),l.LFG(P.s),l.LFG(u.c))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},9104:(T,f,t)=>{t.d(f,{N:()=>u});var h=t(8260),s=t(3668),l=t(3521);let u=(()=>{class e{constructor(A){this.requestService=A}getRoles(){return this.requestService.createGetRequest(h.N.usineApi+"postes")}getIri(A){return"string"==typeof A?A:`/api/postes/${A.id}`}}return e.\u0275fac=function(A){return new(A||e)(s.LFG(l.s))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},4552:(T,f,t)=>{t.d(f,{z:()=>P});var h=t(8260),s=t(3668),l=t(3521);let P=(()=>{class u{constructor(a){this.requestService=a}getServices(){return this.requestService.createGetRequest(h.N.usineApi+"services")}getIri(a){return"string"==typeof a?a:`/api/services/${a.id}`}}return u.\u0275fac=function(a){return new(a||u)(s.LFG(l.s))},u.\u0275prov=s.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},2236:(T,f,t)=>{t.d(f,{W:()=>P});var h=t(8260),s=t(3668),l=t(3521);let P=(()=>{class u{constructor(a){this.requestService=a}getUnites(){return this.requestService.createGetRequest(h.N.usineApi+"divisions")}getIri(a){return"string"==typeof a?a:`/api/services/${a.id}`}}return u.\u0275fac=function(a){return new(a||u)(s.LFG(l.s))},u.\u0275prov=s.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},7914:(T,f,t)=>{t.d(f,{f:()=>n});var h=t(4762),s=t(8260),l=t(3668),P=t(3521),u=t(9104),e=t(4552),a=t(4655),A=t(2236);let c=(()=>{class i{constructor(){}getIri(o){return"string"==typeof o?o:`/api/services/${o.id}`}}return i.\u0275fac=function(o){return new(o||i)},i.\u0275prov=l.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),n=(()=>{class i{constructor(o,p,E,S,R,O){this.requestService=o,this.roleService=p,this.serviceService=E,this.programService=S,this.uniteService=R,this.usineService=O}getUserById(o){return this.requestService.createGetRequest(s.N.usineApi+`users/${o}`)}getUsers(o){return this.requestService.createGetRequest(s.N.usineApi+"users")}registerUser(o){return this.requestService.createPostRequest(s.N.usineApi+"users",o)}getIri(o){return"string"==typeof o?o:`/api/users/${o.id}`}getGroups(){return this.requestService.createGetRequest(s.N.usineApi+"groupe_affectations")}createGroup(o){return this.requestService.createPostRequest(s.N.usineApi+"groupe_affectations",o)}updateUser(o){const p={matricule:o.matricule,nom:o.nom,prenom:o.prenom,poste:this.roleService.getIri(o.poste),service:this.serviceService.getIri(o.service),programmeAvion:o.programmeAvion.map(E=>this.programService.getIri(E)),unite:this.uniteService.getIri(o.unite),site:this.usineService.getIri(o.site)};return this.requestService.createPutRequest(s.N.usineApi+`users/${o.id}`,p)}addUserToGroup(o){return new Promise((p,E)=>(0,h.mG)(this,void 0,void 0,function*(){for(const S of o.groupeAffectations){const R={libelle:S.libelle,population:S.population.map(O=>this.getIri(O))};R.population.push(this.getIri(o)),yield this.requestService.createPatchRequest(s.N.usineApi+"groupe_affectations/"+S.id+"/addUsers",{population:R.population}).then(O=>{o.groupeAffectations=O})}p(o)}))}getUsersByService(o){return this.requestService.createGetRequest(s.N.usineApi+`services/${o}`)}deleteUser(o){return this.requestService.createDeleteRequest(s.N.usineApi+`users/${o}`)}}return i.\u0275fac=function(o){return new(o||i)(l.LFG(P.s),l.LFG(u.N),l.LFG(e.z),l.LFG(a.W),l.LFG(A.W),l.LFG(c))},i.\u0275prov=l.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()},1109:(T,f,t)=>{t.r(f),t.d(f,{ToolRequestPageModule:()=>L});var h=t(6019),s=t(9133),l=t(1704),P=t(4382),u=t(1171),e=t(3668),a=t(6607),A=t(7914),c=t(3580),m=t(1832);const n=["menu"];function i(r,M){if(1&r&&(e.TgZ(0,"ion-badge",14),e._uU(1),e.qZA()),2&r){const g=e.oxw();e.xp6(1),e.hij("New ",g.newRequests,"")}}function d(r,M){if(1&r&&(e.TgZ(0,"ion-badge",14),e._uU(1),e.qZA()),2&r){const g=e.oxw(2);e.xp6(1),e.hij("New ",g.newUsers,"")}}const o=function(){return["ROLE_ADMIN"]};function p(r,M){if(1&r){const g=e.EpF();e.TgZ(0,"ion-item-group"),e.TgZ(1,"ion-item-divider"),e.TgZ(2,"ion-label",5),e._uU(3,"L'\xe9quipe"),e.qZA(),e.qZA(),e.TgZ(4,"ion-menu-toggle",6),e.TgZ(5,"ion-item",9),e.NdJ("click",function(){return e.CHM(g),e.oxw().navigate("tooling/manage-tool-team")}),e.TgZ(6,"ion-label"),e._uU(7," Gestion de l'\xe9quipe "),e.qZA(),e.YNc(8,d,2,1,"ion-badge",10),e.qZA(),e.qZA(),e.TgZ(9,"ion-menu-toggle",6),e.TgZ(10,"ion-item",11),e.NdJ("click",function(){return e.CHM(g),e.oxw().navigate("tooling/tool-indicators")}),e.TgZ(11,"ion-label"),e._uU(12," Indicateurs "),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&r){const g=e.oxw();e.xp6(5),e.Q6J("button",!0),e.xp6(3),e.Q6J("ngIf",g.newUsers),e.xp6(2),e.Q6J("disabled",!g.roleGuard.isRole(e.DdM(4,o)))("button",!0)}}const S=[{path:"",component:(()=>{class r{constructor(g,v,I,D,N,C){this.router=g,this.navCtrl=v,this.authService=I,this.roleGuard=D,this.userService=N,this.toolRequestService=C,this.page={pageTitle:"Module Outillage",menuTitle:"Menu outillage",contentId:"tooling-content"},this.isManager=!1}ionViewWillEnter(){this.page={pageTitle:"Module Outillage",menuTitle:"Menu outillage",contentId:"tooling-content"},this.menu.open(),this.isManager&&this.loadIndicators()}ngOnInit(){this.buildManagerPage()}buildManagerPage(){this.isManager=this.roleGuard.isRole(["ROLE_ADMIN","ROLE_RESP_OUTIL","ROLE_CE_OUTIL"])&&this.authService.authUser.isActive}loadIndicators(){this.userService.getUsersByService("5").then(g=>{this.newUsers=g.users.length}),this.toolRequestService.getToolRequests().then(g=>{this.newRequests=g.filter(v=>"NOUVELLE"===v.statut).length})}navigate(g){this.navCtrl.navigateRoot(g).then(()=>{}).catch(v=>{console.error(v)})}}return r.\u0275fac=function(g){return new(g||r)(e.Y36(P.F0),e.Y36(l.SH),e.Y36(a.e),e.Y36(u.p),e.Y36(A.f),e.Y36(c.C))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-tool-request"]],viewQuery:function(g,v){if(1&g&&e.Gf(n,5),2&g){let I;e.iGM(I=e.CRH())&&(v.menu=I.first)}},decls:39,vars:12,consts:[[3,"pageTitle"],["color","medium",3,"fullscreen"],["open","true","side","start","type","push","contentId","tooling-content"],["menu",""],["color","succes"],["color","secondary"],["auto-hide","true"],["routerDirection","forward",3,"disabled","button","click"],["routerDirection","forward",3,"button","click"],["routerDirection","root",3,"button","click"],["color","danger",4,"ngIf"],["routerDirection","root",3,"disabled","button","click"],[4,"ngIf"],["id","tooling-content"],["color","danger"]],template:function(g,v){1&g&&(e._UZ(0,"app-shared-user-header",0),e.TgZ(1,"ion-content",1),e.TgZ(2,"ion-menu",2,3),e.TgZ(4,"ion-header"),e.TgZ(5,"ion-toolbar",4),e.TgZ(6,"ion-title"),e._uU(7),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"ion-content"),e.TgZ(9,"ion-list"),e.TgZ(10,"ion-item-divider"),e.TgZ(11,"ion-label",5),e._uU(12,"Faire une demande"),e.qZA(),e.qZA(),e.TgZ(13,"ion-menu-toggle",6),e.TgZ(14,"ion-item",7),e.NdJ("click",function(){return v.navigate("tooling/new-tool")}),e.TgZ(15,"ion-label"),e._uU(16," Nouvel outillage (SBO) "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(17,"ion-menu-toggle",6),e.TgZ(18,"ion-item",8),e.NdJ("click",function(){return v.navigate("tooling/repair-tool")}),e.TgZ(19,"ion-label"),e._uU(20," Maintenance et r\xe9paration "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(21,"ion-menu-toggle",6),e.TgZ(22,"ion-item",8),e.NdJ("click",function(){return v.navigate("tooling/3D-tool")}),e.TgZ(23,"ion-label"),e._uU(24," Contr\xf4le 3D "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(25,"ion-item-divider"),e.TgZ(26,"ion-label",5),e._uU(27,"Suivi"),e.qZA(),e.qZA(),e.TgZ(28,"ion-menu-toggle",6),e.TgZ(29,"ion-item",9),e.NdJ("click",function(){return v.navigate("tooling/tool-request-list")}),e.TgZ(30,"ion-label"),e._uU(31," Liste des demandes outillages "),e.qZA(),e.YNc(32,i,2,1,"ion-badge",10),e.qZA(),e.qZA(),e.TgZ(33,"ion-menu-toggle",6),e.TgZ(34,"ion-item",11),e.NdJ("click",function(){return v.navigate("tooling/tool-list")}),e.TgZ(35,"ion-label"),e._uU(36," Liste des outillages "),e.qZA(),e.qZA(),e.qZA(),e.YNc(37,p,13,5,"ion-item-group",12),e.qZA(),e.qZA(),e.qZA(),e._UZ(38,"ion-router-outlet",13),e.qZA()),2&g&&(e.Q6J("pageTitle",v.page.pageTitle),e.xp6(1),e.Q6J("fullscreen",!1),e.xp6(6),e.hij(" ",v.page.menuTitle," "),e.xp6(7),e.Q6J("disabled",!0)("button",!0),e.xp6(4),e.Q6J("button",!0),e.xp6(4),e.Q6J("button",!0),e.xp6(7),e.Q6J("button",!0),e.xp6(3),e.Q6J("ngIf",v.newRequests&&v.isManager),e.xp6(2),e.Q6J("disabled",!0)("button",!0),e.xp6(3),e.Q6J("ngIf",v.isManager))},directives:[m.Q,l.W2,l.z0,l.Gu,l.sr,l.wd,l.q_,l.rH,l.Q$,l.zc,l.Ie,h.O5,l.jP,l.yp,l.Ub],styles:[""]}),r})(),children:[{path:"new-tool",loadChildren:()=>Promise.all([t.e(8527),t.e(3050),t.e(8592),t.e(3240)]).then(t.bind(t,3240)).then(r=>r.NewToolPageModule)},{path:"tool-request-list",loadChildren:()=>Promise.all([t.e(8527),t.e(2899),t.e(3050),t.e(8592),t.e(1547)]).then(t.bind(t,1547)).then(r=>r.ToolRequestsPageModule)},{path:"tool-list",canActivate:[u.p],data:{expectedRole:["ROLE_ADMIN","ROLE_RESP_OUTIL"]},loadChildren:()=>t.e(6824).then(t.bind(t,6824)).then(r=>r.ToolListPageModule)},{path:"repair-tool",loadChildren:()=>Promise.all([t.e(7247),t.e(8592),t.e(5641)]).then(t.bind(t,5641)).then(r=>r.MaintenanceReparationPageModule)},{path:"repair-tool/:id",loadChildren:()=>Promise.all([t.e(7247),t.e(8592),t.e(5641)]).then(t.bind(t,5641)).then(r=>r.MaintenanceReparationPageModule)},{path:"3D-tool",loadChildren:()=>Promise.all([t.e(7247),t.e(1162)]).then(t.bind(t,1162)).then(r=>r.Control3DPageModule)},{path:"3D-tool/:id",loadChildren:()=>Promise.all([t.e(7247),t.e(1162)]).then(t.bind(t,1162)).then(r=>r.Control3DPageModule)},{path:"manage-tool-team",canActivate:[u.p],data:{expectedRole:["ROLE_ADMIN","ROLE_RESP_OUTIL","ROLE_CE_OUTIL"]},loadChildren:()=>Promise.all([t.e(8527),t.e(2899),t.e(8592),t.e(2109)]).then(t.bind(t,2109)).then(r=>r.ManageTeamPageModule)},{path:"tool-indicators",canActivate:[u.p],data:{expectedRole:["ROLE_ADMIN","ROLE_RESP_OUTIL","ROLE_CE_OUTIL"]},loadChildren:()=>Promise.all([t.e(720),t.e(9438)]).then(t.bind(t,9438)).then(r=>r.IndicatorsPageModule)}]}];let R=(()=>{class r{}return r.\u0275fac=function(g){return new(g||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[P.Bz.forChild(S)],P.Bz]}),r})();var O=t(9372),Z=t(4915);let L=(()=>{class r{}return r.\u0275fac=function(g){return new(g||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[h.ez,P.Bz,s.u5,l.Pc,R,O.A,Z.$]]}),r})()}}]);