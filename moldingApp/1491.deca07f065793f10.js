"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1491],{1491:(C,g,r)=>{r.r(g),r.d(g,{LoginPageModule:()=>A});var h=r(9808),a=r(4182),n=r(9928),u=r(4406),d=r(2340),e=r(5e3),f=r(4147),p=r(7704),v=r(9172),L=r(1086),m=r(2853);let S=(()=>{class o{constructor(t,i){this.authService=t,this.alertService=i,this.tableUpdates=[{id:1,dateUpdate:new Date(2022,4,9),description:"Pour associer un outillage \xe0 un moulage il suffit de scanner le num\xe9ro d'OT dans l'OF.Vous devez le scanner comme un kit",title:"Module Moulage"},{id:2,dateUpdate:new Date(2022,4,9),description:"Le module outillage est ouvert pour test",title:"Module Outillage"}]}showUpdates(){this.getUpdatesToShow().subscribe(t=>{t&&t.forEach(i=>{this.alertService.simpleAlert("Info sur la mise \xe0 jours",i.title,i.description)})})}getUpdates(t){const i=this.tableUpdates.filter(s=>s.dateUpdate>=new Date(t));return i.length>0?i:null}getUpdatesToShow(){return(0,L.of)(this.getUpdates(this.authService.authUser.lastCon))}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(p.e),e.LFG(m.c))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var U=r(6800),E=r(67);const P=["userName"],R=["password"],O=function(){return["/register"]},y=[{path:"",component:(()=>{class o{constructor(t,i,s,c,N,T,Z,b){this.authService=t,this.formBuilder=i,this.loadingService=s,this.updateService=c,this.navControler=N,this.alertService=T,this.noticeService=Z,this.headerService=b,this.version=f.i8,this.reRouteOpts=[{roles:["ROLE_MOULEUR","\tROLE_RESP_MOULAGE","ROLE_CE_MOULAGE"],route:"molding"},{roles:["ROLE_RESP_OUTIL","ROLE_CE_OUTIL","ROLE_OUTILLEUR"],route:"tooling"},{roles:["ROLE_ADMIN","ROLE_USER","ROLE_METHODES"],route:"home"}]}showNotice(){this.noticeService.presentModal()}ionViewWillEnter(){(0,e.X6Q)()&&this.loginForm.setValue({userName:d.N.username,password:d.N.password})}ngOnInit(){console.log("login init"),this.headerService.changePageParams({title:"",visible:!1},"login"),this.loginForm=this.formBuilder.group({userName:["",a.kI.required],password:[""]})}onSubmit(){this.loadingService.startLoading("Patienter pendant la connexion");const t=this.loginForm.get("userName").value.replace(/^0+/,""),i=this.loginForm.get("password").value||t;this.authService.authenticate(t,i).subscribe(()=>{this.afterLoginActions()},s=>{this.logginError(s)})}afterLoginActions(){this.loadingService.stopLoading().then(()=>{this.loginForm.reset(),this.reRouteUser(),this.updateService.showUpdates()})}reRouteUser(){const t=this.reRouteOpts.find(i=>this.authService.authUser.roles.some(s=>i.roles.find(c=>c===s)));this.navControler.navigateRoot(void 0===t?"home":t.route)}logginError(t){console.error(t),this.alertService.simpleAlert("Erreur d'authentification","","Le nom d'utilisateur ou votre mot de passe n'est pas correct"),this.loadingService.stopLoading()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(p.e),e.Y36(a.qu),e.Y36(v.b),e.Y36(S),e.Y36(n.SH),e.Y36(m.c),e.Y36(U.L),e.Y36(E.r))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-login"]],viewQuery:function(t,i){if(1&t&&(e.Gf(P,5),e.Gf(R,5)),2&t){let s;e.iGM(s=e.CRH())&&(i.userName=s.first),e.iGM(s=e.CRH())&&(i.password=s.first)}},decls:29,vars:6,consts:[[3,"fullscreen"],["fixed","",1,"full-height","ion-align-items-center","ion-justify-content-center"],[1,"ion-align-items-center"],[3,"formGroup","ngSubmit","keyup.enter"],["position","floating"],["color","danger"],["autocapitalize","on","required","","formControlName","userName","type","text","autocomplete","off","autofocus","true","inputmode","numeric","value","204292"],["userName",""],["formControlName","password","type","password","value",""],["password",""],["block","","color","primary","type","submit",3,"disabled"],["fill","clear",3,"routerLink"],["vertical","top","horizontal","end","slot","fixed"],["size","small","color","light",3,"click"],["name","information-circle-outline"],["slot","end",1,"ion-padding"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-content",0)(1,"ion-grid",1)(2,"ion-row",2)(3,"form",3),e.NdJ("ngSubmit",function(){return i.onSubmit()})("keyup.enter",function(){return i.onSubmit()}),e.TgZ(4,"ion-item")(5,"ion-label",4),e._uU(6,"Nom d'utilisateur "),e.TgZ(7,"ion-text",5),e._uU(8,"*"),e.qZA()(),e._UZ(9,"ion-input",6,7),e.TgZ(11,"ion-note"),e._uU(12," Le nom d'utilisateur est le num\xe9ro de matricule pr\xe9sent sur le badge "),e.qZA()(),e.TgZ(13,"ion-item")(14,"ion-label",4),e._uU(15,"Password "),e.qZA(),e._UZ(16,"ion-input",8,9),e.qZA(),e.TgZ(18,"ion-button",10),e._uU(19," Se connecter "),e.qZA(),e.TgZ(20,"ion-button",11),e._uU(21," Cr\xe9er un compte "),e.qZA()()()(),e.TgZ(22,"ion-fab",12)(23,"ion-fab-button",13),e.NdJ("click",function(){return i.showNotice()}),e._UZ(24,"ion-icon",14),e.qZA()()(),e.TgZ(25,"ion-footer")(26,"ion-toolbar")(27,"div",15),e._uU(28),e.qZA()()()),2&t&&(e.Q6J("fullscreen",!0),e.xp6(3),e.Q6J("formGroup",i.loginForm),e.xp6(15),e.Q6J("disabled",i.loginForm.invalid),e.xp6(2),e.Q6J("routerLink",e.DdM(5,O)),e.xp6(8),e.hij(" Version : ",i.version," "))},dependencies:[a._Y,a.JJ,a.JL,a.Q7,n.YG,n.W2,n.IJ,n.W4,n.fr,n.jY,n.gu,n.pK,n.Ie,n.Q$,n.uN,n.Nd,n.yW,n.sr,n.j9,n.YI,u.rH,a.sg,a.u],styles:[".full-height[_ngcontent-%COMP%]{height:100%;display:flex!important;flex-direction:column}ion-title[_ngcontent-%COMP%]{font-size:60px!important;text-transform:uppercase}"]}),o})()}];let M=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[u.Bz.forChild(y),u.Bz]}),o})(),A=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[h.ez,a.u5,n.Pc,M,a.UX]}),o})()}}]);