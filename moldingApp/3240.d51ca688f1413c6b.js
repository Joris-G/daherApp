"use strict";var ud=Object.defineProperty,pd=Object.defineProperties,fd=Object.getOwnPropertyDescriptors,na=Object.getOwnPropertySymbols,dd=Object.prototype.hasOwnProperty,hd=Object.prototype.propertyIsEnumerable,ra=(St,Q,T)=>Q in St?ud(St,Q,{enumerable:!0,configurable:!0,writable:!0,value:T}):St[Q]=T,vt=(St,Q)=>{for(var T in Q||(Q={}))dd.call(Q,T)&&ra(St,T,Q[T]);if(na)for(var T of na(Q))hd.call(Q,T)&&ra(St,T,Q[T]);return St},ge=(St,Q)=>pd(St,fd(Q));(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3240,6188],{3580:(St,Q,T)=>{T.d(Q,{C:()=>pn});var R=T(4762),C=T(8260),F=T(3668),Fe=T(3521),ze=T(6188),c=T(2048),Lt=T(6607);let pn=(()=>{class z{constructor(_,k,q,Wt){this.requestService=_,this.toolService=k,this.userService=q,this.authService=Wt}getType(_){return"string"==typeof _?_:_.controle?"controle":_.maintenance?"maintenance":void 0}createToolRequest(_){return this.requestService.createPostRequest(C.N.toolApi+"demandes",_)}createControlRequest(_){var k;const q={id:null!==(k=_.id)&&void 0!==k?k:null,outillage:_.outillage?this.toolService.getIri(_.outillage):"",dateBesoin:_.dateBesoin,userCreat:this.userService.getIri(this.authService.authUser),refPlan:_.refPlan,indPlan:_.indPlan,cheminCAO:_.cheminCAO,description:_.description,detailsControle:_.detailsControle,tolerances:_.tolerances,dispoOut:_.dispoOut,ligneBudgetaire:_.ligneBudgetaire,typeRapport:_.typeRapport};return this.requestService.createPostRequest(C.N.toolApi+"controles",q)}createAllMaintenaceItems(_){const k=[];return new Promise((q,Wt)=>{_.itemActionCorrective.forEach(At=>{this.requestService.createPostRequest(C.N.toolApi+"maintenance_items",At).then(ne=>{k.push(`/api/maintenance_items/${ne.id}`),console.log(k.length,_.itemActionCorrective.length),k.length===_.itemActionCorrective.length&&q(k)})})})}createMaintenanceRequest(_){return new Promise((k,q)=>{this.createAllMaintenaceItems(_).then(Wt=>{var At;console.log(Wt);const ne={id:null!==(At=_.id)&&void 0!==At?At:null,outillage:_.outillage?this.toolService.getIri(_.outillage):"",dateBesoin:_.dateBesoin,userCreat:this.userService.getIri(this.authService.authUser),rep:_.rep,itemActionCorrective:Wt};console.log(ne),this.requestService.createPostRequest(C.N.toolApi+"maintenances",ne).then(ve=>{k(ve)})})})}updateRequest(_){const k={statut:_.statut,createdAt:_.createdAt,id:_.id};return this.requestService.createPutRequest(C.N.toolApi+"demandes/"+k.id,k)}updateControlRequest(_){var k;const q={id:null!==(k=_.controle.id)&&void 0!==k?k:null,outillage:_.controle.outillage?this.toolService.getIri(_.controle.outillage):"",dateBesoin:_.dateBesoin,userCreat:this.userService.getIri(_.controle.demandeur),refPlan:_.controle.refPlan,indPlan:_.controle.indPlan,cheminCAO:_.controle.cheminCAO,description:_.controle.description,detailsControle:_.controle.detailsControle,tolerances:_.controle.tolerances,dispoOut:_.controle.dispoOut,ligneBudgetaire:_.controle.ligneBudgetaire,interventionDate:_.controle.interventionDate,moyenMesure:_.controle.moyenMesure,infosComplementaire:_.controle.infosComplementaire,visaControleur:_.controle.visaControleur,typeRapport:_.controle.typeRapport};return console.log(q),this.requestService.createPutRequest(C.N.toolApi+"controles/"+q.id,q)}updateMaintenanceItems(_){return(0,R.mG)(this,void 0,void 0,function*(){const k=_.map(q=>q.id?this.requestService.createPutRequest(C.N.toolApi+"maintenance_items/"+q.id,q):this.requestService.createPostRequest(C.N.toolApi+"maintenance_items",q));return Promise.all(k)})}updateMainteanceRequest(_){return new Promise((k,q)=>{this.updateMaintenanceItems(_.maintenance.itemActionCorrective).then(Wt=>{var At;_.maintenance.itemActionCorrective=Wt,console.log(_.maintenance.itemActionCorrective);const ne=_.maintenance.itemActionCorrective.map(lo=>"/api/maintenance_items/"+lo.id),ve={id:null!==(At=_.maintenance.id)&&void 0!==At?At:null,outillage:_.maintenance.outillage?this.toolService.getIri(_.maintenance.outillage):"",dateBesoin:_.dateBesoin,userCreat:this.userService.getIri(_.maintenance.userCreat),itemActionCorrective:ne};console.log(ve),k(this.requestService.createPutRequest(C.N.toolApi+"maintenances/"+ve.id,ve))})})}getToolRequest(_){return this.requestService.createGetRequest(C.N.toolApi+"demandes/"+_)}getToolRequests(){return this.requestService.createGetRequest(C.N.toolApi+"demandes")}getControl(_){return this.requestService.createGetRequest(C.N.toolApi+"controles/"+_)}getMaintenance(_){return this.requestService.createGetRequest(C.N.toolApi+"maintenances/"+_)}removeRequest(_){return new Promise((k,q)=>{this.requestService.createDeleteRequest("demandes/"+_.id)})}}return z.\u0275fac=function(_){return new(_||z)(F.LFG(Fe.s),F.LFG(ze.o),F.LFG(c.f),F.LFG(Lt.e))},z.\u0275prov=F.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"}),z})()},6188:(St,Q,T)=>{T.d(Q,{o:()=>c});var R=T(4522),C=T(8260),F=T(3668),Fe=T(3521),ze=T(5243);let c=(()=>{class Lt{constructor(z,tt,_){this.http=z,this.requestService=tt,this.alertService=_}getToolByInput(z){return new Promise((tt,_)=>{switch(z.length){case 5:this.getToolByToolNumber(z).then(k=>{tt(k)},k=>{this.alertService.simpleAlert("Erreur","Le serveur outillage \xe0 renvoy\xe9 une erreur :",k),_()}).catch(k=>{console.error(k)});break;case 7:break;case 8:z.startsWith("OT")&&this.getToolByToolNumber(z.substring(z.length-5)).then(k=>{tt(k)},k=>{this.alertService.simpleAlert("Erreur","Le serveur outillage \xe0 renvoy\xe9 une erreur :",k),_()}).catch(k=>{console.error(k)});break;default:this.getToolByIdentification(z).then(k=>{tt(k)},k=>{this.alertService.simpleAlert("Erreur","Le serveur outillage \xe0 renvoy\xe9 une erreur :",k),_()}).catch(k=>{console.error(k)})}})}getToolById(z){return this.requestService.createGetRequest(`${C.N.toolApi}tools/${z}`)}getToolByToolNumber(z){return new Promise((tt,_)=>{this.requestService.createGetRequest(`${C.N.toolApi}tools?sapToolNumber=${z}`).then(k=>{1===k.length?tt(k[0]):_(k.length>1?"Il y a plus d'un outillage correspondant en base de donn\xe9e":"aucun outillage trouv\xe9")},k=>{console.log(k),_("Pas de r\xe9ponse du serveur")})})}getToolByIdentification(z){return new Promise((tt,_)=>{this.requestService.createGetRequest(`${C.N.toolApi}tools?identification=${z}`).then(k=>{1===k.length?tt(k[0]):_(k.length>1?"Il y a plus d'un outillage correspondant en base de donn\xe9e":"aucun outillage trouv\xe9")},k=>{console.log(k),_("Pas de r\xe9ponse du serveur")})})}getAllTools(){return new Promise((z,tt)=>{const _=(new R.WM).append("content-type","application/json");this.http.get(`${C.N.apiServer}molding_tools`,{headers:_}).subscribe(k=>{z(k)},k=>{console.log(k),tt()})})}getIri(z){return`/api/tools/${z.id}`}createTool(z){const tt=z;return tt.sapToolNumber=parseInt(z.sapToolNumber.substring(2),10),this.requestService.createPostRequest(C.N.toolApi+"tools",tt)}}return Lt.\u0275fac=function(z){return new(z||Lt)(F.LFG(R.eN),F.LFG(Fe.s),F.LFG(ze.c))},Lt.\u0275prov=F.Yz7({token:Lt,factory:Lt.\u0275fac,providedIn:"root"}),Lt})()},3240:(St,Q,T)=>{T.r(Q),T.d(Q,{NewToolPageModule:()=>cd});var R=T(6019),C=T(9133),F=T(1704),Fe=T(5711),ze=T(8290),c=T(3668);let oa=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({imports:[[ze.vT]]}),n})();var Ht=T(6731);let ia=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({imports:[[Ht.si,Ht.BQ],Ht.BQ]}),n})();T(2411),T(540),T(6813),T(1366),T(8053),T(2047),T(6658),T(550),T(4522);var Wn=T(5427);let ga=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({imports:[[Ht.BQ],Ht.BQ]}),n})();var hn=T(8095);T(9814);let Qn=(()=>{class n{constructor(){this.changes=new hn.xQ,this.optionalLabel="Optional",this.completedLabel="Completed",this.editableLabel="Editable"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Ta={provide:Qn,deps:[[new c.FiY,new c.tp0,Qn]],useFactory:function(n){return n||new Qn}};let Ia=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:[Ta,Ht.rD],imports:[[Ht.BQ,R.ez,Fe.eL,ia,oa,ga,Ht.si],Ht.BQ]}),n})();var Kn=T(4382),Na=T(8774);function at(n){this.content=n}at.prototype={constructor:at,find:function(n){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===n)return t;return-1},get:function(n){var t=this.find(n);return-1==t?void 0:this.content[t+1]},update:function(n,t,e){var r=e&&e!=n?this.remove(e):this,o=r.find(n),i=r.content.slice();return-1==o?i.push(e||n,t):(i[o+1]=t,e&&(i[o]=e)),new at(i)},remove:function(n){var t=this.find(n);if(-1==t)return this;var e=this.content.slice();return e.splice(t,2),new at(e)},addToStart:function(n,t){return new at([n,t].concat(this.remove(n).content))},addToEnd:function(n,t){var e=this.remove(n).content.slice();return e.push(n,t),new at(e)},addBefore:function(n,t,e){var r=this.remove(t),o=r.content.slice(),i=r.find(n);return o.splice(-1==i?o.length:i,0,t,e),new at(o)},forEach:function(n){for(var t=0;t<this.content.length;t+=2)n(this.content[t],this.content[t+1])},prepend:function(n){return(n=at.from(n)).size?new at(n.content.concat(this.subtract(n).content)):this},append:function(n){return(n=at.from(n)).size?new at(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var t=this;n=at.from(n);for(var e=0;e<n.content.length;e+=2)t=t.remove(n.content[e]);return t},get size(){return this.content.length>>1}},at.from=function(n){if(n instanceof at)return n;var t=[];if(n)for(var e in n)t.push(e,n[e]);return new at(t)};const go=at;function vo(n,t,e){for(var r=0;;r++){if(r==n.childCount||r==t.childCount)return n.childCount==t.childCount?null:e;var o=n.child(r),i=t.child(r);if(o!=i){if(!o.sameMarkup(i))return e;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)e++;return e}if(o.content.size||i.content.size){var a=vo(o.content,i.content,e+1);if(null!=a)return a}e+=o.nodeSize}else e+=o.nodeSize}}function yo(n,t,e,r){for(var o=n.childCount,i=t.childCount;;){if(0==o||0==i)return o==i?null:{a:e,b:r};var s=n.child(--o),a=t.child(--i),l=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:e,b:r};if(s.isText&&s.text!=a.text){for(var u=0,p=Math.min(s.text.length,a.text.length);u<p&&s.text[s.text.length-u-1]==a.text[a.text.length-u-1];)u++,e--,r--;return{a:e,b:r}}if(s.content.size||a.content.size){var f=yo(s.content,a.content,e-1,r-1);if(f)return f}e-=l,r-=l}else e-=l,r-=l}}var v=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var r=0;r<t.length;r++)this.size+=t[r].nodeSize},mn={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};v.prototype.nodesBetween=function(t,e,r,o,i){void 0===o&&(o=0);for(var s=0,a=0;a<e;s++){var l=this.content[s],u=a+l.nodeSize;if(u>t&&!1!==r(l,o+a,i,s)&&l.content.size){var p=a+1;l.nodesBetween(Math.max(0,t-p),Math.min(l.content.size,e-p),r,o+p)}a=u}},v.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},v.prototype.textBetween=function(t,e,r,o){var i="",s=!0;return this.nodesBetween(t,e,function(a,l){a.isText?(i+=a.text.slice(Math.max(t,l)-l,e-l),s=!r):a.isLeaf&&o?(i+="function"==typeof o?o(a):o,s=!r):!s&&a.isBlock&&(i+=r,s=!0)},0),i},v.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,r=t.firstChild,o=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(r)&&(o[o.length-1]=e.withText(e.text+r.text),i=1);i<t.content.length;i++)o.push(t.content[i]);return new v(o,this.size+t.size)},v.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var r=[],o=0;if(e>t)for(var i=0,s=0;s<e;i++){var a=this.content[i],l=s+a.nodeSize;l>t&&((s<t||l>e)&&(a=a.isText?a.cut(Math.max(0,t-s),Math.min(a.text.length,e-s)):a.cut(Math.max(0,t-s-1),Math.min(a.content.size,e-s-1))),r.push(a),o+=a.nodeSize),s=l}return new v(r,o)},v.prototype.cutByIndex=function(t,e){return t==e?v.empty:0==t&&e==this.content.length?this:new v(this.content.slice(t,e))},v.prototype.replaceChild=function(t,e){var r=this.content[t];if(r==e)return this;var o=this.content.slice(),i=this.size+e.nodeSize-r.nodeSize;return o[t]=e,new v(o,i)},v.prototype.addToStart=function(t){return new v([t].concat(this.content),this.size+t.nodeSize)},v.prototype.addToEnd=function(t){return new v(this.content.concat(t),this.size+t.nodeSize)},v.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},mn.firstChild.get=function(){return this.content.length?this.content[0]:null},mn.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},mn.childCount.get=function(){return this.content.length},v.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},v.prototype.maybeChild=function(t){return this.content[t]},v.prototype.forEach=function(t){for(var e=0,r=0;e<this.content.length;e++){var o=this.content[e];t(o,r,e),r+=o.nodeSize}},v.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),vo(this,t,e)},v.prototype.findDiffEnd=function(t,e,r){return void 0===e&&(e=this.size),void 0===r&&(r=t.size),yo(this,t,e,r)},v.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return gn(0,t);if(t==this.size)return gn(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var r=0,o=0;;r++){var s=o+this.child(r).nodeSize;if(s>=t)return s==t||e>0?gn(r+1,s):gn(r,o);o=s}},v.prototype.toString=function(){return"<"+this.toStringInner()+">"},v.prototype.toStringInner=function(){return this.content.join(", ")},v.prototype.toJSON=function(){return this.content.length?this.content.map(function(t){return t.toJSON()}):null},v.fromJSON=function(t,e){if(!e)return v.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new v(e.map(t.nodeFromJSON))},v.fromArray=function(t){if(!t.length)return v.empty;for(var e,r=0,o=0;o<t.length;o++){var i=t[o];r+=i.nodeSize,o&&i.isText&&t[o-1].sameMarkup(i)?(e||(e=t.slice(0,o)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new v(e||t,r)},v.from=function(t){if(!t)return v.empty;if(t instanceof v)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new v([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(v.prototype,mn);var Gn={index:0,offset:0};function gn(n,t){return Gn.index=n,Gn.offset=t,Gn}function vn(n,t){if(n===t)return!0;if(!n||"object"!=typeof n||!t||"object"!=typeof t)return!1;var e=Array.isArray(n);if(Array.isArray(t)!=e)return!1;if(e){if(n.length!=t.length)return!1;for(var r=0;r<n.length;r++)if(!vn(n[r],t[r]))return!1}else{for(var o in n)if(!(o in t)||!vn(n[o],t[o]))return!1;for(var i in t)if(!(i in n))return!1}return!0}v.empty=new v([],0);var O=function(t,e){this.type=t,this.attrs=e};function Pt(n){var t=Error.call(this,n);return t.__proto__=Pt.prototype,t}O.prototype.addToSet=function(t){for(var e,r=!1,o=0;o<t.length;o++){var i=t[o];if(this.eq(i))return t;if(this.type.excludes(i.type))e||(e=t.slice(0,o));else{if(i.type.excludes(this.type))return t;!r&&i.type.rank>this.type.rank&&(e||(e=t.slice(0,o)),e.push(this),r=!0),e&&e.push(i)}}return e||(e=t.slice()),r||e.push(this),e},O.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},O.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},O.prototype.eq=function(t){return this==t||this.type==t.type&&vn(this.attrs,t.attrs)},O.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},O.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var r=t.marks[e.type];if(!r)throw new RangeError("There is no mark type "+e.type+" in this schema");return r.create(e.attrs)},O.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].eq(e[r]))return!1;return!0},O.setFrom=function(t){if(!t||0==t.length)return O.none;if(t instanceof O)return[t];var e=t.slice();return e.sort(function(r,o){return r.type.rank-o.type.rank}),e},O.none=[],(Pt.prototype=Object.create(Error.prototype)).constructor=Pt,Pt.prototype.name="ReplaceError";var M=function(t,e,r){this.content=t,this.openStart=e,this.openEnd=r},_o={size:{configurable:!0}};function bo(n,t,e){var r=n.findIndex(t),o=r.index,i=r.offset,s=n.maybeChild(o),a=n.findIndex(e),l=a.index;if(i==t||s.isText){if(a.offset!=e&&!n.child(l).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(e))}if(o!=l)throw new RangeError("Removing non-flat range");return n.replaceChild(o,s.copy(bo(s.content,t-i-1,e-i-1)))}function xo(n,t,e,r){var o=n.findIndex(t),i=o.index,s=o.offset,a=n.maybeChild(i);if(s==t||a.isText)return r&&!r.canReplace(i,i,e)?null:n.cut(0,t).append(e).append(n.cut(t));var l=xo(a.content,t-s-1,e);return l&&n.replaceChild(i,a.copy(l))}function Oa(n,t,e){if(e.openStart>n.depth)throw new Pt("Inserted content deeper than insertion position");if(n.depth-e.openStart!=t.depth-e.openEnd)throw new Pt("Inconsistent open depths");return So(n,t,e,0)}function So(n,t,e,r){var o=n.index(r),i=n.node(r);if(o==t.index(r)&&r<n.depth-e.openStart){var s=So(n,t,e,r+1);return i.copy(i.content.replaceChild(o,s))}if(e.content.size){if(e.openStart||e.openEnd||n.depth!=r||t.depth!=r){var u=function(n,t){for(var e=t.depth-n.openStart,o=t.node(e).copy(n.content),i=e-1;i>=0;i--)o=t.node(i).copy(v.from(o));return{start:o.resolveNoCache(n.openStart+e),end:o.resolveNoCache(o.content.size-n.openEnd-e)}}(e,n);return ie(i,Co(n,u.start,u.end,t,r))}var a=n.parent,l=a.content;return ie(a,l.cut(0,n.parentOffset).append(e.content).append(l.cut(t.parentOffset)))}return ie(i,yn(n,t,r))}function Mo(n,t){if(!t.type.compatibleContent(n.type))throw new Pt("Cannot join "+t.type.name+" onto "+n.type.name)}function Yn(n,t,e){var r=n.node(e);return Mo(r,t.node(e)),r}function oe(n,t){var e=t.length-1;e>=0&&n.isText&&n.sameMarkup(t[e])?t[e]=n.withText(t[e].text+n.text):t.push(n)}function Ve(n,t,e,r){var o=(t||n).node(e),i=0,s=t?t.index(e):o.childCount;n&&(i=n.index(e),n.depth>e?i++:n.textOffset&&(oe(n.nodeAfter,r),i++));for(var a=i;a<s;a++)oe(o.child(a),r);t&&t.depth==e&&t.textOffset&&oe(t.nodeBefore,r)}function ie(n,t){if(!n.type.validContent(t))throw new Pt("Invalid content for node "+n.type.name);return n.copy(t)}function Co(n,t,e,r,o){var i=n.depth>o&&Yn(n,t,o+1),s=r.depth>o&&Yn(e,r,o+1),a=[];return Ve(null,n,o,a),i&&s&&t.index(o)==e.index(o)?(Mo(i,s),oe(ie(i,Co(n,t,e,r,o+1)),a)):(i&&oe(ie(i,yn(n,t,o+1)),a),Ve(t,e,o,a),s&&oe(ie(s,yn(e,r,o+1)),a)),Ve(r,null,o,a),new v(a)}function yn(n,t,e){var r=[];return Ve(null,n,e,r),n.depth>e&&oe(ie(Yn(n,t,e+1),yn(n,t,e+1)),r),Ve(t,null,e,r),new v(r)}_o.size.get=function(){return this.content.size-this.openStart-this.openEnd},M.prototype.insertAt=function(t,e){var r=xo(this.content,t+this.openStart,e,null);return r&&new M(r,this.openStart,this.openEnd)},M.prototype.removeBetween=function(t,e){return new M(bo(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},M.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},M.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},M.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},M.fromJSON=function(t,e){if(!e)return M.empty;var r=e.openStart||0,o=e.openEnd||0;if("number"!=typeof r||"number"!=typeof o)throw new RangeError("Invalid input for Slice.fromJSON");return new M(v.fromJSON(t,e.content),r,o)},M.maxOpen=function(t,e){void 0===e&&(e=!0);for(var r=0,o=0,i=t.firstChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.firstChild)r++;for(var s=t.lastChild;s&&!s.isLeaf&&(e||!s.type.spec.isolating);s=s.lastChild)o++;return new M(t,r,o)},Object.defineProperties(M.prototype,_o),M.empty=new M(v.empty,0,0);var V=function(t,e,r){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=r},ye={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};V.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},ye.parent.get=function(){return this.node(this.depth)},ye.doc.get=function(){return this.node(0)},V.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},V.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},V.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},V.prototype.start=function(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1},V.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},V.prototype.before=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},V.prototype.after=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},ye.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},ye.nodeAfter.get=function(){var n=this.parent,t=this.index(this.depth);if(t==n.childCount)return null;var e=this.pos-this.path[this.path.length-1],r=n.child(t);return e?n.child(t).cut(e):r},ye.nodeBefore.get=function(){var n=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(n).cut(0,t):0==n?null:this.parent.child(n-1)},V.prototype.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var r=this.path[3*e],o=0==e?0:this.path[3*e-1]+1,i=0;i<t;i++)o+=r.child(i).nodeSize;return o},V.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return O.none;if(this.textOffset)return t.child(e).marks;var r=t.maybeChild(e-1),o=t.maybeChild(e);if(!r){var i=r;r=o,o=i}for(var s=r.marks,a=0;a<s.length;a++)!1===s[a].type.spec.inclusive&&(!o||!s[a].isInSet(o.marks))&&(s=s[a--].removeFromSet(s));return s},V.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var r=e.marks,o=t.parent.maybeChild(t.index()),i=0;i<r.length;i++)!1===r[i].type.spec.inclusive&&(!o||!r[i].isInSet(o.marks))&&(r=r[i--].removeFromSet(r));return r},V.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},V.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var r=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);r>=0;r--)if(t.pos<=this.end(r)&&(!e||e(this.node(r))))return new Ze(this,t,r)},V.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},V.prototype.max=function(t){return t.pos>this.pos?t:this},V.prototype.min=function(t){return t.pos<this.pos?t:this},V.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},V.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var r=[],o=0,i=e,s=t;;){var a=s.content.findIndex(i),l=a.index,u=a.offset,p=i-u;if(r.push(s,l,o+u),!p||(s=s.child(l)).isText)break;i=p-1,o+=u+1}return new V(e,r,i)},V.resolveCached=function(t,e){for(var r=0;r<Xn.length;r++){var o=Xn[r];if(o.pos==e&&o.doc==t)return o}var i=Xn[$n]=V.resolve(t,e);return $n=($n+1)%Aa,i},Object.defineProperties(V.prototype,ye);var Xn=[],$n=0,Aa=12,Ze=function(t,e,r){this.$from=t,this.$to=e,this.depth=r},_e={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};_e.start.get=function(){return this.$from.before(this.depth+1)},_e.end.get=function(){return this.$to.after(this.depth+1)},_e.parent.get=function(){return this.$from.node(this.depth)},_e.startIndex.get=function(){return this.$from.index(this.depth)},_e.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(Ze.prototype,_e);var Pa=Object.create(null),D=function(t,e,r,o){this.type=t,this.attrs=e,this.content=r||v.empty,this.marks=o||O.none},yt={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};yt.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},yt.childCount.get=function(){return this.content.childCount},D.prototype.child=function(t){return this.content.child(t)},D.prototype.maybeChild=function(t){return this.content.maybeChild(t)},D.prototype.forEach=function(t){this.content.forEach(t)},D.prototype.nodesBetween=function(t,e,r,o){void 0===o&&(o=0),this.content.nodesBetween(t,e,r,o,this)},D.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},yt.textContent.get=function(){return this.textBetween(0,this.content.size,"")},D.prototype.textBetween=function(t,e,r,o){return this.content.textBetween(t,e,r,o)},yt.firstChild.get=function(){return this.content.firstChild},yt.lastChild.get=function(){return this.content.lastChild},D.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},D.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},D.prototype.hasMarkup=function(t,e,r){return this.type==t&&vn(this.attrs,e||t.defaultAttrs||Pa)&&O.sameSet(this.marks,r||O.none)},D.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},D.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},D.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},D.prototype.slice=function(t,e,r){if(void 0===e&&(e=this.content.size),void 0===r&&(r=!1),t==e)return M.empty;var o=this.resolve(t),i=this.resolve(e),s=r?0:o.sharedDepth(e),a=o.start(s),u=o.node(s).content.cut(o.pos-a,i.pos-a);return new M(u,o.depth-s,i.depth-s)},D.prototype.replace=function(t,e,r){return Oa(this.resolve(t),this.resolve(e),r)},D.prototype.nodeAt=function(t){for(var e=this;;){var r=e.content.findIndex(t),i=r.offset;if(!(e=e.maybeChild(r.index)))return null;if(i==t||e.isText)return e;t-=i+1}},D.prototype.childAfter=function(t){var e=this.content.findIndex(t),r=e.index,o=e.offset;return{node:this.content.maybeChild(r),index:r,offset:o}},D.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),r=e.index,o=e.offset;if(o<t)return{node:this.content.child(r),index:r,offset:o};var i=this.content.child(r-1);return{node:i,index:r-1,offset:o-i.nodeSize}},D.prototype.resolve=function(t){return V.resolveCached(this,t)},D.prototype.resolveNoCache=function(t){return V.resolve(this,t)},D.prototype.rangeHasMark=function(t,e,r){var o=!1;return e>t&&this.nodesBetween(t,e,function(i){return r.isInSet(i.marks)&&(o=!0),!o}),o},yt.isBlock.get=function(){return this.type.isBlock},yt.isTextblock.get=function(){return this.type.isTextblock},yt.inlineContent.get=function(){return this.type.inlineContent},yt.isInline.get=function(){return this.type.isInline},yt.isText.get=function(){return this.type.isText},yt.isLeaf.get=function(){return this.type.isLeaf},yt.isAtom.get=function(){return this.type.isAtom},D.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),ko(this.marks,t)},D.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},D.prototype.canReplace=function(t,e,r,o,i){void 0===r&&(r=v.empty),void 0===o&&(o=0),void 0===i&&(i=r.childCount);var s=this.contentMatchAt(t).matchFragment(r,o,i),a=s&&s.matchFragment(this.content,e);if(!a||!a.validEnd)return!1;for(var l=o;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0},D.prototype.canReplaceWith=function(t,e,r,o){if(o&&!this.type.allowsMarks(o))return!1;var i=this.contentMatchAt(t).matchType(r),s=i&&i.matchFragment(this.content,e);return!!s&&s.validEnd},D.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},D.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=O.none,e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!O.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(r){return r.type.name}));this.content.forEach(function(r){return r.check()})},D.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(function(r){return r.toJSON()})),t},D.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var r=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,r)}var o=v.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,o,r)},Object.defineProperties(D.prototype,yt);var Ra=function(n){function t(r,o,i,s){if(n.call(this,r,o,null,s),!i)throw new RangeError("Empty text nodes are not allowed");this.text=i}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={textContent:{configurable:!0},nodeSize:{configurable:!0}};return t.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):ko(this.marks,JSON.stringify(this.text))},e.textContent.get=function(){return this.text},t.prototype.textBetween=function(o,i){return this.text.slice(o,i)},e.nodeSize.get=function(){return this.text.length},t.prototype.mark=function(o){return o==this.marks?this:new t(this.type,this.attrs,this.text,o)},t.prototype.withText=function(o){return o==this.text?this:new t(this.type,this.attrs,o,this.marks)},t.prototype.cut=function(o,i){return void 0===o&&(o=0),void 0===i&&(i=this.text.length),0==o&&i==this.text.length?this:this.withText(this.text.slice(o,i))},t.prototype.eq=function(o){return this.sameMarkup(o)&&this.text==o.text},t.prototype.toJSON=function(){var o=n.prototype.toJSON.call(this);return o.text=this.text,o},Object.defineProperties(t.prototype,e),t}(D);function ko(n,t){for(var e=n.length-1;e>=0;e--)t=n[e].type.name+"("+t+")";return t}var lt=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},_n={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};lt.parse=function(t,e){var r=new bn(t,e);if(null==r.next)return lt.empty;var o=To(r);r.next&&r.err("Unexpected trailing text");var i=function(n){var t=Object.create(null);return function e(r){var o=[];r.forEach(function(l){n[l].forEach(function(u){var p=u.term,f=u.to;if(p){var d=o.indexOf(p),h=d>-1&&o[d+1];Eo(n,f).forEach(function(m){h||o.push(p,h=[]),-1==h.indexOf(m)&&h.push(m)})}})});for(var i=t[r.join(",")]=new lt(r.indexOf(n.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(No);i.next.push(o[s],t[a.join(",")]||e(a))}return i}(Eo(n,0))}(function(n){var t=[[]];return o(function i(s,a){if("choice"==s.type)return s.exprs.reduce(function(S,b){return S.concat(i(b,a))},[]);if("seq"==s.type)for(var l=0;;l++){var u=i(s.exprs[l],a);if(l==s.exprs.length-1)return u;o(u,a=e())}else{if("star"==s.type){var p=e();return r(a,p),o(i(s.expr,p),p),[r(p)]}if("plus"==s.type){var f=e();return o(i(s.expr,a),f),o(i(s.expr,f),f),[r(f)]}if("opt"==s.type)return[r(a)].concat(i(s.expr,a));if("range"==s.type){for(var d=a,h=0;h<s.min;h++){var m=e();o(i(s.expr,d),m),d=m}if(-1==s.max)o(i(s.expr,d),d);else for(var g=s.min;g<s.max;g++){var x=e();r(d,x),o(i(s.expr,d),x),d=x}return[r(d)]}if("name"==s.type)return[r(a,null,s.value)]}}(n,0),e()),t;function e(){return t.push([])-1}function r(s,a,l){var u={term:l,to:a};return t[s].push(u),u}function o(s,a){s.forEach(function(l){return l.to=a})}}(o));return function(n,t){for(var e=0,r=[n];e<r.length;e++){for(var o=r[e],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var l=o.next[a],u=o.next[a+1];s.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),-1==r.indexOf(u)&&r.push(u)}i&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(i,r),i},lt.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},lt.prototype.matchFragment=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=t.childCount);for(var o=this,i=e;o&&i<r;i++)o=o.matchType(t.child(i).type);return o},_n.inlineContent.get=function(){var n=this.next[0];return!!n&&n.isInline},_n.defaultType.get=function(){for(var n=0;n<this.next.length;n+=2){var t=this.next[n];if(!t.isText&&!t.hasRequiredAttrs())return t}},lt.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var r=0;r<t.next.length;r+=2)if(this.next[e]==t.next[r])return!0;return!1},lt.prototype.fillBefore=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=0);var o=[this];return function i(s,a){var l=s.matchFragment(t,r);if(l&&(!e||l.validEnd))return v.from(a.map(function(h){return h.createAndFill()}));for(var u=0;u<s.next.length;u+=2){var p=s.next[u],f=s.next[u+1];if(!p.isText&&!p.hasRequiredAttrs()&&-1==o.indexOf(f)){o.push(f);var d=i(f,a.concat(p));if(d)return d}}}(this,[])},lt.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var r=this.computeWrapping(t);return this.wrapCache.push(t,r),r},lt.prototype.computeWrapping=function(t){for(var e=Object.create(null),r=[{match:this,type:null,via:null}];r.length;){var o=r.shift(),i=o.match;if(i.matchType(t)){for(var s=[],a=o;a.type;a=a.via)s.push(a.type);return s.reverse()}for(var l=0;l<i.next.length;l+=2){var u=i.next[l];!u.isLeaf&&!u.hasRequiredAttrs()&&!(u.name in e)&&(!o.type||i.next[l+1].validEnd)&&(r.push({match:u.contentMatch,type:u,via:o}),e[u.name]=!0)}}},_n.edgeCount.get=function(){return this.next.length>>1},lt.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},lt.prototype.toString=function(){var t=[];return function e(r){t.push(r);for(var o=1;o<r.next.length;o+=2)-1==t.indexOf(r.next[o])&&e(r.next[o])}(this),t.map(function(r,o){for(var i=o+(r.validEnd?"*":" ")+" ",s=0;s<r.next.length;s+=2)i+=(s?", ":"")+r.next[s].name+"->"+t.indexOf(r.next[s+1]);return i}).join("\n")},Object.defineProperties(lt.prototype,_n),lt.empty=new lt(!0);var bn=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()},wo={next:{configurable:!0}};function To(n){var t=[];do{t.push(Fa(n))}while(n.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function Fa(n){var t=[];do{t.push(za(n))}while(n.next&&")"!=n.next&&"|"!=n.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function za(n){for(var t=function(n){if(n.eat("(")){var t=To(n);return n.eat(")")||n.err("Missing closing paren"),t}if(!/\W/.test(n.next)){var e=function(n,t){var e=n.nodeTypes,r=e[t];if(r)return[r];var o=[];for(var i in e){var s=e[i];s.groups.indexOf(t)>-1&&o.push(s)}return 0==o.length&&n.err("No node type or group '"+t+"' found"),o}(n,n.next).map(function(r){return null==n.inline?n.inline=r.isInline:n.inline!=r.isInline&&n.err("Mixing inline and block content"),{type:"name",value:r}});return n.pos++,1==e.length?e[0]:{type:"choice",exprs:e}}n.err("Unexpected token '"+n.next+"'")}(n);;)if(n.eat("+"))t={type:"plus",expr:t};else if(n.eat("*"))t={type:"star",expr:t};else if(n.eat("?"))t={type:"opt",expr:t};else{if(!n.eat("{"))break;t=Ba(n,t)}return t}function Io(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");var t=Number(n.next);return n.pos++,t}function Ba(n,t){var e=Io(n),r=e;return n.eat(",")&&(r="}"!=n.next?Io(n):-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:e,max:r,expr:t}}function No(n,t){return t-n}function Eo(n,t){var e=[];return function r(o){var i=n[o];if(1==i.length&&!i[0].term)return r(i[0].to);e.push(o);for(var s=0;s<i.length;s++){var a=i[s],u=a.to;!a.term&&-1==e.indexOf(u)&&r(u)}}(t),e.sort(No)}function Oo(n){var t=Object.create(null);for(var e in n){var r=n[e];if(!r.hasDefault)return null;t[e]=r.default}return t}function Do(n,t){var e=Object.create(null);for(var r in n){var o=t&&t[r];if(void 0===o){var i=n[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}e[r]=o}return e}function Ao(n){var t=Object.create(null);if(n)for(var e in n)t[e]=new Po(n[e]);return t}wo.next.get=function(){return this.tokens[this.pos]},bn.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},bn.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(bn.prototype,wo);var ft=function(t,e,r){this.name=t,this.schema=e,this.spec=r,this.groups=r.group?r.group.split(" "):[],this.attrs=Ao(r.attrs),this.defaultAttrs=Oo(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(r.inline||"text"==t),this.isText="text"==t},be={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0},whitespace:{configurable:!0}};be.isInline.get=function(){return!this.isBlock},be.isTextblock.get=function(){return this.isBlock&&this.inlineContent},be.isLeaf.get=function(){return this.contentMatch==lt.empty},be.isAtom.get=function(){return this.isLeaf||this.spec.atom},be.whitespace.get=function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")},ft.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},ft.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},ft.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:Do(this.attrs,t)},ft.prototype.create=function(t,e,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new D(this,this.computeAttrs(t),v.from(e),O.setFrom(r))},ft.prototype.createChecked=function(t,e,r){if(e=v.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new D(this,this.computeAttrs(t),e,O.setFrom(r))},ft.prototype.createAndFill=function(t,e,r){if(t=this.computeAttrs(t),(e=v.from(e)).size){var o=this.contentMatch.fillBefore(e);if(!o)return null;e=o.append(e)}var i=this.contentMatch.matchFragment(e).fillBefore(v.empty,!0);return i?new D(this,t,e.append(i),O.setFrom(r)):null},ft.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var r=0;r<t.childCount;r++)if(!this.allowsMarks(t.child(r).marks))return!1;return!0},ft.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},ft.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},ft.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,r=0;r<t.length;r++)this.allowsMarkType(t[r].type)?e&&e.push(t[r]):e||(e=t.slice(0,r));return e?e.length?e:O.empty:t},ft.compile=function(t,e){var r=Object.create(null);t.forEach(function(s,a){return r[s]=new ft(s,e,a)});var o=e.spec.topNode||"doc";if(!r[o])throw new RangeError("Schema is missing its top node type ('"+o+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(var i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r},Object.defineProperties(ft.prototype,be);var Po=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},Ro={isRequired:{configurable:!0}};Ro.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(Po.prototype,Ro);var jt=function(t,e,r,o){this.name=t,this.schema=r,this.spec=o,this.attrs=Ao(o.attrs),this.rank=e,this.excluded=null;var i=Oo(this.attrs);this.instance=i&&new O(this,i)};jt.prototype.create=function(t){return!t&&this.instance?this.instance:new O(this,Do(this.attrs,t))},jt.compile=function(t,e){var r=Object.create(null),o=0;return t.forEach(function(i,s){return r[i]=new jt(i,o++,e,s)}),r},jt.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t},jt.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},jt.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var se=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=go.from(t.nodes),this.spec.marks=go.from(t.marks),this.nodes=ft.compile(this.spec.nodes,this),this.marks=jt.compile(this.spec.marks,this);var r=Object.create(null);for(var o in this.nodes){if(o in this.marks)throw new RangeError(o+" can not be both a node and a mark");var i=this.nodes[o],s=i.spec.content||"",a=i.spec.marks;i.contentMatch=r[s]||(r[s]=lt.parse(s,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.markSet="_"==a?null:a?Fo(this,a.split(" ")):""!=a&&i.inlineContent?null:[]}for(var l in this.marks){var u=this.marks[l],p=u.spec.excludes;u.excluded=null==p?[u]:""==p?[]:Fo(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function Fo(n,t){for(var e=[],r=0;r<t.length;r++){var o=t[r],i=n.marks[o],s=i;if(i)e.push(i);else for(var a in n.marks){var l=n.marks[a];("_"==o||l.spec.group&&l.spec.group.split(" ").indexOf(o)>-1)&&e.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[r]+"'")}return e}se.prototype.node=function(t,e,r,o){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof ft))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,r,o)},se.prototype.text=function(t,e){var r=this.nodes.text;return new Ra(r,r.defaultAttrs,t,O.setFrom(e))},se.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},se.prototype.nodeFromJSON=function(t){return D.fromJSON(this,t)},se.prototype.markFromJSON=function(t){return O.fromJSON(this,t)},se.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var Mt=function(t,e){var r=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach(function(o){o.tag?r.tags.push(o):o.style&&r.styles.push(o)}),this.normalizeLists=!this.tags.some(function(o){if(!/^(ul|ol)\b/.test(o.tag)||!o.node)return!1;var i=t.nodes[o.node];return i.contentMatch.matchType(i)})};Mt.prototype.parse=function(t,e){void 0===e&&(e={});var r=new H(this,e,!1);return r.addAll(t,null,e.from,e.to),r.finish()},Mt.prototype.parseSlice=function(t,e){void 0===e&&(e={});var r=new H(this,e,!0);return r.addAll(t,null,e.from,e.to),M.maxOpen(r.finish())},Mt.prototype.matchTag=function(t,e,r){for(var o=r?this.tags.indexOf(r)+1:0;o<this.tags.length;o++){var i=this.tags[o];if(Wa(t,i.tag)&&(void 0===i.namespace||t.namespaceURI==i.namespace)&&(!i.context||e.matchesContext(i.context))){if(i.getAttrs){var s=i.getAttrs(t);if(!1===s)continue;i.attrs=s}return i}}},Mt.prototype.matchStyle=function(t,e,r,o){for(var i=o?this.styles.indexOf(o)+1:0;i<this.styles.length;i++){var s=this.styles[i];if(!(0!=s.style.indexOf(t)||s.context&&!r.matchesContext(s.context)||s.style.length>t.length&&(61!=s.style.charCodeAt(t.length)||s.style.slice(t.length+1)!=e))){if(s.getAttrs){var a=s.getAttrs(e);if(!1===a)continue;s.attrs=a}return s}}},Mt.schemaRules=function(t){var e=[];function r(l){for(var u=null==l.priority?50:l.priority,p=0;p<e.length;p++){var f=e[p];if((null==f.priority?50:f.priority)<u)break}e.splice(p,0,l)}var u,o=function(l){var u=t.marks[l].spec.parseDOM;u&&u.forEach(function(p){r(p=Lo(p)),p.mark=l})};for(var i in t.marks)o(i);for(var a in t.nodes)u=void 0,(u=t.nodes[a].spec.parseDOM)&&u.forEach(function(p){r(p=Lo(p)),p.node=a});return e},Mt.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new Mt(t,Mt.schemaRules(t)))};var tr={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ja={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},zo={ol:!0,ul:!0};function Bo(n,t,e){return null!=t?(t?1:0)|("full"===t?2:0):n&&"pre"==n.whitespace?3:-5&e}var Vt=function(t,e,r,o,i,s,a){this.type=t,this.attrs=e,this.solid=i,this.match=s||(4&a?null:t.contentMatch),this.options=a,this.content=[],this.marks=r,this.activeMarks=O.none,this.pendingMarks=o,this.stashMarks=[]};Vt.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(v.from(t));if(!e){var o,r=this.type.contentMatch;return(o=r.findWrapping(t.type))?(this.match=r,o):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},Vt.prototype.finish=function(t){if(!(1&this.options)){var r,e=this.content[this.content.length-1];e&&e.isText&&(r=/[ \t\r\n\u000c]+$/.exec(e.text))&&(e.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=e.withText(e.text.slice(0,e.text.length-r[0].length)))}var o=v.from(this.content);return!t&&this.match&&(o=o.append(this.match.fillBefore(v.empty,!0))),this.type?this.type.create(this.attrs,o,this.marks):o},Vt.prototype.popFromStashMark=function(t){for(var e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]},Vt.prototype.applyPending=function(t){for(var e=0,r=this.pendingMarks;e<r.length;e++){var o=r[e];(this.type?this.type.allowsMarkType(o.type):Qa(o.type,t))&&!o.isInSet(this.activeMarks)&&(this.activeMarks=o.addToSet(this.activeMarks),this.pendingMarks=o.removeFromSet(this.pendingMarks))}},Vt.prototype.inlineContext=function(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!tr.hasOwnProperty(t.parentNode.nodeName.toLowerCase())};var H=function(t,e,r){this.parser=t,this.options=e,this.isOpen=r;var i,o=e.topNode,s=Bo(null,e.preserveWhitespace,0)|(r?4:0);i=o?new Vt(o.type,o.attrs,O.none,O.none,!0,e.topMatch||o.type.contentMatch,s):new Vt(r?null:t.schema.topNodeType,null,O.none,O.none,!0,null,s),this.nodes=[i],this.open=0,this.find=e.findPositions,this.needsBlock=!1},er={top:{configurable:!0},currentPos:{configurable:!0}};function Wa(n,t){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,t)}function Lo(n){var t={};for(var e in n)t[e]=n[e];return t}function Qa(n,t){var e=t.schema.nodes,r=function(s){var a=e[s];if(a.allowsMarkType(n)){var l=[],u=function(p){l.push(p);for(var f=0;f<p.edgeCount;f++){var d=p.edge(f),m=d.next;if(d.type==t||l.indexOf(m)<0&&u(m))return!0}};if(u(a.contentMatch))return{v:!0}}};for(var o in e){var i=r(o);if(i)return i.v}}er.top.get=function(){return this.nodes[this.open]},H.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),r=e?this.readStyles(function(n){for(var e,t=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];e=t.exec(n);)r.push(e[1],e[2].trim());return r}(e)):null,o=this.top;if(null!=r)for(var i=0;i<r.length;i++)this.addPendingMark(r[i]);if(this.addElement(t),null!=r)for(var s=0;s<r.length;s++)this.removePendingMark(r[s],o)}},H.prototype.addTextNode=function(t){var e=t.nodeValue,r=this.top;if(2&r.options||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(1&r.options)e=2&r.options?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var o=r.content[r.content.length-1],i=t.previousSibling;(!o||i&&"BR"==i.nodeName||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},H.prototype.addElement=function(t,e){var o,r=t.nodeName.toLowerCase();zo.hasOwnProperty(r)&&this.parser.normalizeLists&&function(n){for(var t=n.firstChild,e=null;t;t=t.nextSibling){var r=1==t.nodeType?t.nodeName.toLowerCase():null;r&&zo.hasOwnProperty(r)&&e?(e.appendChild(t),t=e):"li"==r?e=t:r&&(e=null)}}(t);var i=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(o=this.parser.matchTag(t,this,e));if(i?i.ignore:Ja.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(t=i.skip);var s,a=this.top,l=this.needsBlock;if(tr.hasOwnProperty(r))s=!0,a.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),s&&this.sync(a),this.needsBlock=l}else this.addElementByRule(t,i,!1===i.consuming?o:null)},H.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},H.prototype.ignoreFallback=function(t){"BR"==t.nodeName&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))},H.prototype.readStyles=function(t){var e=O.none;t:for(var r=0;r<t.length;r+=2)for(var o=null;;){var i=this.parser.matchStyle(t[r],t[r+1],this,o);if(!i)continue t;if(i.ignore)return null;if(e=this.parser.schema.marks[i.mark].create(i.attrs).addToSet(e),!1!==i.consuming)break;o=i}return e},H.prototype.addElementByRule=function(t,e,r){var i,s,l,o=this;e.node?(s=this.parser.schema.nodes[e.node]).isLeaf?this.insertNode(s.create(e.attrs))||this.leafFallback(t):i=this.enter(s,e.attrs,e.preserveWhitespace):(l=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(l));var u=this.top;if(s&&s.isLeaf)this.findInside(t);else if(r)this.addElement(t,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(function(f){return o.insertNode(f)});else{var p=e.contentElement;"string"==typeof p?p=t.querySelector(p):"function"==typeof p&&(p=p(t)),p||(p=t),this.findAround(t,p,!0),this.addAll(p,i)}i&&(this.sync(u),this.open--),l&&this.removePendingMark(l,u)},H.prototype.addAll=function(t,e,r,o){for(var i=r||0,s=r?t.childNodes[r]:t.firstChild,a=null==o?null:t.childNodes[o];s!=a;s=s.nextSibling,++i)this.findAtPoint(t,i),this.addDOM(s),e&&tr.hasOwnProperty(s.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,i)},H.prototype.findPlace=function(t){for(var e,r,o=this.open;o>=0;o--){var i=this.nodes[o],s=i.findWrapping(t);if(s&&(!e||e.length>s.length)&&(e=s,r=i,!s.length)||i.solid)break}if(!e)return!1;this.sync(r);for(var a=0;a<e.length;a++)this.enterInner(e[a],null,!1);return!0},H.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var r=this.top;r.applyPending(t.type),r.match&&(r.match=r.match.matchType(t.type));for(var o=r.activeMarks,i=0;i<t.marks.length;i++)(!r.type||r.type.allowsMarkType(t.marks[i].type))&&(o=t.marks[i].addToSet(o));return r.content.push(t.mark(o)),!0}return!1},H.prototype.enter=function(t,e,r){var o=this.findPlace(t.create(e));return o&&this.enterInner(t,e,!0,r),o},H.prototype.enterInner=function(t,e,r,o){this.closeExtra();var i=this.top;i.applyPending(t),i.match=i.match&&i.match.matchType(t,e);var s=Bo(t,o,i.options);4&i.options&&0==i.content.length&&(s|=4),this.nodes.push(new Vt(t,e,i.activeMarks,i.pendingMarks,r,null,s)),this.open++},H.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},H.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},H.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},er.currentPos.get=function(){this.closeExtra();for(var n=0,t=this.open;t>=0;t--){for(var e=this.nodes[t].content,r=e.length-1;r>=0;r--)n+=e[r].nodeSize;t&&n++}return n},H.prototype.findAtPoint=function(t,e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==t&&this.find[r].offset==e&&(this.find[r].pos=this.currentPos)},H.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},H.prototype.findAround=function(t,e,r){if(t!=e&&this.find)for(var o=0;o<this.find.length;o++)null==this.find[o].pos&&1==t.nodeType&&t.contains(this.find[o].node)&&e.compareDocumentPosition(this.find[o].node)&(r?2:4)&&(this.find[o].pos=this.currentPos)},H.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},H.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var r=t.split("/"),o=this.options.context,i=!(this.isOpen||o&&o.parent.type!=this.nodes[0].type),s=(i?0:1)-(o?o.depth+1:0),a=function(l,u){for(;l>=0;l--){var p=r[l];if(""==p){if(l==r.length-1||0==l)continue;for(;u>=s;u--)if(a(l-1,u))return!0;return!1}var f=u>0||0==u&&i?e.nodes[u].type:o&&u>=s?o.node(u-s).type:null;if(!f||f.name!=p&&-1==f.groups.indexOf(p))return!1;u--}return!0};return a(r.length-1,this.open)},H.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var r=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(var o in this.parser.schema.nodes){var i=this.parser.schema.nodes[o];if(i.isTextblock&&i.defaultAttrs)return i}},H.prototype.addPendingMark=function(t){var e=function(n,t){for(var e=0;e<t.length;e++)if(n.eq(t[e]))return t[e]}(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},H.prototype.removePendingMark=function(t,e){for(var r=this.open;r>=0;r--){var o=this.nodes[r];if(o.pendingMarks.lastIndexOf(t)>-1)o.pendingMarks=t.removeFromSet(o.pendingMarks);else{o.activeMarks=t.removeFromSet(o.activeMarks);var s=o.popFromStashMark(t);s&&o.type&&o.type.allowsMarkType(s.type)&&(o.activeMarks=s.addToSet(o.activeMarks))}if(o==e)break}},Object.defineProperties(H.prototype,er);var et=function(t,e){this.nodes=t||{},this.marks=e||{}};function Ho(n){var t={};for(var e in n){var r=n[e].spec.toDOM;r&&(t[e]=r)}return t}function nr(n){return n.document||window.document}et.prototype.serializeFragment=function(t,e,r){var o=this;void 0===e&&(e={}),r||(r=nr(e).createDocumentFragment());var i=r,s=null;return t.forEach(function(a){if(s||a.marks.length){s||(s=[]);for(var l=0,u=0;l<s.length&&u<a.marks.length;){var p=a.marks[u];if(o.marks[p.type.name]){if(!p.eq(s[l])||!1===p.type.spec.spanning)break;l+=2,u++}else u++}for(;l<s.length;)i=s.pop(),s.pop();for(;u<a.marks.length;){var f=a.marks[u++],d=o.serializeMark(f,a.isInline,e);d&&(s.push(f,i),i.appendChild(d.dom),i=d.contentDOM||d.dom)}}i.appendChild(o.serializeNodeInner(a,e))}),r},et.prototype.serializeNodeInner=function(t,e){void 0===e&&(e={});var r=et.renderSpec(nr(e),this.nodes[t.type.name](t)),o=r.dom,i=r.contentDOM;if(i){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,i,e):this.serializeFragment(t.content,e,i)}return o},et.prototype.serializeNode=function(t,e){void 0===e&&(e={});for(var r=this.serializeNodeInner(t,e),o=t.marks.length-1;o>=0;o--){var i=this.serializeMark(t.marks[o],t.isInline,e);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r},et.prototype.serializeMark=function(t,e,r){void 0===r&&(r={});var o=this.marks[t.type.name];return o&&et.renderSpec(nr(r),o(t,e))},et.renderSpec=function(t,e,r){if(void 0===r&&(r=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;var o=e[0],i=o.indexOf(" ");i>0&&(r=o.slice(0,i),o=o.slice(i+1));var s=null,a=r?t.createElementNS(r,o):t.createElement(o),l=e[1],u=1;if(l&&"object"==typeof l&&null==l.nodeType&&!Array.isArray(l))for(var p in u=2,l)if(null!=l[p]){var f=p.indexOf(" ");f>0?a.setAttributeNS(p.slice(0,f),p.slice(f+1),l[p]):a.setAttribute(p,l[p])}for(var d=u;d<e.length;d++){var h=e[d];if(0===h){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}var m=et.renderSpec(t,h,r),x=m.contentDOM;if(a.appendChild(m.dom),x){if(s)throw new RangeError("Multiple content holes");s=x}}return{dom:a,contentDOM:s}},et.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new et(this.nodesFromSchema(t),this.marksFromSchema(t)))},et.nodesFromSchema=function(t){var e=Ho(t.nodes);return e.text||(e.text=function(r){return r.text}),e},et.marksFromSchema=function(t){return Ho(t.marks)};var Zo=Math.pow(2,16);function Ga(n,t){return n+t*Zo}function qo(n){return 65535&n}var rr=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=null),this.pos=t,this.deleted=e,this.recover=r},nt=function n(t,e){if(void 0===e&&(e=!1),!t.length&&n.empty)return n.empty;this.ranges=t,this.inverted=e};nt.prototype.recover=function(t){var n,e=0,r=qo(t);if(!this.inverted)for(var o=0;o<r;o++)e+=this.ranges[3*o+2]-this.ranges[3*o+1];return this.ranges[3*r]+e+((n=t)-(65535&n))/Zo},nt.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},nt.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},nt.prototype._map=function(t,e,r){for(var o=0,i=this.inverted?2:1,s=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var l=this.ranges[a]-(this.inverted?o:0);if(l>t)break;var u=this.ranges[a+i],p=this.ranges[a+s],f=l+u;if(t<=f){var h=l+o+((u?t==l?-1:t==f?1:e:e)<0?0:p);if(r)return h;var m=t==(e<0?l:f)?null:Ga(a/3,t-l);return new rr(h,e<0?t!=l:t!=f,m)}o+=p-u}return r?t+o:new rr(t+o)},nt.prototype.touches=function(t,e){for(var r=0,o=qo(e),i=this.inverted?2:1,s=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var l=this.ranges[a]-(this.inverted?r:0);if(l>t)break;var u=this.ranges[a+i];if(t<=l+u&&a==3*o)return!0;r+=this.ranges[a+s]-u}return!1},nt.prototype.forEach=function(t){for(var e=this.inverted?2:1,r=this.inverted?1:2,o=0,i=0;o<this.ranges.length;o+=3){var s=this.ranges[o],a=s-(this.inverted?i:0),l=s+(this.inverted?0:i),u=this.ranges[o+e],p=this.ranges[o+r];t(a,a+u,l,l+p),i+=p-u}},nt.prototype.invert=function(){return new nt(this.ranges,!this.inverted)},nt.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},nt.offset=function(t){return 0==t?nt.empty:new nt(t<0?[0,-t,0]:[0,0,t])},nt.empty=new nt([]);var ct=function(t,e,r,o){this.maps=t||[],this.from=r||0,this.to=null==o?this.maps.length:o,this.mirror=e};function xe(n){var t=Error.call(this,n);return t.__proto__=xe.prototype,t}ct.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new ct(this.maps,this.mirror,t,e)},ct.prototype.copy=function(){return new ct(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},ct.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},ct.prototype.appendMapping=function(t){for(var e=0,r=this.maps.length;e<t.maps.length;e++){var o=t.getMirror(e);this.appendMap(t.maps[e],null!=o&&o<e?r+o:null)}},ct.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},ct.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},ct.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){var o=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=o&&o>e?r-o-1:null)}},ct.prototype.invert=function(){var t=new ct;return t.appendMappingInverted(this),t},ct.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t},ct.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},ct.prototype._map=function(t,e,r){for(var o=!1,i=this.from;i<this.to;i++){var a=this.maps[i].mapResult(t,e);if(null!=a.recover){var l=this.getMirror(i);if(null!=l&&l>i&&l<this.to){i=l,t=this.maps[l].recover(a.recover);continue}}a.deleted&&(o=!0),t=a.pos}return r?t:new rr(t,o)},(xe.prototype=Object.create(Error.prototype)).constructor=xe,xe.prototype.name="TransformError";var J=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new ct},or={before:{configurable:!0},docChanged:{configurable:!0}};function Mn(){throw new Error("Override me")}or.before.get=function(){return this.docs.length?this.docs[0]:this.doc},J.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new xe(e.failed);return this},J.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},or.docChanged.get=function(){return this.steps.length>0},J.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(J.prototype,or);var ir=Object.create(null),ut=function(){};ut.prototype.apply=function(t){return Mn()},ut.prototype.getMap=function(){return nt.empty},ut.prototype.invert=function(t){return Mn()},ut.prototype.map=function(t){return Mn()},ut.prototype.merge=function(t){return null},ut.prototype.toJSON=function(){return Mn()},ut.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var r=ir[e.stepType];if(!r)throw new RangeError("No step type "+e.stepType+" defined");return r.fromJSON(t,e)},ut.jsonID=function(t,e){if(t in ir)throw new RangeError("Duplicate use of step JSON ID "+t);return ir[t]=e,e.prototype.jsonID=t,e};var dt=function(t,e){this.doc=t,this.failed=e};dt.ok=function(t){return new dt(t,null)},dt.fail=function(t){return new dt(null,t)},dt.fromReplace=function(t,e,r,o){try{return dt.ok(t.replace(e,r,o))}catch(i){if(i instanceof Pt)return dt.fail(i.message);throw i}};var Qt=function(n){function t(e,r,o,i){n.call(this),this.from=e,this.to=r,this.slice=o,this.structure=!!i}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){return this.structure&&sr(r,this.from,this.to)?dt.fail("Structure replace would overwrite content"):dt.fromReplace(r,this.from,this.to,this.slice)},t.prototype.getMap=function(){return new nt([this.from,this.to-this.from,this.slice.size])},t.prototype.invert=function(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))},t.prototype.map=function(r){var o=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);return o.deleted&&i.deleted?null:new t(o.pos,Math.max(o.pos,i.pos),this.slice)},t.prototype.merge=function(r){if(!(r instanceof t)||r.structure||this.structure)return null;if(this.from+this.slice.size!=r.from||this.slice.openEnd||r.slice.openStart){if(r.to!=this.from||this.slice.openStart||r.slice.openEnd)return null;var i=this.slice.size+r.slice.size==0?M.empty:new M(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,i,this.structure)}var o=this.slice.size+r.slice.size==0?M.empty:new M(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),o,this.structure)},t.prototype.toJSON=function(){var r={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,o){if("number"!=typeof o.from||"number"!=typeof o.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new t(o.from,o.to,M.fromJSON(r,o.slice),!!o.structure)},t}(ut);ut.jsonID("replace",Qt);var _t=function(n){function t(e,r,o,i,s,a,l){n.call(this),this.from=e,this.to=r,this.gapFrom=o,this.gapTo=i,this.slice=s,this.insert=a,this.structure=!!l}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){if(this.structure&&(sr(r,this.from,this.gapFrom)||sr(r,this.gapTo,this.to)))return dt.fail("Structure gap-replace would overwrite content");var o=r.slice(this.gapFrom,this.gapTo);if(o.openStart||o.openEnd)return dt.fail("Gap is not a flat range");var i=this.slice.insertAt(this.insert,o.content);return i?dt.fromReplace(r,this.from,this.to,i):dt.fail("Content does not fit in gap")},t.prototype.getMap=function(){return new nt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},t.prototype.invert=function(r){var o=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+o,this.from+this.insert,this.from+this.insert+o,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},t.prototype.map=function(r){var o=r.mapResult(this.from,1),i=r.mapResult(this.to,-1),s=r.map(this.gapFrom,-1),a=r.map(this.gapTo,1);return o.deleted&&i.deleted||s<o.pos||a>i.pos?null:new t(o.pos,i.pos,s,a,this.slice,this.insert,this.structure)},t.prototype.toJSON=function(){var r={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,o){if("number"!=typeof o.from||"number"!=typeof o.to||"number"!=typeof o.gapFrom||"number"!=typeof o.gapTo||"number"!=typeof o.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new t(o.from,o.to,o.gapFrom,o.gapTo,M.fromJSON(r,o.slice),o.insert,!!o.structure)},t}(ut);function sr(n,t,e){for(var r=n.resolve(t),o=e-t,i=r.depth;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0)for(var s=r.node(i).maybeChild(r.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function Xa(n,t,e){return(0==t||n.canReplace(t,n.childCount))&&(e==n.childCount||n.canReplace(0,e))}function Je(n){for(var e=n.parent.content.cutByIndex(n.startIndex,n.endIndex),r=n.depth;;--r){var o=n.$from.node(r),i=n.$from.index(r),s=n.$to.indexAfter(r);if(r<n.depth&&o.canReplace(i,s,e))return r;if(0==r||o.type.spec.isolating||!Xa(o,i,s))break}}function ar(n,t,e,r){void 0===r&&(r=n);var o=function(n,t){var e=n.parent,r=n.startIndex,o=n.endIndex,i=e.contentMatchAt(r).findWrapping(t);return i&&e.canReplaceWith(r,o,i.length?i[0]:t)?i:null}(n,t),i=o&&function(n,t){var e=n.parent,r=n.startIndex,o=n.endIndex,i=e.child(r),s=t.contentMatch.findWrapping(i.type);if(!s)return null;for(var l=(s.length?s[s.length-1]:t).contentMatch,u=r;l&&u<o;u++)l=l.matchType(e.child(u).type);return l&&l.validEnd?s:null}(r,t);return i?o.map(Jo).concat({type:t,attrs:e}).concat(i.map(Jo)):null}function Jo(n){return{type:n,attrs:null}}function Se(n,t,e,r){void 0===e&&(e=1);var o=n.resolve(t),i=o.depth-e,s=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var a=o.depth-1,l=e-2;a>i;a--,l--){var u=o.node(a),p=o.index(a);if(u.type.spec.isolating)return!1;var f=u.content.cutByIndex(p,u.childCount),d=r&&r[l]||u;if(d!=u&&(f=f.replaceChild(0,d.type.create(d.attrs))),!u.canReplace(p+1,u.childCount)||!d.type.validContent(f))return!1}var h=o.indexAfter(i),m=r&&r[0];return o.node(i).canReplaceWith(h,h,m?m.type:o.node(i+1).type)}function lr(n,t){var e=n.resolve(t),r=e.index();return function(n,t){return n&&t&&!n.isLeaf&&n.canAppend(t)}(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(r,r+1)}function cr(n,t,e){for(var r=[],o=0;o<n.childCount;o++){var i=n.child(o);i.content.size&&(i=i.copy(cr(i.content,t,i))),i.isInline&&(i=t(i,e,o)),r.push(i)}return v.fromArray(r)}ut.jsonID("replaceAround",_t),J.prototype.lift=function(n,t){for(var e=n.$from,r=n.$to,o=n.depth,i=e.before(o+1),s=r.after(o+1),a=i,l=s,u=v.empty,p=0,f=o,d=!1;f>t;f--)d||e.index(f)>0?(d=!0,u=v.from(e.node(f).copy(u)),p++):a--;for(var h=v.empty,m=0,g=o,x=!1;g>t;g--)x||r.after(g+1)<r.end(g)?(x=!0,h=v.from(r.node(g).copy(h)),m++):l++;return this.step(new _t(a,l,i,s,new M(u.append(h),p,m),u.size-p,!0))},J.prototype.wrap=function(n,t){for(var e=v.empty,r=t.length-1;r>=0;r--){if(e.size){var o=t[r].type.contentMatch.matchFragment(e);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}e=v.from(t[r].type.create(t[r].attrs,e))}var i=n.start,s=n.end;return this.step(new _t(i,s,i,s,new M(e,0,0),t.length,!0))},J.prototype.setBlockType=function(n,t,e,r){var o=this;if(void 0===t&&(t=n),!e.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=this.steps.length;return this.doc.nodesBetween(n,t,function(s,a){if(s.isTextblock&&!s.hasMarkup(e,r)&&function(n,t,e){var r=n.resolve(t),o=r.index();return r.parent.canReplaceWith(o,o+1,e)}(o.doc,o.mapping.slice(i).map(a),e)){o.clearIncompatible(o.mapping.slice(i).map(a,1),e);var l=o.mapping.slice(i),u=l.map(a,1),p=l.map(a+s.nodeSize,1);return o.step(new _t(u,p,u+1,p-1,new M(v.from(e.create(r,null,s.marks)),0,0),1,!0)),!1}}),this},J.prototype.setNodeMarkup=function(n,t,e,r){var o=this.doc.nodeAt(n);if(!o)throw new RangeError("No node at given position");t||(t=o.type);var i=t.create(e,null,r||o.marks);if(o.isLeaf)return this.replaceWith(n,n+o.nodeSize,i);if(!t.validContent(o.content))throw new RangeError("Invalid content for node type "+t.name);return this.step(new _t(n,n+o.nodeSize,n+1,n+o.nodeSize-1,new M(v.from(i),0,0),1,!0))},J.prototype.split=function(n,t,e){void 0===t&&(t=1);for(var r=this.doc.resolve(n),o=v.empty,i=v.empty,s=r.depth,a=r.depth-t,l=t-1;s>a;s--,l--){o=v.from(r.node(s).copy(o));var u=e&&e[l];i=v.from(u?u.type.create(u.attrs,i):r.node(s).copy(i))}return this.step(new Qt(n,n,new M(o.append(i),t,t),!0))},J.prototype.join=function(n,t){void 0===t&&(t=1);var e=new Qt(n-t,n+t,M.empty,!0);return this.step(e)};var ur=function(n){function t(e,r,o){n.call(this),this.from=e,this.to=r,this.mark=o}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){var o=this,i=r.slice(this.from,this.to),s=r.resolve(this.from),a=s.node(s.sharedDepth(this.to)),l=new M(cr(i.content,function(u,p){return u.isAtom&&p.type.allowsMarkType(o.mark.type)?u.mark(o.mark.addToSet(u.marks)):u},a),i.openStart,i.openEnd);return dt.fromReplace(r,this.from,this.to,l)},t.prototype.invert=function(){return new Ue(this.from,this.to,this.mark)},t.prototype.map=function(r){var o=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);return o.deleted&&i.deleted||o.pos>=i.pos?null:new t(o.pos,i.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,o){if("number"!=typeof o.from||"number"!=typeof o.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new t(o.from,o.to,r.markFromJSON(o.mark))},t}(ut);ut.jsonID("addMark",ur);var Ue=function(n){function t(e,r,o){n.call(this),this.from=e,this.to=r,this.mark=o}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){var o=this,i=r.slice(this.from,this.to),s=new M(cr(i.content,function(a){return a.mark(o.mark.removeFromSet(a.marks))}),i.openStart,i.openEnd);return dt.fromReplace(r,this.from,this.to,s)},t.prototype.invert=function(){return new ur(this.from,this.to,this.mark)},t.prototype.map=function(r){var o=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);return o.deleted&&i.deleted||o.pos>=i.pos?null:new t(o.pos,i.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,o){if("number"!=typeof o.from||"number"!=typeof o.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new t(o.from,o.to,r.markFromJSON(o.mark))},t}(ut);function pr(n,t,e,r){if(void 0===e&&(e=t),void 0===r&&(r=M.empty),t==e&&!r.size)return null;var o=n.resolve(t),i=n.resolve(e);return Wo(o,i,r)?new Qt(t,e,r):new Ct(o,i,r).fit()}function Wo(n,t,e){return!e.openStart&&!e.openEnd&&n.start()==t.start()&&n.parent.canReplace(n.index(),t.index(),e.content)}ut.jsonID("removeMark",Ue),J.prototype.addMark=function(n,t,e){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(n,t,function(l,u,p){if(l.isInline){var f=l.marks;if(!e.isInSet(f)&&p.type.allowsMarkType(e.type)){for(var d=Math.max(u,n),h=Math.min(u+l.nodeSize,t),m=e.addToSet(f),g=0;g<f.length;g++)f[g].isInSet(m)||(s&&s.to==d&&s.mark.eq(f[g])?s.to=h:o.push(s=new Ue(d,h,f[g])));a&&a.to==d?a.to=h:i.push(a=new ur(d,h,e))}}}),o.forEach(function(l){return r.step(l)}),i.forEach(function(l){return r.step(l)}),this},J.prototype.removeMark=function(n,t,e){var r=this;void 0===e&&(e=null);var o=[],i=0;return this.doc.nodesBetween(n,t,function(s,a){if(s.isInline){i++;var l=null;if(e instanceof jt)for(var p,u=s.marks;p=e.isInSet(u);)(l||(l=[])).push(p),u=p.removeFromSet(u);else e?e.isInSet(s.marks)&&(l=[e]):l=s.marks;if(l&&l.length)for(var f=Math.min(a+s.nodeSize,t),d=0;d<l.length;d++){for(var h=l[d],m=void 0,g=0;g<o.length;g++){var x=o[g];x.step==i-1&&h.eq(o[g].style)&&(m=x)}m?(m.to=f,m.step=i):o.push({style:h,from:Math.max(a,n),to:f,step:i})}}}),o.forEach(function(s){return r.step(new Ue(s.from,s.to,s.style))}),this},J.prototype.clearIncompatible=function(n,t,e){void 0===e&&(e=t.contentMatch);for(var r=this.doc.nodeAt(n),o=[],i=n+1,s=0;s<r.childCount;s++){var a=r.child(s),l=i+a.nodeSize,u=e.matchType(a.type,a.attrs);if(u){e=u;for(var p=0;p<a.marks.length;p++)t.allowsMarkType(a.marks[p].type)||this.step(new Ue(i,l,a.marks[p]))}else o.push(new Qt(i,l,M.empty));i=l}if(!e.validEnd){var f=e.fillBefore(v.empty,!0);this.replace(i,i,new M(f,0,0))}for(var d=o.length-1;d>=0;d--)this.step(o[d]);return this},J.prototype.replace=function(n,t,e){void 0===t&&(t=n),void 0===e&&(e=M.empty);var r=pr(this.doc,n,t,e);return r&&this.step(r),this},J.prototype.replaceWith=function(n,t,e){return this.replace(n,t,new M(v.from(e),0,0))},J.prototype.delete=function(n,t){return this.replace(n,t,M.empty)},J.prototype.insert=function(n,t){return this.replaceWith(n,n,t)};var Ct=function(t,e,r){this.$to=e,this.$from=t,this.unplaced=r,this.frontier=[];for(var o=0;o<=t.depth;o++){var i=t.node(o);this.frontier.push({type:i.type,match:i.contentMatchAt(t.indexAfter(o))})}this.placed=v.empty;for(var s=t.depth;s>0;s--)this.placed=v.from(t.node(s).copy(this.placed))},jo={depth:{configurable:!0}};function We(n,t,e){return 0==t?n.cutByIndex(e):n.replaceChild(0,n.firstChild.copy(We(n.firstChild.content,t-1,e)))}function je(n,t,e){return 0==t?n.append(e):n.replaceChild(n.childCount-1,n.lastChild.copy(je(n.lastChild.content,t-1,e)))}function fr(n,t){for(var e=0;e<t;e++)n=n.firstChild.content;return n}function Qo(n,t,e){if(t<=0)return n;var r=n.content;return t>1&&(r=r.replaceChild(0,Qo(r.firstChild,t-1,1==r.childCount?e-1:0))),t>0&&(r=n.type.contentMatch.fillBefore(r).append(r),e<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(v.empty,!0)))),n.copy(r)}function dr(n,t,e,r,o){var i=n.node(t),s=o?n.indexAfter(t):n.index(t);if(s==i.childCount&&!e.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!function(n,t,e){for(var r=e;r<t.childCount;r++)if(!n.allowsMarks(t.child(r).marks))return!0;return!1}(e,i.content,s)?a:null}function Ko(n,t,e,r,o){if(t<e){var i=n.firstChild;n=n.replaceChild(0,i.copy(Ko(i.content,t+1,e,r,i)))}if(t>r){var s=o.contentMatchAt(0),a=s.fillBefore(n).append(n);n=a.append(s.matchFragment(a).fillBefore(v.empty,!0))}return n}function Go(n,t){for(var e=[],o=Math.min(n.depth,t.depth);o>=0;o--){var i=n.start(o);if(i<n.pos-(n.depth-o)||t.end(o)>t.pos+(t.depth-o)||n.node(o).type.spec.isolating||t.node(o).type.spec.isolating)break;(i==t.start(o)||o==n.depth&&o==t.depth&&n.parent.inlineContent&&t.parent.inlineContent&&o&&t.start(o-1)==i-1)&&e.push(o)}return e}jo.depth.get=function(){return this.frontier.length-1},Ct.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,o=this.$from,i=this.close(e<0?this.$to:o.doc.resolve(e));if(!i)return null;for(var s=this.placed,a=o.depth,l=i.depth;a&&l&&1==s.childCount;)s=s.firstChild.content,a--,l--;var u=new M(s,a,l);return e>-1?new _t(o.pos,e,this.$to.pos,this.$to.end(),u,r):u.size||o.pos!=this.$to.pos?new Qt(o.pos,i.pos,u):void 0},Ct.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--)for(var o=void 0,i=(e?(o=fr(this.unplaced.content,e-1).firstChild).content:this.unplaced.content).firstChild,s=this.depth;s>=0;s--){var a=this.frontier[s],l=a.type,u=a.match,p=void 0,f=void 0;if(1==t&&(i?u.matchType(i.type)||(f=u.fillBefore(v.from(i),!1)):l.compatibleContent(o.type)))return{sliceDepth:e,frontierDepth:s,parent:o,inject:f};if(2==t&&i&&(p=u.findWrapping(i.type)))return{sliceDepth:e,frontierDepth:s,parent:o,wrap:p};if(o&&u.matchType(o.type))break}},Ct.prototype.openMore=function(){var t=this.unplaced,e=t.content,r=t.openStart,o=t.openEnd,i=fr(e,r);return!(!i.childCount||i.firstChild.isLeaf||(this.unplaced=new M(e,r+1,Math.max(o,i.size+r>=e.size-o?r+1:0)),0))},Ct.prototype.dropNode=function(){var t=this.unplaced,e=t.content,r=t.openStart,o=t.openEnd,i=fr(e,r);if(i.childCount<=1&&r>0){var s=e.size-r<=r+i.size;this.unplaced=new M(We(e,r-1,1),r-1,s?r-1:o)}else this.unplaced=new M(We(e,r,1),r,o)},Ct.prototype.placeNodes=function(t){for(var e=t.sliceDepth,r=t.frontierDepth,o=t.parent,i=t.inject,s=t.wrap;this.depth>r;)this.closeFrontierNode();if(s)for(var a=0;a<s.length;a++)this.openFrontierNode(s[a]);var l=this.unplaced,u=o?o.content:l.content,p=l.openStart-e,f=0,d=[],h=this.frontier[r],m=h.match,g=h.type;if(i){for(var x=0;x<i.childCount;x++)d.push(i.child(x));m=m.matchFragment(i)}for(var S=u.size+e-(l.content.size-l.openEnd);f<u.childCount;){var b=u.child(f),N=m.matchType(b.type);if(!N)break;(++f>1||0==p||b.content.size)&&(m=N,d.push(Qo(b.mark(g.allowedMarks(b.marks)),1==f?p:0,f==u.childCount?S:-1)))}var w=f==u.childCount;w||(S=-1),this.placed=je(this.placed,r,v.from(d)),this.frontier[r].match=m,w&&S<0&&o&&o.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var I=0,A=u;I<S;I++){var j=A.lastChild;this.frontier.push({type:j.type,match:j.contentMatchAt(j.childCount)}),A=j.content}this.unplaced=w?0==e?M.empty:new M(We(l.content,e-1,1),e-1,S<0?l.openEnd:e-1):new M(We(l.content,e,f),l.openStart,l.openEnd)},Ct.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e,t=this.frontier[this.depth];if(!t.type.isTextblock||!dr(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;for(var o=this.$to.depth,i=this.$to.after(o);o>1&&i==this.$to.end(--o);)++i;return i},Ct.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var r=this.frontier[e],o=r.match,i=r.type,s=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),a=dr(t,e,i,o,s);if(a){for(var l=e-1;l>=0;l--){var u=this.frontier[l],d=dr(t,l,u.type,u.match,!0);if(!d||d.childCount)continue t}return{depth:e,fit:a,move:s?t.doc.resolve(t.after(e+1)):t}}}},Ct.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=je(this.placed,e.depth,e.fit)),t=e.move;for(var r=e.depth+1;r<=t.depth;r++){var o=t.node(r),i=o.type.contentMatch.fillBefore(o.content,!0,t.index(r));this.openFrontierNode(o.type,o.attrs,i)}return t},Ct.prototype.openFrontierNode=function(t,e,r){var o=this.frontier[this.depth];o.match=o.match.matchType(t),this.placed=je(this.placed,this.depth,v.from(t.create(e,r))),this.frontier.push({type:t,match:t.contentMatch})},Ct.prototype.closeFrontierNode=function(){var e=this.frontier.pop().match.fillBefore(v.empty,!0);e.childCount&&(this.placed=je(this.placed,this.frontier.length,e))},Object.defineProperties(Ct.prototype,jo),J.prototype.replaceRange=function(n,t,e){if(!e.size)return this.deleteRange(n,t);var r=this.doc.resolve(n),o=this.doc.resolve(t);if(Wo(r,o,e))return this.step(new Qt(n,t,e));var i=Go(r,this.doc.resolve(t));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,l=r.pos-1;a>0;a--,l--){var u=r.node(a).type.spec;if(u.defining||u.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==l&&i.splice(1,0,-a)}for(var p=i.indexOf(s),f=[],d=e.openStart,h=e.content,m=0;;m++){var g=h.firstChild;if(f.push(g),m==e.openStart)break;h=g.content}d>0&&f[d-1].type.spec.defining&&r.node(p).type!=f[d-1].type?d-=1:d>=2&&f[d-1].isTextblock&&f[d-2].type.spec.defining&&r.node(p).type!=f[d-2].type&&(d-=2);for(var x=e.openStart;x>=0;x--){var S=(x+d+1)%(e.openStart+1),b=f[S];if(b)for(var N=0;N<i.length;N++){var w=i[(N+p)%i.length],I=!0;w<0&&(I=!1,w=-w);var A=r.node(w-1),j=r.index(w-1);if(A.canReplaceWith(j,j,b.type,b.marks))return this.replace(r.before(w),I?o.after(w):t,new M(Ko(e.content,0,e.openStart,S),S,e.openEnd))}}for(var U=this.steps.length,K=i.length-1;K>=0&&(this.replace(n,t,e),!(this.steps.length>U));K--){var X=i[K];X<0||(n=r.before(X),t=o.after(X))}return this},J.prototype.replaceRangeWith=function(n,t,e){if(!e.isInline&&n==t&&this.doc.resolve(n).parent.content.size){var r=function(n,t,e){var r=n.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),e))return t;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,e))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,e))return r.after(s+1);if(a<r.node(s).childCount)return null}}(this.doc,n,e.type);null!=r&&(n=t=r)}return this.replaceRange(n,t,new M(v.from(e),0,0))},J.prototype.deleteRange=function(n,t){for(var e=this.doc.resolve(n),r=this.doc.resolve(t),o=Go(e,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||e.node(s).type.contentMatch.validEnd)return this.delete(e.start(s),r.end(s));if(s>0&&(a||e.node(s-1).canReplace(e.index(s-1),r.indexAfter(s-1))))return this.delete(e.before(s),r.after(s))}for(var l=1;l<=e.depth&&l<=r.depth;l++)if(n-e.start(l)==e.depth-l&&t>e.end(l)&&r.end(l)-t!=r.depth-l)return this.delete(e.before(l),t);return this.delete(n,t)};var hr=Object.create(null),P=function(t,e,r){this.ranges=r||[new il(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},Kt={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Kt.anchor.get=function(){return this.$anchor.pos},Kt.head.get=function(){return this.$head.pos},Kt.from.get=function(){return this.$from.pos},Kt.to.get=function(){return this.$to.pos},Kt.$from.get=function(){return this.ranges[0].$from},Kt.$to.get=function(){return this.ranges[0].$to},Kt.empty.get=function(){for(var n=this.ranges,t=0;t<n.length;t++)if(n[t].$from.pos!=n[t].$to.pos)return!1;return!0},P.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},P.prototype.replace=function(t,e){void 0===e&&(e=M.empty);for(var r=e.content.lastChild,o=null,i=0;i<e.openEnd;i++)o=r,r=r.lastChild;for(var s=t.steps.length,a=this.ranges,l=0;l<a.length;l++){var u=a[l],p=u.$from,f=u.$to,d=t.mapping.slice(s);t.replaceRange(d.map(p.pos),d.map(f.pos),l?M.empty:e),0==l&&Yo(t,s,(r?r.isInline:o&&o.isTextblock)?-1:1)}},P.prototype.replaceWith=function(t,e){for(var r=t.steps.length,o=this.ranges,i=0;i<o.length;i++){var s=o[i],a=s.$from,l=s.$to,u=t.mapping.slice(r),p=u.map(a.pos),f=u.map(l.pos);i?t.deleteRange(p,f):(t.replaceRangeWith(p,f,e),Yo(t,r,e.isInline?-1:1))}},P.findFrom=function(t,e,r){var o=t.parent.inlineContent?new Z(t):Me(t.node(0),t.parent,t.pos,t.index(),e,r);if(o)return o;for(var i=t.depth-1;i>=0;i--){var s=e<0?Me(t.node(0),t.node(i),t.before(i+1),t.index(i),e,r):Me(t.node(0),t.node(i),t.after(i+1),t.index(i)+1,e,r);if(s)return s}},P.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new Zt(t.node(0))},P.atStart=function(t){return Me(t,t,0,0,1)||new Zt(t)},P.atEnd=function(t){return Me(t,t,t.content.size,t.childCount,-1)||new Zt(t)},P.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var r=hr[e.type];if(!r)throw new RangeError("No selection type "+e.type+" defined");return r.fromJSON(t,e)},P.jsonID=function(t,e){if(t in hr)throw new RangeError("Duplicate use of selection JSON ID "+t);return hr[t]=e,e.prototype.jsonID=t,e},P.prototype.getBookmark=function(){return Z.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(P.prototype,Kt),P.prototype.visible=!0;var il=function(t,e){this.$from=t,this.$to=e},Z=function(n){function t(r,o){void 0===o&&(o=r),n.call(this,r,o)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={$cursor:{configurable:!0}};return e.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},t.prototype.map=function(o,i){var s=o.resolve(i.map(this.head));if(!s.parent.inlineContent)return n.near(s);var a=o.resolve(i.map(this.anchor));return new t(a.parent.inlineContent?a:s,s)},t.prototype.replace=function(o,i){if(void 0===i&&(i=M.empty),n.prototype.replace.call(this,o,i),i==M.empty){var s=this.$from.marksAcross(this.$to);s&&o.ensureMarks(s)}},t.prototype.eq=function(o){return o instanceof t&&o.anchor==this.anchor&&o.head==this.head},t.prototype.getBookmark=function(){return new Qe(this.anchor,this.head)},t.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},t.fromJSON=function(o,i){if("number"!=typeof i.anchor||"number"!=typeof i.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new t(o.resolve(i.anchor),o.resolve(i.head))},t.create=function(o,i,s){void 0===s&&(s=i);var a=o.resolve(i);return new this(a,s==i?a:o.resolve(s))},t.between=function(o,i,s){var a=o.pos-i.pos;if((!s||a)&&(s=a>=0?1:-1),!i.parent.inlineContent){var l=n.findFrom(i,s,!0)||n.findFrom(i,-s,!0);if(!l)return n.near(i,s);i=l.$head}return o.parent.inlineContent||(0==a||(o=(n.findFrom(o,-s,!0)||n.findFrom(o,s,!0)).$anchor).pos<i.pos!=a<0)&&(o=i),new t(o,i)},Object.defineProperties(t.prototype,e),t}(P);P.jsonID("text",Z);var Qe=function(t,e){this.anchor=t,this.head=e};Qe.prototype.map=function(t){return new Qe(t.map(this.anchor),t.map(this.head))},Qe.prototype.resolve=function(t){return Z.between(t.resolve(this.anchor),t.resolve(this.head))};var E=function(n){function t(e){var r=e.nodeAfter,o=e.node(0).resolve(e.pos+r.nodeSize);n.call(this,e,o),this.node=r}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.map=function(r,o){var i=o.mapResult(this.anchor),s=i.deleted,l=r.resolve(i.pos);return s?n.near(l):new t(l)},t.prototype.content=function(){return new M(v.from(this.node),0,0)},t.prototype.eq=function(r){return r instanceof t&&r.anchor==this.anchor},t.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},t.prototype.getBookmark=function(){return new Cn(this.anchor)},t.fromJSON=function(r,o){if("number"!=typeof o.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new t(r.resolve(o.anchor))},t.create=function(r,o){return new this(r.resolve(o))},t.isSelectable=function(r){return!r.isText&&!1!==r.type.spec.selectable},t}(P);E.prototype.visible=!1,P.jsonID("node",E);var Cn=function(t){this.anchor=t};Cn.prototype.map=function(t){var e=t.mapResult(this.anchor),o=e.pos;return e.deleted?new Qe(o,o):new Cn(o)},Cn.prototype.resolve=function(t){var e=t.resolve(this.anchor),r=e.nodeAfter;return r&&E.isSelectable(r)?new E(e):P.near(e)};var Zt=function(n){function t(e){n.call(this,e.resolve(0),e.resolve(e.content.size))}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.replace=function(r,o){if(void 0===o&&(o=M.empty),o==M.empty){r.delete(0,r.doc.content.size);var i=n.atStart(r.doc);i.eq(r.selection)||r.setSelection(i)}else n.prototype.replace.call(this,r,o)},t.prototype.toJSON=function(){return{type:"all"}},t.fromJSON=function(r){return new t(r)},t.prototype.map=function(r){return new t(r)},t.prototype.eq=function(r){return r instanceof t},t.prototype.getBookmark=function(){return sl},t}(P);P.jsonID("all",Zt);var sl={map:function(){return this},resolve:function(t){return new Zt(t)}};function Me(n,t,e,r,o,i){if(t.inlineContent)return Z.create(n,e);for(var s=r-(o>0?0:1);o>0?s<t.childCount:s>=0;s+=o){var a=t.child(s);if(a.isAtom){if(!i&&E.isSelectable(a))return E.create(n,e-(o<0?a.nodeSize:0))}else{var l=Me(n,a,e+o,o<0?a.childCount:0,o,i);if(l)return l}e+=a.nodeSize*o}}function Yo(n,t,e){var r=n.steps.length-1;if(!(r<t)){var s,o=n.steps[r];(o instanceof Qt||o instanceof _t)&&(n.mapping.maps[r].forEach(function(a,l,u,p){null==s&&(s=p)}),n.setSelection(P.near(n.doc.resolve(s),e)))}}var al=function(n){function t(r){n.call(this,r.doc),this.time=Date.now(),this.curSelection=r.selection,this.curSelectionFor=0,this.storedMarks=r.storedMarks,this.updated=0,this.meta=Object.create(null)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return e.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},t.prototype.setSelection=function(o){if(o.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=o,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this},e.selectionSet.get=function(){return(1&this.updated)>0},t.prototype.setStoredMarks=function(o){return this.storedMarks=o,this.updated|=2,this},t.prototype.ensureMarks=function(o){return O.sameSet(this.storedMarks||this.selection.$from.marks(),o)||this.setStoredMarks(o),this},t.prototype.addStoredMark=function(o){return this.ensureMarks(o.addToSet(this.storedMarks||this.selection.$head.marks()))},t.prototype.removeStoredMark=function(o){return this.ensureMarks(o.removeFromSet(this.storedMarks||this.selection.$head.marks()))},e.storedMarksSet.get=function(){return(2&this.updated)>0},t.prototype.addStep=function(o,i){n.prototype.addStep.call(this,o,i),this.updated=-3&this.updated,this.storedMarks=null},t.prototype.setTime=function(o){return this.time=o,this},t.prototype.replaceSelection=function(o){return this.selection.replace(this,o),this},t.prototype.replaceSelectionWith=function(o,i){var s=this.selection;return!1!==i&&(o=o.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||O.none))),s.replaceWith(this,o),this},t.prototype.deleteSelection=function(){return this.selection.replace(this),this},t.prototype.insertText=function(o,i,s){void 0===s&&(s=i);var a=this.doc.type.schema;if(null==i)return o?this.replaceSelectionWith(a.text(o),!0):this.deleteSelection();if(!o)return this.deleteRange(i,s);var l=this.storedMarks;if(!l){var u=this.doc.resolve(i);l=s==i?u.marks():u.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(i,s,a.text(o,l)),this.selection.empty||this.setSelection(P.near(this.selection.$to)),this},t.prototype.setMeta=function(o,i){return this.meta["string"==typeof o?o:o.key]=i,this},t.prototype.getMeta=function(o){return this.meta["string"==typeof o?o:o.key]},e.isGeneric.get=function(){for(var r in this.meta)return!1;return!0},t.prototype.scrollIntoView=function(){return this.updated|=4,this},e.scrolledIntoView.get=function(){return(4&this.updated)>0},Object.defineProperties(t.prototype,e),t}(J);function ti(n,t){return t&&n?n.bind(t):n}var Ke=function(t,e,r){this.name=t,this.init=ti(e.init,r),this.apply=ti(e.apply,r)},ll=[new Ke("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new Ke("selection",{init:function(t,e){return t.selection||P.atStart(e.doc)},apply:function(t){return t.selection}}),new Ke("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,r,o){return o.selection.$cursor?t.storedMarks:null}}),new Ke("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],mr=function(t,e){var r=this;this.schema=t,this.fields=ll.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach(function(o){if(r.pluginsByKey[o.key])throw new RangeError("Adding different instances of a keyed plugin ("+o.key+")");r.plugins.push(o),r.pluginsByKey[o.key]=o,o.spec.state&&r.fields.push(new Ke(o.key,o.spec.state,o))})},pt=function(t){this.config=t},wn={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};wn.schema.get=function(){return this.config.schema},wn.plugins.get=function(){return this.config.plugins},pt.prototype.apply=function(t){return this.applyTransaction(t).state},pt.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var r=0;r<this.config.plugins.length;r++)if(r!=e){var o=this.config.plugins[r];if(o.spec.filterTransaction&&!o.spec.filterTransaction.call(o,t,this))return!1}return!0},pt.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],r=this.applyInner(t),o=null;;){for(var i=!1,s=0;s<this.config.plugins.length;s++){var a=this.config.plugins[s];if(a.spec.appendTransaction){var l=o?o[s].n:0,u=o?o[s].state:this,p=l<e.length&&a.spec.appendTransaction.call(a,l?e.slice(l):e,u,r);if(p&&r.filterTransaction(p,s)){if(p.setMeta("appendedTransaction",t),!o){o=[];for(var f=0;f<this.config.plugins.length;f++)o.push(f<s?{state:r,n:e.length}:{state:this,n:0})}e.push(p),r=r.applyInner(p),i=!0}o&&(o[s]={state:r,n:e.length})}}if(!i)return{state:r,transactions:e}}},pt.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new pt(this.config),r=this.config.fields,o=0;o<r.length;o++){var i=r[o];e[i.name]=i.apply(t,this[i.name],this,e)}for(var s=0;s<Ge.length;s++)Ge[s](this,t,e);return e},wn.tr.get=function(){return new al(this)},pt.create=function(t){for(var e=new mr(t.doc?t.doc.type.schema:t.schema,t.plugins),r=new pt(e),o=0;o<e.fields.length;o++)r[e.fields[o].name]=e.fields[o].init(t,r);return r},pt.prototype.reconfigure=function(t){for(var e=new mr(this.schema,t.plugins),r=e.fields,o=new pt(e),i=0;i<r.length;i++){var s=r[i].name;o[s]=this.hasOwnProperty(s)?this[s]:r[i].init(t,o)}return o},pt.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(function(s){return s.toJSON()})),t&&"object"==typeof t)for(var r in t){if("doc"==r||"selection"==r)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var o=t[r],i=o.spec.state;i&&i.toJSON&&(e[r]=i.toJSON.call(o,this[o.key]))}return e},pt.fromJSON=function(t,e,r){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var o=new mr(t.schema,t.plugins),i=new pt(o);return o.fields.forEach(function(s){if("doc"==s.name)i.doc=D.fromJSON(t.schema,e.doc);else if("selection"==s.name)i.selection=P.fromJSON(i.doc,e.selection);else if("storedMarks"==s.name)e.storedMarks&&(i.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(r)for(var a in r){var l=r[a],u=l.spec.state;if(l.key==s.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(e,a))return void(i[s.name]=u.fromJSON.call(l,t,e[a],i))}i[s.name]=s.init(t,i)}}),i},pt.addApplyListener=function(t){Ge.push(t)},pt.removeApplyListener=function(t){var e=Ge.indexOf(t);e>-1&&Ge.splice(e,1)},Object.defineProperties(pt.prototype,wn);var Ge=[];function ei(n,t,e){for(var r in n){var o=n[r];o instanceof Function?o=o.bind(t):"handleDOMEvents"==r&&(o=ei(o,t,{})),e[r]=o}return e}var It=function(t){this.props={},t.props&&ei(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:ni("plugin")};It.prototype.getState=function(t){return t[this.key]};var gr=Object.create(null);function ni(n){return n in gr?n+"$"+ ++gr[n]:(gr[n]=0,n+"$")}var Nt=function(t){void 0===t&&(t="key"),this.key=ni(t)};Nt.prototype.get=function(t){return t.config.pluginsByKey[this.key]},Nt.prototype.getState=function(t){return t[this.key]};var y={};if("undefined"!=typeof navigator&&"undefined"!=typeof document){var vr=/Edge\/(\d+)/.exec(navigator.userAgent),ri=/MSIE \d/.test(navigator.userAgent),yr=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),_r=y.ie=!!(ri||yr||vr);y.ie_version=ri?document.documentMode||6:yr?+yr[1]:vr?+vr[1]:null,y.gecko=!_r&&/gecko\/(\d+)/i.test(navigator.userAgent),y.gecko_version=y.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var br=!_r&&/Chrome\/(\d+)/.exec(navigator.userAgent);y.chrome=!!br,y.chrome_version=br&&+br[1],y.safari=!_r&&/Apple Computer/.test(navigator.vendor),y.ios=y.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),y.mac=y.ios||/Mac/.test(navigator.platform),y.android=/Android \d/.test(navigator.userAgent),y.webkit="webkitFontSmoothing"in document.documentElement.style,y.webkit_version=y.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var bt=function(n){for(var t=0;;t++)if(!(n=n.previousSibling))return t},xr=function(n){var t=n.assignedSlot||n.parentNode;return t&&11==t.nodeType?t.host:t},oi=null,qt=function(n,t,e){var r=oi||(oi=document.createRange());return r.setEnd(n,null==e?n.nodeValue.length:e),r.setStart(n,t||0),r},Ye=function(n,t,e,r){return e&&(ii(n,t,e,r,-1)||ii(n,t,e,r,1))},cl=/^(img|br|input|textarea|hr)$/i;function ii(n,t,e,r,o){for(;;){if(n==e&&t==r)return!0;if(t==(o<0?0:Rt(n))){var i=n.parentNode;if(!i||1!=i.nodeType||pl(n)||cl.test(n.nodeName)||"false"==n.contentEditable)return!1;t=bt(n)+(o<0?0:1),n=i}else{if(1!=n.nodeType)return!1;if("false"==(n=n.childNodes[t+(o<0?-1:0)]).contentEditable)return!1;t=o<0?Rt(n):0}}}function Rt(n){return 3==n.nodeType?n.nodeValue.length:n.childNodes.length}function pl(n){for(var t,e=n;e&&!(t=e.pmViewDesc);e=e.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==n||t.contentDOM==n)}var Sr=function(n){var t=n.isCollapsed;return t&&y.chrome&&n.rangeCount&&!n.getRangeAt(0).collapsed&&(t=!1),t};function Ce(n,t){var e=document.createEvent("Event");return e.initEvent("keydown",!0,!0),e.keyCode=n,e.key=e.code=t,e}function fl(n){return{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function Gt(n,t){return"number"==typeof n?n:n[t]}function dl(n){var t=n.getBoundingClientRect();return{left:t.left,right:t.left+n.clientWidth*(t.width/n.offsetWidth||1),top:t.top,bottom:t.top+n.clientHeight*(t.height/n.offsetHeight||1)}}function ai(n){for(var t=[],e=n.ownerDocument;n&&(t.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),n!=e);n=xr(n));return t}function li(n,t){for(var e=0;e<n.length;e++){var r=n[e],o=r.dom,i=r.top,s=r.left;o.scrollTop!=i+t&&(o.scrollTop=i+t),o.scrollLeft!=s&&(o.scrollLeft=s)}}var ke=null;function ci(n,t){for(var e,o,r=2e8,i=0,s=t.top,a=t.top,l=n.firstChild,u=0;l;l=l.nextSibling,u++){var p=void 0;if(1==l.nodeType)p=l.getClientRects();else{if(3!=l.nodeType)continue;p=qt(l).getClientRects()}for(var f=0;f<p.length;f++){var d=p[f];if(d.top<=s&&d.bottom>=a){s=Math.max(d.bottom,s),a=Math.min(d.top,a);var h=d.left>t.left?d.left-t.left:d.right<t.left?t.left-d.right:0;if(h<r){e=l,r=h,o=h&&3==e.nodeType?{left:d.right<t.left?d.right:d.left,top:t.top}:t,1==l.nodeType&&h&&(i=u+(t.left>=(d.left+d.right)/2?1:0));continue}}!e&&(t.left>=d.right&&t.top>=d.top||t.left>=d.left&&t.top>=d.bottom)&&(i=u+1)}}return e&&3==e.nodeType?function(n,t){for(var e=n.nodeValue.length,r=document.createRange(),o=0;o<e;o++){r.setEnd(n,o+1),r.setStart(n,o);var i=Yt(r,1);if(i.top!=i.bottom&&Mr(t,i))return{node:n,offset:o+(t.left>=(i.left+i.right)/2?1:0)}}return{node:n,offset:0}}(e,o):!e||r&&1==e.nodeType?{node:n,offset:i}:ci(e,o)}function Mr(n,t){return n.left>=t.left-1&&n.left<=t.right+1&&n.top>=t.top-1&&n.top<=t.bottom+1}function ui(n,t,e){var r=n.childNodes.length;if(r&&e.top<e.bottom)for(var o=Math.max(0,Math.min(r-1,Math.floor(r*(t.top-e.top)/(e.bottom-e.top))-2)),i=o;;){var s=n.childNodes[i];if(1==s.nodeType)for(var a=s.getClientRects(),l=0;l<a.length;l++){var u=a[l];if(Mr(t,u))return ui(s,t,u)}if((i=(i+1)%r)==o)break}return n}function xl(n,t){var e,r,i,s,o=n.dom.ownerDocument;if(o.caretPositionFromPoint)try{var a=o.caretPositionFromPoint(t.left,t.top);a&&(i=(e=a).offsetNode,s=e.offset)}catch(x){}if(!i&&o.caretRangeFromPoint){var l=o.caretRangeFromPoint(t.left,t.top);l&&(i=(r=l).startContainer,s=r.startOffset)}var p,u=(n.root.elementFromPoint?n.root:o).elementFromPoint(t.left,t.top+1);if(!u||!n.dom.contains(1!=u.nodeType?u.parentNode:u)){var f=n.dom.getBoundingClientRect();if(!Mr(t,f)||!(u=ui(n.dom,t,f)))return null}if(y.safari)for(var d=u;i&&d;d=xr(d))d.draggable&&(i=s=null);if(u=function(n,t){var e=n.parentNode;return e&&/^li$/i.test(e.nodeName)&&t.left<n.getBoundingClientRect().left?e:n}(u,t),i){if(y.gecko&&1==i.nodeType&&(s=Math.min(s,i.childNodes.length))<i.childNodes.length){var m,h=i.childNodes[s];"IMG"==h.nodeName&&(m=h.getBoundingClientRect()).right<=t.left&&m.bottom>t.top&&s++}i==n.dom&&s==i.childNodes.length-1&&1==i.lastChild.nodeType&&t.top>i.lastChild.getBoundingClientRect().bottom?p=n.state.doc.content.size:(0==s||1!=i.nodeType||"BR"!=i.childNodes[s-1].nodeName)&&(p=function(n,t,e,r){for(var o=-1,i=t;i!=n.dom;){var s=n.docView.nearestDesc(i,!0);if(!s)return null;if(s.node.isBlock&&s.parent){var a=s.dom.getBoundingClientRect();if(a.left>r.left||a.top>r.top)o=s.posBefore;else{if(!(a.right<r.left||a.bottom<r.top))break;o=s.posAfter}}i=s.dom.parentNode}return o>-1?o:n.docView.posFromDOM(t,e)}(n,i,s,t))}null==p&&(p=function(n,t,e){var r=ci(t,e),o=r.node,i=r.offset,s=-1;if(1==o.nodeType&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&e.left>(a.left+a.right)/2?1:-1}return n.docView.posFromDOM(o,i,s)}(n,u,t));var g=n.docView.nearestDesc(u,!0);return{pos:p,inside:g?g.posAtStart-g.border:-1}}function Yt(n,t){var e=n.getClientRects();return e.length?e[t<0?0:e.length-1]:n.getBoundingClientRect()}var Sl=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function pi(n,t,e){var r=n.docView.domFromPos(t,e<0?-1:1),o=r.node,i=r.offset,s=y.webkit||y.gecko;if(3==o.nodeType){if(!s||!Sl.test(o.nodeValue)&&(e<0?i:i!=o.nodeValue.length)){var p=i,f=i,d=e<0?1:-1;return e<0&&!i?(f++,d=-1):e>=0&&i==o.nodeValue.length?(p--,d=1):e<0?p--:f++,Xe(Yt(qt(o,p,f),d),d<0)}var a=Yt(qt(o,i,i),e);if(y.gecko&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var l=Yt(qt(o,i-1,i-1),-1);if(l.top==a.top){var u=Yt(qt(o,i,i+1),-1);if(u.top!=a.top)return Xe(u,u.left<l.left)}}return a}if(!n.state.doc.resolve(t).parent.inlineContent){if(i&&(e<0||i==Rt(o))){var h=o.childNodes[i-1];if(1==h.nodeType)return Cr(h.getBoundingClientRect(),!1)}if(i<Rt(o)){var m=o.childNodes[i];if(1==m.nodeType)return Cr(m.getBoundingClientRect(),!0)}return Cr(o.getBoundingClientRect(),e>=0)}if(i&&(e<0||i==Rt(o))){var g=o.childNodes[i-1],x=3==g.nodeType?qt(g,Rt(g)-(s?0:1)):1!=g.nodeType||"BR"==g.nodeName&&g.nextSibling?null:g;if(x)return Xe(Yt(x,1),!1)}if(i<Rt(o)){for(var S=o.childNodes[i];S.pmViewDesc&&S.pmViewDesc.ignoreForCoords;)S=S.nextSibling;var b=S?3==S.nodeType?qt(S,0,s?0:1):1==S.nodeType?S:null:null;if(b)return Xe(Yt(b,-1),!0)}return Xe(Yt(3==o.nodeType?qt(o):o,-e),e>=0)}function Xe(n,t){if(0==n.width)return n;var e=t?n.left:n.right;return{top:n.top,bottom:n.bottom,left:e,right:e}}function Cr(n,t){if(0==n.height)return n;var e=t?n.top:n.bottom;return{top:e,bottom:e,left:n.left,right:n.right}}function fi(n,t,e){var r=n.state,o=n.root.activeElement;r!=t&&n.updateState(t),o!=n.dom&&n.focus();try{return e()}finally{r!=t&&n.updateState(r),o!=n.dom&&o&&o.focus()}}var Cl=/[\u0590-\u08ac]/,di=null,hi=null,mi=!1;var L=function(t,e,r,o){this.parent=t,this.children=e,this.dom=r,r.pmViewDesc=this,this.contentDOM=o,this.dirty=0},Ft={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};L.prototype.matchesWidget=function(){return!1},L.prototype.matchesMark=function(){return!1},L.prototype.matchesNode=function(){return!1},L.prototype.matchesHack=function(t){return!1},L.prototype.parseRule=function(){return null},L.prototype.stopEvent=function(){return!1},Ft.size.get=function(){for(var n=0,t=0;t<this.children.length;t++)n+=this.children[t].size;return n},Ft.border.get=function(){return 0},L.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var t=0;t<this.children.length;t++)this.children[t].destroy()},L.prototype.posBeforeChild=function(t){for(var e=0,r=this.posAtStart;e<this.children.length;e++){var o=this.children[e];if(o==t)return r;r+=o.size}},Ft.posBefore.get=function(){return this.parent.posBeforeChild(this)},Ft.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0},Ft.posAfter.get=function(){return this.posBefore+this.size},Ft.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border},L.prototype.localPosFromDOM=function(t,e,r){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(r<0){var o,i;if(t==this.contentDOM)o=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.previousSibling}for(;o&&(!(i=o.pmViewDesc)||i.parent!=this);)o=o.previousSibling;return o?this.posBeforeChild(i)+i.size:this.posAtStart}var s,a;if(t==this.contentDOM)s=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;s=t.nextSibling}for(;s&&(!(a=s.pmViewDesc)||a.parent!=this);)s=s.nextSibling;return s?this.posBeforeChild(a):this.posAtEnd}var l;if(t==this.dom&&this.contentDOM)l=e>bt(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))l=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(var u=t;;u=u.parentNode){if(u==this.dom){l=!1;break}if(u.parentNode.firstChild!=u)break}if(null==l&&e==t.childNodes.length)for(var p=t;;p=p.parentNode){if(p==this.dom){l=!0;break}if(p.parentNode.lastChild!=p)break}}return(null==l?r>0:l)?this.posAtEnd:this.posAtStart},L.prototype.nearestDesc=function(t,e){for(var r=!0,o=t;o;o=o.parentNode){var i=this.getDesc(o);if(i&&(!e||i.node)){if(!r||!i.nodeDOM||(1==i.nodeDOM.nodeType?i.nodeDOM.contains(1==t.nodeType?t:t.parentNode):i.nodeDOM==t))return i;r=!1}}},L.prototype.getDesc=function(t){for(var e=t.pmViewDesc,r=e;r;r=r.parent)if(r==this)return e},L.prototype.posFromDOM=function(t,e,r){for(var o=t;o;o=o.parentNode){var i=this.getDesc(o);if(i)return i.localPosFromDOM(t,e,r)}return-1},L.prototype.descAt=function(t){for(var e=0,r=0;e<this.children.length;e++){var o=this.children[e],i=r+o.size;if(r==t&&i!=r){for(;!o.border&&o.children.length;)o=o.children[0];return o}if(t<i)return o.descAt(t-r-o.border);r=i}},L.prototype.domFromPos=function(t,e){if(!this.contentDOM)return{node:this.dom,offset:0};for(var r=0,o=0,i=0;r<this.children.length;r++){var s=this.children[r],a=i+s.size;if(a>t||s instanceof bi){o=t-i;break}i=a}if(o)return this.children[r].domFromPos(o-this.children[r].border,e);for(var l=void 0;r&&!(l=this.children[r-1]).size&&l instanceof vi&&l.widget.type.side>=0;r--);if(e<=0){for(var u,p=!0;(u=r?this.children[r-1]:null)&&u.dom.parentNode!=this.contentDOM;r--,p=!1);return u&&e&&p&&!u.border&&!u.domAtom?u.domFromPos(u.size,e):{node:this.contentDOM,offset:u?bt(u.dom)+1:0}}for(var f,d=!0;(f=r<this.children.length?this.children[r]:null)&&f.dom.parentNode!=this.contentDOM;r++,d=!1);return f&&d&&!f.border&&!f.domAtom?f.domFromPos(0,e):{node:this.contentDOM,offset:f?bt(f.dom):this.contentDOM.childNodes.length}},L.prototype.parseRange=function(t,e,r){if(void 0===r&&(r=0),0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var o=-1,i=-1,s=r,a=0;;a++){var l=this.children[a],u=s+l.size;if(-1==o&&t<=u){var p=s+l.border;if(t>=p&&e<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(t,e,p);t=s;for(var f=a;f>0;f--){var d=this.children[f-1];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(1)){o=bt(d.dom)+1;break}t-=d.size}-1==o&&(o=0)}if(o>-1&&(u>e||a==this.children.length-1)){e=u;for(var h=a+1;h<this.children.length;h++){var m=this.children[h];if(m.size&&m.dom.parentNode==this.contentDOM&&!m.emptyChildAt(-1)){i=bt(m.dom);break}e+=m.size}-1==i&&(i=this.contentDOM.childNodes.length);break}s=u}return{node:this.contentDOM,from:t,to:e,fromOffset:o,toOffset:i}},L.prototype.emptyChildAt=function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)},L.prototype.domAfterPos=function(t){var e=this.domFromPos(t,0),r=e.node,o=e.offset;if(1!=r.nodeType||o==r.childNodes.length)throw new RangeError("No node after pos "+t);return r.childNodes[o]},L.prototype.setSelection=function(t,e,r,o){for(var i=Math.min(t,e),s=Math.max(t,e),a=0,l=0;a<this.children.length;a++){var u=this.children[a],p=l+u.size;if(i>l&&s<p)return u.setSelection(t-l-u.border,e-l-u.border,r,o);l=p}var f=this.domFromPos(t,t?-1:1),d=e==t?f:this.domFromPos(e,e?-1:1),h=r.getSelection(),m=!1;if((y.gecko||y.safari)&&t==e){var g=f.node,x=f.offset;if(3==g.nodeType){if((m=x&&"\n"==g.nodeValue[x-1])&&x==g.nodeValue.length)for(var S=g,b=void 0;S;S=S.parentNode){if(b=S.nextSibling){"BR"==b.nodeName&&(f=d={node:b.parentNode,offset:bt(b)+1});break}var N=S.pmViewDesc;if(N&&N.node&&N.node.isBlock)break}}else{var w=g.childNodes[x-1];m=w&&("BR"==w.nodeName||"false"==w.contentEditable)}}if(y.gecko&&h.focusNode&&h.focusNode!=d.node&&1==h.focusNode.nodeType){var I=h.focusNode.childNodes[h.focusOffset];I&&"false"==I.contentEditable&&(o=!0)}if(o||m&&y.safari||!Ye(f.node,f.offset,h.anchorNode,h.anchorOffset)||!Ye(d.node,d.offset,h.focusNode,h.focusOffset)){var A=!1;if((h.extend||t==e)&&!m){h.collapse(f.node,f.offset);try{t!=e&&h.extend(d.node,d.offset),A=!0}catch(K){if(!(K instanceof DOMException))throw K}}if(!A){if(t>e){var j=f;f=d,d=j}var U=document.createRange();U.setEnd(d.node,d.offset),U.setStart(f.node,f.offset),h.removeAllRanges(),h.addRange(U)}}},L.prototype.ignoreMutation=function(t){return!this.contentDOM&&"selection"!=t.type},Ft.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)},L.prototype.markDirty=function(t,e){for(var r=0,o=0;o<this.children.length;o++){var i=this.children[o],s=r+i.size;if(r==s?t<=s&&e>=r:t<s&&e>r){var a=r+i.border,l=s-i.border;if(t>=a&&e<=l)return this.dirty=t==r||e==s?2:1,void(t!=a||e!=l||!i.contentLost&&i.dom.parentNode==this.contentDOM?i.markDirty(t-a,e-a):i.dirty=3);i.dirty=i.dom!=i.contentDOM||i.dom.parentNode!=this.contentDOM||i.children.length?3:2}r=s}this.dirty=2},L.prototype.markParentsDirty=function(){for(var t=1,e=this.parent;e;e=e.parent,t++){var r=1==t?2:1;e.dirty<r&&(e.dirty=r)}},Ft.domAtom.get=function(){return!1},Ft.ignoreForCoords.get=function(){return!1},Object.defineProperties(L.prototype,Ft);var Xt=[],vi=function(n){function t(r,o,i,s){var a,l=o.type.toDOM;if("function"==typeof l&&(l=l(i,function(){return a?a.parent?a.parent.posBeforeChild(a):void 0:s})),!o.type.spec.raw){if(1!=l.nodeType){var u=document.createElement("span");u.appendChild(l),l=u}l.contentEditable=!1,l.classList.add("ProseMirror-widget")}n.call(this,r,Xt,l,null),this.widget=o,a=this}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={domAtom:{configurable:!0}};return t.prototype.matchesWidget=function(o){return 0==this.dirty&&o.type.eq(this.widget.type)},t.prototype.parseRule=function(){return{ignore:!0}},t.prototype.stopEvent=function(o){var i=this.widget.spec.stopEvent;return!!i&&i(o)},t.prototype.ignoreMutation=function(o){return"selection"!=o.type||this.widget.spec.ignoreSelection},t.prototype.destroy=function(){this.widget.type.destroy(this.dom),n.prototype.destroy.call(this)},e.domAtom.get=function(){return!0},Object.defineProperties(t.prototype,e),t}(L),Tl=function(n){function t(r,o,i,s){n.call(this,r,Xt,o,null),this.textDOM=i,this.text=s}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={size:{configurable:!0}};return e.size.get=function(){return this.text.length},t.prototype.localPosFromDOM=function(o,i){return o!=this.textDOM?this.posAtStart+(i?this.size:0):this.posAtStart+i},t.prototype.domFromPos=function(o){return{node:this.textDOM,offset:o}},t.prototype.ignoreMutation=function(o){return"characterData"===o.type&&o.target.nodeValue==o.oldValue},Object.defineProperties(t.prototype,e),t}(L),Tn=function(n){function t(e,r,o,i){n.call(this,e,[],o,i),this.mark=r}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.create=function(r,o,i,s){var a=s.nodeViews[o.type.name],l=a&&a(o,s,i);return(!l||!l.dom)&&(l=et.renderSpec(document,o.type.spec.toDOM(o,i))),new t(r,o,l.dom,l.contentDOM||l.dom)},t.prototype.parseRule=function(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},t.prototype.matchesMark=function(r){return 3!=this.dirty&&this.mark.eq(r)},t.prototype.markDirty=function(r,o){if(n.prototype.markDirty.call(this,r,o),0!=this.dirty){for(var i=this.parent;!i.node;)i=i.parent;i.dirty<this.dirty&&(i.dirty=this.dirty),this.dirty=0}},t.prototype.slice=function(r,o,i){var s=t.create(this.parent,this.mark,!0,i),a=this.children,l=this.size;o<l&&(a=Tr(a,o,l,i)),r>0&&(a=Tr(a,0,r,i));for(var u=0;u<a.length;u++)a[u].parent=s;return s.children=a,s},t}(L),tn=function(n){function t(r,o,i,s,a,l,u,p,f){n.call(this,r,o.isLeaf?Xt:[],a,l),this.nodeDOM=u,this.node=o,this.outerDeco=i,this.innerDeco=s,l&&this.updateChildren(p,f)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return t.create=function(o,i,s,a,l,u){var p,d,f=l.nodeViews[i.type.name],h=f&&f(i,l,function(){return d?d.parent?d.parent.posBeforeChild(d):void 0:u},s,a),m=h&&h.dom,g=h&&h.contentDOM;if(i.isText)if(m){if(3!=m.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else m=document.createTextNode(i.text);else m||(m=(p=et.renderSpec(document,i.type.spec.toDOM(i))).dom,g=p.contentDOM);!g&&!i.isText&&"BR"!=m.nodeName&&(m.hasAttribute("contenteditable")||(m.contentEditable=!1),i.type.spec.draggable&&(m.draggable=!0));var x=m;return m=Mi(m,s,i),h?d=new Il(o,i,s,a,m,g,x,h,l,u+1):i.isText?new _i(o,i,s,a,m,x,l):new t(o,i,s,a,m,g,x,l,u+1)},t.prototype.parseRule=function(){var o=this;if(this.node.type.spec.reparseInView)return null;var i={node:this.node.type.name,attrs:this.node.attrs};return"pre"==this.node.type.whitespace&&(i.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?i.contentElement=this.contentDOM:i.getContent=function(){return o.contentDOM?v.empty:o.node.content},i},t.prototype.matchesNode=function(o,i,s){return 0==this.dirty&&o.eq(this.node)&&wr(i,this.outerDeco)&&s.eq(this.innerDeco)},e.size.get=function(){return this.node.nodeSize},e.border.get=function(){return this.node.isLeaf?0:1},t.prototype.updateChildren=function(o,i){var s=this,a=this.node.inlineContent,l=i,u=o.composing&&this.localCompositionInfo(o,i),p=u&&u.pos>-1?u:null,f=u&&u.pos<0,d=new kt(this,p&&p.node);(function(n,t,e,r){var o=t.locals(n),i=0;if(0!=o.length)for(var l=0,u=[],p=null,f=0;;){if(l<o.length&&o[l].to==i){for(var d=o[l++],h=void 0;l<o.length&&o[l].to==i;)(h||(h=[d])).push(o[l++]);if(h){h.sort(Ol);for(var m=0;m<h.length;m++)e(h[m],f,!!p)}else e(d,f,!!p)}var g=void 0,x=void 0;if(p)x=-1,g=p,p=null;else{if(!(f<n.childCount))break;x=f,g=n.child(f++)}for(var S=0;S<u.length;S++)u[S].to<=i&&u.splice(S--,1);for(;l<o.length&&o[l].from<=i&&o[l].to>i;)u.push(o[l++]);var b=i+g.nodeSize;if(g.isText){var N=b;l<o.length&&o[l].from<N&&(N=o[l].from);for(var w=0;w<u.length;w++)u[w].to<N&&(N=u[w].to);N<b&&(p=g.cut(N-i),g=g.cut(0,N-i),b=N,x=-1)}r(g,u.length?g.isInline&&!g.isLeaf?u.filter(function(A){return!A.inline}):u.slice():Xt,t.forChild(i,g),x),i=b}else for(var s=0;s<n.childCount;s++){var a=n.child(s);r(a,o,t.forChild(i,a),s),i+=a.nodeSize}})(this.node,this.innerDeco,function(h,m,g){h.spec.marks?d.syncToMarks(h.spec.marks,a,o):h.type.side>=0&&!g&&d.syncToMarks(m==s.node.childCount?O.none:s.node.child(m).marks,a,o),d.placeWidget(h,o,l)},function(h,m,g,x){var S;d.syncToMarks(h.marks,a,o),d.findNodeMatch(h,m,g,x)||f&&o.state.selection.from>l&&o.state.selection.to<l+h.nodeSize&&(S=d.findIndexWithChild(u.node))>-1&&d.updateNodeAt(h,m,g,S,o)||d.updateNextNode(h,m,g,o,x)||d.addNode(h,m,g,o,l),l+=h.nodeSize}),d.syncToMarks(Xt,a,o),this.node.isTextblock&&d.addTextblockHacks(),d.destroyRest(),(d.changed||2==this.dirty)&&(p&&this.protectLocalComposition(o,p),xi(this.contentDOM,this.children,o),y.ios&&function(n){if("UL"==n.nodeName||"OL"==n.nodeName){var t=n.style.cssText;n.style.cssText=t+"; list-style: square !important",window.getComputedStyle(n),n.style.cssText=t}}(this.dom))},t.prototype.localCompositionInfo=function(o,i){var s=o.state.selection,a=s.from,l=s.to;if(!(!(o.state.selection instanceof Z)||a<i||l>i+this.node.content.size)){var u=o.root.getSelection(),p=function(n,t){for(;;){if(3==n.nodeType)return n;if(1==n.nodeType&&t>0){if(n.childNodes.length>t&&3==n.childNodes[t].nodeType)return n.childNodes[t];t=Rt(n=n.childNodes[t-1])}else{if(!(1==n.nodeType&&t<n.childNodes.length))return null;n=n.childNodes[t],t=0}}}(u.focusNode,u.focusOffset);if(p&&this.dom.contains(p.parentNode)){if(this.node.inlineContent){var f=p.nodeValue,d=function(n,t,e,r){for(var o=0,i=0;o<n.childCount&&i<=r;){var s=n.child(o++),a=i;if(i+=s.nodeSize,s.isText){for(var l=s.text;o<n.childCount;){var u=n.child(o++);if(i+=u.nodeSize,!u.isText)break;l+=u.text}if(i>=e&&a<r){var p=l.lastIndexOf(t,r-a-1);if(p>=0&&p+t.length+a>=e)return a+p}}}return-1}(this.node.content,f,a-i,l-i);return d<0?null:{node:p,pos:d,text:f}}return{node:p,pos:-1}}}},t.prototype.protectLocalComposition=function(o,i){var s=i.node,a=i.pos,l=i.text;if(!this.getDesc(s)){for(var u=s;u.parentNode!=this.contentDOM;u=u.parentNode){for(;u.previousSibling;)u.parentNode.removeChild(u.previousSibling);for(;u.nextSibling;)u.parentNode.removeChild(u.nextSibling);u.pmViewDesc&&(u.pmViewDesc=null)}var p=new Tl(this,u,s,l);o.compositionNodes.push(p),this.children=Tr(this.children,a,a+l.length,o,p)}},t.prototype.update=function(o,i,s,a){return!(3==this.dirty||!o.sameMarkup(this.node)||(this.updateInner(o,i,s,a),0))},t.prototype.updateInner=function(o,i,s,a){this.updateOuterDeco(i),this.node=o,this.innerDeco=s,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=0},t.prototype.updateOuterDeco=function(o){if(!wr(o,this.outerDeco)){var i=1!=this.nodeDOM.nodeType,s=this.dom;this.dom=Si(this.dom,this.nodeDOM,kr(this.outerDeco,this.node,i),kr(o,this.node,i)),this.dom!=s&&(s.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=o}},t.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},t.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},e.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(t.prototype,e),t}(L);function yi(n,t,e,r,o){return Mi(r,t,n),new tn(null,n,t,e,r,r,r,o,0)}var _i=function(n){function t(r,o,i,s,a,l,u){n.call(this,r,o,i,s,a,null,l,u)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={domAtom:{configurable:!0}};return t.prototype.parseRule=function(){for(var o=this.nodeDOM.parentNode;o&&o!=this.dom&&!o.pmIsDeco;)o=o.parentNode;return{skip:o||!0}},t.prototype.update=function(o,i,s,a){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!o.sameMarkup(this.node)||(this.updateOuterDeco(i),(0!=this.dirty||o.text!=this.node.text)&&o.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=o.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=o,this.dirty=0,0))},t.prototype.inParent=function(){for(var o=this.parent.contentDOM,i=this.nodeDOM;i;i=i.parentNode)if(i==o)return!0;return!1},t.prototype.domFromPos=function(o){return{node:this.nodeDOM,offset:o}},t.prototype.localPosFromDOM=function(o,i,s){return o==this.nodeDOM?this.posAtStart+Math.min(i,this.node.text.length):n.prototype.localPosFromDOM.call(this,o,i,s)},t.prototype.ignoreMutation=function(o){return"characterData"!=o.type&&"selection"!=o.type},t.prototype.slice=function(o,i,s){var a=this.node.cut(o,i),l=document.createTextNode(a.text);return new t(this.parent,a,this.outerDeco,this.innerDeco,l,l,s)},t.prototype.markDirty=function(o,i){n.prototype.markDirty.call(this,o,i),this.dom!=this.nodeDOM&&(0==o||i==this.nodeDOM.nodeValue.length)&&(this.dirty=3)},e.domAtom.get=function(){return!1},Object.defineProperties(t.prototype,e),t}(tn),bi=function(n){function t(){n.apply(this,arguments)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return t.prototype.parseRule=function(){return{ignore:!0}},t.prototype.matchesHack=function(o){return 0==this.dirty&&this.dom.nodeName==o},e.domAtom.get=function(){return!0},e.ignoreForCoords.get=function(){return"IMG"==this.dom.nodeName},Object.defineProperties(t.prototype,e),t}(L),Il=function(n){function t(e,r,o,i,s,a,l,u,p,f){n.call(this,e,r,o,i,s,a,l,p,f),this.spec=u}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.update=function(r,o,i,s){if(3==this.dirty)return!1;if(this.spec.update){var a=this.spec.update(r,o,i);return a&&this.updateInner(r,o,i,s),a}return!(!this.contentDOM&&!r.isLeaf)&&n.prototype.update.call(this,r,o,i,s)},t.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():n.prototype.selectNode.call(this)},t.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():n.prototype.deselectNode.call(this)},t.prototype.setSelection=function(r,o,i,s){this.spec.setSelection?this.spec.setSelection(r,o,i):n.prototype.setSelection.call(this,r,o,i,s)},t.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),n.prototype.destroy.call(this)},t.prototype.stopEvent=function(r){return!!this.spec.stopEvent&&this.spec.stopEvent(r)},t.prototype.ignoreMutation=function(r){return this.spec.ignoreMutation?this.spec.ignoreMutation(r):n.prototype.ignoreMutation.call(this,r)},t}(tn);function xi(n,t,e){for(var r=n.firstChild,o=!1,i=0;i<t.length;i++){var s=t[i],a=s.dom;if(a.parentNode==n){for(;a!=r;)r=Ci(r),o=!0;r=r.nextSibling}else o=!0,n.insertBefore(a,r);if(s instanceof Tn){var l=r?r.previousSibling:n.lastChild;xi(s.contentDOM,s.children,e),r=l?l.nextSibling:n.firstChild}}for(;r;)r=Ci(r),o=!0;o&&e.trackWrites==n&&(e.trackWrites=null)}function en(n){n&&(this.nodeName=n)}en.prototype=Object.create(null);var ae=[new en];function kr(n,t,e){if(0==n.length)return ae;for(var r=e?ae[0]:new en,o=[r],i=0;i<n.length;i++){var s=n[i].type.attrs;if(s)for(var a in s.nodeName&&o.push(r=new en(s.nodeName)),s){var l=s[a];null!=l&&(e&&1==o.length&&o.push(r=new en(t.isInline?"span":"div")),"class"==a?r.class=(r.class?r.class+" ":"")+l:"style"==a?r.style=(r.style?r.style+";":"")+l:"nodeName"!=a&&(r[a]=l))}}return o}function Si(n,t,e,r){if(e==ae&&r==ae)return t;for(var o=t,i=0;i<r.length;i++){var s=r[i],a=e[i];if(i){var l=void 0;a&&a.nodeName==s.nodeName&&o!=n&&(l=o.parentNode)&&l.tagName.toLowerCase()==s.nodeName||((l=document.createElement(s.nodeName)).pmIsDeco=!0,l.appendChild(o),a=ae[0]),o=l}Nl(o,a||ae[0],s)}return o}function Nl(n,t,e){for(var r in t)"class"!=r&&"style"!=r&&"nodeName"!=r&&!(r in e)&&n.removeAttribute(r);for(var o in e)"class"!=o&&"style"!=o&&"nodeName"!=o&&e[o]!=t[o]&&n.setAttribute(o,e[o]);if(t.class!=e.class){for(var i=t.class?t.class.split(" ").filter(Boolean):Xt,s=e.class?e.class.split(" ").filter(Boolean):Xt,a=0;a<i.length;a++)-1==s.indexOf(i[a])&&n.classList.remove(i[a]);for(var l=0;l<s.length;l++)-1==i.indexOf(s[l])&&n.classList.add(s[l]);0==n.classList.length&&n.removeAttribute("class")}if(t.style!=e.style){if(t.style)for(var p,u=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;p=u.exec(t.style);)n.style.removeProperty(p[1]);e.style&&(n.style.cssText+=e.style)}}function Mi(n,t,e){return Si(n,n,ae,kr(t,e,1!=n.nodeType))}function wr(n,t){if(n.length!=t.length)return!1;for(var e=0;e<n.length;e++)if(!n[e].type.eq(t[e].type))return!1;return!0}function Ci(n){var t=n.nextSibling;return n.parentNode.removeChild(n),t}var kt=function(t,e){this.top=t,this.lock=e,this.index=0,this.stack=[],this.changed=!1,this.preMatch=function(n,t){var e=t,r=e.children.length,o=n.childCount,i=new Map,s=[];t:for(;o>0;){for(var a=void 0;;)if(r){var l=e.children[r-1];if(!(l instanceof Tn)){a=l,r--;break}e=l,r=l.children.length}else{if(e==t)break t;r=e.parent.children.indexOf(e),e=e.parent}var u=a.node;if(u){if(u!=n.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}(t.node.content,t)};function Ol(n,t){return n.type.side-t.type.side}function Tr(n,t,e,r,o){for(var i=[],s=0,a=0;s<n.length;s++){var l=n[s],u=a,p=a+=l.size;u>=e||p<=t?i.push(l):(u<t&&i.push(l.slice(0,t-u,r)),o&&(i.push(o),o=null),p>e&&i.push(l.slice(e-u,l.size,r)))}return i}function ki(n,t){var e=n.root.getSelection(),r=n.state.doc;if(!e.focusNode)return null;var o=n.docView.nearestDesc(e.focusNode),i=o&&0==o.size,s=n.docView.posFromDOM(e.focusNode,e.focusOffset);if(s<0)return null;var l,u,a=r.resolve(s);if(Sr(e)){for(l=a;o&&!o.node;)o=o.parent;if(o&&o.node.isAtom&&E.isSelectable(o.node)&&o.parent&&(!o.node.isInline||!function(n,t,e){for(var r=0==t,o=t==Rt(n);r||o;){if(n==e)return!0;var i=bt(n);if(!(n=n.parentNode))return!1;r=r&&0==i,o=o&&i==Rt(n)}}(e.focusNode,e.focusOffset,o.dom))){var p=o.posBefore;u=new E(s==p?a:r.resolve(p))}}else{var f=n.docView.posFromDOM(e.anchorNode,e.anchorOffset);if(f<0)return null;l=r.resolve(f)}return u||(u=Nr(n,l,a,"pointer"==t||n.state.selection.head<a.pos&&!i?1:-1)),u}function wi(n){return n.editable?n.hasFocus():Er(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function $t(n,t){var e=n.state.selection;if(Ei(n,e),wi(n)){if(!t&&n.mouseDown&&n.mouseDown.allowDefault&&y.chrome){var r=n.root.getSelection(),o=n.domObserver.currentSelection;if(r.anchorNode&&Ye(r.anchorNode,r.anchorOffset,o.anchorNode,o.anchorOffset))return n.mouseDown.delayedSelectionSync=!0,void n.domObserver.setCurSelection()}if(n.domObserver.disconnectSelection(),n.cursorWrapper)!function(n){var t=n.root.getSelection(),e=document.createRange(),r=n.cursorWrapper.dom,o="IMG"==r.nodeName;o?e.setEnd(r.parentNode,bt(r)+1):e.setEnd(r,0),e.collapse(!1),t.removeAllRanges(),t.addRange(e),!o&&!n.state.selection.visible&&y.ie&&y.ie_version<=11&&(r.disabled=!0,r.disabled=!1)}(n);else{var a,l,i=e.anchor,s=e.head;Ti&&!(e instanceof Z)&&(e.$from.parent.inlineContent||(a=Ii(n,e.from)),!e.empty&&!e.$from.parent.inlineContent&&(l=Ii(n,e.to))),n.docView.setSelection(i,s,n.root,t),Ti&&(a&&Ni(a),l&&Ni(l)),e.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(n){var t=n.dom.ownerDocument;t.removeEventListener("selectionchange",n.hideSelectionGuard);var e=n.root.getSelection(),r=e.anchorNode,o=e.anchorOffset;t.addEventListener("selectionchange",n.hideSelectionGuard=function(){(e.anchorNode!=r||e.anchorOffset!=o)&&(t.removeEventListener("selectionchange",n.hideSelectionGuard),setTimeout(function(){(!wi(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}kt.prototype.destroyBetween=function(t,e){if(t!=e){for(var r=t;r<e;r++)this.top.children[r].destroy();this.top.children.splice(t,e-t),this.changed=!0}},kt.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)},kt.prototype.syncToMarks=function(t,e,r){for(var o=0,i=this.stack.length>>1,s=Math.min(i,t.length);o<s&&(o==i-1?this.top:this.stack[o+1<<1]).matchesMark(t[o])&&!1!==t[o].type.spec.spanning;)o++;for(;o<i;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<t.length;){this.stack.push(this.top,this.index+1);for(var a=-1,l=this.index;l<Math.min(this.index+3,this.top.children.length);l++)if(this.top.children[l].matchesMark(t[i])){a=l;break}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{var u=Tn.create(this.top,t[i],e,r);this.top.children.splice(this.index,0,u),this.top=u,this.changed=!0}this.index=0,i++}},kt.prototype.findNodeMatch=function(t,e,r,o){var s,i=-1;if(o>=this.preMatch.index&&(s=this.preMatch.matches[o-this.preMatch.index]).parent==this.top&&s.matchesNode(t,e,r))i=this.top.children.indexOf(s,this.index);else for(var a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){var u=this.top.children[a];if(u.matchesNode(t,e,r)&&!this.preMatch.matched.has(u)){i=a;break}}return!(i<0||(this.destroyBetween(this.index,i),this.index++,0))},kt.prototype.updateNodeAt=function(t,e,r,o,i){return!!this.top.children[o].update(t,e,r,i)&&(this.destroyBetween(this.index,o),this.index=o+1,!0)},kt.prototype.findIndexWithChild=function(t){for(;;){var e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){var r=t.pmViewDesc;if(r)for(var o=this.index;o<this.top.children.length;o++)if(this.top.children[o]==r)return o;return-1}t=e}},kt.prototype.updateNextNode=function(t,e,r,o,i){for(var s=this.index;s<this.top.children.length;s++){var a=this.top.children[s];if(a instanceof tn){var l=this.preMatch.matched.get(a);if(null!=l&&l!=i)return!1;var u=a.dom;if((!this.lock||!(u==this.lock||1==u.nodeType&&u.contains(this.lock.parentNode))||t.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==t.text&&3!=a.dirty&&wr(e,a.outerDeco))&&a.update(t,e,r,o))return this.destroyBetween(this.index,s),a.dom!=u&&(this.changed=!0),this.index++,!0;break}}return!1},kt.prototype.addNode=function(t,e,r,o,i){this.top.children.splice(this.index++,0,tn.create(this.top,t,e,r,o,i)),this.changed=!0},kt.prototype.placeWidget=function(t,e,r){var o=this.index<this.top.children.length?this.top.children[this.index]:null;if(!o||!o.matchesWidget(t)||t!=o.widget&&o.widget.type.toDOM.parentNode){var i=new vi(this.top,t,e,r);this.top.children.splice(this.index++,0,i),this.changed=!0}else this.index++},kt.prototype.addTextblockHacks=function(){for(var t=this.top.children[this.index-1];t instanceof Tn;)t=t.children[t.children.length-1];(!t||!(t instanceof _i)||/\n$/.test(t.node.text))&&((y.safari||y.chrome)&&t&&"false"==t.dom.contentEditable&&this.addHackNode("IMG"),this.addHackNode("BR"))},kt.prototype.addHackNode=function(t){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack(t))this.index++;else{var e=document.createElement(t);"IMG"==t&&(e.className="ProseMirror-separator"),"BR"==t&&(e.className="ProseMirror-trailingBreak"),this.top.children.splice(this.index++,0,new bi(this.top,Xt,e,null)),this.changed=!0}};var Ti=y.safari||y.chrome&&y.chrome_version<63;function Ii(n,t){var e=n.docView.domFromPos(t,0),r=e.node,o=e.offset,i=o<r.childNodes.length?r.childNodes[o]:null,s=o?r.childNodes[o-1]:null;if(y.safari&&i&&"false"==i.contentEditable)return Ir(i);if(!(i&&"false"!=i.contentEditable||s&&"false"!=s.contentEditable)){if(i)return Ir(i);if(s)return Ir(s)}}function Ir(n){return n.contentEditable="true",y.safari&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Ni(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function Ei(n,t){if(t instanceof E){var e=n.docView.descAt(t.from);e!=n.lastSelectedViewDesc&&(Oi(n),e&&e.selectNode(),n.lastSelectedViewDesc=e)}else Oi(n)}function Oi(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=null)}function Nr(n,t,e,r){return n.someProp("createSelectionBetween",function(o){return o(n,t,e)})||Z.between(t,e,r)}function Er(n){var t=n.root.getSelection();if(!t.anchorNode)return!1;try{return n.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(n.editable||n.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(e){return!1}}function Or(n,t){var e=n.selection,r=e.$anchor,o=e.$head,i=t>0?r.max(o):r.min(o),s=i.parent.inlineContent?i.depth?n.doc.resolve(t>0?i.after():i.before()):null:i;return s&&P.findFrom(s,t)}function le(n,t){return n.dispatch(n.state.tr.setSelection(t).scrollIntoView()),!0}function Di(n,t,e){var r=n.state.selection;if(!(r instanceof Z)){if(r instanceof E&&r.node.isInline)return le(n,new Z(t>0?r.$to:r.$from));var u=Or(n.state,t);return!!u&&le(n,u)}if(!r.empty||e.indexOf("s")>-1)return!1;if(n.endOfTextblock(t>0?"right":"left")){var o=Or(n.state,t);return!!(o&&o instanceof E)&&le(n,o)}if(!(y.mac&&e.indexOf("m")>-1)){var a,i=r.$head,s=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText)return!1;var l=t<0?i.pos-s.nodeSize:i.pos;return!!(s.isAtom||(a=n.docView.descAt(l))&&!a.contentDOM)&&(E.isSelectable(s)?le(n,new E(t<0?n.state.doc.resolve(i.pos-s.nodeSize):i)):!!y.webkit&&le(n,new Z(n.state.doc.resolve(t<0?l:l+s.nodeSize))))}}function In(n){return 3==n.nodeType?n.nodeValue.length:n.childNodes.length}function nn(n){var t=n.pmViewDesc;return t&&0==t.size&&(n.nextSibling||"BR"!=n.nodeName)}function Dr(n){var t=n.root.getSelection(),e=t.focusNode,r=t.focusOffset;if(e){var o,i,s=!1;for(y.gecko&&1==e.nodeType&&r<In(e)&&nn(e.childNodes[r])&&(s=!0);;)if(r>0){if(1!=e.nodeType)break;var a=e.childNodes[r-1];if(nn(a))o=e,i=--r;else{if(3!=a.nodeType)break;r=(e=a).nodeValue.length}}else{if(Ai(e))break;for(var l=e.previousSibling;l&&nn(l);)o=e.parentNode,i=bt(l),l=l.previousSibling;if(l)r=In(e=l);else{if((e=e.parentNode)==n.dom)break;r=0}}s?Pr(n,t,e,r):o&&Pr(n,t,o,i)}}function Ar(n){var t=n.root.getSelection(),e=t.focusNode,r=t.focusOffset;if(e){for(var i,s,o=In(e);;)if(r<o){if(1!=e.nodeType)break;if(!nn(e.childNodes[r]))break;i=e,s=++r}else{if(Ai(e))break;for(var l=e.nextSibling;l&&nn(l);)i=l.parentNode,s=bt(l)+1,l=l.nextSibling;if(l)r=0,o=In(e=l);else{if((e=e.parentNode)==n.dom)break;r=o=0}}i&&Pr(n,t,i,s)}}function Ai(n){var t=n.pmViewDesc;return t&&t.node&&t.node.isBlock}function Pr(n,t,e,r){if(Sr(t)){var o=document.createRange();o.setEnd(e,r),o.setStart(e,r),t.removeAllRanges(),t.addRange(o)}else t.extend&&t.extend(e,r);n.domObserver.setCurSelection();var i=n.state;setTimeout(function(){n.state==i&&$t(n)},50)}function Pi(n,t,e){var r=n.state.selection;if(r instanceof Z&&!r.empty||e.indexOf("s")>-1||y.mac&&e.indexOf("m")>-1)return!1;var o=r.$from,i=r.$to;if(!o.parent.inlineContent||n.endOfTextblock(t<0?"up":"down")){var s=Or(n.state,t);if(s&&s instanceof E)return le(n,s)}if(!o.parent.inlineContent){var a=t<0?o:i,l=r instanceof Zt?P.near(a,t):P.findFrom(a,t);return!!l&&le(n,l)}return!1}function Ri(n,t){if(!(n.state.selection instanceof Z))return!0;var e=n.state.selection,r=e.$head,i=e.empty;if(!r.sameParent(e.$anchor))return!0;if(!i)return!1;if(n.endOfTextblock(t>0?"forward":"backward"))return!0;var s=!r.textOffset&&(t<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){var a=n.state.tr;return t<0?a.delete(r.pos-s.nodeSize,r.pos):a.delete(r.pos,r.pos+s.nodeSize),n.dispatch(a),!0}return!1}function Fi(n,t,e){n.domObserver.stop(),t.contentEditable=e,n.domObserver.start()}function Jl(n){var t=n.pmViewDesc;if(t)return t.parseRule();if("BR"==n.nodeName&&n.parentNode){if(y.safari&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){var e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(n.parentNode.lastChild==n||y.safari&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if("IMG"==n.nodeName&&n.getAttribute("mark-placeholder"))return{ignore:!0}}function zi(n,t,e){return Math.max(e.anchor,e.head)>t.content.size?null:Nr(n,t.resolve(e.anchor),t.resolve(e.head))}function Rr(n,t,e){for(var r=n.depth,o=t?n.end():n.pos;r>0&&(t||n.indexAfter(r)==n.node(r).childCount);)r--,o++,t=!1;if(e)for(var i=n.node(r).maybeChild(n.indexAfter(r));i&&!i.isLeaf;)i=i.firstChild,o++;return o}function Bi(n,t){for(var e=[],r=t.content,o=t.openStart,i=t.openEnd;o>1&&i>1&&1==r.childCount&&1==r.firstChild.childCount;){o--,i--;var s=r.firstChild;e.push(s.type.name,s.attrs!=s.type.defaultAttrs?s.attrs:null),r=s.content}var a=n.someProp("clipboardSerializer")||et.fromSchema(n.state.schema),l=Wi(),u=l.createElement("div");u.appendChild(a.serializeFragment(r,{document:l}));for(var f,p=u.firstChild;p&&1==p.nodeType&&(f=Ji[p.nodeName.toLowerCase()]);){for(var d=f.length-1;d>=0;d--){for(var h=l.createElement(f[d]);u.firstChild;)h.appendChild(u.firstChild);u.appendChild(h),"tbody"!=f[d]&&(o++,i++)}p=u.firstChild}return p&&1==p.nodeType&&p.setAttribute("data-pm-slice",o+" "+i+" "+JSON.stringify(e)),{dom:u,text:n.someProp("clipboardTextSerializer",function(g){return g(t)})||t.content.textBetween(0,t.content.size,"\n\n")}}function Li(n,t,e,r,o){var i,a,s=o.parent.type.spec.code;if(!e&&!t)return null;var l=t&&(r||s||!e);if(l){if(n.someProp("transformPastedText",function(I){t=I(t,s||r)}),s)return t?new M(v.from(n.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):M.empty;var u=n.someProp("clipboardTextParser",function(I){return I(t,o,r)});if(u)a=u;else{var p=o.marks(),d=n.state.schema,h=et.fromSchema(d);i=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(function(I){var A=i.appendChild(document.createElement("p"));I&&A.appendChild(h.serializeNode(d.text(I,p)))})}}else n.someProp("transformPastedHTML",function(I){e=I(e)}),i=function(n){var t=/^(\s*<meta [^>]*>)*/.exec(n);t&&(n=n.slice(t[0].length));var o,e=Wi().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n);if((o=r&&Ji[r[1].toLowerCase()])&&(n=o.map(function(s){return"<"+s+">"}).join("")+n+o.map(function(s){return"</"+s+">"}).reverse().join("")),e.innerHTML=n,o)for(var i=0;i<o.length;i++)e=e.querySelector(o[i])||e;return e}(e),y.webkit&&function(n){for(var t=n.querySelectorAll(y.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),e=0;e<t.length;e++){var r=t[e];1==r.childNodes.length&&"\xa0"==r.textContent&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}(i);var m=i&&i.querySelector("[data-pm-slice]"),g=m&&/^(\d+) (\d+) (.*)/.exec(m.getAttribute("data-pm-slice"));if(!a){var x=n.someProp("clipboardParser")||n.someProp("domParser")||Mt.fromSchema(n.state.schema);a=x.parseSlice(i,{preserveWhitespace:!(!l&&!g),context:o,ruleFromNode:function(A){if("BR"==A.nodeName&&!A.nextSibling&&A.parentNode&&!Kl.test(A.parentNode.nodeName))return{ignore:!0}}})}if(g)a=function(n,t){if(!n.size)return n;var r,e=n.content.firstChild.type.schema;try{r=JSON.parse(t)}catch(u){return n}for(var o=n.content,i=n.openStart,s=n.openEnd,a=r.length-2;a>=0;a-=2){var l=e.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;o=v.from(l.create(r[a+1],o)),i++,s++}return new M(o,i,s)}(qi(a,+g[1],+g[2]),g[3]);else if(a=M.maxOpen(function(n,t){if(n.childCount<2)return n;for(var e=function(i){var a=t.node(i).contentMatchAt(t.index(i)),l=void 0,u=[];if(n.forEach(function(p){if(u){var d,f=a.findWrapping(p.type);if(!f)return u=null;if(d=u.length&&l.length&&Vi(f,l,p,u[u.length-1],0))u[u.length-1]=d;else{u.length&&(u[u.length-1]=Zi(u[u.length-1],l.length));var h=Hi(p,f);u.push(h),a=a.matchType(h.type,h.attrs),l=f}}}),u)return{v:v.from(u)}},r=t.depth;r>=0;r--){var o=e(r);if(o)return o.v}return n}(a.content,o),!0),a.openStart||a.openEnd){for(var S=0,b=0,N=a.content.firstChild;S<a.openStart&&!N.type.spec.isolating;S++,N=N.firstChild);for(var w=a.content.lastChild;b<a.openEnd&&!w.type.spec.isolating;b++,w=w.lastChild);a=qi(a,S,b)}return n.someProp("transformPasted",function(I){a=I(a)}),a}var Kl=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Hi(n,t,e){void 0===e&&(e=0);for(var r=t.length-1;r>=e;r--)n=t[r].create(null,v.from(n));return n}function Vi(n,t,e,r,o){if(o<n.length&&o<t.length&&n[o]==t[o]){var i=Vi(n,t,e,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(o==n.length-1?e.type:n[o+1]))return r.copy(r.content.append(v.from(Hi(e,n,o+1))))}}function Zi(n,t){if(0==t)return n;var e=n.content.replaceChild(n.childCount-1,Zi(n.lastChild,t-1)),r=n.contentMatchAt(n.childCount).fillBefore(v.empty,!0);return n.copy(e.append(r))}function Fr(n,t,e,r,o,i){var s=t<0?n.firstChild:n.lastChild,a=s.content;return o<r-1&&(a=Fr(a,t,e,r,o+1,i)),o>=e&&(a=t<0?s.contentMatchAt(0).fillBefore(a,n.childCount>1||i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(v.empty,!0))),n.replaceChild(t<0?0:n.childCount-1,s.copy(a))}function qi(n,t,e){return t<n.openStart&&(n=new M(Fr(n.content,-1,t,n.openStart,0,n.openEnd),t,n.openEnd)),e<n.openEnd&&(n=new M(Fr(n.content,1,e,n.openEnd,0,0),n.openStart,e)),n}var Ji={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Ui=null;function Wi(){return Ui||(Ui=document.implementation.createHTMLDocument("title"))}var tc={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},zr=y.ie&&y.ie_version<=11,Br=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};Br.prototype.set=function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset},Br.prototype.eq=function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset};var xt=function(t,e){var r=this;this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(o){for(var i=0;i<o.length;i++)r.queue.push(o[i]);y.ie&&y.ie_version<=11&&o.some(function(s){return"childList"==s.type&&s.removedNodes.length||"characterData"==s.type&&s.oldValue.length>s.target.nodeValue.length})?r.flushSoon():r.flush()}),this.currentSelection=new Br,zr&&(this.onCharData=function(o){r.queue.push({target:o.target,type:"characterData",oldValue:o.prevValue}),r.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};xt.prototype.flushSoon=function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){t.flushingSoon=-1,t.flush()},20))},xt.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())},xt.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,tc),zr&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()},xt.prototype.stop=function(){var t=this;if(this.observer){var e=this.observer.takeRecords();if(e.length){for(var r=0;r<e.length;r++)this.queue.push(e[r]);window.setTimeout(function(){return t.flush()},20)}this.observer.disconnect()}zr&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()},xt.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)},xt.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)},xt.prototype.suppressSelectionUpdates=function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return t.suppressingSelectionUpdates=!1},50)},xt.prototype.onSelectionChange=function(){if((!(n=this.view).editable||n.root.activeElement==n.dom)&&Er(n)){if(this.suppressingSelectionUpdates)return $t(this.view);if(y.ie&&y.ie_version<=11&&!this.view.state.selection.empty){var t=this.view.root.getSelection();if(t.focusNode&&Ye(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}var n},xt.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())},xt.prototype.ignoreSelectionChange=function(t){if(0==t.rangeCount)return!0;var e=t.getRangeAt(0).commonAncestorContainer,r=this.view.docView.nearestDesc(e);return r&&r.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0},xt.prototype.flush=function(){if(this.view.docView&&!(this.flushingSoon>-1)){var t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);var e=this.view.root.getSelection(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(e)&&Er(this.view)&&!this.ignoreSelectionChange(e),o=-1,i=-1,s=!1,a=[];if(this.view.editable)for(var l=0;l<t.length;l++){var u=this.registerMutation(t[l],a);u&&(o=o<0?u.from:Math.min(u.from,o),i=i<0?u.to:Math.max(u.to,i),u.typeOver&&(s=!0))}if(y.gecko&&a.length>1){var p=a.filter(function(h){return"BR"==h.nodeName});if(2==p.length){var f=p[0],d=p[1];f.parentNode&&f.parentNode.parentNode==d.parentNode?d.remove():f.remove()}}(o>-1||r)&&(o>-1&&(this.view.docView.markDirty(o,i),ji||(ji=!0,"normal"==getComputedStyle(this.view.dom).whiteSpace&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))),this.handleDOMChange(o,i,s,a),this.view.docView&&this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(e)||$t(this.view),this.currentSelection.set(e))}},xt.prototype.registerMutation=function(t,e){if(e.indexOf(t.target)>-1)return null;var r=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(r==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style"))||!r||r.ignoreMutation(t))return null;if("childList"==t.type){for(var o=0;o<t.addedNodes.length;o++)e.push(t.addedNodes[o]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(t.target))return{from:r.posBefore,to:r.posAfter};var i=t.previousSibling,s=t.nextSibling;if(y.ie&&y.ie_version<=11&&t.addedNodes.length)for(var a=0;a<t.addedNodes.length;a++){var l=t.addedNodes[a],u=l.previousSibling,p=l.nextSibling;(!u||Array.prototype.indexOf.call(t.addedNodes,u)<0)&&(i=u),(!p||Array.prototype.indexOf.call(t.addedNodes,p)<0)&&(s=p)}var f=i&&i.parentNode==t.target?bt(i)+1:0,d=r.localPosFromDOM(t.target,f,-1),h=s&&s.parentNode==t.target?bt(s):t.target.childNodes.length;return{from:d,to:r.localPosFromDOM(t.target,h,1)}}return"attributes"==t.type?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}};var ji=!1,gt={},ht={};function ce(n,t){n.lastSelectionOrigin=t,n.lastSelectionTime=Date.now()}function Lr(n){n.someProp("handleDOMEvents",function(t){for(var e in t)n.eventHandlers[e]||n.dom.addEventListener(e,n.eventHandlers[e]=function(r){return Hr(n,r)})})}function Hr(n,t){return n.someProp("handleDOMEvents",function(e){var r=e[t.type];return!!r&&(r(n,t)||t.defaultPrevented)})}function Nn(n){return{left:n.clientX,top:n.clientY}}function Vr(n,t,e,r,o){if(-1==r)return!1;for(var i=n.state.doc.resolve(r),s=function(u){if(n.someProp(t,function(p){return u>i.depth?p(n,e,i.nodeAfter,i.before(u),o,!0):p(n,e,i.node(u),i.before(u),o,!1)}))return{v:!0}},a=i.depth+1;a>0;a--){var l=s(a);if(l)return l.v}return!1}function we(n,t,e){n.focused||n.focus();var r=n.state.tr.setSelection(t);"pointer"==e&&r.setMeta("pointer",!0),n.dispatch(r)}function uc(n,t,e,r){return Vr(n,"handleDoubleClickOn",t,e,r)||n.someProp("handleDoubleClick",function(o){return o(n,t,r)})}function pc(n,t,e,r){return Vr(n,"handleTripleClickOn",t,e,r)||n.someProp("handleTripleClick",function(o){return o(n,t,r)})||function(n,t,e){if(0!=e.button)return!1;var r=n.state.doc;if(-1==t)return!!r.inlineContent&&(we(n,Z.create(r,0,r.content.size),"pointer"),!0);for(var o=r.resolve(t),i=o.depth+1;i>0;i--){var s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)we(n,Z.create(r,a+1,a+1+s.content.size),"pointer");else{if(!E.isSelectable(s))continue;we(n,E.create(r,a),"pointer")}return!0}}(n,e,r)}function Zr(n){return On(n)}ht.keydown=function(n,t){if(n.shiftKey=16==t.keyCode||t.shiftKey,!Ki(n,t)&&(n.lastKeyCode=t.keyCode,n.lastKeyCodeTime=Date.now(),!y.android||!y.chrome||13!=t.keyCode))if(229!=t.keyCode&&n.domObserver.forceFlush(),!y.ios||13!=t.keyCode||t.ctrlKey||t.altKey||t.metaKey)n.someProp("handleKeyDown",function(r){return r(n,t)})||function(n,t){var e=t.keyCode,r=function(n){var t="";return n.ctrlKey&&(t+="c"),n.metaKey&&(t+="m"),n.altKey&&(t+="a"),n.shiftKey&&(t+="s"),t}(t);return 8==e||y.mac&&72==e&&"c"==r?Ri(n,-1)||Dr(n):46==e||y.mac&&68==e&&"c"==r?Ri(n,1)||Ar(n):13==e||27==e||(37==e?Di(n,-1,r)||Dr(n):39==e?Di(n,1,r)||Ar(n):38==e?Pi(n,-1,r)||Dr(n):40==e?function(n){if(y.safari&&!(n.state.selection.$head.parentOffset>0)){var t=n.root.getSelection(),e=t.focusNode;if(e&&1==e.nodeType&&0==t.focusOffset&&e.firstChild&&"false"==e.firstChild.contentEditable){var o=e.firstChild;Fi(n,o,!0),setTimeout(function(){return Fi(n,o,!1)},20)}}}(n)||Pi(n,1,r)||Ar(n):r==(y.mac?"m":"c")&&(66==e||73==e||89==e||90==e))}(n,t)?t.preventDefault():ce(n,"key");else{var e=Date.now();n.lastIOSEnter=e,n.lastIOSEnterFallbackTimeout=setTimeout(function(){n.lastIOSEnter==e&&(n.someProp("handleKeyDown",function(r){return r(n,Ce(13,"Enter"))}),n.lastIOSEnter=0)},200)}},ht.keyup=function(n,t){16==t.keyCode&&(n.shiftKey=!1)},ht.keypress=function(n,t){if(!(Ki(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||y.mac&&t.metaKey)){if(n.someProp("handleKeyPress",function(o){return o(n,t)}))return void t.preventDefault();var e=n.state.selection;if(!(e instanceof Z&&e.$from.sameParent(e.$to))){var r=String.fromCharCode(t.charCode);n.someProp("handleTextInput",function(o){return o(n,e.$from.pos,e.$to.pos,r)})||n.dispatch(n.state.tr.insertText(r).scrollIntoView()),t.preventDefault()}}};var Qi=y.mac?"metaKey":"ctrlKey";gt.mousedown=function(n,t){n.shiftKey=t.shiftKey;var e=Zr(n),r=Date.now(),o="singleClick";r-n.lastClick.time<500&&function(n,t){var e=t.x-n.clientX,r=t.y-n.clientY;return e*e+r*r<100}(t,n.lastClick)&&!t[Qi]&&("singleClick"==n.lastClick.type?o="doubleClick":"doubleClick"==n.lastClick.type&&(o="tripleClick")),n.lastClick={time:r,x:t.clientX,y:t.clientY,type:o};var i=n.posAtCoords(Nn(t));!i||("singleClick"==o?(n.mouseDown&&n.mouseDown.done(),n.mouseDown=new En(n,i,t,e)):("doubleClick"==o?uc:pc)(n,i.pos,i.inside,t)?t.preventDefault():ce(n,"pointer"))};var En=function(t,e,r,o){var s,a,i=this;if(this.view=t,this.startDoc=t.state.doc,this.pos=e,this.event=r,this.flushed=o,this.selectNode=r[Qi],this.allowDefault=r.shiftKey,this.delayedSelectionSync=!1,e.inside>-1)s=t.state.doc.nodeAt(e.inside),a=e.inside;else{var l=t.state.doc.resolve(e.pos);s=l.parent,a=l.depth?l.before():0}this.mightDrag=null;var u=o?null:r.target,p=u?t.docView.nearestDesc(u,!0):null;this.target=p?p.dom:null;var d=t.state.selection;(0==r.button&&s.type.spec.draggable&&!1!==s.type.spec.selectable||d instanceof E&&d.from<=a&&d.to>a)&&(this.mightDrag={node:s,pos:a,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&y.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){i.view.mouseDown==i&&i.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),ce(t,"pointer")};function Ki(n,t){return!!n.composing||!!(y.safari&&Math.abs(t.timeStamp-n.compositionEndedAt)<500)&&(n.compositionEndedAt=-2e8,!0)}En.prototype.done=function(){var t=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return $t(t.view)}),this.view.mouseDown=null},En.prototype.up=function(t){if(this.done(),this.view.dom.contains(3==t.target.nodeType?t.target.parentNode:t.target)){var e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Nn(t))),this.allowDefault||!e?ce(this.view,"pointer"):function(n,t,e,r,o){return Vr(n,"handleClickOn",t,e,r)||n.someProp("handleClick",function(i){return i(n,t,r)})||(o?function(n,t){if(-1==t)return!1;var r,o,e=n.state.selection;e instanceof E&&(r=e.node);for(var i=n.state.doc.resolve(t),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(E.isSelectable(a)){o=r&&e.$from.depth>0&&s>=e.$from.depth&&i.before(e.$from.depth+1)==e.$from.pos?i.before(e.$from.depth):i.before(s);break}}return null!=o&&(we(n,E.create(n.state.doc,o),"pointer"),!0)}(n,e):function(n,t){if(-1==t)return!1;var e=n.state.doc.resolve(t),r=e.nodeAfter;return!!(r&&r.isAtom&&E.isSelectable(r))&&(we(n,new E(e),"pointer"),!0)}(n,e))}(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():0==t.button&&(this.flushed||y.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||y.chrome&&!(this.view.state.selection instanceof Z)&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(we(this.view,P.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):ce(this.view,"pointer")}},En.prototype.move=function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0),ce(this.view,"pointer"),0==t.buttons&&this.done()},gt.touchdown=function(n){Zr(n),ce(n,"pointer")},gt.contextmenu=function(n){return Zr(n)};var dc=y.android?5e3:-1;function Gi(n,t){clearTimeout(n.composingTimeout),t>-1&&(n.composingTimeout=setTimeout(function(){return On(n)},t))}function Yi(n){for(n.composing&&(n.composing=!1,n.compositionEndedAt=function(){var n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}());n.compositionNodes.length>0;)n.compositionNodes.pop().markParentsDirty()}function On(n,t){if(!(y.android&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),Yi(n),t||n.docView&&n.docView.dirty){var e=ki(n);return e&&!e.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(e)):n.updateState(n.state),!0}return!1}}ht.compositionstart=ht.compositionupdate=function(n){if(!n.composing){n.domObserver.flush();var t=n.state,e=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!e.textOffset&&e.parentOffset&&e.nodeBefore.marks.some(function(a){return!1===a.type.spec.inclusive})))n.markCursor=n.state.storedMarks||e.marks(),On(n,!0),n.markCursor=null;else if(On(n),y.gecko&&t.selection.empty&&e.parentOffset&&!e.textOffset&&e.nodeBefore.marks.length)for(var r=n.root.getSelection(),o=r.focusNode,i=r.focusOffset;o&&1==o.nodeType&&0!=i;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(3==s.nodeType){r.collapse(s,s.nodeValue.length);break}o=s,i=-1}n.composing=!0}Gi(n,dc)},ht.compositionend=function(n,t){n.composing&&(n.composing=!1,n.compositionEndedAt=t.timeStamp,Gi(n,20))};var Te=y.ie&&y.ie_version<15||y.ios&&y.webkit_version<604;function qr(n,t,e,r){var o=Li(n,t,e,n.shiftKey,n.state.selection.$from);if(n.someProp("handlePaste",function(a){return a(n,r,o||M.empty)}))return!0;if(!o)return!1;var i=function(n){return 0==n.openStart&&0==n.openEnd&&1==n.content.childCount?n.content.firstChild:null}(o),s=i?n.state.tr.replaceSelectionWith(i,n.shiftKey):n.state.tr.replaceSelection(o);return n.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}gt.copy=ht.cut=function(n,t){var e=n.state.selection,r="cut"==t.type;if(!e.empty){var o=Te?null:t.clipboardData,s=Bi(n,e.content()),a=s.dom,l=s.text;o?(t.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",l)):function(n,t){if(n.dom.parentNode){var e=n.dom.parentNode.appendChild(document.createElement("div"));e.appendChild(t),e.style.cssText="position: fixed; left: -10000px; top: 10px";var r=getSelection(),o=document.createRange();o.selectNodeContents(t),n.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e),n.focus()},50)}}(n,a),r&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}},ht.paste=function(n,t){if(!n.composing||y.android){var e=Te?null:t.clipboardData;e&&qr(n,e.getData("text/plain"),e.getData("text/html"),t)?t.preventDefault():function(n,t){if(n.dom.parentNode){var e=n.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(e?"textarea":"div"));e||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(function(){n.focus(),r.parentNode&&r.parentNode.removeChild(r),e?qr(n,r.value,null,t):qr(n,r.textContent,r.innerHTML,t)},50)}}(n,t)}};var yc=function(t,e){this.slice=t,this.move=e},Xi=y.mac?"altKey":"ctrlKey";for(var $i in gt.dragstart=function(n,t){var e=n.mouseDown;if(e&&e.done(),t.dataTransfer){var r=n.state.selection,o=r.empty?null:n.posAtCoords(Nn(t));if(!(o&&o.pos>=r.from&&o.pos<=(r instanceof E?r.to-1:r.to)))if(e&&e.mightDrag)n.dispatch(n.state.tr.setSelection(E.create(n.state.doc,e.mightDrag.pos)));else if(t.target&&1==t.target.nodeType){var i=n.docView.nearestDesc(t.target,!0);i&&i.node.type.spec.draggable&&i!=n.docView&&n.dispatch(n.state.tr.setSelection(E.create(n.state.doc,i.posBefore)))}var s=n.state.selection.content(),a=Bi(n,s),l=a.dom,u=a.text;t.dataTransfer.clearData(),t.dataTransfer.setData(Te?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",Te||t.dataTransfer.setData("text/plain",u),n.dragging=new yc(s,!t[Xi])}},gt.dragend=function(n){var t=n.dragging;window.setTimeout(function(){n.dragging==t&&(n.dragging=null)},50)},ht.dragover=ht.dragenter=function(n,t){return t.preventDefault()},ht.drop=function(n,t){var e=n.dragging;if(n.dragging=null,t.dataTransfer){var r=n.posAtCoords(Nn(t));if(r){var o=n.state.doc.resolve(r.pos);if(o){var i=e&&e.slice;i?n.someProp("transformPasted",function(m){i=m(i)}):i=Li(n,t.dataTransfer.getData(Te?"Text":"text/plain"),Te?null:t.dataTransfer.getData("text/html"),!1,o);var s=e&&!t[Xi];if(n.someProp("handleDrop",function(m){return m(n,t,i||M.empty,s)}))return void t.preventDefault();if(i){t.preventDefault();var a=i?function(n,t,e){var r=n.resolve(t);if(!e.content.size)return t;for(var o=e.content,i=0;i<e.openStart;i++)o=o.firstChild.content;for(var s=1;s<=(0==e.openStart&&e.size?2:1);s++)for(var a=r.depth;a>=0;a--){var l=a==r.depth?0:r.pos<=(r.start(a+1)+r.end(a+1))/2?-1:1,u=r.index(a)+(l>0?1:0),p=r.node(a),f=!1;if(1==s)f=p.canReplace(u,u,o);else{var d=p.contentMatchAt(u).findWrapping(o.firstChild.type);f=d&&p.canReplaceWith(u,u,d[0])}if(f)return 0==l?r.pos:l<0?r.before(a+1):r.after(a+1)}return null}(n.state.doc,o.pos,i):o.pos;null==a&&(a=o.pos);var l=n.state.tr;s&&l.deleteSelection();var u=l.mapping.map(a),p=0==i.openStart&&0==i.openEnd&&1==i.content.childCount,f=l.doc;if(p?l.replaceRangeWith(u,u,i.content.firstChild):l.replaceRange(u,u,i),!l.doc.eq(f)){var d=l.doc.resolve(u);if(p&&E.isSelectable(i.content.firstChild)&&d.nodeAfter&&d.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new E(d));else{var h=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach(function(m,g,x,S){return h=S}),l.setSelection(Nr(n,d,l.doc.resolve(h)))}n.focus(),n.dispatch(l.setMeta("uiEvent","drop"))}}}}}},gt.focus=function(n){n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(function(){n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.root.getSelection())&&$t(n)},20))},gt.blur=function(n,t){n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.set({}),n.focused=!1)},gt.beforeinput=function(n,t){if(y.chrome&&y.android&&"deleteContentBackward"==t.inputType){n.domObserver.flushSoon();var e=n.domChangeCount;setTimeout(function(){if(n.domChangeCount==e&&(n.dom.blur(),n.focus(),!n.someProp("handleKeyDown",function(i){return i(n,Ce(8,"Backspace"))}))){var o=n.state.selection.$cursor;o&&o.pos>0&&n.dispatch(n.state.tr.delete(o.pos-1,o.pos).scrollIntoView())}},50)}},ht)gt[$i]=ht[$i];function rn(n,t){if(n==t)return!0;for(var e in n)if(n[e]!==t[e])return!1;for(var r in t)if(!(r in n))return!1;return!0}var Ie=function(t,e){this.spec=e||ue,this.side=this.spec.side||0,this.toDOM=t};Ie.prototype.map=function(t,e,r,o){var i=t.mapResult(e.from+o,this.side<0?-1:1),s=i.pos;return i.deleted?null:new Y(s-r,s-r,this)},Ie.prototype.valid=function(){return!0},Ie.prototype.eq=function(t){return this==t||t instanceof Ie&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&rn(this.spec,t.spec))},Ie.prototype.destroy=function(t){this.spec.destroy&&this.spec.destroy(t)};var Ot=function(t,e){this.spec=e||ue,this.attrs=t};Ot.prototype.map=function(t,e,r,o){var i=t.map(e.from+o,this.spec.inclusiveStart?-1:1)-r,s=t.map(e.to+o,this.spec.inclusiveEnd?1:-1)-r;return i>=s?null:new Y(i,s,this)},Ot.prototype.valid=function(t,e){return e.from<e.to},Ot.prototype.eq=function(t){return this==t||t instanceof Ot&&rn(this.attrs,t.attrs)&&rn(this.spec,t.spec)},Ot.is=function(t){return t.type instanceof Ot};var on=function(t,e){this.spec=e||ue,this.attrs=t};on.prototype.map=function(t,e,r,o){var i=t.mapResult(e.from+o,1);if(i.deleted)return null;var s=t.mapResult(e.to+o,-1);return s.deleted||s.pos<=i.pos?null:new Y(i.pos-r,s.pos-r,this)},on.prototype.valid=function(t,e){var s,r=t.content.findIndex(e.from),i=r.offset;return i==e.from&&!(s=t.child(r.index)).isText&&i+s.nodeSize==e.to},on.prototype.eq=function(t){return this==t||t instanceof on&&rn(this.attrs,t.attrs)&&rn(this.spec,t.spec)};var Y=function(t,e,r){this.from=t,this.to=e,this.type=r},Jr={spec:{configurable:!0},inline:{configurable:!0}};Y.prototype.copy=function(t,e){return new Y(t,e,this.type)},Y.prototype.eq=function(t,e){return void 0===e&&(e=0),this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to},Y.prototype.map=function(t,e,r){return this.type.map(t,this,e,r)},Y.widget=function(t,e,r){return new Y(t,t,new Ie(e,r))},Y.inline=function(t,e,r,o){return new Y(t,e,new Ot(r,o))},Y.node=function(t,e,r,o){return new Y(t,e,new on(r,o))},Jr.spec.get=function(){return this.type.spec},Jr.inline.get=function(){return this.type instanceof Ot},Object.defineProperties(Y.prototype,Jr);var Dn=[],ue={},B=function(t,e){this.local=t&&t.length?t:Dn,this.children=e&&e.length?e:Dn};B.create=function(t,e){return e.length?An(e,t,0,ue):rt},B.prototype.find=function(t,e,r){var o=[];return this.findInner(null==t?0:t,null==e?1e9:e,o,0,r),o},B.prototype.findInner=function(t,e,r,o,i){for(var s=0;s<this.local.length;s++){var a=this.local[s];a.from<=e&&a.to>=t&&(!i||i(a.spec))&&r.push(a.copy(a.from+o,a.to+o))}for(var l=0;l<this.children.length;l+=3)if(this.children[l]<e&&this.children[l+1]>t){var u=this.children[l]+1;this.children[l+2].findInner(t-u,e-u,r,o+u,i)}},B.prototype.map=function(t,e,r){return this==rt||0==t.maps.length?this:this.mapInner(t,e,0,0,r||ue)},B.prototype.mapInner=function(t,e,r,o,i){for(var s,a=0;a<this.local.length;a++){var l=this.local[a].map(t,r,o);l&&l.type.valid(e,l)?(s||(s=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?function(n,t,e,r,o,i,s){for(var a=n.slice(),l=function(Re,he,me,Jn){for(var mt=0;mt<a.length;mt+=3){var $=a[mt+1],ao=void 0;-1==$||Re>$+i||(he>=a[mt]+i?a[mt+1]=-1:me>=o&&(ao=Jn-me-(he-Re))&&(a[mt]+=ao,a[mt+1]+=ao))}},u=0;u<e.maps.length;u++)e.maps[u].forEach(l);for(var p=!1,f=0;f<a.length;f+=3)if(-1==a[f+1]){var d=e.map(n[f]+i),h=d-o;if(h<0||h>=r.content.size){p=!0;continue}var g=e.map(n[f+1]+i,-1)-o,x=r.content.findIndex(h),b=x.offset,N=r.maybeChild(x.index);if(N&&b==h&&b+N.nodeSize==g){var w=a[f+2].mapInner(e,N,d+1,n[f]+i+1,s);w!=rt?(a[f]=h,a[f+1]=g,a[f+2]=w):(a[f+1]=-2,p=!0)}else p=!0}if(p){var I=function(n,t,e,r,o,i,s){function a(u,p){for(var f=0;f<u.local.length;f++){var d=u.local[f].map(r,o,p);d?e.push(d):s.onRemove&&s.onRemove(u.local[f].spec)}for(var h=0;h<u.children.length;h+=3)a(u.children[h+2],u.children[h]+p+1)}for(var l=0;l<n.length;l+=3)-1==n[l+1]&&a(n[l+2],t[l]+i+1);return e}(a,n,t||[],e,o,i,s),A=An(I,r,0,s);t=A.local;for(var j=0;j<a.length;j+=3)a[j+1]<0&&(a.splice(j,3),j-=3);for(var U=0,K=0;U<A.children.length;U+=3){for(var X=A.children[U];K<a.length&&a[K]<X;)K+=3;a.splice(K,0,A.children[U],A.children[U+1],A.children[U+2])}}return new B(t&&t.sort(pe),a)}(this.children,s,t,e,r,o,i):s?new B(s.sort(pe)):rt},B.prototype.add=function(t,e){return e.length?this==rt?B.create(t,e):this.addInner(t,e,0):this},B.prototype.addInner=function(t,e,r){var i,o=this,s=0;t.forEach(function(u,p){var d,f=p+r;if(d=es(e,u,f)){for(i||(i=o.children.slice());s<i.length&&i[s]<p;)s+=3;i[s]==p?i[s+2]=i[s+2].addInner(u,d,f+1):i.splice(s,0,p,p+u.nodeSize,An(d,u,f+1,ue)),s+=3}});for(var a=ts(s?ns(e):e,-r),l=0;l<a.length;l++)a[l].type.valid(t,a[l])||a.splice(l--,1);return new B(a.length?this.local.concat(a).sort(pe):this.local,i||this.children)},B.prototype.remove=function(t){return 0==t.length||this==rt?this:this.removeInner(t,0)},B.prototype.removeInner=function(t,e){for(var r=this.children,o=this.local,i=0;i<r.length;i+=3){for(var s=void 0,a=r[i]+e,l=r[i+1]+e,u=0,p=void 0;u<t.length;u++)(p=t[u])&&p.from>a&&p.to<l&&(t[u]=null,(s||(s=[])).push(p));if(s){r==this.children&&(r=this.children.slice());var f=r[i+2].removeInner(s,a+1);f!=rt?r[i+2]=f:(r.splice(i,3),i-=3)}}if(o.length)for(var d=0,h=void 0;d<t.length;d++)if(h=t[d])for(var m=0;m<o.length;m++)o[m].eq(h,e)&&(o==this.local&&(o=this.local.slice()),o.splice(m--,1));return r==this.children&&o==this.local?this:o.length||r.length?new B(o,r):rt},B.prototype.forChild=function(t,e){if(this==rt)return this;if(e.isLeaf)return B.empty;for(var r,o,i=0;i<this.children.length;i+=3)if(this.children[i]>=t){this.children[i]==t&&(r=this.children[i+2]);break}for(var s=t+1,a=s+e.content.size,l=0;l<this.local.length;l++){var u=this.local[l];if(u.from<a&&u.to>s&&u.type instanceof Ot){var p=Math.max(s,u.from)-s,f=Math.min(a,u.to)-s;p<f&&(o||(o=[])).push(u.copy(p,f))}}if(o){var d=new B(o.sort(pe));return r?new wt([d,r]):d}return r||rt},B.prototype.eq=function(t){if(this==t)return!0;if(!(t instanceof B)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(var e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(var r=0;r<this.children.length;r+=3)if(this.children[r]!=t.children[r]||this.children[r+1]!=t.children[r+1]||!this.children[r+2].eq(t.children[r+2]))return!1;return!0},B.prototype.locals=function(t){return Ur(this.localsInner(t))},B.prototype.localsInner=function(t){if(this==rt)return Dn;if(t.inlineContent||!this.local.some(Ot.is))return this.local;for(var e=[],r=0;r<this.local.length;r++)this.local[r].type instanceof Ot||e.push(this.local[r]);return e};var rt=new B;B.empty=rt,B.removeOverlap=Ur;var wt=function(t){this.members=t};function ts(n,t){if(!t||!n.length)return n;for(var e=[],r=0;r<n.length;r++){var o=n[r];e.push(new Y(o.from+t,o.to+t,o.type))}return e}function es(n,t,e){if(t.isLeaf)return null;for(var r=e+t.nodeSize,o=null,i=0,s=void 0;i<n.length;i++)(s=n[i])&&s.from>e&&s.to<r&&((o||(o=[])).push(s),n[i]=null);return o}function ns(n){for(var t=[],e=0;e<n.length;e++)null!=n[e]&&t.push(n[e]);return t}function An(n,t,e,r){var o=[],i=!1;t.forEach(function(l,u){var p=es(n,l,u+e);if(p){i=!0;var f=An(p,l,e+u+1,r);f!=rt&&o.push(u,u+l.nodeSize,f)}});for(var s=ts(i?ns(n):n,-e).sort(pe),a=0;a<s.length;a++)s[a].type.valid(t,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new B(s,o):rt}function pe(n,t){return n.from-t.from||n.to-t.to}function Ur(n){for(var t=n,e=0;e<t.length-1;e++){var r=t[e];if(r.from!=r.to)for(var o=e+1;o<t.length;o++){var i=t[o];if(i.from!=r.from){i.from<r.to&&(t==n&&(t=n.slice()),t[e]=r.copy(r.from,i.from),rs(t,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(t==n&&(t=n.slice()),t[o]=i.copy(i.from,r.to),rs(t,o+1,i.copy(r.to,i.to)))}}return t}function rs(n,t,e){for(;t<n.length&&pe(e,n[t])>0;)t++;n.splice(t,0,e)}function Wr(n){var t=[];return n.someProp("decorations",function(e){var r=e(n.state);r&&r!=rt&&t.push(r)}),n.cursorWrapper&&t.push(B.create(n.state.doc,[n.cursorWrapper.deco])),wt.from(t)}wt.prototype.map=function(t,e){var r=this.members.map(function(o){return o.map(t,e,ue)});return wt.from(r)},wt.prototype.forChild=function(t,e){if(e.isLeaf)return B.empty;for(var r=[],o=0;o<this.members.length;o++){var i=this.members[o].forChild(t,e);i!=rt&&(i instanceof wt?r=r.concat(i.members):r.push(i))}return wt.from(r)},wt.prototype.eq=function(t){if(!(t instanceof wt)||t.members.length!=this.members.length)return!1;for(var e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0},wt.prototype.locals=function(t){for(var e,r=!0,o=0;o<this.members.length;o++){var i=this.members[o].localsInner(t);if(i.length)if(e){r&&(e=e.slice(),r=!1);for(var s=0;s<i.length;s++)e.push(i[s])}else e=i}return e?Ur(r?e:e.sort(pe)):Dn},wt.from=function(t){switch(t.length){case 0:return rt;case 1:return t[0];default:return new wt(t)}};var W=function(t,e){this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(cs),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):t.apply?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=as(this),this.markCursor=null,this.cursorWrapper=null,ss(this),this.nodeViews=ls(this),this.docView=yi(this.state.doc,is(this),Wr(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,function(n){n.shiftKey=!1,n.mouseDown=null,n.lastKeyCode=null,n.lastKeyCodeTime=0,n.lastClick={time:0,x:0,y:0,type:""},n.lastSelectionOrigin=null,n.lastSelectionTime=0,n.lastIOSEnter=0,n.lastIOSEnterFallbackTimeout=null,n.lastAndroidDelete=0,n.composing=!1,n.composingTimeout=null,n.compositionNodes=[],n.compositionEndedAt=-2e8,n.domObserver=new xt(n,function(r,o,i,s){return function(n,t,e,r,o){if(t<0){var i=n.lastSelectionTime>Date.now()-50?n.lastSelectionOrigin:null,s=ki(n,i);if(s&&!n.state.selection.eq(s)){var a=n.state.tr.setSelection(s);"pointer"==i?a.setMeta("pointer",!0):"key"==i&&a.scrollIntoView(),n.dispatch(a)}}else{var l=n.state.doc.resolve(t),u=l.sharedDepth(e);t=l.before(u+1),e=n.state.doc.resolve(e).after(u+1);var p=n.state.selection,f=function(n,t,e){var r=n.docView.parseRange(t,e),o=r.node,i=r.fromOffset,s=r.toOffset,a=r.from,l=r.to,u=n.root.getSelection(),p=null,f=u.anchorNode;if(f&&n.dom.contains(1==f.nodeType?f:f.parentNode)&&(p=[{node:f,offset:u.anchorOffset}],Sr(u)||p.push({node:u.focusNode,offset:u.focusOffset})),y.chrome&&8===n.lastKeyCode)for(var d=s;d>i;d--){var h=o.childNodes[d-1],m=h.pmViewDesc;if("BR"==h.nodeName&&!m){s=d;break}if(!m||m.size)break}var g=n.state.doc,x=n.someProp("domParser")||Mt.fromSchema(n.state.schema),S=g.resolve(a),b=null,N=x.parse(o,{topNode:S.parent,topMatch:S.parent.contentMatchAt(S.index()),topOpen:!0,from:i,to:s,preserveWhitespace:"pre"!=S.parent.type.whitespace||"full",editableContent:!0,findPositions:p,ruleFromNode:Jl,context:S});if(p&&null!=p[0].pos){var w=p[0].pos,I=p[1]&&p[1].pos;null==I&&(I=w),b={anchor:w+a,head:I+a}}return{doc:N,sel:b,from:a,to:l}}(n,t,e);if(y.chrome&&n.cursorWrapper&&f.sel&&f.sel.anchor==n.cursorWrapper.deco.from){var d=n.cursorWrapper.deco.type.toDOM.nextSibling,h=d&&d.nodeValue?d.nodeValue.length:1;f.sel={anchor:f.sel.anchor+h,head:f.sel.anchor+h}}var x,S,m=n.state.doc,g=m.slice(f.from,f.to);8===n.lastKeyCode&&Date.now()-100<n.lastKeyCodeTime?(x=n.state.selection.to,S="end"):(x=n.state.selection.from,S="start"),n.lastKeyCode=null;var b=function(n,t,e,r,o){var i=n.findDiffStart(t,e);if(null==i)return null;var s=n.findDiffEnd(t,e+n.size,e+t.size),a=s.a,l=s.b;return"end"==o&&(r-=a+Math.max(0,i-Math.min(a,l))-i),a<i&&n.size<t.size?(l=(i-=r<=i&&r>=a?i-r:0)+(l-a),a=i):l<i&&(a=(i-=r<=i&&r>=l?i-r:0)+(a-l),l=i),{start:i,endA:a,endB:l}}(g.content,f.doc.content,f.from,x,S);if(!b){if(!(r&&p instanceof Z&&!p.empty&&p.$head.sameParent(p.$anchor))||n.composing||f.sel&&f.sel.anchor!=f.sel.head){if((y.ios&&n.lastIOSEnter>Date.now()-225||y.android)&&o.some(function($){return"DIV"==$.nodeName||"P"==$.nodeName})&&n.someProp("handleKeyDown",function($){return $(n,Ce(13,"Enter"))}))return void(n.lastIOSEnter=0);if(f.sel){var N=zi(n,n.state.doc,f.sel);N&&!N.eq(n.state.selection)&&n.dispatch(n.state.tr.setSelection(N))}return}b={start:p.from,endA:p.to,endB:p.to}}n.domChangeCount++,n.state.selection.from<n.state.selection.to&&b.start==b.endB&&n.state.selection instanceof Z&&(b.start>n.state.selection.from&&b.start<=n.state.selection.from+2?b.start=n.state.selection.from:b.endA<n.state.selection.to&&b.endA>=n.state.selection.to-2&&(b.endB+=n.state.selection.to-b.endA,b.endA=n.state.selection.to)),y.ie&&y.ie_version<=11&&b.endB==b.start+1&&b.endA==b.start&&b.start>f.from&&" \xa0"==f.doc.textBetween(b.start-f.from-1,b.start-f.from+1)&&(b.start--,b.endA--,b.endB--);var j,w=f.doc.resolveNoCache(b.start-f.from),I=f.doc.resolveNoCache(b.endB-f.from),A=w.sameParent(I)&&w.parent.inlineContent;if((y.ios&&n.lastIOSEnter>Date.now()-225&&(!A||o.some(function($){return"DIV"==$.nodeName||"P"==$.nodeName}))||!A&&w.pos<f.doc.content.size&&(j=P.findFrom(f.doc.resolve(w.pos+1),1,!0))&&j.head==I.pos)&&n.someProp("handleKeyDown",function($){return $(n,Ce(13,"Enter"))}))n.lastIOSEnter=0;else if(n.state.selection.anchor>b.start&&function(n,t,e,r,o){if(!r.parent.isTextblock||e-t<=o.pos-r.pos||Rr(r,!0,!1)<o.pos)return!1;var i=n.resolve(t);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var s=n.resolve(Rr(i,!0,!0));return!(!s.parent.isTextblock||s.pos>e||Rr(s,!0,!1)<e)&&r.parent.content.cut(r.parentOffset).eq(s.parent.content)}(m,b.start,b.endA,w,I)&&n.someProp("handleKeyDown",function($){return $(n,Ce(8,"Backspace"))}))y.android&&y.chrome&&n.domObserver.suppressSelectionUpdates();else{y.chrome&&y.android&&b.toB==b.from&&(n.lastAndroidDelete=Date.now()),y.android&&!A&&w.start()!=I.start()&&0==I.parentOffset&&w.depth==I.depth&&f.sel&&f.sel.anchor==f.sel.head&&f.sel.head==b.endA&&(b.endB-=2,I=f.doc.resolveNoCache(b.endB-f.from),setTimeout(function(){n.someProp("handleKeyDown",function($){return $(n,Ce(13,"Enter"))})},20));var X,Re,he,me,U=b.start,K=b.endA;if(A)if(w.pos==I.pos)y.ie&&y.ie_version<=11&&0==w.parentOffset&&(n.domObserver.suppressSelectionUpdates(),setTimeout(function(){return $t(n)},20)),X=n.state.tr.delete(U,K),Re=m.resolve(b.start).marksAcross(m.resolve(b.endA));else if(b.endA==b.endB&&(me=m.resolve(b.start))&&(he=function(n,t){for(var s,a,l,e=n.firstChild.marks,r=t.firstChild.marks,o=e,i=r,u=0;u<r.length;u++)o=r[u].removeFromSet(o);for(var p=0;p<e.length;p++)i=e[p].removeFromSet(i);if(1==o.length&&0==i.length)a=o[0],s="add",l=function(h){return h.mark(a.addToSet(h.marks))};else{if(0!=o.length||1!=i.length)return null;a=i[0],s="remove",l=function(h){return h.mark(a.removeFromSet(h.marks))}}for(var f=[],d=0;d<t.childCount;d++)f.push(l(t.child(d)));if(v.from(f).eq(n))return{mark:a,type:s}}(w.parent.content.cut(w.parentOffset,I.parentOffset),me.parent.content.cut(me.parentOffset,b.endA-me.start()))))X=n.state.tr,"add"==he.type?X.addMark(U,K,he.mark):X.removeMark(U,K,he.mark);else if(w.parent.child(w.index()).isText&&w.index()==I.index()-(I.textOffset?0:1)){var Jn=w.parent.textBetween(w.parentOffset,I.parentOffset);if(n.someProp("handleTextInput",function($){return $(n,U,K,Jn)}))return;X=n.state.tr.insertText(Jn,U,K)}if(X||(X=n.state.tr.replace(U,K,f.doc.slice(b.start-f.from,b.endB-f.from))),f.sel){var mt=zi(n,X.doc,f.sel);mt&&!(y.chrome&&y.android&&n.composing&&mt.empty&&(b.start!=b.endB||n.lastAndroidDelete<Date.now()-100)&&(mt.head==U||mt.head==X.mapping.map(K)-1)||y.ie&&mt.empty&&mt.head==U)&&X.setSelection(mt)}Re&&X.ensureMarks(Re),n.dispatch(X.scrollIntoView())}}}(n,r,o,i,s)}),n.domObserver.start(),n.domChangeCount=0,n.eventHandlers=Object.create(null);var t=function(r){var o=gt[r];n.dom.addEventListener(r,n.eventHandlers[r]=function(i){(function(n,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(var e=t.target;e!=n.dom;e=e.parentNode)if(!e||11==e.nodeType||e.pmViewDesc&&e.pmViewDesc.stopEvent(t))return!1;return!0})(n,i)&&!Hr(n,i)&&(n.editable||!(i.type in ht))&&o(n,i)})};for(var e in gt)t(e);y.safari&&n.dom.addEventListener("input",function(){return null}),Lr(n)}(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},Pn={props:{configurable:!0},root:{configurable:!0},isDestroyed:{configurable:!0}};function is(n){var t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(n.editable),t.translate="no",n.someProp("attributes",function(e){if("function"==typeof e&&(e=e(n.state)),e)for(var r in e)"class"==r&&(t.class+=" "+e[r]),"style"==r?t.style=(t.style?t.style+";":"")+e[r]:!t[r]&&"contenteditable"!=r&&"nodeName"!=r&&(t[r]=String(e[r]))}),[Y.node(0,n.state.doc.content.size,t)]}function ss(n){if(n.markCursor){var t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),n.cursorWrapper={dom:t,deco:Y.widget(n.state.selection.head,t,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function as(n){return!n.someProp("editable",function(t){return!1===t(n.state)})}function ls(n){var t={};return n.someProp("nodeViews",function(e){for(var r in e)Object.prototype.hasOwnProperty.call(t,r)||(t[r]=e[r])}),t}function cs(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}Pn.props.get=function(){if(this._props.state!=this.state){var n=this._props;for(var t in this._props={},n)this._props[t]=n[t];this._props.state=this.state}return this._props},W.prototype.update=function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&Lr(this),this._props=t,t.plugins&&(t.plugins.forEach(cs),this.directPlugins=t.plugins),this.updateStateInner(t.state,!0)},W.prototype.setProps=function(t){var e={};for(var r in this._props)e[r]=this._props[r];for(var o in e.state=this.state,t)e[o]=t[o];this.update(e)},W.prototype.updateState=function(t){this.updateStateInner(t,this.state.plugins!=t.plugins)},W.prototype.updateStateInner=function(t,e){var r=this,o=this.state,i=!1,s=!1;if(t.storedMarks&&this.composing&&(Yi(this),s=!0),this.state=t,e){var a=ls(this);(function(n,t){var e=0,r=0;for(var o in n){if(n[o]!=t[o])return!0;e++}for(var i in t)r++;return e!=r})(a,this.nodeViews)&&(this.nodeViews=a,i=!0),Lr(this)}this.editable=as(this),ss(this);var l=Wr(this),u=is(this),p=e?"reset":t.scrollToSelection>o.scrollToSelection?"to selection":"preserve",f=i||!this.docView.matchesNode(t.doc,u,l);(f||!t.selection.eq(o.selection))&&(s=!0);var d="preserve"==p&&s&&null==this.dom.style.overflowAnchor&&function(n){for(var r,o,t=n.dom.getBoundingClientRect(),e=Math.max(0,t.top),i=(t.left+t.right)/2,s=e+1;s<Math.min(innerHeight,t.bottom);s+=5){var a=n.root.elementFromPoint(i,s);if(a!=n.dom&&n.dom.contains(a)){var l=a.getBoundingClientRect();if(l.top>=e-20){r=a,o=l.top;break}}}return{refDOM:r,refTop:o,stack:ai(n.dom)}}(this);if(s){this.domObserver.stop();var h=f&&(y.ie||y.chrome)&&!this.composing&&!o.selection.empty&&!t.selection.empty&&function(n,t){var e=Math.min(n.$anchor.sharedDepth(n.head),t.$anchor.sharedDepth(t.head));return n.$anchor.start(e)!=t.$anchor.start(e)}(o.selection,t.selection);if(f){var m=y.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(i||!this.docView.update(t.doc,u,l,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=yi(t.doc,u,l,this.dom,this)),m&&!this.trackWrites&&(h=!0)}h||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&function(n){var t=n.docView.domFromPos(n.state.selection.anchor,0),e=n.root.getSelection();return Ye(t.node,t.offset,e.anchorNode,e.anchorOffset)}(this))?$t(this,h):(Ei(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(o),"reset"==p)this.dom.scrollTop=0;else if("to selection"==p){var g=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(x){return x(r)})||function(n,t,e){for(var r=n.someProp("scrollThreshold")||0,o=n.someProp("scrollMargin")||5,i=n.dom.ownerDocument,s=e||n.dom;s;s=xr(s))if(1==s.nodeType){var a=s==i.body||1!=s.nodeType,l=a?fl(i):dl(s),u=0,p=0;if(t.top<l.top+Gt(r,"top")?p=-(l.top-t.top+Gt(o,"top")):t.bottom>l.bottom-Gt(r,"bottom")&&(p=t.bottom-l.bottom+Gt(o,"bottom")),t.left<l.left+Gt(r,"left")?u=-(l.left-t.left+Gt(o,"left")):t.right>l.right-Gt(r,"right")&&(u=t.right-l.right+Gt(o,"right")),u||p)if(a)i.defaultView.scrollBy(u,p);else{var f=s.scrollLeft,d=s.scrollTop;p&&(s.scrollTop+=p),u&&(s.scrollLeft+=u);var h=s.scrollLeft-f,m=s.scrollTop-d;t={left:t.left-h,top:t.top-m,right:t.right-h,bottom:t.bottom-m}}if(a)break}}(this,t.selection instanceof E?this.docView.domAfterPos(t.selection.from).getBoundingClientRect():this.coordsAtPos(t.selection.head,1),g)}else d&&function(n){var t=n.refDOM,e=n.refTop,r=n.stack,o=t?t.getBoundingClientRect().top:0;li(r,0==o?0:o-e)}(d)},W.prototype.destroyPluginViews=function(){for(var t;t=this.pluginViews.pop();)t.destroy&&t.destroy()},W.prototype.updatePluginViews=function(t){if(t&&t.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(var s=0;s<this.pluginViews.length;s++){var a=this.pluginViews[s];a.update&&a.update(this,t)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var e=0;e<this.directPlugins.length;e++){var r=this.directPlugins[e];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(var o=0;o<this.state.plugins.length;o++){var i=this.state.plugins[o];i.spec.view&&this.pluginViews.push(i.spec.view(this))}}},W.prototype.someProp=function(t,e){var o,r=this._props&&this._props[t];if(null!=r&&(o=e?e(r):r))return o;for(var i=0;i<this.directPlugins.length;i++){var s=this.directPlugins[i].props[t];if(null!=s&&(o=e?e(s):s))return o}var a=this.state.plugins;if(a)for(var l=0;l<a.length;l++){var u=a[l].props[t];if(null!=u&&(o=e?e(u):u))return o}},W.prototype.hasFocus=function(){return this.root.activeElement==this.dom},W.prototype.focus=function(){this.domObserver.stop(),this.editable&&function(n){if(n.setActive)return n.setActive();if(ke)return n.focus(ke);var t=ai(n);n.focus(null==ke?{get preventScroll(){return ke={preventScroll:!0},!0}}:void 0),ke||(ke=!1,li(t,0))}(this.dom),$t(this),this.domObserver.start()},Pn.root.get=function(){var n=this._root;if(null==n)for(var t=this.dom.parentNode;t;t=t.parentNode)if(9==t.nodeType||11==t.nodeType&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=function(){return document.getSelection()}),this._root=t;return n||document},W.prototype.posAtCoords=function(t){return xl(this,t)},W.prototype.coordsAtPos=function(t,e){return void 0===e&&(e=1),pi(this,t,e)},W.prototype.domAtPos=function(t,e){return void 0===e&&(e=0),this.docView.domFromPos(t,e)},W.prototype.nodeDOM=function(t){var e=this.docView.descAt(t);return e?e.nodeDOM:null},W.prototype.posAtDOM=function(t,e,r){void 0===r&&(r=-1);var o=this.docView.posFromDOM(t,e,r);if(null==o)throw new RangeError("DOM position not inside the editor");return o},W.prototype.endOfTextblock=function(t,e){return function(n,t,e){return di==t&&hi==e?mi:(di=t,hi=e,mi="up"==e||"down"==e?function(n,t,e){var r=t.selection,o="up"==e?r.$from:r.$to;return fi(n,t,function(){for(var s=n.docView.domFromPos(o.pos,"up"==e?-1:1).node;;){var a=n.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.dom;break}s=a.dom.parentNode}for(var l=pi(n,o.pos,1),u=s.firstChild;u;u=u.nextSibling){var p=void 0;if(1==u.nodeType)p=u.getClientRects();else{if(3!=u.nodeType)continue;p=qt(u,0,u.nodeValue.length).getClientRects()}for(var f=0;f<p.length;f++){var d=p[f];if(d.bottom>d.top+1&&("up"==e?l.top-d.top>2*(d.bottom-l.top):d.bottom-l.bottom>2*(l.bottom-d.top)))return!1}}return!0})}(n,t,e):function(n,t,e){var o=t.selection.$head;if(!o.parent.isTextblock)return!1;var i=o.parentOffset,s=!i,a=i==o.parent.content.size,l=n.root.getSelection();return Cl.test(o.parent.textContent)&&l.modify?fi(n,t,function(){var u=l.getRangeAt(0),p=l.focusNode,f=l.focusOffset,d=l.caretBidiLevel;l.modify("move",e,"character");var m=!(o.depth?n.docView.domAfterPos(o.before()):n.dom).contains(1==l.focusNode.nodeType?l.focusNode:l.focusNode.parentNode)||p==l.focusNode&&f==l.focusOffset;return l.removeAllRanges(),l.addRange(u),null!=d&&(l.caretBidiLevel=d),m}):"left"==e||"backward"==e?s:a}(n,t,e))}(this,e||this.state,t)},W.prototype.destroy=function(){!this.docView||(function(n){for(var t in n.domObserver.stop(),n.eventHandlers)n.dom.removeEventListener(t,n.eventHandlers[t]);clearTimeout(n.composingTimeout),clearTimeout(n.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Wr(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)},Pn.isDestroyed.get=function(){return null==this.docView},W.prototype.dispatchEvent=function(t){return function(n,t){!Hr(n,t)&&gt[t.type]&&(n.editable||!(t.type in ht))&&gt[t.type](n,t)}(this,t)},W.prototype.dispatch=function(t){var e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))},Object.defineProperties(W.prototype,Pn);var Mc=["ol",0],Cc=["ul",0],kc=["li",0],us={attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:function(t){return{order:t.hasAttribute("start")?+t.getAttribute("start"):1}}}],toDOM:function(t){return 1==t.attrs.order?Mc:["ol",{start:t.attrs.order},0]}},ps={parseDOM:[{tag:"ul"}],toDOM:function(){return Cc}};function Ic(n){return function(t,e){var r=t.selection,o=r.$from,i=r.$to,s=r.node;if(s&&s.isBlock||o.depth<2||!o.sameParent(i))return!1;var a=o.node(-1);if(a.type!=n)return!1;if(0==o.parent.content.size&&o.node(-1).childCount==o.indexAfter(-1)){if(2==o.depth||o.node(-3).type!=n||o.index(-2)!=o.node(-2).childCount-1)return!1;if(e){for(var l=v.empty,u=o.index(-1)?1:o.index(-2)?2:3,p=o.depth-u;p>=o.depth-3;p--)l=v.from(o.node(p).copy(l));var f=o.indexAfter(-1)<o.node(-2).childCount?1:o.indexAfter(-2)<o.node(-3).childCount?2:3;l=l.append(v.from(n.createAndFill()));var d=o.before(o.depth-(u-1)),h=t.tr.replace(d,o.after(-f),new M(l,4-u,0)),m=-1;h.doc.nodesBetween(d,h.doc.content.size,function(b,N){if(m>-1)return!1;b.isTextblock&&0==b.content.size&&(m=N+1)}),m>-1&&h.setSelection(t.selection.constructor.near(h.doc.resolve(m))),e(h.scrollIntoView())}return!0}var g=i.pos==o.end()?a.contentMatchAt(0).defaultType:null,x=t.tr.delete(o.pos,i.pos),S=g&&[null,{type:g}];return!!Se(x.doc,o.pos,2,S)&&(e&&e(x.split(o.pos,2,S).scrollIntoView()),!0)}}function ds(n){return function(t,e){var r=t.selection,o=r.$from,s=o.blockRange(r.$to,function(a){return a.childCount&&a.firstChild.type==n});return!!s&&(!e||(o.node(s.depth-1).type==n?function(n,t,e,r){var o=n.tr,i=r.end,s=r.$to.end(r.depth);return i<s&&(o.step(new _t(i-1,s,i,s,new M(v.from(e.create(null,r.parent.copy())),1,0),1,!0)),r=new Ze(o.doc.resolve(r.$from.pos),o.doc.resolve(s),r.depth)),t(o.lift(r,Je(r)).scrollIntoView()),!0}(t,e,n,s):function(n,t,e){for(var r=n.tr,o=e.parent,i=e.end,s=e.endIndex-1,a=e.startIndex;s>a;s--)i-=o.child(s).nodeSize,r.delete(i-1,i+1);var l=r.doc.resolve(e.start),u=l.nodeAfter;if(r.mapping.map(e.end)!=e.start+l.nodeAfter.nodeSize)return!1;var p=0==e.startIndex,f=e.endIndex==o.childCount,d=l.node(-1),h=l.index(-1);if(!d.canReplace(h+(p?0:1),h+1,u.content.append(f?v.empty:v.from(o))))return!1;var m=l.pos,g=m+u.nodeSize;return r.step(new _t(m-(p?1:0),g+(f?1:0),m+1,g-1,new M((p?v.empty:v.from(o.copy(v.empty))).append(f?v.empty:v.from(o.copy(v.empty))),p?0:1,f?0:1),p?0:1)),t(r.scrollIntoView()),!0}(t,e,s)))}}function hs(n){return function(t,e){var r=t.selection,s=r.$from.blockRange(r.$to,function(g){return g.childCount&&g.firstChild.type==n});if(!s)return!1;var a=s.startIndex;if(0==a)return!1;var l=s.parent,u=l.child(a-1);if(u.type!=n)return!1;if(e){var p=u.lastChild&&u.lastChild.type==l.type,f=v.from(p?n.create():null),d=new M(v.from(n.create(null,v.from(l.type.create(null,f)))),p?3:1,0),h=s.start,m=s.end;e(t.tr.step(new _t(h-(p?3:1),m,h,m,d,1,!0)).scrollIntoView())}return!0}}const ms=n=>{const t=(n=>{const t={};return Object.keys(n).forEach(e=>{n[e]&&(t[e]=n[e])}),t})(n);return Object.entries(t).map(([e,r])=>`${(n=>n.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`))(e)}:${r}`).join(";")},Rn=new se({marks:{link:{attrs:{href:{},title:{default:null},target:{default:"_blank"}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:n=>({href:n.getAttribute("href"),title:n.getAttribute("title"),target:n.getAttribute("target")})}],toDOM(n){const{href:t,title:e,target:r}=n.attrs;return["a",{href:t,title:e,target:r},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:n=>"normal"!==n.style.fontWeight&&null},{style:"font-weight",getAttrs:n=>/^(?:bold(?:er)?|[5-9]\d{2,})$/.test(n)&&null}],toDOM:()=>["strong",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},u:{parseDOM:[{tag:"u"},{style:"text-decoration=underline",consuming:!1}],toDOM:()=>["u",0]},s:{parseDOM:[{tag:"s"},{tag:"strike"},{style:"text-decoration=line-through"}],toDOM:()=>["s",0]},text_color:{attrs:{color:{default:null}},parseDOM:[{style:"color",getAttrs:n=>({color:n})}],toDOM(n){const{color:t}=n.attrs;return["span",{style:`color:${t};`},0]}},text_background_color:{attrs:{backgroundColor:{default:null}},parseDOM:[{style:"background-color",getAttrs:n=>({backgroundColor:n})}],toDOM(n){const{backgroundColor:t}=n.attrs;return["span",{style:`background-color:${t};`},0]}}},nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",attrs:{align:{default:null}},parseDOM:[{tag:"p",getAttrs(n){const{textAlign:t}=n.style;return{align:n.getAttribute("align")||t||null}}}],toDOM(n){const{align:t}=n.attrs;return["p",{style:ms({textAlign:"left"!==t?t:null})||null},0]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},heading:{attrs:{level:{default:1},align:{default:null}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",getAttrs(n){const{textAlign:t}=n.style;return{level:1,align:n.getAttribute("align")||t||null}}},{tag:"h2",getAttrs(n){const{textAlign:t}=n.style;return{level:2,align:n.getAttribute("align")||t||null}}},{tag:"h3",getAttrs(n){const{textAlign:t}=n.style;return{level:3,align:n.getAttribute("align")||t||null}}},{tag:"h4",getAttrs(n){const{textAlign:t}=n.style;return{level:4,align:n.getAttribute("align")||t||null}}},{tag:"h5",getAttrs(n){const{textAlign:t}=n.style;return{level:5,align:n.getAttribute("align")||t||null}}},{tag:"h6",getAttrs(n){const{textAlign:t}=n.style;return{level:6,align:n.getAttribute("align")||t||null}}}],toDOM(n){const{level:t,align:e}=n.attrs;return[`h${t}`,{style:ms({textAlign:"left"!==e?e:null})||null},0]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>["pre",["code",0]]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:n=>({src:n.getAttribute("src"),title:n.getAttribute("title"),alt:n.getAttribute("alt"),width:n.getAttribute("width")})}],toDOM(n){const{src:t,alt:e,title:r,width:o}=n.attrs;return["img",{src:t,alt:e,title:r,width:o}]}},list_item:ge(vt({},{parseDOM:[{tag:"li"}],toDOM:function(){return kc},defining:!0}),{content:"paragraph block*"}),ordered_list:ge(vt({},us),{content:"list_item+",group:"block"}),bullet_list:ge(vt({},ps),{content:"list_item+",group:"block"})}});function gs(n,t){return!n.selection.empty&&(t&&t(n.tr.deleteSelection().scrollIntoView()),!0)}function Ne(n,t,e){for(;n;n="start"==t?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(e&&1!=n.childCount)return!1}return!1}function vs(n){if(!n.parent.type.spec.isolating)for(var t=n.depth-1;t>=0;t--){if(n.index(t)>0)return n.doc.resolve(n.before(t+1));if(n.node(t).type.spec.isolating)break}return null}function ys(n){if(!n.parent.type.spec.isolating)for(var t=n.depth-1;t>=0;t--){var e=n.node(t);if(n.index(t)+1<e.childCount)return n.doc.resolve(n.after(t+1));if(e.type.spec.isolating)break}return null}function _s(n,t){var e=n.selection,r=e.$head;return!(!r.parent.type.spec.code||!r.sameParent(e.$anchor)||(t&&t(n.tr.insertText("\n").scrollIntoView()),0))}function Qr(n){for(var t=0;t<n.edgeCount;t++){var r=n.edge(t).type;if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function bs(n,t){var e=n.selection,r=e.$head;if(!r.parent.type.spec.code||!r.sameParent(e.$anchor))return!1;var i=r.node(-1),s=r.indexAfter(-1),a=Qr(i.contentMatchAt(s));if(!i.canReplaceWith(s,s,a))return!1;if(t){var l=r.after(),u=n.tr.replaceWith(l,l,a.createAndFill());u.setSelection(P.near(u.doc.resolve(l),1)),t(u.scrollIntoView())}return!0}function xs(n,t){var e=n.selection,r=e.$from,o=e.$to;if(e instanceof Zt||r.parent.inlineContent||o.parent.inlineContent)return!1;var i=Qr(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(t){var s=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,a=n.tr.insert(s,i.createAndFill());a.setSelection(Z.create(a.doc,s+1)),t(a.scrollIntoView())}return!0}function Ss(n,t){var r=n.selection.$cursor;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){var o=r.before();if(Se(n.doc,o))return t&&t(n.tr.split(o).scrollIntoView()),!0}var i=r.blockRange(),s=i&&Je(i);return null!=s&&(t&&t(n.tr.lift(i,s).scrollIntoView()),!0)}function Kr(n,t){var e=n.selection,r=e.$from,o=e.$to;if(n.selection instanceof E&&n.selection.node.isBlock)return!(!r.parentOffset||!Se(n.doc,r.pos)||(t&&t(n.tr.split(r.pos).scrollIntoView()),0));if(!r.parent.isBlock)return!1;if(t){var i=o.parentOffset==o.parent.content.size,s=n.tr;(n.selection instanceof Z||n.selection instanceof Zt)&&s.deleteSelection();var a=0==r.depth?null:Qr(r.node(-1).contentMatchAt(r.indexAfter(-1))),l=i&&a?[{type:a}]:null,u=Se(s.doc,s.mapping.map(r.pos),1,l);if(!l&&!u&&Se(s.doc,s.mapping.map(r.pos),1,a&&[{type:a}])&&(l=[{type:a}],u=!0),u&&(s.split(s.mapping.map(r.pos),1,l),!i&&!r.parentOffset&&r.parent.type!=a)){var p=s.mapping.map(r.before()),f=s.doc.resolve(p);r.node(-1).canReplaceWith(f.index(),f.index()+1,a)&&s.setNodeMarkup(s.mapping.map(r.before()),a)}t(s.scrollIntoView())}return!0}function Ms(n,t,e){var i,s,r=t.nodeBefore,o=t.nodeAfter;if(r.type.spec.isolating||o.type.spec.isolating)return!1;if(function(n,t,e){var r=t.nodeBefore,o=t.nodeAfter,i=t.index();return!(!(r&&o&&r.type.compatibleContent(o.type))||(!r.content.size&&t.parent.canReplace(i-1,i)?(e&&e(n.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(i,i+1)||!o.isTextblock&&!lr(n.doc,t.pos)||(e&&e(n.tr.clearIncompatible(t.pos,r.type,r.contentMatchAt(r.childCount)).join(t.pos).scrollIntoView()),0)))}(n,t,e))return!0;var a=t.parent.canReplace(t.index(),t.index()+1);if(a&&(i=(s=r.contentMatchAt(r.childCount)).findWrapping(o.type))&&s.matchType(i[0]||o.type).validEnd){if(e){for(var l=t.pos+o.nodeSize,u=v.empty,p=i.length-1;p>=0;p--)u=v.from(i[p].create(null,u));u=v.from(r.copy(u));var f=n.tr.step(new _t(t.pos-1,l,t.pos,l,new M(u,1,0),i.length,!0)),d=l+2*i.length;lr(f.doc,d)&&f.join(d),e(f.scrollIntoView())}return!0}var h=P.findFrom(t,1),m=h&&h.$from.blockRange(h.$to),g=m&&Je(m);if(null!=g&&g>=t.depth)return e&&e(n.tr.lift(m,g).scrollIntoView()),!0;if(a&&Ne(o,"start",!0)&&Ne(r,"end")){for(var x=r,S=[];S.push(x),!x.isTextblock;)x=x.lastChild;for(var b=o,N=1;!b.isTextblock;b=b.firstChild)N++;if(x.canReplace(x.childCount,x.childCount,b.content)){if(e){for(var w=v.empty,I=S.length-1;I>=0;I--)w=v.from(S[I].copy(w));e(n.tr.step(new _t(t.pos-S.length,t.pos+o.nodeSize,t.pos+N,t.pos+o.nodeSize-N,new M(w,S.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function Cs(n){return function(t,e){for(var r=t.selection,o=n<0?r.$from:r.$to,i=o.depth;o.node(i).isInline;){if(!i)return!1;i--}return!!o.node(i).isTextblock&&(e&&e(t.tr.setSelection(Z.create(t.doc,n<0?o.start(i):o.end(i)))),!0)}}var ks=Cs(-1),ws=Cs(1);function Gr(n,t){return function(e,r){var o=e.selection,i=o.from,s=o.to,a=!1;return e.doc.nodesBetween(i,s,function(l,u){if(a)return!1;if(l.isTextblock&&!l.hasMarkup(n,t))if(l.type==n)a=!0;else{var p=e.doc.resolve(u),f=p.index();a=p.parent.canReplaceWith(f,f+1,n)}}),!!a&&(r&&r(e.tr.setBlockType(i,s,n,t).scrollIntoView()),!0)}}function Ee(n,t){return function(e,r){var o=e.selection,s=o.$cursor,a=o.ranges;if(o.empty&&!s||!function(n,t,e){for(var r=function(s){var a=t[s],l=a.$from,u=a.$to,p=0==l.depth&&n.type.allowsMarkType(e);if(n.nodesBetween(l.pos,u.pos,function(f){if(p)return!1;p=f.inlineContent&&f.type.allowsMarkType(e)}),p)return{v:!0}},o=0;o<t.length;o++){var i=r(o);if(i)return i.v}return!1}(e.doc,a,n))return!1;if(r)if(s)n.isInSet(e.storedMarks||s.marks())?r(e.tr.removeStoredMark(n)):r(e.tr.addStoredMark(n.create(t)));else{for(var l=!1,u=e.tr,p=0;!l&&p<a.length;p++){var f=a[p];l=e.doc.rangeHasMark(f.$from.pos,f.$to.pos,n)}for(var m=0;m<a.length;m++){var g=a[m],x=g.$from,S=g.$to;if(l)u.removeMark(x.pos,S.pos,n);else{var b=x.pos,N=S.pos,w=x.nodeAfter,I=S.nodeBefore,A=w&&w.isText?/^\s*/.exec(w.text)[0].length:0,j=I&&I.isText?/\s*$/.exec(I.text)[0].length:0;b+A<N&&(b+=A,N-=j),u.addMark(b,N,n.create(t))}}r(u.scrollIntoView())}return!0}}function sn(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];return function(e,r,o){for(var i=0;i<n.length;i++)if(n[i](e,r,o))return!0;return!1}}var Yr=sn(gs,function(n,t,e){var o=n.selection.$cursor;if(!o||(e?!e.endOfTextblock("backward",n):o.parentOffset>0))return!1;var i=vs(o);if(!i){var s=o.blockRange(),a=s&&Je(s);return null!=a&&(t&&t(n.tr.lift(s,a).scrollIntoView()),!0)}var l=i.nodeBefore;if(!l.type.spec.isolating&&Ms(n,i,t))return!0;if(0==o.parent.content.size&&(Ne(l,"end")||E.isSelectable(l))){var u=pr(n.doc,o.before(),o.after(),M.empty);if(u.slice.size<u.to-u.from){if(t){var p=n.tr.step(u);p.setSelection(Ne(l,"end")?P.findFrom(p.doc.resolve(p.mapping.map(i.pos,-1)),-1):E.create(p.doc,i.pos-l.nodeSize)),t(p.scrollIntoView())}return!0}}return!(!l.isAtom||i.depth!=o.depth-1||(t&&t(n.tr.delete(i.pos-l.nodeSize,i.pos).scrollIntoView()),0))},function(n,t,e){var r=n.selection,o=r.$head,s=o;if(!r.empty)return!1;if(o.parent.isTextblock){if(e?!e.endOfTextblock("backward",n):o.parentOffset>0)return!1;s=vs(o)}var a=s&&s.nodeBefore;return!(!a||!E.isSelectable(a)||(t&&t(n.tr.setSelection(E.create(n.doc,s.pos-a.nodeSize)).scrollIntoView()),0))}),Ts=sn(gs,function(n,t,e){var o=n.selection.$cursor;if(!o||(e?!e.endOfTextblock("forward",n):o.parentOffset<o.parent.content.size))return!1;var i=ys(o);if(!i)return!1;var s=i.nodeAfter;if(Ms(n,i,t))return!0;if(0==o.parent.content.size&&(Ne(s,"start")||E.isSelectable(s))){var a=pr(n.doc,o.before(),o.after(),M.empty);if(a.slice.size<a.to-a.from){if(t){var l=n.tr.step(a);l.setSelection(Ne(s,"start")?P.findFrom(l.doc.resolve(l.mapping.map(i.pos)),1):E.create(l.doc,l.mapping.map(i.pos))),t(l.scrollIntoView())}return!0}}return!(!s.isAtom||i.depth!=o.depth-1||(t&&t(n.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),0))},function(n,t,e){var r=n.selection,o=r.$head,s=o;if(!r.empty)return!1;if(o.parent.isTextblock){if(e?!e.endOfTextblock("forward",n):o.parentOffset<o.parent.content.size)return!1;s=ys(o)}var a=s&&s.nodeAfter;return!(!a||!E.isSelectable(a)||(t&&t(n.tr.setSelection(E.create(n.doc,s.pos)).scrollIntoView()),0))}),Dt={Enter:sn(_s,xs,Ss,Kr),"Mod-Enter":bs,Backspace:Yr,"Mod-Backspace":Yr,"Shift-Backspace":Yr,Delete:Ts,"Mod-Delete":Ts,"Mod-a":function(n,t){return t&&t(n.tr.setSelection(new Zt(n.doc))),!0}},Is={"Ctrl-h":Dt.Backspace,"Alt-Backspace":Dt["Mod-Backspace"],"Ctrl-d":Dt.Delete,"Ctrl-Alt-Backspace":Dt["Mod-Delete"],"Alt-Delete":Dt["Mod-Delete"],"Alt-d":Dt["Mod-Delete"],"Ctrl-a":ks,"Ctrl-e":ws};for(var Ns in Dt)Is[Ns]=Dt[Ns];Dt.Home=ks,Dt.End=ws;var iu=("undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&"darwin"==os.platform())?Is:Dt,Ut=function(t,e){var n;this.match=t,this.handler="string"==typeof e?(n=e,function(t,e,r,o){var i=n;if(e[1]){var s=e[0].lastIndexOf(e[1]);i+=e[0].slice(s+e[1].length);var a=(r+=s)-o;a>0&&(i=e[0].slice(s-a,s)+i,r=o)}return t.tr.insertText(i,r,o)}):e};function Es(n,t,e,r,o,i){if(n.composing)return!1;var s=n.state,a=s.doc.resolve(t);if(a.parent.type.spec.code)return!1;for(var l=a.parent.textBetween(Math.max(0,a.parentOffset-500),a.parentOffset,null,"\ufffc")+r,u=0;u<o.length;u++){var p=o[u].match.exec(l),f=p&&o[u].handler(s,p,t-(p[0].length-r.length),e);if(f)return n.dispatch(f.setMeta(i,{transform:f,from:t,to:e,text:r})),!0}return!1}var cu=new Ut(/--$/,"\u2014"),uu=new Ut(/\.\.\.$/,"\u2026"),mu=[new Ut(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"\u201c"),new Ut(/"$/,"\u201d"),new Ut(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"\u2018"),new Ut(/'$/,"\u2019")];function Xr(n,t,e,r){return new Ut(n,function(o,i,s,a){var l=e instanceof Function?e(i):e,u=o.tr.delete(s,a),f=u.doc.resolve(s).blockRange(),d=f&&ar(f,t,l);if(!d)return null;u.wrap(f,d);var h=u.doc.resolve(s-1).nodeBefore;return h&&h.type==t&&lr(u.doc,s-1)&&(!r||r(i,h))&&u.join(s-1),u})}function Os(n,t,e){return new Ut(n,function(r,o,i,s){var a=r.doc.resolve(i),l=e instanceof Function?e(o):e;return a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),t)?r.tr.delete(i,s).setBlockType(i,i,t,l):null})}const $r=(n,t)=>{const{from:e,$from:r,to:o,empty:i}=n.selection;return i?Boolean(t.isInSet(n.storedMarks||r.marks())):n.doc.rangeHasMark(e,o,t)},Ds=(n,t,e={})=>{const{selection:r}=n,{$from:o,to:i}=r,s=((n,t)=>{for(let e=t.depth;e>0;e-=1)if(t.node(e).type===n)return t.node(e).type;return null})(t,o);return Object.entries(e).length&&s?i<=o.end()&&o.parent.hasMarkup(t,e):Boolean(s)},As=n=>{const t=[],{selection:{from:e,to:r}}=n;return n.doc.nodesBetween(e,r,o=>{t.push(o)}),t},Ps=(n,t,e)=>{for(const r of t){const{$from:o,$to:i}=r;let s=0===o.depth&&n.type.allowsMarkType(e);if(n.nodesBetween(o.pos,i.pos,a=>!s&&(s=a.inlineContent&&a.type.allowsMarkType(e),!0)),s)return!0}return!1},Rs=(n,t,e)=>new Ut(n,(r,o,i,s)=>{const{tr:a}=r,l=i;let u=s;if(o[2]){const p=i+o[0].indexOf(o[2]),f=p+o[2].length;f<s&&a.delete(f,s),p>i&&a.delete(i,p),u=i+o[2].length}return a.addMark(l,u,t.create(e))}),Fs=(n,t={})=>(e,r)=>{const{tr:o,selection:i}=e,{empty:s,ranges:a,$from:l,$to:u}=i;if(s&&i instanceof Z){const{$cursor:p}=i;if(!p||!Ps(e.doc,a,n)||(o.addStoredMark(n.create(t)),!o.storedMarksSet))return!1;null==r||r(o)}else{if(o.addMark(l.pos,u.pos,n.create(t)),!o.docChanged)return!1;null==r||r(o.scrollIntoView())}return!0};for(var te={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},Fn={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},zs="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),bu="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),xu="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),Bs="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),Su="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Mu=zs&&(Bs||+zs[1]<57)||xu&&Bs,ot=0;ot<10;ot++)te[48+ot]=te[96+ot]=String(ot);for(ot=1;ot<=24;ot++)te[ot+111]="F"+ot;for(ot=65;ot<=90;ot++)te[ot]=String.fromCharCode(ot+32),Fn[ot]=String.fromCharCode(ot);for(var to in te)Fn.hasOwnProperty(to)||(Fn[to]=te[to]);var ku="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function wu(n){var t=n.split(/-(?!$)/),e=t[t.length-1];"Space"==e&&(e=" ");for(var r,o,i,s,a=0;a<t.length-1;a++){var l=t[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))o=!0;else if(/^s(hift)?$/i.test(l))i=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);ku?s=!0:o=!0}}return r&&(e="Alt-"+e),o&&(e="Ctrl-"+e),s&&(e="Meta-"+e),i&&(e="Shift-"+e),e}function eo(n,t,e){return t.altKey&&(n="Alt-"+n),t.ctrlKey&&(n="Ctrl-"+n),t.metaKey&&(n="Meta-"+n),!1!==e&&t.shiftKey&&(n="Shift-"+n),n}function zn(n){return new It({props:{handleKeyDown:Iu(n)}})}function Iu(n){var t=function(n){var t=Object.create(null);for(var e in n)t[wu(e)]=n[e];return t}(n);return function(e,r){var s,o=function(n){var e=!(Mu&&(n.ctrlKey||n.altKey||n.metaKey)||(bu||Su)&&n.shiftKey&&n.key&&1==n.key.length)&&n.key||(n.shiftKey?Fn:te)[n.keyCode]||n.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}(r),i=1==o.length&&" "!=o,a=t[eo(o,r,!i)];if(a&&a(e.state,e.dispatch,e))return!0;if(i&&(r.shiftKey||r.altKey||r.metaKey||o.charCodeAt(0)>127)&&(s=te[r.keyCode])&&s!=o){var l=t[eo(s,r,!0)];if(l&&l(e.state,e.dispatch,e))return!0}else if(i&&r.shiftKey){var u=t[eo(o,r,!0)];if(u&&u(e.state,e.dispatch,e))return!0}return!1}}var it=function(){};it.prototype.append=function(t){return t.length?(t=it.from(t),!this.length&&t||t.length<200&&this.leafAppend(t)||this.length<200&&t.leafPrepend(this)||this.appendInner(t)):this},it.prototype.prepend=function(t){return t.length?it.from(t).append(this):this},it.prototype.appendInner=function(t){return new Nu(this,t)},it.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t>=e?it.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))},it.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)},it.prototype.forEach=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=this.length),e<=r?this.forEachInner(t,e,r,0):this.forEachInvertedInner(t,e,r,0)},it.prototype.map=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=this.length);var o=[];return this.forEach(function(i,s){return o.push(t(i,s))},e,r),o},it.from=function(t){return t instanceof it?t:t&&t.length?new Ls(t):it.empty};var Ls=function(n){function t(r){n.call(this),this.values=r}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(o,i){return 0==o&&i==this.length?this:new t(this.values.slice(o,i))},t.prototype.getInner=function(o){return this.values[o]},t.prototype.forEachInner=function(o,i,s,a){for(var l=i;l<s;l++)if(!1===o(this.values[l],a+l))return!1},t.prototype.forEachInvertedInner=function(o,i,s,a){for(var l=i-1;l>=s;l--)if(!1===o(this.values[l],a+l))return!1},t.prototype.leafAppend=function(o){if(this.length+o.length<=200)return new t(this.values.concat(o.flatten()))},t.prototype.leafPrepend=function(o){if(this.length+o.length<=200)return new t(o.flatten().concat(this.values))},e.length.get=function(){return this.values.length},e.depth.get=function(){return 0},Object.defineProperties(t.prototype,e),t}(it);it.empty=new Ls([]);var Nu=function(n){function t(e,r){n.call(this),this.left=e,this.right=r,this.length=e.length+r.length,this.depth=Math.max(e.depth,r.depth)+1}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},t.prototype.forEachInner=function(r,o,i,s){var a=this.left.length;if(o<a&&!1===this.left.forEachInner(r,o,Math.min(i,a),s)||i>a&&!1===this.right.forEachInner(r,Math.max(o-a,0),Math.min(this.length,i)-a,s+a))return!1},t.prototype.forEachInvertedInner=function(r,o,i,s){var a=this.left.length;if(o>a&&!1===this.right.forEachInvertedInner(r,o-a,Math.max(i,a)-a,s+a)||i<a&&!1===this.left.forEachInvertedInner(r,Math.min(o,a),i,s))return!1},t.prototype.sliceInner=function(r,o){if(0==r&&o==this.length)return this;var i=this.left.length;return o<=i?this.left.slice(r,o):r>=i?this.right.slice(r-i,o-i):this.left.slice(r,i).append(this.right.slice(0,o-i))},t.prototype.leafAppend=function(r){var o=this.right.leafAppend(r);if(o)return new t(this.left,o)},t.prototype.leafPrepend=function(r){var o=this.left.leafPrepend(r);if(o)return new t(o,this.right)},t.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new t(this.left,new t(this.right,r)):new t(this,r)},t}(it);const Hs=it;var st=function(t,e){this.items=t,this.eventCount=e};st.prototype.popEvent=function(t,e){var s,a,r=this;if(0==this.eventCount)return null;for(var o=this.items.length;;o--)if(this.items.get(o-1).selection){--o;break}e&&(s=this.remapping(o,this.items.length),a=s.maps.length);var u,p,l=t.tr,f=[],d=[];return this.items.forEach(function(h,m){if(!h.step)return s||(s=r.remapping(o,m+1),a=s.maps.length),a--,void d.push(h);if(s){d.push(new zt(h.map));var x,g=h.step.map(s.slice(a));g&&l.maybeStep(g).doc&&f.push(new zt(x=l.mapping.maps[l.mapping.maps.length-1],null,null,f.length+d.length)),a--,x&&s.appendMap(x,a)}else l.maybeStep(h.step);return h.selection?(u=s?h.selection.map(s.slice(a)):h.selection,p=new st(r.items.slice(0,o).append(d.reverse().concat(f)),r.eventCount-1),!1):void 0},this.items.length,0),{remaining:p,transform:l,selection:u}},st.prototype.addTransform=function(t,e,r,o){for(var i=[],s=this.eventCount,a=this.items,l=!o&&a.length?a.get(a.length-1):null,u=0;u<t.steps.length;u++){var d,p=t.steps[u].invert(t.docs[u]),f=new zt(t.mapping.maps[u],p,e);(d=l&&l.merge(f))&&(f=d,u?i.pop():a=a.slice(0,a.length-1)),i.push(f),e&&(s++,e=null),o||(l=f)}var h=s-r.depth;return h>Au&&(a=function(n,t){var e;return n.forEach(function(r,o){if(r.selection&&0==t--)return e=o,!1}),n.slice(e)}(a,h),s-=h),new st(a.append(i),s)},st.prototype.remapping=function(t,e){var r=new ct;return this.items.forEach(function(o,i){r.appendMap(o.map,null!=o.mirrorOffset&&i-o.mirrorOffset>=t?r.maps.length-o.mirrorOffset:null)},t,e),r},st.prototype.addMaps=function(t){return 0==this.eventCount?this:new st(this.items.append(t.map(function(e){return new zt(e)})),this.eventCount)},st.prototype.rebased=function(t,e){if(!this.eventCount)return this;var r=[],o=Math.max(0,this.items.length-e),i=t.mapping,s=t.steps.length,a=this.eventCount;this.items.forEach(function(h){h.selection&&a--},o);var l=e;this.items.forEach(function(h){var m=i.getMirror(--l);if(null!=m){s=Math.min(s,m);var g=i.maps[m];if(h.step){var x=t.steps[m].invert(t.docs[m]),S=h.selection&&h.selection.map(i.slice(l+1,m));S&&a++,r.push(new zt(g,x,S))}else r.push(new zt(g))}},o);for(var u=[],p=e;p<s;p++)u.push(new zt(i.maps[p]));var f=this.items.slice(0,o).append(u).append(r),d=new st(f,a);return d.emptyItemCount()>500&&(d=d.compress(this.items.length-r.length)),d},st.prototype.emptyItemCount=function(){var t=0;return this.items.forEach(function(e){e.step||t++}),t},st.prototype.compress=function(t){void 0===t&&(t=this.items.length);var e=this.remapping(0,t),r=e.maps.length,o=[],i=0;return this.items.forEach(function(s,a){if(a>=t)o.push(s),s.selection&&i++;else if(s.step){var l=s.step.map(e.slice(r)),u=l&&l.getMap();if(r--,u&&e.appendMap(u,r),l){var p=s.selection&&s.selection.map(e.slice(r));p&&i++;var d,f=new zt(u.invert(),l,p),h=o.length-1;(d=o.length&&o[h].merge(f))?o[h]=d:o.push(f)}}else s.map&&r--},this.items.length,0),new st(Hs.from(o.reverse()),i)},st.empty=new st(Hs.empty,0);var zt=function(t,e,r,o){this.map=t,this.step=e,this.selection=r,this.mirrorOffset=o};zt.prototype.merge=function(t){if(this.step&&t.step&&!t.selection){var e=t.step.merge(this.step);if(e)return new zt(e.getMap().invert(),e,this.selection)}};var ee=function(t,e,r,o){this.done=t,this.undone=e,this.prevRanges=r,this.prevTime=o},Au=20;function Vs(n){var t=[];return n.forEach(function(e,r,o,i){return t.push(o,i)}),t}function no(n,t){if(!n)return null;for(var e=[],r=0;r<n.length;r+=2){var o=t.map(n[r],1),i=t.map(n[r+1],-1);o<=i&&e.push(o,i)}return e}function Zs(n,t,e,r){var o=Ln(t),i=Bt.get(t).spec.config,s=(r?n.undone:n.done).popEvent(t,o);if(s){var a=s.selection.resolve(s.transform.doc),l=(r?n.done:n.undone).addTransform(s.transform,t.selection.getBookmark(),i,o),u=new ee(r?l:s.remaining,r?s.remaining:l,null,0);e(s.transform.setSelection(a).setMeta(Bt,{redo:r,historyState:u}).scrollIntoView())}}var ro=!1,qs=null;function Ln(n){var t=n.plugins;if(qs!=t){ro=!1,qs=t;for(var e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){ro=!0;break}}return ro}var Bt=new Nt("history"),Js=new Nt("closeHistory");function Us(n,t){var e=Bt.getState(n);return!(!e||0==e.done.eventCount||(t&&Zs(e,n,t,!1),0))}function oo(n,t){var e=Bt.getState(n);return!(!e||0==e.undone.eventCount||(t&&Zs(e,n,t,!0),0))}const zu=["imgEl"];function Bu(n,t){if(1&n){const e=c.EpF();c.TgZ(0,"span",4),c.TgZ(1,"span",5),c.NdJ("mousedown",function(o){return c.CHM(e),c.oxw().startResizing(o,"left")}),c.qZA(),c.TgZ(2,"span",6),c.NdJ("mousedown",function(o){return c.CHM(e),c.oxw().startResizing(o,"right")}),c.qZA(),c.TgZ(3,"span",7),c.NdJ("mousedown",function(o){return c.CHM(e),c.oxw().startResizing(o,"left")}),c.qZA(),c.TgZ(4,"span",8),c.NdJ("mousedown",function(o){return c.CHM(e),c.oxw().startResizing(o,"right")}),c.qZA(),c.qZA()}}const Lu=function(n){return{"NgxEditor__Resizer--Active":n}},Hu=["ngxEditor"],Vu=["*"];function Zu(n,t){if(1&n&&(c.TgZ(0,"div",12),c._uU(1),c.qZA()),2&n){const e=c.oxw(2);c.xp6(1),c.hij(" ",(null==e.href.errors?null:e.href.errors.pattern)&&"Please enter valid url."," ")}}function qu(n,t){if(1&n&&(c.TgZ(0,"div",12),c._uU(1),c.qZA()),2&n){const e=c.oxw(2);c.xp6(1),c.hij(" ",(null==e.text.errors?null:e.text.errors.required)&&"This is required"," ")}}function Ju(n,t){if(1&n){const e=c.EpF();c.TgZ(0,"div",2),c.TgZ(1,"form",3),c.NdJ("ngSubmit",function(o){return c.CHM(e),c.oxw().insertLink(o)}),c.TgZ(2,"div",4),c.TgZ(3,"div",5),c.TgZ(4,"label",6),c._uU(5),c.qZA(),c._UZ(6,"input",7),c.YNc(7,Zu,2,1,"div",8),c.qZA(),c.qZA(),c.TgZ(8,"div",4),c.TgZ(9,"div",5),c.TgZ(10,"label",6),c._uU(11),c.qZA(),c._UZ(12,"input",9),c.YNc(13,qu,2,1,"div",8),c.qZA(),c.qZA(),c.TgZ(14,"div",4),c.TgZ(15,"div",5),c.TgZ(16,"label"),c._UZ(17,"input",10),c._uU(18),c.qZA(),c.qZA(),c.qZA(),c.TgZ(19,"button",11),c._uU(20),c.qZA(),c.qZA(),c.qZA()}if(2&n){const e=c.oxw();c.xp6(1),c.Q6J("formGroup",e.form),c.xp6(4),c.Oqu(e.getLabel("url")),c.xp6(2),c.Q6J("ngIf",e.href.touched&&e.href.invalid),c.xp6(4),c.Oqu(e.getLabel("text")),c.xp6(2),c.Q6J("ngIf",e.text.touched&&e.text.invalid),c.xp6(5),c.hij(" ",e.getLabel("openInNewTab")," "),c.xp6(1),c.Q6J("disabled",!e.form.valid),c.xp6(1),c.Oqu(e.getLabel("insert"))}}function Uu(n,t){if(1&n&&(c.TgZ(0,"div",12),c._uU(1),c.qZA()),2&n){const e=c.oxw(2);c.xp6(1),c.hij(" ",(null==e.src.errors?null:e.src.errors.pattern)&&"Please enter valid url."," ")}}function Wu(n,t){if(1&n){const e=c.EpF();c.TgZ(0,"div",2),c.TgZ(1,"form",3),c.NdJ("ngSubmit",function(o){return c.CHM(e),c.oxw().insertLink(o)}),c.TgZ(2,"div",4),c.TgZ(3,"div",5),c.TgZ(4,"label",6),c._uU(5),c.qZA(),c._UZ(6,"input",7),c.YNc(7,Uu,2,1,"div",8),c.qZA(),c.qZA(),c.TgZ(8,"div",4),c.TgZ(9,"div",5),c.TgZ(10,"label",6),c._uU(11),c.qZA(),c._UZ(12,"input",9),c.qZA(),c.qZA(),c.TgZ(13,"div",4),c.TgZ(14,"div",5),c.TgZ(15,"label",6),c._uU(16),c.qZA(),c._UZ(17,"input",10),c.qZA(),c.qZA(),c.TgZ(18,"button",11),c._uU(19),c.qZA(),c.qZA(),c.qZA()}if(2&n){const e=c.oxw();c.xp6(1),c.Q6J("formGroup",e.form),c.xp6(4),c.Oqu(e.getLabel("url")),c.xp6(2),c.Q6J("ngIf",e.src.touched&&e.src.invalid),c.xp6(4),c.Oqu(e.getLabel("altText")),c.xp6(5),c.Oqu(e.getLabel("title")),c.xp6(2),c.Q6J("disabled",!e.form.valid||!e.form.dirty),c.xp6(1),c.Oqu(e.getLabel("insert"))}}const ju=function(n,t){return{"NgxEditor__Dropdown--Active":n,"NgxEditor--Disabled":t}};function Qu(n,t){if(1&n){const e=c.EpF();c.TgZ(0,"div",4),c.NdJ("mousedown",function(o){const s=c.CHM(e).$implicit;return c.oxw(2).onClick(o,s)}),c._uU(1),c.qZA()}if(2&n){const e=t.$implicit,r=c.oxw(2);c.Q6J("ngClass",c.WLB(2,ju,e===r.activeItem,r.disabledItems.includes(e))),c.xp6(1),c.hij(" ",r.getName(e)," ")}}function Ku(n,t){if(1&n&&(c.TgZ(0,"div",2),c.YNc(1,Qu,2,5,"div",3),c.qZA()),2&n){const e=c.oxw();c.xp6(1),c.Q6J("ngForOf",e.items)("ngForTrackBy",e.trackByIndex)}}const Gu=function(n,t){return{backgroundColor:n,color:t}},Yu=function(n){return{"NgxEditor__Color--Active":n}};function Xu(n,t){if(1&n){const e=c.EpF();c.TgZ(0,"button",7),c.NdJ("mousedown",function(o){const s=c.CHM(e).$implicit;return c.oxw(3).onColorSelect(o,s)}),c.qZA()}if(2&n){const e=t.$implicit,r=c.oxw(3);c.Q6J("ngStyle",c.WLB(3,Gu,e,r.getContrastYIQ(e)))("title",e)("ngClass",c.VKq(6,Yu,r.activeColors.includes(e)))}}function $u(n,t){if(1&n&&(c.TgZ(0,"div",5),c.YNc(1,Xu,1,8,"button",6),c.qZA()),2&n){const e=t.$implicit,r=c.oxw(2);c.xp6(1),c.Q6J("ngForOf",e)("ngForTrackBy",r.trackByIndex)}}function tp(n,t){if(1&n){const e=c.EpF();c.TgZ(0,"div",2),c.YNc(1,$u,2,2,"div",3),c.TgZ(2,"button",4),c.NdJ("mousedown",function(o){return c.CHM(e),c.oxw().remove(o)}),c._uU(3),c.qZA(),c.qZA()}if(2&n){const e=c.oxw();c.xp6(1),c.Q6J("ngForOf",e.presets)("ngForTrackBy",e.trackByIndex),c.xp6(1),c.Q6J("disabled",!e.isActive),c.xp6(1),c.hij(" ",e.getLabel("remove")," ")}}function ep(n,t){if(1&n&&c._UZ(0,"ngx-toggle-command",7),2&n){const e=c.oxw().$implicit,r=c.oxw(2);c.Tol(r.iconContainerClass),c.Q6J("toolbarItem",e)}}function np(n,t){if(1&n&&c._UZ(0,"ngx-link"),2&n){const e=c.oxw(3);c.Tol(e.iconContainerClass)}}function rp(n,t){if(1&n&&c._UZ(0,"ngx-image"),2&n){const e=c.oxw(3);c.Tol(e.iconContainerClass)}}function op(n,t){if(1&n&&c._UZ(0,"ngx-dropdown",9),2&n){const e=t.$implicit,r=c.oxw(4);c.Tol(r.dropdownContainerClass),c.Q6J("group",e.key)("items",e.value)}}function ip(n,t){if(1&n&&(c.ynx(0),c.YNc(1,op,1,4,"ngx-dropdown",8),c.ALo(2,"keyvalue"),c.BQk()),2&n){const e=c.oxw().$implicit,r=c.oxw(2);c.xp6(1),c.Q6J("ngForOf",c.lcZ(2,2,r.getDropdownItems(e)))("ngForTrackBy",r.trackByIndex)}}function sp(n,t){if(1&n&&c._UZ(0,"ngx-color-picker",10),2&n){const e=c.oxw(3);c.Tol(e.iconContainerClass),c.Q6J("presets",e.presets)}}function ap(n,t){if(1&n&&c._UZ(0,"ngx-color-picker",11),2&n){const e=c.oxw(3);c.Tol(e.iconContainerClass),c.Q6J("presets",e.presets)}}function lp(n,t){if(1&n&&c._UZ(0,"div"),2&n){const e=c.oxw(3);c.Tol(e.seperatorClass)}}function cp(n,t){if(1&n&&(c.ynx(0),c.YNc(1,ep,1,3,"ngx-toggle-command",3),c.YNc(2,np,1,2,"ngx-link",4),c.YNc(3,rp,1,2,"ngx-image",4),c.YNc(4,ip,3,4,"ng-container",2),c.YNc(5,sp,1,3,"ngx-color-picker",5),c.YNc(6,ap,1,3,"ngx-color-picker",6),c.YNc(7,lp,1,2,"div",4),c.BQk()),2&n){const e=t.$implicit,r=t.last,o=c.oxw().last,i=c.oxw();c.xp6(1),c.Q6J("ngIf",i.toggleCommands.includes(e)),c.xp6(1),c.Q6J("ngIf","link"===e),c.xp6(1),c.Q6J("ngIf","image"===e),c.xp6(1),c.Q6J("ngIf",i.isDropDown(e)),c.xp6(1),c.Q6J("ngIf","text_color"===e),c.xp6(1),c.Q6J("ngIf","background_color"===e),c.xp6(1),c.Q6J("ngIf",r&&!o)}}function up(n,t){if(1&n&&(c.ynx(0),c.YNc(1,cp,8,7,"ng-container",1),c.BQk()),2&n){const e=t.$implicit,r=c.oxw();c.xp6(1),c.Q6J("ngForOf",e)("ngForTrackBy",r.trackByIndex)}}function pp(n,t){if(1&n&&(c.ynx(0),c.GkF(1,12),c.BQk()),2&n){const e=c.oxw();c.xp6(1),c.Q6J("ngTemplateOutlet",e.customMenuRef)}}const fp=function(n,t){return{"NgxEditor--Disabled":n,"NgxEditor__MenuBar--Reverse":t}},vp=(n=!0)=>new It({key:new Nt("editable"),state:{init:()=>n,apply(t,e){var r;return null!=(r=t.getMeta("UPDATE_EDITABLE"))?r:e}},props:{editable(t){return this.getState(t)},attributes(t){return this.getState(t)?null:{class:"NgxEditor__Content--Disabled"}}}}),_p=n=>new It({key:new Nt("placeholder"),state:{init:()=>null!=n?n:"",apply(t,e){var o;return null!=(o=t.getMeta("UPDATE_PLACEHOLDER"))?o:e}},props:{decorations(t){const{doc:e}=t,{textContent:r,childCount:o}=e,i=this.getState(t);if(!i||o>1)return B.empty;const s=[];return e.descendants((l,u)=>{var p;if(l.type.isBlock&&0===l.childCount&&0===r.length){const h=Y.node(u,u+l.nodeSize,{class:"NgxEditor__Placeholder","data-placeholder":i,"data-align":null!=(p=l.attrs.align)?p:null});s.push(h)}return!1}),B.create(e,s)}}}),Ws=n=>new It({key:new Nt("focus"),props:{handleDOMEvents:{focus:()=>(n(),!1)}}});let Sp=(()=>{class n{constructor(){this.alt="",this.title="",this.outerWidth="",this.selected=!1,this.imageResize=new c.vpe}startResizing(e,r){e.preventDefault(),this.resizeImage(e,r)}resizeImage(e,r){const o=e.pageX,i=this.imgEl.nativeElement.clientWidth,s="left"===r,{width:a}=window.getComputedStyle(this.view.dom),l=parseInt(a,10),u=f=>{const h=f.pageX-o,m=s?i-h:i+h;m>l||m<20||(this.outerWidth=`${m}px`)},p=f=>{f.preventDefault(),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",p),this.imageResize.emit()};document.addEventListener("mousemove",u),document.addEventListener("mouseup",p)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=c.Xpm({type:n,selectors:[["ngx-image-view"]],viewQuery:function(e,r){if(1&e&&c.Gf(zu,7),2&e){let o;c.iGM(o=c.CRH())&&(r.imgEl=o.first)}},inputs:{src:"src",alt:"alt",title:"title",outerWidth:"outerWidth",selected:"selected",view:"view"},outputs:{imageResize:"imageResize"},decls:4,vars:9,consts:[[1,"NgxEditor__ImageWrapper",3,"ngClass"],["class","NgxEditor__ResizeHandle",4,"ngIf"],[3,"src","alt","title"],["imgEl",""],[1,"NgxEditor__ResizeHandle"],[1,"NgxEditor__ResizeHandle--TL",3,"mousedown"],[1,"NgxEditor__ResizeHandle--TR",3,"mousedown"],[1,"NgxEditor__ResizeHandle--BL",3,"mousedown"],[1,"NgxEditor__ResizeHandle--BR",3,"mousedown"]],template:function(e,r){1&e&&(c.TgZ(0,"span",0),c.YNc(1,Bu,5,0,"span",1),c._UZ(2,"img",2,3),c.qZA()),2&e&&(c.Udp("width",r.outerWidth),c.Q6J("ngClass",c.VKq(7,Lu,r.selected)),c.xp6(1),c.Q6J("ngIf",r.selected),c.xp6(1),c.Q6J("src",r.src,c.LSH)("alt",r.alt)("title",r.title))},directives:[R.mk,R.O5],styles:["*[_ngcontent-%COMP%], *[_ngcontent-%COMP%]:before, *[_ngcontent-%COMP%]:after{box-sizing:border-box}img[_ngcontent-%COMP%]{width:100%;height:100%}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]{position:relative;display:inline-block;line-height:0;padding:2px}.NgxEditor__ImageWrapper.NgxEditor__Resizer--Active[_ngcontent-%COMP%]{padding:1px;border:1px solid #1a73e8}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TL[_ngcontent-%COMP%], .NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BL[_ngcontent-%COMP%], .NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TR[_ngcontent-%COMP%], .NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BR[_ngcontent-%COMP%]{position:absolute;width:7px;height:7px;background-color:#1a73e8;border:1px solid white}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BR[_ngcontent-%COMP%]{bottom:-5px;right:-5px;cursor:se-resize}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TR[_ngcontent-%COMP%]{top:-5px;right:-5px;cursor:ne-resize}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TL[_ngcontent-%COMP%]{top:-5px;left:-5px;cursor:nw-resize}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BL[_ngcontent-%COMP%]{bottom:-5px;left:-5px;cursor:sw-resize}"]}),n})();class Mp{constructor(t,e,r,o){this.updating=!1,this.handleResize=()=>{if(this.updating)return;const{state:a,dispatch:l}=this.view,{tr:u}=a,p=u.setNodeMarkup(this.getPos(),void 0,ge(vt({},this.node.attrs),{width:this.imageComponentRef.instance.outerWidth})),f=p.doc.resolve(this.getPos()),d=new E(f);p.setSelection(d),l(p)};const i=o.get(c._Vd);this.applicationRef=o.get(c.z2F);const s=i.resolveComponentFactory(Sp);this.imageComponentRef=s.create(o,[]),this.applicationRef.attachView(this.imageComponentRef.hostView),this.setNodeAttributes(t.attrs),this.imageComponentRef.instance.view=e,this.dom=this.imageComponentRef.location.nativeElement,this.view=e,this.node=t,this.getPos=r,this.resizeSubscription=this.imageComponentRef.instance.imageResize.subscribe(()=>{this.handleResize()})}computeChanges(t,e){return JSON.stringify(t)===JSON.stringify(e)}setNodeAttributes(t){this.imageComponentRef.instance.src=t.src,this.imageComponentRef.instance.alt=t.alt,this.imageComponentRef.instance.title=t.title,this.imageComponentRef.instance.outerWidth=t.width}update(t){return t.type===this.node.type&&(this.node=t,this.computeChanges(this.node.attrs,t.attrs)&&(this.updating=!0,this.setNodeAttributes(t.attrs),this.updating=!1),!0)}ignoreMutation(){return!0}selectNode(){this.imageComponentRef.instance.selected=!0}deselectNode(){this.imageComponentRef.instance.selected=!1}destroy(){this.resizeSubscription.unsubscribe(),this.applicationRef.detachView(this.imageComponentRef.hostView)}}const kp=/(?:https?:\/\/)?[\w-]+(?:\.[\w-]+)+\.?(?:\d+)?(?:\/\S*)?$/,js=n=>{const t=[];return n.forEach(e=>{if(e.isText){const r=e.text;let o=0;const i=kp.exec(r);if(i){const s=i.index,a=s+i[0].length,{link:l}=e.type.schema.marks;s>0&&t.push(e.cut(o,s));const u=r.slice(s,a);t.push(e.cut(s,a).mark(l.create({href:u}).addToSet(e.marks))),o=a}o<r.length&&t.push(e.cut(o))}else t.push(e.copy(js(e.content)))}),v.fromArray(t)},Tp={type:"doc",content:[{type:"paragraph"}]},an=(n,t)=>{if(!n)return t.nodeFromJSON(Tp);if("string"!=typeof n)return t.nodeFromJSON(n);const e=((n,t)=>{const e=null!=t?t:Rn,r=document.createElement("div");return r.innerHTML=n,Mt.fromSchema(e).parse(r).toJSON()})(n,t);return t.nodeFromJSON(e)};let Ep=(()=>{class n{constructor(e,r,o){this.renderer=e,this.injector=r,this.elementRef=o,this.placeholder="Type Here...",this.focusOut=new c.vpe,this.focusIn=new c.vpe,this.subscriptions=[],this.onChange=()=>{},this.onTouched=()=>{}}writeValue(e){!this.outputFormat&&"string"==typeof e&&(this.outputFormat="html"),this.editor.setContent(null!=e?e:"")}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.setMeta("UPDATE_EDITABLE",!e),this.renderer.setProperty(this.elementRef.nativeElement,"disabled",e)}handleChange(e){if("html"!==this.outputFormat)this.onChange(e);else{const r=((n,t)=>{const e=null!=t?t:Rn,r=e.nodeFromJSON(n),o=et.fromSchema(e).serializeFragment(r.content),i=document.createElement("div");return i.appendChild(o),i.innerHTML})(e,this.editor.schema);this.onChange(r)}}setMeta(e,r){const{dispatch:o,state:{tr:i}}=this.editor.view;o(i.setMeta(e,r))}setPlaceholder(e){this.setMeta("UPDATE_PLACEHOLDER",e)}registerPlugins(){this.editor.registerPlugin(vp()),this.editor.registerPlugin(_p(this.placeholder)),this.editor.registerPlugin(((n={})=>new It({key:new Nt("attributes"),props:{attributes:n}}))({class:"NgxEditor__Content"})),this.editor.registerPlugin(Ws(()=>{this.focusIn.emit()})),this.editor.registerPlugin(Ws(()=>{this.focusIn.emit()})),this.editor.registerPlugin((n=>new It({key:new Nt("blur"),props:{handleDOMEvents:{blur:()=>(n(),!1)}}}))(()=>{this.focusOut.emit(),this.onTouched()})),this.editor.features.resizeImage&&this.editor.registerPlugin((n=>new It({key:new Nt("image-resize"),props:{nodeViews:{image:(t,e,r)=>new Mp(t,e,r,n)}}}))(this.injector)),this.editor.features.linkOnPaste&&this.editor.registerPlugin(new It({key:new Nt("linkify"),props:{transformPasted:n=>new M(js(n.content),n.openStart,n.openEnd)}}))}ngOnInit(){if(!this.editor)throw new Error("NgxEditor: Required editor instance");this.registerPlugins(),this.renderer.appendChild(this.ngxEditor.nativeElement,this.editor.view.dom);const e=this.editor.valueChanges.subscribe(r=>{this.handleChange(r)});this.subscriptions.push(e)}ngOnChanges(e){(null==e?void 0:e.placeholder)&&!e.placeholder.isFirstChange()&&this.setPlaceholder(e.placeholder.currentValue)}ngOnDestroy(){this.subscriptions.forEach(e=>{e.unsubscribe()})}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(c.Qsj),c.Y36(c.zs3),c.Y36(c.SBq))},n.\u0275cmp=c.Xpm({type:n,selectors:[["ngx-editor"]],viewQuery:function(e,r){if(1&e&&c.Gf(Hu,7),2&e){let o;c.iGM(o=c.CRH())&&(r.ngxEditor=o.first)}},inputs:{editor:"editor",outputFormat:"outputFormat",placeholder:"placeholder"},outputs:{focusOut:"focusOut",focusIn:"focusIn"},features:[c._Bn([{provide:C.JU,useExisting:(0,c.Gpc)(()=>n),multi:!0}]),c.TTD],ngContentSelectors:Vu,decls:3,vars:0,consts:[[1,"NgxEditor"],["ngxEditor",""]],template:function(e,r){1&e&&(c.F$t(),c.TgZ(0,"div",0,1),c.Hsn(2),c.qZA())},styles:['.NgxEditor{background:white;color:#000;background-clip:padding-box;border-radius:4px;border:1px solid rgba(0,0,0,.2);position:relative}.NgxEditor--Disabled{opacity:.5;pointer-events:none}.NgxEditor__Placeholder:before{color:#6c757d;opacity:1;-webkit-user-select:none;user-select:none;position:absolute;cursor:text;content:attr(data-placeholder)}.NgxEditor__Placeholder[data-align=right]:before{position:relative}.NgxEditor__Content{padding:8px;white-space:pre-wrap;outline:none;font-variant-ligatures:none;font-feature-settings:"liga" 0,none}.NgxEditor__Content p{margin:0 0 10px}.NgxEditor__Content blockquote{padding-left:16px;border-left:3px solid #ddd;margin-left:0;margin-right:0}.NgxEditor__Content--Disabled{-webkit-user-select:none;user-select:none;pointer-events:none}.NgxEditor__Wrapper{border:1px solid rgba(0,0,0,.4);border-radius:4px}.NgxEditor__Wrapper .NgxEditor__MenuBar{border-top-left-radius:4px;border-top-right-radius:4px;border-bottom:1px solid rgba(0,0,0,.2)}.NgxEditor__Wrapper .NgxEditor{border-top-left-radius:0;border-top-right-radius:0;border:none}.NgxEditor__MenuBar{display:flex;padding:3px;cursor:default;background-color:#fff}.NgxEditor__MenuItem{border-radius:2px;display:flex;align-items:center;justify-content:center;position:relative;flex-shrink:0}.NgxEditor__MenuItem:hover{background-color:#f1f1f1}.NgxEditor__MenuItem.NgxEditor__MenuItem--Icon{height:30px;width:30px;transition:.3s ease-in-out}.NgxEditor__MenuItem.NgxEditor__MenuItem--Icon+.NgxEditor__MenuItem--Icon{margin-left:2px}.NgxEditor__MenuItem .NgxEditor__MenuItem--IconContainer{display:flex;height:100%;width:100%;align-items:center;justify-content:center}.NgxEditor__MenuItem.NgxEditor__MenuItem--Text{padding:0 5px}.NgxEditor__MenuItem.NgxEditor__MenuItem--Active{background-color:#e8f0fe;color:#1a73e8}.NgxEditor__Dropdown{min-width:64px;position:relative;display:flex;align-items:center;flex-shrink:0}.NgxEditor__Dropdown:hover{background-color:#f1f1f1}.NgxEditor__Dropdown .NgxEditor__Dropdown--Text{display:flex;align-items:center;justify-content:center;padding:0 5px;height:100%;width:100%}.NgxEditor__Dropdown .NgxEditor__Dropdown--Text:after{display:inline-block;content:"";margin-left:24px;vertical-align:4px;border-top:4px solid;border-right:4px solid transparent;border-bottom:0;border-left:4px solid transparent}.NgxEditor__Dropdown .NgxEditor__Dropdown--DropdownMenu{position:absolute;left:0;box-shadow:#3c404326 0 2px 6px 2px;border-radius:4px;background-color:#fff;z-index:10;width:100%;top:32px}.NgxEditor__Dropdown .NgxEditor__Dropdown--Item{padding:8px;white-space:nowrap;color:inherit}.NgxEditor__Dropdown .NgxEditor__Dropdown--Item:hover{background-color:#ececec}.NgxEditor__Dropdown.NgxEditor__Dropdown--Selected,.NgxEditor__Dropdown.NgxEditor__Dropdown--Open{background-color:#e8f0fe}.NgxEditor__Dropdown.NgxEditor__Dropdown--Selected .NgxEditor__Dropdown--Text,.NgxEditor__Dropdown.NgxEditor__Dropdown--Open .NgxEditor__Dropdown--Text{color:#1a73e8}.NgxEditor__Dropdown .NgxEditor__Dropdown--Active{background-color:#f1f1f1}.NgxEditor__Dropdown .NgxEditor__Dropdown--Active:hover{background-color:#e7e7e7}.NgxEditor__MenuBar--Reverse .NgxEditor__Dropdown--DropdownMenu{top:unset;bottom:32px}.NgxEditor__MenuBar--Reverse .NgxEditor__Dropdown--Text:after{transform:rotate(180deg)}.NgxEditor__MenuBar--Reverse .NgxEditor__Popup{top:unset;bottom:32px}.NgxEditor__Popup{position:absolute;top:32px;box-shadow:#3c404326 0 2px 6px 2px;border-radius:4px;background-color:#fff;z-index:10;min-width:192px;padding:8px}.NgxEditor__Popup .NgxEditor__Popup--FormGroup{margin-bottom:8px}.NgxEditor__Popup .NgxEditor__Popup--FormGroup label{margin-bottom:3px}.NgxEditor__Popup .NgxEditor__Popup--FormGroup input[type=text],.NgxEditor__Popup .NgxEditor__Popup--FormGroup input[type=url]{padding:2px 4px}.NgxEditor__Popup .NgxEditor__Popup--Col{display:flex;flex-direction:column;position:relative}.NgxEditor__Popup .NgxEditor__Popup--Label{font-size:85%}.NgxEditor__Seperator{border-left:1px solid #ccc;margin:0 5px}.NgxEditor__HelpText{font-size:80%}.NgxEditor__HelpText.NgxEditor__HelpText--Error{color:red}\n'],encapsulation:2}),n})(),fe=(()=>{class n{constructor(){this.customMenuRefChange=new hn.xQ}setCustomMenuRef(e){this.customMenuRefChange.next(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Yp={bold:'\n  <path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z" />\n',italic:'\n  <path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z" />\n',code:'\n<path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>\n',underline:'\n<path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>\n',strike:'\n<path d="M6.85,7.08C6.85,4.37,9.45,3,12.24,3c1.64,0,3,0.49,3.9,1.28c0.77,0.65,1.46,1.73,1.46,3.24h-3.01 c0-0.31-0.05-0.59-0.15-0.85c-0.29-0.86-1.2-1.28-2.25-1.28c-1.86,0-2.34,1.02-2.34,1.7c0,0.48,0.25,0.88,0.74,1.21 C10.97,8.55,11.36,8.78,12,9H7.39C7.18,8.66,6.85,8.11,6.85,7.08z M21,12v-2H3v2h9.62c1.15,0.45,1.96,0.75,1.96,1.97 c0,1-0.81,1.67-2.28,1.67c-1.54,0-2.93-0.54-2.93-2.51H6.4c0,0.55,0.08,1.13,0.24,1.58c0.81,2.29,3.29,3.3,5.67,3.3 c2.27,0,5.3-0.89,5.3-4.05c0-0.3-0.01-1.16-0.48-1.94H21V12z"/>\n',ordered_list:'\n<path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/>\n',bullet_list:'\n<path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>\n',blockquote:'\n<path d="M0 0h24v24H0z" fill="none"/><path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/>\n',link:'\n<path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>\n',unlink:'\n<path d="M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.98l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zm-1 4h-2.19l2 2H16zM2 4.27l3.11 3.11C3.29 8.12 2 9.91 2 12c0 2.76 2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1 0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4L20 19.74 3.27 3 2 4.27z"/>\n',image:'\n<path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>\n',align_left:'\n<path d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"/>\n',align_center:'\n<path d="M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z"/>\n',align_right:'\n<path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/>\n',align_justify:'\n<path d="M3 21h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18V7H3v2zm0-6v2h18V3H3z"/>\n',text_color:'\n<path d="M2,20h20v4H2V20z M5.49,17h2.42l1.27-3.58h5.65L16.09,17h2.42L13.25,3h-2.5L5.49,17z M9.91,11.39l2.03-5.79h0.12l2.03,5.79 H9.91z"/>\n',color_fill:'\n<path d="M16.56,8.94L7.62,0L6.21,1.41l2.38,2.38L3.44,8.94c-0.59,0.59-0.59,1.54,0,2.12l5.5,5.5C9.23,16.85,9.62,17,10,17 s0.77-0.15,1.06-0.44l5.5-5.5C17.15,10.48,17.15,9.53,16.56,8.94z M5.21,10L10,5.21L14.79,10H5.21z M19,11.5c0,0-2,2.17-2,3.5 c0,1.1,0.9,2,2,2s2-0.9,2-2C21,13.67,19,11.5,19,11.5z M2,20h20v4H2V20z"/>\n'};class Hn{static get(t,e="currentColor"){return`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill=${e}\n        height=20\n        width=20\n      >\n        ${Yp[t]||"<path></path>"}\n      </svg>\n    `}}class Oe{constructor(t){this.name=t}apply(){return(t,e)=>{const{schema:r}=t,o=r.marks[this.name];return!!o&&Fs(o)(t,e)}}toggle(){return(t,e)=>{const{schema:r}=t,o=r.marks[this.name];return!!o&&Ee(o)(t,e)}}isActive(t){const{schema:e}=t,r=e.marks[this.name];return!!r&&$r(t,r)}canExecute(t){return this.toggle()(t)}}class Vn{constructor(t=!1){this.isBulletList=!1,this.isBulletList=t}getType(t){return this.isBulletList?t.nodes.bullet_list:t.nodes.ordered_list}toggle(){return(t,e)=>{const{schema:r}=t,o=this.getType(r);return!!o&&(this.isActive(t)?ds(r.nodes.list_item)(t,e):function(n,t){return function(e,r){var o=e.selection,i=o.$from,s=o.$to,a=i.blockRange(s),l=!1,u=a;if(!a)return!1;if(a.depth>=2&&i.node(a.depth-1).type.compatibleContent(n)&&0==a.startIndex){if(0==i.index(a.depth-1))return!1;var p=e.doc.resolve(a.start-2);u=new Ze(p,p,a.depth),a.endIndex<a.parent.childCount&&(a=new Ze(i,e.doc.resolve(s.end(a.depth)),a.depth)),l=!0}var f=ar(u,n,t,a);return!!f&&(r&&r(function(n,t,e,r,o){for(var i=v.empty,s=e.length-1;s>=0;s--)i=v.from(e[s].type.create(e[s].attrs,i));n.step(new _t(t.start-(r?2:0),t.end,t.start,t.end,new M(i,0,0),e.length,!0));for(var a=0,l=0;l<e.length;l++)e[l].type==o&&(a=l+1);for(var u=e.length-a,p=t.start+e.length-(r?2:0),f=t.parent,d=t.startIndex,h=t.endIndex,m=!0;d<h;d++,m=!1)!m&&Se(n.doc,p,u)&&(n.split(p,u),p+=2*u),p+=f.child(d).nodeSize;return n}(e.tr,a,f,l,n).scrollIntoView()),!0)}}(o)(t,e))}}isActive(t){const{schema:e}=t,r=this.getType(e);return!!r&&Ds(t,r)}canExecute(t){return this.toggle()(t)}}class de{constructor(t){this.level=t}apply(){return(t,e)=>{const{schema:r}=t,o=r.nodes.heading;return!!o&&Gr(o)(t,e)}}toggle(){return(t,e)=>{var p;const{schema:r,selection:o,doc:i}=t,s=r.nodes.heading;if(!s)return!1;const a=o.$from.before(1),l=i.nodeAt(a),u=null!=(p=null==l?void 0:l.attrs)?p:{};return this.isActive(t)?Gr(r.nodes.paragraph,u)(t,e):Gr(s,ge(vt({},u),{level:this.level}))(t,e)}}isActive(t){const{schema:e}=t,r=As(t),o=e.nodes.heading;if(!o)return!1;const i=[o,e.nodes.text,e.nodes.blockquote],a=r.filter(l=>i.includes(l.type)).find(l=>l.attrs.level===this.level);return Boolean(a)}canExecute(t){return this.toggle()(t)}}class ln{constructor(t){this.align=t}toggle(){return(t,e)=>{const{doc:r,selection:o,tr:i,schema:s}=t,{from:a,to:l}=o;let u=!1;return r.nodesBetween(a,l,(p,f)=>{const d=p.type;return[s.nodes.paragraph,s.nodes.heading].includes(d)&&(u=!0,i.setNodeMarkup(f,d,ge(vt({},p.attrs),{align:this.align}))),!0}),!!u&&(i.docChanged&&(null==e||e(i)),!0)}}isActive(t){const r=As(t).find(o=>o.attrs.align===this.align);return Boolean(r)}canExecute(t){return this.toggle()(t)}}const $p={strict:!0};class io{update(t){return(e,r)=>{const{schema:o,selection:i}=e,s=o.marks.link;return!(!s||i.empty)&&Ee(s,t)(e,r)}}insert(t,e){return(r,o)=>{var p,f;const{schema:i,tr:s}=r;if(!i.marks.link)return!1;const l={href:e.href,title:null!=(p=e.title)?p:t,target:null!=(f=e.target)?f:"_blank"},u=i.text(t,[i.marks.link.create(l)]);return s.replaceSelectionWith(u,!1).scrollIntoView(),!!s.docChanged&&(null==o||o(s),!0)}}isActive(t,e=$p){if(e.strict)return!0;const{schema:r}=t,o=r.marks.link;return!!o&&$r(t,o)}remove(t,e){return((n,t)=>{const{doc:e,selection:r,tr:o}=n,{$head:{pos:i},from:s,to:a}=r;if(s===a){const l=e.resolve(i),u=i-l.textOffset,p=u+l.parent.child(l.index()).nodeSize;o.removeMark(u,p)}else o.removeMark(s,a);return!!o.docChanged&&(null==t||t(o),!0)})(t,e)}canExecute(t){const e={href:""};return this.insert("Exec",e)(t)||this.update(e)(t)}}class Qs{insert(t,e){return(r,o)=>{const{schema:i,tr:s,selection:a}=r,l=i.nodes.image;if(!l)return!1;const u=vt({width:null,src:t},e);!u.width&&a instanceof E&&a.node.type===l&&(u.width=a.node.attrs.width),s.replaceSelectionWith(l.createAndFill(u));const p=s.doc.resolve(s.selection.anchor-s.selection.$anchor.nodeBefore.nodeSize);return s.setSelection(new E(p)).scrollIntoView(),!!s.docChanged&&(null==o||o(s),!0)}}isActive(t){const{selection:e}=t;return e instanceof E&&"image"===e.node.type.name}}class De{constructor(t,e="color"){this.name=t,this.attrName=e}apply(t){return(e,r)=>{const{schema:o,selection:i,doc:s}=e,a=o.marks[this.name];if(!a)return!1;const{from:l,to:u,empty:p}=i;if(!p&&l+1===u){const f=s.nodeAt(l);if((null==f?void 0:f.isAtom)&&!f.isText&&f.isLeaf)return!1}return Fs(a,t)(e,r)}}isActive(t){const{schema:e}=t,r=e.marks[this.name];return!!r&&$r(t,r)}getActiveColors(t){if(!this.isActive(t))return[];const{schema:e}=t;return(n=>{let t=[];const{selection:e,storedMarks:r}=n,{from:o,to:i,empty:s,$from:a}=e;return s?t=r||a.marks():n.doc.nodesBetween(o,i,l=>{t=[...t,...l.marks]}),t})(t).filter(i=>i.type===e.marks[this.name]).map(i=>i.attrs[this.attrName]).filter(Boolean)}remove(){return(t,e)=>{const{schema:r}=t,o=r.marks[this.name];return!!o&&(n=o,(t,e)=>{const{tr:r,selection:o,storedMarks:i,doc:s}=t,{empty:a,ranges:l}=o;if(a&&o instanceof Z){const{$cursor:u}=o;if(!u||!Ps(t.doc,l,n))return!1;if(n.isInSet(i||u.marks()))return r.removeStoredMark(n),null==e||e(r),!0}else{for(const u of l){const{$from:p,$to:f}=u;s.rangeHasMark(p.pos,f.pos,n)&&r.removeMark(p.pos,f.pos,n)}if(!r.docChanged)return!1;null==e||e(r.scrollIntoView())}return!1})(t,e);var n}}canExecute(t){return this.apply("text_color"===this.name?{color:""}:{backgroundColor:""})(t)}}const tf=new Oe("strong"),ef=new Oe("em"),nf=new Oe("code"),rf=new Oe("u"),sf=new Oe("s"),af=new class{toggle(){return(t,e)=>{const{schema:r}=t,o=r.nodes.blockquote;return!!o&&(this.isActive(t)?function(n,t){var e=n.selection,i=e.$from.blockRange(e.$to),s=i&&Je(i);return null!=s&&(t&&t(n.tr.lift(i,s).scrollIntoView()),!0)}(t,e):(n=o,function(e,r){var o=e.selection,a=o.$from.blockRange(o.$to),l=a&&ar(a,n,void 0);return!!l&&(r&&r(e.tr.wrap(a,l).scrollIntoView()),!0)})(t,e));var n}}isActive(t){const{schema:e}=t,r=e.nodes.blockquote;return!!r&&Ds(t,r)}canExecute(t){return this.toggle()(t)}},lf=new Vn(!0),cf=new Vn(!1),uf=new de(1),pf=new de(2),ff=new de(3),df=new de(4),hf=new de(5),mf=new de(6),gf=new ln("left"),vf=new ln("center"),yf=new ln("right"),_f=new ln("justify"),bf=new io,xf=new Qs,Sf=new De("text_color","color"),Mf=new De("text_background_color","backgroundColor"),Zn={bold:tf,italic:ef,code:nf,underline:rf,strike:sf,blockquote:af,bullet_list:lf,ordered_list:cf,h1:uf,h2:pf,h3:ff,h4:df,h5:hf,h6:mf,align_left:gf,align_center:vf,align_right:yf,align_justify:_f},cn=bf,Ks=xf,Cf=Sf,kf=Mf,Gs={bold:"Bold",italic:"Italic",code:"Code",underline:"Underline",strike:"Strike",blockquote:"Blockquote",bullet_list:"Bullet List",ordered_list:"Ordered List",heading:"Heading",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6",align_left:"Left Align",align_center:"Center Align",align_right:"Right Align",align_justify:"Justify",text_color:"Text Color",background_color:"Background Color",insertLink:"Insert Link",removeLink:"Remove Link",insertImage:"Insert Image",url:"URL",text:"Text",openInNewTab:"Open in new tab",insert:"Insert",altText:"Alt Text",title:"Title",remove:"Remove"};class wf{constructor(t={}){this.locals=Gs,this.get=e=>{var r;return null!=(r=this.locals[e])?r:""},this.locals=vt(vt({},Gs),t)}}let so=(()=>{class n{constructor(){this.locals={}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Ae=(()=>{class n{constructor(e){this.config=e}get locals(){return new wf(this.config.locals)}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(so,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Ys=n=>{var t;return{locals:null!=(t=n.locals)?t:{}}};let un=(()=>{class n{constructor(e){this.sanitizer=e}transform(e){return this.sanitizer.bypassSecurityTrustHtml(e)}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(Wn.H7,16))},n.\u0275pipe=c.Yjl({name:"sanitizeHtml",type:n,pure:!0}),n})(),Tf=(()=>{class n{constructor(e,r){this.ngxeService=e,this.menuService=r,this.isActive=!1,this.disabled=!1,this.update=o=>{const{state:i}=o,s=Zn[this.name];this.isActive=s.isActive(i),this.disabled=!s.canExecute(i)}}get name(){return this.toolbarItem}toggle(e){if(e.preventDefault(),0!==e.button)return;const{state:r,dispatch:o}=this.editorView;Zn[this.name].toggle()(r,o)}getTitle(e){return this.ngxeService.locals.get(e)}ngOnInit(){this.html=Hn.get(this.name),this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(Ae),c.Y36(fe))},n.\u0275cmp=c.Xpm({type:n,selectors:[["ngx-toggle-command"]],hostVars:4,hostBindings:function(e,r){2&e&&c.ekj("NgxEditor__MenuItem--Active",r.isActive)("NgxEditor--Disabled",r.disabled)},inputs:{toolbarItem:"toolbarItem"},decls:2,vars:4,consts:[[1,"NgxEditor__MenuItem--IconContainer",3,"innerHTML","title","mousedown"]],template:function(e,r){1&e&&(c.TgZ(0,"div",0),c.NdJ("mousedown",function(i){return r.toggle(i)}),c.ALo(1,"sanitizeHtml"),c.qZA()),2&e&&c.Q6J("innerHTML",c.lcZ(1,2,r.html),c.oJD)("title",r.getTitle(r.name))},pipes:[un],styles:[""]}),n})(),If=(()=>{class n{constructor(e,r,o){this.el=e,this.ngxeService=r,this.menuService=o,this.showPopup=!1,this.isActive=!1,this.canExecute=!0,this.form=new C.cw({href:new C.NI("",[C.kI.required,C.kI.pattern("(https?://)?([\\da-z.-]+)\\.([a-z.]{2,6})[/\\w .-]*/??([^#\n\r]*)?#?([^\n\r]*)")]),text:new C.NI("",[C.kI.required]),openInNewTab:new C.NI(!0)}),this.setText=()=>{const{state:{selection:i,doc:s}}=this.editorView,{empty:a,from:l,to:u}=i,p=a?"":s.textBetween(l,u);p&&(this.text.patchValue(p),this.text.disable())},this.update=i=>{const{state:s}=i;this.isActive=cn.isActive(s,{strict:!1}),this.canExecute=cn.canExecute(s)}}get valid(){return this.isActive||this.showPopup}get disabled(){return!this.canExecute}get icon(){return Hn.get(this.isActive?"unlink":"link")}get title(){return this.ngxeService.locals.get(this.isActive?"removeLink":"insertLink")}get href(){return this.form.get("href")}get text(){return this.form.get("text")}onDocumentClick(e){!this.el.nativeElement.contains(e.target)&&this.showPopup&&this.hideForm()}getLabel(e){return this.ngxeService.locals.get(e)}hideForm(){this.showPopup=!1,this.form.reset({href:"",text:"",openInNewTab:!0}),this.text.enable()}onMouseDown(e){if(0!==e.button)return;const{state:r,dispatch:o}=this.editorView;this.isActive?cn.remove(r,o):(this.showPopup=!this.showPopup,this.showPopup&&this.setText())}insertLink(e){e.preventDefault();const{text:r,href:o,openInNewTab:i}=this.form.getRawValue(),{dispatch:s,state:a}=this.editorView,{selection:l}=a,u={title:o,href:o,target:i?"_blank":"_self"};l.empty?(cn.insert(r,u)(a,s),this.editorView.focus()):cn.update(u)(a,s),this.hideForm()}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(c.SBq),c.Y36(Ae),c.Y36(fe))},n.\u0275cmp=c.Xpm({type:n,selectors:[["ngx-link"]],hostVars:4,hostBindings:function(e,r){1&e&&c.NdJ("mousedown",function(i){return r.onDocumentClick(i)},!1,c.evT),2&e&&c.ekj("NgxEditor__MenuItem--Active",r.valid)("NgxEditor--Disabled",r.disabled)},decls:3,vars:5,consts:[[1,"NgxEditor__MenuItem--IconContainer",3,"innerHTML","title","mousedown"],["class","NgxEditor__Popup",4,"ngIf"],[1,"NgxEditor__Popup"],[1,"NgxEditor__Popup--Form",3,"formGroup","ngSubmit"],[1,"NgxEditor__Popup--FormGroup"],[1,"NgxEditor__Popup--Col"],[1,"NgxEditor__Popup--Label"],["type","href","id","href","formControlName","href","autofocus","","autocomplete","off"],["class","NgxEditor__HelpText NgxEditor__HelpText--Error",4,"ngIf"],["type","text","formControlName","text","autocomplete","off"],["type","checkbox","formControlName","openInNewTab"],["type","submit",3,"disabled"],[1,"NgxEditor__HelpText","NgxEditor__HelpText--Error"]],template:function(e,r){1&e&&(c.TgZ(0,"div",0),c.NdJ("mousedown",function(i){return r.onMouseDown(i)}),c.ALo(1,"sanitizeHtml"),c.qZA(),c.YNc(2,Ju,21,8,"div",1)),2&e&&(c.Q6J("innerHTML",c.lcZ(1,3,r.icon),c.oJD)("title",r.title),c.xp6(2),c.Q6J("ngIf",r.showPopup))},directives:[R.O5,C._Y,C.JL,C.sg,C.Fj,C.JJ,C.u,C.Wl],pipes:[un],styles:[""]}),n})(),Nf=(()=>{class n{constructor(e,r,o){this.el=e,this.ngxeService=r,this.menuService=o,this.showPopup=!1,this.isActive=!1,this.form=new C.cw({src:new C.NI("",[C.kI.required,C.kI.pattern("(https?://)?([\\da-z.-]+)\\.([a-z.]{2,6})[/\\w .-]*/??([^#\n\r]*)?#?([^\n\r]*)")]),alt:new C.NI(""),title:new C.NI("")}),this.update=i=>{const{state:s}=i;this.isActive=Ks.isActive(s)}}get valid(){return this.isActive||this.showPopup}get icon(){return Hn.get("image")}get src(){return this.form.get("src")}onDocumentClick(e){!this.el.nativeElement.contains(e.target)&&this.showPopup&&this.hideForm()}getLabel(e){return this.ngxeService.locals.get(e)}hideForm(){this.showPopup=!1,this.form.reset({src:"",alt:"",title:""})}onMouseDown(e){0===e.button&&(this.showPopup=!this.showPopup,this.showPopup&&this.fillForm())}fillForm(){const{state:e}=this.editorView,{selection:r}=e;if(r instanceof E&&this.isActive){const{src:o,alt:i="",title:s=""}=r.node.attrs;this.form.setValue({src:o,alt:i,title:s})}}insertLink(e){e.preventDefault();const{src:r,alt:o,title:i}=this.form.getRawValue(),{dispatch:s,state:a}=this.editorView;Ks.insert(r,{alt:o,title:i})(a,s),this.editorView.focus(),this.hideForm()}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(c.SBq),c.Y36(Ae),c.Y36(fe))},n.\u0275cmp=c.Xpm({type:n,selectors:[["ngx-image"]],hostVars:2,hostBindings:function(e,r){1&e&&c.NdJ("mousedown",function(i){return r.onDocumentClick(i)},!1,c.evT),2&e&&c.ekj("NgxEditor__MenuItem--Active",r.valid)},decls:3,vars:5,consts:[[1,"NgxEditor__MenuItem--IconContainer",3,"innerHTML","title","mousedown"],["class","NgxEditor__Popup",4,"ngIf"],[1,"NgxEditor__Popup"],[1,"NgxEditor__Popup--Form",3,"formGroup","ngSubmit"],[1,"NgxEditor__Popup--FormGroup"],[1,"NgxEditor__Popup--Col"],[1,"NgxEditor__Popup--Label"],["type","href","id","href","formControlName","src","autofocus","","autocomplete","off"],["class","NgxEditor__HelpText NgxEditor__HelpText--Error",4,"ngIf"],["type","text","formControlName","alt","autocomplete","off"],["type","text","formControlName","title","autocomplete","off"],["type","submit",3,"disabled"],[1,"NgxEditor__HelpText","NgxEditor__HelpText--Error"]],template:function(e,r){1&e&&(c.TgZ(0,"div",0),c.NdJ("mousedown",function(i){return r.onMouseDown(i)}),c.ALo(1,"sanitizeHtml"),c.qZA(),c.YNc(2,Wu,20,7,"div",1)),2&e&&(c.Q6J("innerHTML",c.lcZ(1,3,r.icon),c.oJD)("title",r.getLabel("insertImage")),c.xp6(2),c.Q6J("ngIf",r.showPopup))},directives:[R.O5,C._Y,C.JL,C.sg,C.Fj,C.JJ,C.u],pipes:[un],styles:[""]}),n})(),Ef=(()=>{class n{constructor(e,r,o){this.ngxeService=e,this.menuService=r,this.el=o,this.isDropdownOpen=!1,this.disabledItems=[],this.update=i=>{const{state:s}=i;this.disabledItems=[];const a=[];this.items.forEach(l=>{const u=Zn[l];u.isActive(s)&&a.push(l),u.canExecute(s)||this.disabledItems.push(l)}),1===a.length?[this.activeItem]=a:this.activeItem=null}}get isSelected(){return Boolean(this.activeItem||this.isDropdownOpen)}get isDropdownDisabled(){return this.disabledItems.length===this.items.length}onDocumentClick(e){!this.el.nativeElement.contains(e)&&this.isDropdownOpen&&(this.isDropdownOpen=!1)}getName(e){return this.ngxeService.locals.get(e)}toggleDropdown(e){e.preventDefault(),this.isDropdownOpen=!this.isDropdownOpen}trackByIndex(e){return e}onClick(e,r){if(e.preventDefault(),0!==e.button)return;const o=Zn[r],{state:i,dispatch:s}=this.editorView;o.toggle()(i,s),this.isDropdownOpen=!1}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(Ae),c.Y36(fe),c.Y36(c.SBq))},n.\u0275cmp=c.Xpm({type:n,selectors:[["ngx-dropdown"]],hostVars:4,hostBindings:function(e,r){1&e&&c.NdJ("mousedown",function(i){return r.onDocumentClick(i.target)},!1,c.evT),2&e&&c.ekj("NgxEditor__Dropdown--Selected",r.isSelected)("NgxEditor--Disabled",r.isDropdownDisabled)},inputs:{group:"group",items:"items"},decls:3,vars:2,consts:[[1,"NgxEditor__Dropdown--Text",3,"mousedown"],["class","NgxEditor__Dropdown--DropdownMenu",4,"ngIf"],[1,"NgxEditor__Dropdown--DropdownMenu"],["class","NgxEditor__Dropdown--Item",3,"ngClass","mousedown",4,"ngFor","ngForOf","ngForTrackBy"],[1,"NgxEditor__Dropdown--Item",3,"ngClass","mousedown"]],template:function(e,r){1&e&&(c.TgZ(0,"div",0),c.NdJ("mousedown",function(i){return r.toggleDropdown(i)}),c._uU(1),c.qZA(),c.YNc(2,Ku,2,2,"div",1)),2&e&&(c.xp6(1),c.hij(" ",r.getName(r.activeItem||r.group),"\n"),c.xp6(1),c.Q6J("ngIf",r.isDropdownOpen))},directives:[R.O5,R.sg,R.mk],styles:[""]}),n})(),Of=(()=>{class n{constructor(e,r,o){this.el=e,this.menuService=r,this.ngxeService=o,this.showPopup=!1,this.isActive=!1,this.activeColors=[],this.canExecute=!0,this.update=i=>{const{state:s}=i;this.canExecute=this.command.canExecute(s),this.isActive=this.command.isActive(s),this.activeColors=[],this.isActive&&(this.activeColors=this.command.getActiveColors(s))}}get valid(){return this.isActive||this.showPopup}get disabled(){return!this.canExecute}get title(){return this.getLabel("text_color"===this.type?"text_color":"background_color")}get icon(){return Hn.get("text_color"===this.type?"text_color":"color_fill")}get command(){return"text_color"===this.type?Cf:kf}getContrastYIQ(e){const r=e.replace("#","");return(299*parseInt(r.substring(0,2),16)+587*parseInt(r.substring(2,4),16)+114*parseInt(r.substring(4,6),16))/1e3>=128?"black":"white"}onDocumentClick(e){!this.el.nativeElement.contains(e.target)&&this.showPopup&&this.hidePopup()}hidePopup(){this.showPopup=!1}togglePopup(e){e.preventDefault(),0===e.button&&(this.showPopup=!this.showPopup)}remove(e){e.preventDefault();const{state:r,dispatch:o}=this.editorView;this.command.remove()(r,o),this.hidePopup()}trackByIndex(e){return e}onColorSelect(e,r){if(e.preventDefault(),0!==e.button)return;const{state:o,dispatch:i}=this.editorView;"text_color"===this.type?this.command.apply({color:r})(o,i):this.command.apply({backgroundColor:r})(o,i),this.editorView.hasFocus()||this.editorView.focus(),this.hidePopup()}getLabel(e){return this.ngxeService.locals.get(e)}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(c.SBq),c.Y36(fe),c.Y36(Ae))},n.\u0275cmp=c.Xpm({type:n,selectors:[["ngx-color-picker"]],hostVars:4,hostBindings:function(e,r){1&e&&c.NdJ("mousedown",function(i){return r.onDocumentClick(i)},!1,c.evT),2&e&&c.ekj("NgxEditor__MenuItem--Active",r.valid)("NgxEditor--Disabled",r.disabled)},inputs:{presets:"presets",type:"type"},decls:3,vars:5,consts:[[1,"NgxEditor__MenuItem--IconContainer",3,"innerHTML","title","mousedown"],["class","NgxEditor__Popup",4,"ngIf"],[1,"NgxEditor__Popup"],["class","NgxEditor__ColorContainer",4,"ngFor","ngForOf","ngForTrackBy"],[1,"NgxEditor__MenuItem--Button",3,"disabled","mousedown"],[1,"NgxEditor__ColorContainer"],["class","NgxEditor__Color",3,"ngStyle","title","ngClass","mousedown",4,"ngFor","ngForOf","ngForTrackBy"],[1,"NgxEditor__Color",3,"ngStyle","title","ngClass","mousedown"]],template:function(e,r){1&e&&(c.TgZ(0,"div",0),c.NdJ("mousedown",function(i){return r.togglePopup(i)}),c.ALo(1,"sanitizeHtml"),c.qZA(),c.YNc(2,tp,4,4,"div",1)),2&e&&(c.Q6J("innerHTML",c.lcZ(1,3,r.icon),c.oJD)("title",r.title),c.xp6(2),c.Q6J("ngIf",r.showPopup))},directives:[R.O5,R.sg,R.PC,R.mk],pipes:[un],styles:['@charset "UTF-8";.NgxEditor__Popup[_ngcontent-%COMP%]{width:230px}.NgxEditor__ColorContainer[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.NgxEditor__ColorContainer[_ngcontent-%COMP%] + .NgxEditor__ColorContainer[_ngcontent-%COMP%]{margin-top:5px}.NgxEditor__Color[_ngcontent-%COMP%]{border:none;outline:none;border-radius:6px;width:24px;height:24px;flex-shrink:0}.NgxEditor__Color--Active[_ngcontent-%COMP%]:after{content:"\\2714";font-size:90%}.NgxEditor__MenuItem--Button[_ngcontent-%COMP%]{margin-top:5px}']}),n})();const Df=[["bold","italic"],[{heading:["h1","h2","h3","h4","h5","h6"]}],["link","image"],["text_color","background_color"]],Af=["#b60205","#d93f0b","#fbca04","#0e8a16","#006b75","#1d76db","#0052cc","#5319e7","#e99695","#f9d0c4","#fef2c0","#c2e0c6","#bfdadc","#c5def5","#bfd4f2","#d4c5f9"];let Pf=(()=>{class n{constructor(e){this.menuService=e,this.toolbar=Df,this.colorPresets=Af,this.disabled=!1,this.customMenuRef=null,this.dropdownPlacement="bottom",this.toggleCommands=["bold","italic","underline","strike","code","blockquote","ordered_list","bullet_list","align_left","align_center","align_right","align_justify"],this.iconContainerClass=["NgxEditor__MenuItem","NgxEditor__MenuItem--Icon"],this.dropdownContainerClass=["NgxEditor__Dropdown"],this.seperatorClass=["NgxEditor__Seperator"]}get presets(){const r=[];return this.colorPresets.forEach((o,i)=>{const s=Math.floor(i/8);r[s]||r.push([]),r[s].push(o)}),r}trackByIndex(e){return e}isDropDown(e){return!!(null==e?void 0:e.heading)}getDropdownItems(e){return e}ngOnInit(){if(!this.editor)throw new Error("NgxEditor: Required editor instance");this.menuService.editor=this.editor}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(fe))},n.\u0275cmp=c.Xpm({type:n,selectors:[["ngx-editor-menu"]],inputs:{toolbar:"toolbar",colorPresets:"colorPresets",disabled:"disabled",editor:"editor",customMenuRef:"customMenuRef",dropdownPlacement:"dropdownPlacement"},features:[c._Bn([fe])],decls:3,vars:7,consts:[[1,"NgxEditor__MenuBar",3,"ngClass"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[3,"toolbarItem","class",4,"ngIf"],[3,"class",4,"ngIf"],["type","text_color",3,"class","presets",4,"ngIf"],["type","background_color",3,"class","presets",4,"ngIf"],[3,"toolbarItem"],[3,"class","group","items",4,"ngFor","ngForOf","ngForTrackBy"],[3,"group","items"],["type","text_color",3,"presets"],["type","background_color",3,"presets"],[3,"ngTemplateOutlet"]],template:function(e,r){1&e&&(c.TgZ(0,"div",0),c.YNc(1,up,2,2,"ng-container",1),c.YNc(2,pp,2,1,"ng-container",2),c.qZA()),2&e&&(c.Q6J("ngClass",c.WLB(4,fp,r.disabled,"top"===r.dropdownPlacement)),c.xp6(1),c.Q6J("ngForOf",r.toolbar)("ngForTrackBy",r.trackByIndex),c.xp6(1),c.Q6J("ngIf",r.customMenuRef))},directives:[R.mk,R.sg,R.O5,Tf,If,Nf,Ef,Of,R.tP],pipes:[R.Nd],styles:[""]}),n})(),Rf=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:[un],imports:[[R.ez,C.UX]]}),n})();const qn=new c.OlP("NgxEditorConfig");let Ff=(()=>{class n{static forRoot(e){return{ngModule:n,providers:[{provide:qn,useValue:e},{provide:so,useFactory:Ys,deps:[qn]}]}}static forChild(e){return{ngModule:n,providers:[{provide:qn,useValue:e},{provide:so,useFactory:Ys,deps:[qn]},Ae]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:[],imports:[[R.ez,Rf]]}),n})();const Tt=(n,t=!1)=>(e,r)=>{const o=new Oe(n);return t?o.toggle()(e,r):o.apply()(e,r)};class Lf{constructor(t){if(this.applyTrx=e=>{this.state=this.state.apply(null!=e?e:this.tr),this.tr=this.state.tr,this.tr.setMeta("APPLIED_TRX",!0)},this.dispatch=e=>{this.applyTrx(e)},!t)throw Error("NgxEditor: Required view to initialize commands.");this.view=t,this.state=t.state,this.tr=this.view.state.tr}exec(){if(!this.tr.getMeta("APPLIED_TRX"))return!1;const t=!this.view.state.doc.eq(this.state.doc);this.view.updateState(this.state);const e=this.tr.setMeta("FORCE_EMIT",t);return this.view.dispatch(e),!0}focus(){return this.view.focus(),this}scrollIntoView(){return this.tr.scrollIntoView(),this.applyTrx(),this}insertText(t){return this.tr.insertText(t),this.applyTrx(),this}insertNewLine(){return sn(_s,xs,Ss,Kr)(this.state,this.dispatch),this}applyMark(t){return Tt(t,!1)(this.state,this.dispatch),this}toggleMark(t){return Tt(t,!0)(this.state,this.dispatch),this}bold(){return Tt("strong")(this.state,this.dispatch),this}toggleBold(){return Tt("strong",!0)(this.state,this.dispatch),this}italics(){return Tt("em")(this.state,this.dispatch),this}toggleItalics(){return Tt("em",!0)(this.state,this.dispatch),this}underline(){return Tt("u")(this.state,this.dispatch),this}toggleUnderline(){return Tt("u",!0)(this.state,this.dispatch),this}strike(){return Tt("s")(this.state,this.dispatch),this}toggleStrike(){return Tt("s",!0)(this.state,this.dispatch),this}code(){return Tt("code")(this.state,this.dispatch),this}toggleCode(){return Tt("code",!0)(this.state,this.dispatch),this}toggleOrderedList(){return new Vn(!1).toggle()(this.state,this.dispatch),this}toggleBulletList(){return new Vn(!0).toggle()(this.state,this.dispatch),this}toggleHeading(t){return new de(t).toggle()(this.state,this.dispatch),this}insertLink(t,e){return(new io).insert(t,e)(this.state,this.dispatch),this}updateLink(t){return(new io).update(t)(this.state,this.dispatch),this}insertImage(t,e={}){return(new Qs).insert(t,e)(this.state,this.dispatch),this}textColor(t){return new De("text_color").apply({color:t})(this.state,this.dispatch),this}backgroundColor(t){return new De("text_background_color").apply({backgroundColor:t})(this.state,this.dispatch),this}removeTextColor(){return new De("text_color").remove()(this.state,this.dispatch),this}removeBackgroundColor(){return new De("text_background_color").remove()(this.state,this.dispatch),this}align(t){return new ln(t).toggle()(this.state,this.dispatch),this}insertHTML(t){const{selection:e,schema:r,tr:o}=this.state,{from:i,to:s}=e,a=document.createElement("div");a.innerHTML=t.trim();const l=Mt.fromSchema(r).parseSlice(a),u=o.replaceRange(i,s,l);return this.applyTrx(u),this}}const Hf="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),Qf=n=>{const t=mu.concat(uu,cu);return t.push((n=>Rs(/(?:^|\s)(?:(?:\*\*|__)(?:(?:[^*_]+))(?:\*\*|__))$/,n))(n.marks.strong)),t.push((n=>Rs(/(?:^|\s)(?:(?:\*|_)(?:(?:[^*_]+))(?:\*|_))$/,n))(n.marks.em)),t.push((n=>Xr(/^\s*>\s$/,n))(n.nodes.blockquote)),t.push((n=>Xr(/^(?:\d+)\.\s$/,n,t=>({order:Number(t[1])}),(t,e)=>e.childCount+e.attrs.order===Number(t[1])))(n.nodes.ordered_list)),t.push((n=>Xr(/^\s*(?:[-+*])\s$/,n))(n.nodes.bullet_list)),t.push((n=>Os(/^```$/,n))(n.nodes.code_block)),t.push(((n,t)=>Os(new RegExp("^(#{1,6})\\s$"),n,e=>({level:e[1].length})))(n.nodes.heading)),function(n){var t=n.rules,e=new It({state:{init:function(){return null},apply:function(o,i){return o.getMeta(this)||(o.selectionSet||o.docChanged?null:i)}},props:{handleTextInput:function(o,i,s,a){return Es(o,i,s,a,t,e)},handleDOMEvents:{compositionend:function(r){setTimeout(function(){var i=r.state.selection.$cursor;i&&Es(r,i.pos,i.pos,"",t,e)})}}},isInputRules:!0});return e}({rules:t})},Gf=(n,t)=>{const e=[];return t.keyboardShortcuts&&e.push(...((n,t)=>{const e={};e["Mod-z"]=Us,Hf?e["Shift-Mod-z"]=oo:e["Mod-y"]=oo;const r=[zn({"Mod-b":Ee(n.marks.strong),"Mod-i":Ee(n.marks.em),"Mod-u":Ee(n.marks.u),"Mod-`":Ee(n.marks.code)}),zn({Enter:Ic(n.nodes.list_item),"Shift-Enter":sn(bs,(o,i)=>{const{tr:s}=o;return i(s.replaceSelectionWith(n.nodes.hard_break.create()).scrollIntoView()),!0}),"Mod-[":ds(n.nodes.list_item),"Mod-]":hs(n.nodes.list_item),Tab:hs(n.nodes.list_item)}),zn(iu)];return t.history&&r.push(zn(e)),r})(n,{history:t.history})),t.history&&e.push(function(n){return new It({key:Bt,state:{init:function(){return new ee(st.empty,st.empty,null,0)},apply:function(e,r,o){return function(n,t,e,r){var i,o=e.getMeta(Bt);if(o)return o.historyState;e.getMeta(Js)&&(n=new ee(n.done,n.undone,null,0));var s=e.getMeta("appendedTransaction");if(0==e.steps.length)return n;if(s&&s.getMeta(Bt))return s.getMeta(Bt).redo?new ee(n.done.addTransform(e,null,r,Ln(t)),n.undone,Vs(e.mapping.maps[e.steps.length-1]),n.prevTime):new ee(n.done,n.undone.addTransform(e,null,r,Ln(t)),null,n.prevTime);if(!1===e.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(i=e.getMeta("rebased"))?new ee(n.done.rebased(e,i),n.undone.rebased(e,i),no(n.prevRanges,e.mapping),n.prevTime):new ee(n.done.addMaps(e.mapping.maps),n.undone.addMaps(e.mapping.maps),no(n.prevRanges,e.mapping),n.prevTime);var a=0==n.prevTime||!s&&(n.prevTime<(e.time||0)-r.newGroupDelay||!function(n,t){if(!t)return!1;if(!n.docChanged)return!0;var e=!1;return n.mapping.maps[0].forEach(function(r,o){for(var i=0;i<t.length;i+=2)r<=t[i+1]&&o>=t[i]&&(e=!0)}),e}(e,n.prevRanges)),l=s?no(n.prevRanges,e.mapping):Vs(e.mapping.maps[e.steps.length-1]);return new ee(n.done.addTransform(e,a?t.selection.getBookmark():null,r,Ln(t)),st.empty,l,e.time)}(r,o,e,n)}},config:n={depth:n&&n.depth||100,newGroupDelay:n&&n.newGroupDelay||500},props:{handleDOMEvents:{beforeinput:function(e,r){var o="historyUndo"==r.inputType?Us(e.state,e.dispatch):"historyRedo"==r.inputType&&oo(e.state,e.dispatch);return o&&r.preventDefault(),o}}}})}()),t.inputRules&&e.push(Qf(n)),e},$s={linkOnPaste:!0,resizeImage:!0},ta={content:null,history:!0,keyboardShortcuts:!0,inputRules:!0,schema:Rn,plugins:[],nodeViews:{},attributes:{},features:$s};class Yf{constructor(t=ta){this.valueChangesSubject=new hn.xQ,this.updateSubject=new hn.xQ,this.options=vt(vt({},ta),t),this.createEditor()}get valueChanges(){return this.valueChangesSubject.asObservable()}get update(){return this.updateSubject.asObservable()}get schema(){return this.options.schema||Rn}get commands(){return new Lf(this.view)}get features(){return vt(vt({},$s),this.options.features)}handleTransactions(t){const e=this.view.state.apply(t);if(this.view.updateState(e),this.updateSubject.next(this.view),!t.docChanged&&!t.getMeta("FORCE_EMIT"))return;const r=e.doc.toJSON();this.valueChangesSubject.next(r)}createEditor(){var d,h;const{options:t,schema:e}=this,{content:r=null,nodeViews:o}=t,{history:i=!0,keyboardShortcuts:s=!0,inputRules:a=!0}=t,l=an(r,e),u=null!=(d=t.plugins)?d:[],p=null!=(h=t.attributes)?h:{},f=Gf(e,{history:i,keyboardShortcuts:s,inputRules:a});this.view=new W(null,{state:pt.create({doc:l,schema:e,plugins:[...f,...u]}),nodeViews:o,dispatchTransaction:this.handleTransactions.bind(this),attributes:p})}setContent(t){if(null==t)return;const{state:e}=this.view,{tr:r,doc:o}=e,i=an(t,this.schema);r.replaceWith(0,e.doc.content.size,i),!o.eq(r.doc)&&(!r.docChanged||this.view.dispatch(r))}registerPlugin(t){const{state:e}=this.view,r=[...e.plugins,t],o=e.reconfigure({plugins:r});this.view.updateState(o)}destroy(){this.view.destroy()}}var ea=T(3172),Xf=T(4655),$f=T(6607),td=T(6188),ed=T(2048),nd=T(3580),Pe=T(3050);let rd=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=c.Xpm({type:n,selectors:[["app-sbo"]],inputs:{spec:"spec",tool:"tool"},decls:76,vars:9,consts:[[1,"header"],["fixed",""],["size","2"],["src","assets/images/logoDaher.png",1,"ion-hide-sm-down","logo"],["size","7"],[1,"doc-title"],["size","3"],[1,"doc-codif"],[1,"aircraft-type"],["size","9"],[1,"sbo-title"],["size","4"],[1,"interch"],["size","8"],[1,"table"],[1,"sbo"],["fixed","",1,"data-grid"],[1,"header-row"],["size","1"],["size","3",1,"ion-no-padding","ion-no-border"],["size","12"],[1,"data-row"],[1,"title"],[1,"content"],[1,"footer"],[1,"norm"],[1,"toolnfl"]],template:function(e,r){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"ion-grid",1),c.TgZ(2,"ion-row"),c.TgZ(3,"ion-col",2),c._UZ(4,"ion-img",3),c.qZA(),c.TgZ(5,"ion-col",4),c.TgZ(6,"h3",5),c._uU(7," Processus \xab D\xe9velopper modifier une a\xe9rostructure \xbb "),c.qZA(),c.qZA(),c.TgZ(8,"ion-col",6),c.TgZ(9,"div",7),c._uU(10," F0381#A "),c._UZ(11,"br"),c._uU(12," Doc de rattachement : P0087 "),c.qZA(),c.qZA(),c.qZA(),c.TgZ(13,"ion-row"),c.TgZ(14,"ion-col",6),c.TgZ(15,"div",8),c._uU(16),c.qZA(),c.qZA(),c.TgZ(17,"ion-col",9),c.TgZ(18,"div",10),c._uU(19," SPECIFICATION DE BESOIN OUTILLAGE / TOOL REQUIREMENT SPECIFICATION "),c.qZA(),c.qZA(),c.qZA(),c.TgZ(20,"ion-row"),c.TgZ(21,"ion-col",11),c.TgZ(22,"div",12),c._uU(23," Interchangeabilit\xe9 : Cocher la case correspondante : Interchangeability: Check off the appropriate box: "),c.qZA(),c.qZA(),c.TgZ(24,"ion-col",13),c.TgZ(25,"ion-row",14),c.TgZ(26,"ion-col",11),c._uU(27),c.qZA(),c.TgZ(28,"ion-col",11),c._uU(29,"N\xb0 OT Client : "),c.qZA(),c.TgZ(30,"ion-col",11),c._uU(31,"OI : DAE-0022-2-4-1"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(32,"div",15),c.TgZ(33,"ion-grid",16),c.TgZ(34,"ion-row",17),c.TgZ(35,"ion-col",18),c._uU(36,"Ind"),c.qZA(),c.TgZ(37,"ion-col",18),c._uU(38,"Date"),c.qZA(),c.TgZ(39,"ion-col",2),c._uU(40,"Nom / Name"),c.qZA(),c.TgZ(41,"ion-col",11),c._uU(42,"Texte / Text"),c.qZA(),c.TgZ(43,"ion-col",19),c.TgZ(44,"ion-row"),c.TgZ(45,"ion-col",20),c._uU(46,"Temps allou\xe9 / Time allowed"),c.qZA(),c.qZA(),c.TgZ(47,"ion-row"),c.TgZ(48,"ion-col",11),c._uU(49,"Etude Design "),c.qZA(),c.TgZ(50,"ion-col",11),c._uU(51,"Prep OT WO preparation "),c.qZA(),c.TgZ(52,"ion-col",11),c._uU(53,"R\xe9al OT WO execution "),c.qZA(),c.qZA(),c.qZA(),c.TgZ(54,"ion-col",18),c._uU(55,"D\xe9lai utilisation Shelf life "),c.qZA(),c.qZA(),c.TgZ(56,"ion-row",21),c._UZ(57,"ion-col",18),c._UZ(58,"ion-col",18),c._UZ(59,"ion-col",2),c.TgZ(60,"ion-col",11),c.TgZ(61,"div",22),c._uU(62),c.qZA(),c.TgZ(63,"div",23),c._uU(64),c.qZA(),c.qZA(),c._UZ(65,"ion-col",18),c._UZ(66,"ion-col",18),c._UZ(67,"ion-col",18),c.TgZ(68,"ion-col",18),c._uU(69),c.ALo(70,"date"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(71,"div",24),c.TgZ(72,"div",25),c._uU(73,"Num\xe9rotation outillage suivant normes / Tool numbering as per : NFL 09.101 - NO.OO.OO1 et NO.01 001"),c.qZA(),c.TgZ(74,"div",26),c._uU(75),c.qZA(),c.qZA()),2&e&&(c.xp6(16),c.hij(" Type avion : ",r.spec.controls.aircraftProgram.value," "),c.xp6(11),c.hij("OT SAP : ",r.tool.controls.sapToolNumber.value,""),c.xp6(35),c.hij(" ",r.spec.controls.title.value,""),c.xp6(2),c.Oqu(r.spec.controls.description.value),c.xp6(5),c.Oqu(c.xi3(70,6,r.spec.controls.needDate.value,"dd/MM/yyyy")),c.xp6(6),c.Oqu(r.tool.controls.identification.value))},directives:[F.jY,F.Nd,F.wI,F.Xz],pipes:[R.uU],styles:[".logo[_ngcontent-%COMP%]{width:100px}.sbo-title[_ngcontent-%COMP%]{font-weight:bold}.table[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{border:solid 1px}.interch[_ngcontent-%COMP%]{font-size:small}.data-grid[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{border:solid 1px}.data-grid[_ngcontent-%COMP%]   .data-row[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{border:solid 1px}"]}),n})();function od(n,t){if(1&n&&(c.TgZ(0,"ion-select-option",18),c._uU(1),c.qZA()),2&n){const e=t.$implicit;c.Q6J("value",e.id),c.xp6(1),c.hij(" ",e.Designation," ")}}const id=[{title:"Nouvelle demande outillage",path:"new-tool",type:"button"},{title:"Liste des demandes outillages",path:"/tool-requests",type:"button"}],sd=[{path:"",component:(()=>{class n{constructor(e,r,o,i,s,a,l){this.formBuilder=e,this.programService=r,this.authService=o,this.toolService=i,this.userService=s,this.toolRequestService=a,this.router=l,this.requestTypeEnum=ea.x,this.page={pageTitle:"Cr\xe9ation d'une demande",menuTitle:"Menu outillage",menuItems:id,contentId:"tooling-content"},this.programService.getPrograms().then(u=>{this.programs=u}),this.editor=new Yf,this.editor.setContent("html")}ngOnInit(){this.newToolForm=this.formBuilder.group({sapToolNumber:new C.NI,identification:new C.NI,designation:new C.NI}),this.newToolRequestForm=this.formBuilder.group({aircraftProgram:new C.NI,title:new C.NI,description:new C.NI,needDate:new C.NI})}createToolClick(){this.toolService.createTool({designation:this.newToolForm.value.designation,identification:this.newToolForm.value.identification,sapToolNumber:this.newToolForm.value.sapToolNumber}).then(e=>{this.newTool=e}).catch(()=>{})}createToolRequestClick(){const e={type:ea.x.sbo,dateBesoin:this.newToolRequestForm.value.needDate,createdAt:new Date,demandeur:this.authService.authUser,toolSAP:this.toolService.getIri(this.newTool)};this.toolRequestService.createToolRequest(e).then(()=>{this.newToolForm.reset(),this.newToolRequestForm.reset(),this.router.navigate(["tool-requests"])}).catch(()=>{})}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(C.qu),c.Y36(Xf.W),c.Y36($f.e),c.Y36(td.o),c.Y36(ed.f),c.Y36(nd.C),c.Y36(Kn.F0))},n.\u0275cmp=c.Xpm({type:n,selectors:[["app-new-tool"]],decls:68,vars:11,consts:[["color","light"],["multi","",1,"example-headers-align"],[3,"formGroup"],["position","floating"],["color","danger"],["required","","formControlName","sapToolNumber","type","text","placeholder","ex. OT095999"],["required","","formControlName","identification","type","text","placeholder","ex. 19900Z01-T700P5522000123"],["required","","formControlName","designation","type","text"],["slot","end","expand","block","color","primary",3,"click"],["formControlName","aircraftProgram","multiple","true","placeholder","S\xe9lectionner le programme avion"],[3,"value",4,"ngFor","ngForOf"],["required","","formControlName","title"],[1,"NgxEditor__Wrapper"],[3,"editor"],["formControlName","description",3,"editor","ngModel","disabled","placeholder"],["display-format","DD.MM.YYYY HH:mm","formControlName","needDate"],[3,"spec","tool"],["slot","end","expand","block","color","primary",3,"disabled","click"],[3,"value"]],template:function(e,r){1&e&&(c.TgZ(0,"ion-content",0),c.TgZ(1,"mat-accordion",1),c.TgZ(2,"mat-expansion-panel"),c.TgZ(3,"mat-expansion-panel-header"),c.TgZ(4,"mat-panel-title"),c._uU(5," D\xe9finition "),c.qZA(),c.TgZ(6,"mat-panel-description"),c._uU(7," Cr\xe9er ou s\xe9lectionner l'outillage "),c.qZA(),c.qZA(),c.TgZ(8,"form",2),c.TgZ(9,"ion-item-group"),c.TgZ(10,"ion-item"),c.TgZ(11,"ion-label",3),c._uU(12,"Num\xe9ro d'OT SAP "),c.TgZ(13,"ion-text",4),c._uU(14,"*"),c.qZA(),c.qZA(),c._UZ(15,"ion-input",5),c.qZA(),c.TgZ(16,"ion-item"),c.TgZ(17,"ion-label",3),c._uU(18,"Num\xe9ro d'identification "),c.TgZ(19,"ion-text",4),c._uU(20,"*"),c.qZA(),c.qZA(),c._UZ(21,"ion-input",6),c.qZA(),c.TgZ(22,"ion-item"),c.TgZ(23,"ion-label",3),c._uU(24,"D\xe9signation "),c.TgZ(25,"ion-text",4),c._uU(26,"*"),c.qZA(),c.qZA(),c._UZ(27,"ion-input",7),c.qZA(),c.qZA(),c.TgZ(28,"ion-toolbar"),c.TgZ(29,"ion-button",8),c.NdJ("click",function(){return r.createToolClick()}),c._uU(30," Cr\xe9er l'OT "),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(31,"mat-expansion-panel"),c.TgZ(32,"mat-expansion-panel-header"),c.TgZ(33,"mat-panel-title"),c._uU(34," Descritpion "),c.qZA(),c._UZ(35,"mat-panel-description"),c.qZA(),c.TgZ(36,"form",2),c.TgZ(37,"ion-item-group"),c.TgZ(38,"ion-item"),c.TgZ(39,"ion-label"),c._uU(40,"Programme avion"),c.qZA(),c.TgZ(41,"ion-select",9),c.YNc(42,od,2,2,"ion-select-option",10),c.qZA(),c.qZA(),c.TgZ(43,"ion-item"),c.TgZ(44,"ion-label"),c._uU(45,"Titre "),c.TgZ(46,"ion-text",4),c._uU(47,"*"),c.qZA(),c.qZA(),c._UZ(48,"ion-input",11),c.qZA(),c.TgZ(49,"ion-item"),c.TgZ(50,"ion-label"),c._uU(51,"Description "),c.TgZ(52,"ion-text",4),c._uU(53,"*"),c.qZA(),c.qZA(),c.TgZ(54,"div",12),c._UZ(55,"ngx-editor-menu",13),c._UZ(56,"ngx-editor",14),c.qZA(),c.qZA(),c.TgZ(57,"ion-item"),c.TgZ(58,"ion-label"),c._uU(59,"Date "),c.TgZ(60,"ion-text",4),c._uU(61,"*"),c.qZA(),c.qZA(),c._UZ(62,"ion-datetime",15),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c._UZ(63,"app-sbo",16),c.qZA(),c.TgZ(64,"ion-footer"),c.TgZ(65,"ion-toolbar",0),c.TgZ(66,"ion-button",17),c.NdJ("click",function(){return r.createToolRequestClick()}),c._uU(67," Cr\xe9er la demande "),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(8),c.Q6J("formGroup",r.newToolForm),c.xp6(28),c.Q6J("formGroup",r.newToolRequestForm),c.xp6(6),c.Q6J("ngForOf",r.programs),c.xp6(13),c.Q6J("editor",r.editor),c.xp6(1),c.Q6J("editor",r.editor)("ngModel",r.html)("disabled",!1)("placeholder","Taper la description ici"),c.xp6(7),c.Q6J("spec",r.newToolRequestForm)("tool",r.newToolForm),c.xp6(3),c.Q6J("disabled",r.newToolRequestForm.invalid))},directives:[F.W2,Pe.pp,Pe.ib,Pe.yz,Pe.yK,Pe.u4,C._Y,C.JL,C.sg,F.Ub,F.Ie,F.Q$,F.yW,F.pK,F.j9,C.Q7,C.JJ,C.u,F.sr,F.YG,F.t9,F.QI,R.sg,Pf,Ep,F.x4,rd,F.fr,F.n0],styles:[""]}),n})()},{path:"**",component:Na.U}];let ad=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({imports:[[Kn.Bz.forChild(sd)],Kn.Bz]}),n})(),ld=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({imports:[[R.ez,F.Pc]]}),n})(),cd=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({imports:[[R.ez,C.u5,F.Pc,ad,C.UX,Ff,Ia,ld,Pe.To]]}),n})()}}]);