{
  "version": 3,
  "sources": ["src/app/shared/services/users/role.guard.ts", "src/app/tooling/services/tool.service.ts"],
  "sourcesContent": ["import { inject, Injectable } from '@angular/core';\r\nimport { ActivatedRouteSnapshot, Router } from '@angular/router';\r\nimport { AlertService } from '../divers/alert.service';\r\nimport { AuthStore } from './auth.store';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RoleGuard  {\r\n  private readonly authStore: AuthStore = inject(AuthStore);\r\n  private readonly alerteService: AlertService = inject(AlertService);\r\n  private readonly router: Router = inject(Router);\r\n\r\n  canActivate(route: ActivatedRouteSnapshot): boolean {\r\n    const expectedRole = route.data.expectedRole;\r\n    const isRole = this.isRole(expectedRole);\r\n    if (!isRole) {\r\n      // console.error('Impossible d\\'accéder à la page');\r\n      this.alerteService.simpleAlert(\r\n        'Alerte de l\\'application',\r\n        'Autorisation',\r\n        'Vous n\\'avez pas accès à cette page'\r\n      );\r\n      this.router.navigate(['home']);\r\n    }\r\n    return (\r\n      this.authStore.isAuthenticated() && isRole && this.authStore.user().isActive\r\n    );\r\n  }\r\n\r\n  isRole(expectedRoles: string[]): boolean {\r\n    // console.log(expectedRoles);\r\n    if (this.authStore.user()) {\r\n      return expectedRoles.some((expectedRole => this.authStore.user().roles.includes(expectedRole)));\r\n    }\r\n    return false;\r\n  }\r\n\r\n}\r\n", "import { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Tool, ToolCreation } from 'src/app/_interfaces/tooling/tool';\r\nimport { environment } from 'src/environments/environment';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { AlertService } from 'src/app/shared/services/divers/alert.service';\r\nimport { RequestService } from 'src/app/shared/services/request.service';\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ToolService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private requestService: RequestService,\r\n    private alertService: AlertService,\r\n  ) { }\r\n\r\n  getToolByInput(inputOTValue: string) {\r\n    return new Promise((resolve, reject) => {\r\n      switch (inputOTValue.length) {\r\n        case 5 | 6:\r\n          this.getToolByToolNumber(inputOTValue)\r\n            .subscribe((responseTool: Tool) => {\r\n              resolve(responseTool);\r\n            },\r\n              (message: string) => {\r\n                this.alertService.simpleAlert('Erreur', 'Le serveur outillage à renvoyé une erreur :', message);\r\n                reject();\r\n              });\r\n          break;\r\n        case 7:\r\n          // this.toolService.getEquipement()\r\n          break;\r\n        case 8:\r\n          if (inputOTValue.startsWith('OT')) {\r\n            this.getToolByToolNumber(inputOTValue.substring(inputOTValue.length - 5))\r\n              .subscribe((responseTool: Tool) => {\r\n                resolve(responseTool);\r\n              },\r\n                (message: string) => {\r\n                  this.alertService.simpleAlert('Erreur', 'Le serveur outillage à renvoyé une erreur :', message);\r\n                  reject();\r\n                });\r\n          }\r\n          break;\r\n\r\n        default:\r\n          this.getToolByIdentification(inputOTValue)\r\n            .then((responseTool: Tool) => {\r\n              resolve(responseTool);\r\n            },\r\n              (message: string) => {\r\n                this.alertService.simpleAlert('Erreur', 'Le serveur outillage à renvoyé une erreur :', message);\r\n                reject();\r\n              })\r\n            .catch((error) => {\r\n              console.error(error);\r\n            });\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  getToolById(idTool: string) {\r\n    return this.requestService.createGetRequest(`${environment.toolApi}tools/${idTool}`);\r\n  }\r\n\r\n  getToolByToolNumber(toolNumber: string): Observable<Tool | undefined> {\r\n    return this.requestService\r\n      .createGetRequest(`${environment.toolApi}tools?sapToolNumber=${toolNumber}`)\r\n      .pipe(\r\n        map((returnsData: any) => {\r\n          if (returnsData.length === 1) {\r\n            const returnMoldingTool: Tool = returnsData[0];\r\n            return returnMoldingTool;\r\n          } else if (returnsData.length > 1) {\r\n            console.error('Il y a plus d\\'un outillage correspondant en base de donnée');\r\n            return undefined;\r\n          } else {\r\n            console.error('aucun outillage trouvé');\r\n            return undefined;\r\n          }\r\n        }));\r\n  }\r\n\r\n  getToolByIdentification(identification: string) {\r\n    return new Promise((resolve, reject) => {\r\n      this.requestService.createGetRequest(`${environment.toolApi}tools?identification=${identification}`)\r\n        .subscribe((returnsData: any) => {\r\n          if (returnsData.length === 1) {\r\n            const returnMoldingTool: Tool = returnsData[0];\r\n            resolve(returnMoldingTool);\r\n          } else if (returnsData.length > 1) {\r\n            reject('Il y a plus d\\'un outillage correspondant en base de donnée');\r\n          } else {\r\n            reject('aucun outillage trouvé');\r\n          }\r\n        },\r\n          (error) => {\r\n            console.log(error);\r\n            reject('Pas de réponse du serveur');\r\n          });\r\n    });\r\n  }\r\n\r\n  getAllTools() {\r\n    return new Promise((resolve, reject) => {\r\n      const httpHeaders = new HttpHeaders()\r\n        .append('content-type', 'application/json');\r\n      this.http.get(`${environment.apiServer}molding_tools`, { headers: httpHeaders })\r\n        .subscribe((returnsData: any) => {\r\n          resolve(returnsData);\r\n        },\r\n          (error) => {\r\n            console.log(error);\r\n            reject();\r\n          });\r\n    });\r\n  }\r\n  getIri(tool: Tool): string {\r\n    return `/api/tools/${tool.id}`;\r\n  }\r\n\r\n  createTool(toolToCreate: ToolCreation) {\r\n    const tool: any = toolToCreate;\r\n    tool.sapToolNumber = parseInt(toolToCreate.sapToolNumber.substring(2), 10);\r\n    return this.http.post<Tool>(`api/tools`, tool);\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["RoleGuard", "ToolService"]
}
