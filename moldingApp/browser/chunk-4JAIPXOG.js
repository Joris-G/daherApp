import{Ad as A,Bd as P,Da as r,Db as re,Dd as $,Ea as i,Ed as F,Fa as a,G as m,Ga as Z,Ha as ee,J as S,Ja as te,Jb as y,Jc as oe,K as p,Kc as se,Kd as R,L as b,La as f,Lc as ae,Ma as C,Pc as le,Qc as ce,Rb as l,Sc as me,T as D,U as V,Ua as s,Va as E,Vc as pe,Xc as ue,_ as X,ab as w,ae as q,ce as M,eb as B,fb as O,i as G,ia as c,ja as d,jd as x,je as de,l as I,le as T,mb as ie,me as L,nd as _,ne as fe,o as K,od as k,oe as ve,pe as h,sa as Y,t as Q,va as u,wd as U,x as W,yd as j,zb as ne}from"./chunk-U2GCEKKH.js";import{a as z,b as H,h as J}from"./chunk-B4AJQJMI.js";var Se=(()=>{class t{requestService;constructor(e){this.requestService=e}getServices(){return this.requestService.createGetRequest(`${l.usineApi}services`)}getIri(e){return typeof e=="string"?e:`/api/services/${e.id}`}static \u0275fac=function(n){return new(n||t)(S(h))};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var he=(()=>{class t{http=p(y);getPrograms(){return this.http.get(`${l.usineApi}programme_avions`).pipe(I(e=>e.data))}getIri(e){return typeof e=="string"?e:`/api/programme_avions/${e.id}`}static \u0275fac=function(n){return new(n||t)};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ie=(()=>{class t{requestService;constructor(e){this.requestService=e}getRoles(){return this.requestService.createGetRequest(`${l.usineApi}postes`)}getIri(e){return typeof e=="string"?e:`/api/postes/${e.id}`}static \u0275fac=function(n){return new(n||t)(S(h))};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var be=(()=>{class t{requestService;constructor(e){this.requestService=e}getUnites(){return this.requestService.createGetRequest(`${l.usineApi}divisions`)}getIri(e){return typeof e=="string"?e:`/api/divisions/${e.id}`}static \u0275fac=function(n){return new(n||t)(S(h))};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ce=(()=>{class t{constructor(){}getIri(e){return typeof e=="string"?e:`/api/usines/${e.id}`}static \u0275fac=function(n){return new(n||t)};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var N=(()=>{class t{http=p(y);roleService=p(Ie);serviceService=p(Se);programService=p(he);uniteService=p(be);usineService=p(Ce);loadingService=p(L);getUserById(e){return this.http.get(l.usineApi+`users/${e}`)}getUsers(e){return this.http.get(`${l.usineApi}users`,{params:e})}registerUser(e){return this.loadingService.startLoading("Patienter pendant la cr\xE9ation de l'utilisateur"),this.http.post(l.usineApi+"users",e).pipe(W(()=>this.loadingService.stopLoading()))}getIri(e){return typeof e=="string"?e:`/api/users/${e.id}`}getGroups(){return this.http.get(`${l.usineApi}groupe_affectations`)}createGroup(e){return this.http.post(`${l.usineApi}groupe_affectations`,e)}updateUser(e){let n={password:e.password,matricule:e.matricule,nom:e.nom,prenom:e.prenom,poste:this.roleService.getIri(e.poste),service:this.serviceService.getIri(e.service),programmeAvion:e.programmeAvion.map(o=>this.programService.getIri(o)),unite:this.uniteService.getIri(e.unite),site:this.usineService.getIri(e.site),tel:e.tel};return this.http.patch(`${l.usineApi}users/${e.id}`,n)}addUserToGroup(e){let n=e.groupeAffected.map(o=>this.http.patch(`${l.usineApi}groupe_affectations/${o.id}/addUsers`,{population:o.population}).pipe(Q(g=>(console.error(`Erreur avec le groupe ${o.id}:`,g),G(o)))));return K(n).pipe(I(o=>H(z({},e),{groupeAffected:o})))}getUsersByService(e){return ie()?G():this.http.get(`${l.usineApi}services/${e}`)}deleteUser(e){return this.http.delete(`${l.usineApi}users/${e}`)}confirmUser(e,n){return this.http.patch(`${l.usineApi}users/${e}`,{isActive:n})}static \u0275fac=function(n){return new(n||t)};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var we=(()=>{class t{fb;userService;authStore=p(ve);changePasswordForm;constructor(e,n){this.fb=e,this.userService=n,this.changePasswordForm=this.fb.group({newPassword:["",oe.required]})}confirmChangePasswordClick(){let e=this.authStore.user();e.password=this.changePasswordForm.get("newPassword").value,this.userService.updateUser(e)}onSubmit(){}static \u0275fac=function(n){return new(n||t)(d(pe),d(N))};static \u0275cmp=b({type:t,selectors:[["app-change-password"]],standalone:!0,features:[w],decls:22,vars:2,consts:[[3,"ngSubmit","formGroup"],["color","dark"],["formControlName","newPassword","type","password",3,"value"],["slot","end","name","checkmark-outline"],["formControlName","password","type","password",3,"value"],["color","success","slot","end","name","checkmark-done-outline"],["color","light"],["slot","end"],["fill","solid",3,"click","disabled"],["slot","end","name","airplane"]],template:function(n,o){n&1&&(r(0,"form",0),f("ngSubmit",function(){return o.onSubmit()}),r(1,"ion-header")(2,"ion-toolbar",1)(3,"ion-title"),s(4,"Changement du mot de passe"),i()()(),r(5,"ion-content")(6,"ion-item")(7,"ion-label"),s(8,"Nouveau mot de passe"),i(),a(9,"ion-input",2)(10,"ion-icon",3),i(),r(11,"ion-item")(12,"ion-label"),s(13,"Confirmer mot de passe"),i(),a(14,"ion-input",4)(15,"ion-icon",5),i()(),r(16,"ion-footer")(17,"ion-toolbar",6)(18,"ion-buttons",7)(19,"ion-button",8),f("click",function(){return o.confirmChangePasswordClick()}),a(20,"ion-icon",9),s(21," Confirmer "),i()()()()()),n&2&&(u("formGroup",o.changePasswordForm),c(19),u("disabled",o.changePasswordForm.invalid))},dependencies:[ue,le,se,ae,ce,me,T,_,k,U,j,A,P,$,F,R,q,M,x]})}return t})();function xe(t,_e){if(t&1){let e=te();Z(0),r(1,"ion-content")(2,"ion-item")(3,"ion-label"),s(4,"Nom"),i(),a(5,"ion-input",4),i(),r(6,"ion-item")(7,"ion-label"),s(8,"Pr\xE9nom"),i(),a(9,"ion-input",4),i(),r(10,"ion-item")(11,"ion-label"),s(12,"Matricule"),i(),a(13,"ion-input",5)(14,"ion-icon",6),i(),r(15,"ion-item")(16,"ion-label"),s(17,"E-Mail"),i(),a(18,"ion-input",5)(19,"ion-icon",6),i(),r(20,"ion-item")(21,"ion-label"),s(22,"T\xE9l\xE9phone"),i(),a(23,"ion-input",4),i(),r(24,"ion-item")(25,"ion-label"),s(26,"Date de cr\xE9ation"),i(),a(27,"ion-input",5),B(28,"date"),a(29,"ion-icon",6),i(),r(30,"ion-item")(31,"ion-label"),s(32,"Date de derni\xE8re connexion"),i(),a(33,"ion-input",5),B(34,"date"),a(35,"ion-icon",6),i(),r(36,"ion-item")(37,"ion-label"),s(38,"Site"),i(),r(39,"ion-label"),s(40),i(),a(41,"ion-icon",6),i(),r(42,"ion-item")(43,"ion-label"),s(44,"Service"),i(),r(45,"ion-label"),s(46),i(),a(47,"ion-icon",6),i(),r(48,"ion-item")(49,"ion-label"),s(50,"Division"),i(),r(51,"ion-label"),s(52),i(),a(53,"ion-icon",6),i()(),r(54,"ion-footer")(55,"ion-toolbar")(56,"ion-buttons",1)(57,"ion-button",7),f("click",function(){D(e);let o=C();return V(o.updatePasswordClick())}),r(58,"label"),s(59,"Changer mot de passe"),i(),a(60,"ion-icon",8),i()(),r(61,"ion-buttons",9)(62,"ion-button",7),f("click",function(){D(e);let o=C();return V(o.updateUserClick())}),r(63,"label"),s(64,"Enregistrer"),i(),a(65,"ion-icon",10),i()()()(),ee()}if(t&2){let e=C();c(5),u("value",e.user.nom),c(4),u("value",e.user.prenom),c(4),u("value",e.user.matricule),c(5),u("value",e.user.mail),c(5),u("value",e.user.tel),c(4),u("value",O(28,10,e.user.createdAt)),c(6),u("value",O(34,12,e.user.lastCon)),c(7),E(e.user.site.nom),c(6),E(e.user.service.nom),c(6),E(e.user.unite.nom)}}var vt=(()=>{class t{loadingService;alertService;userService;modalCtrl;user;stateChangeEv=new X;constructor(e,n,o,g){this.loadingService=e,this.alertService=n,this.userService=o,this.modalCtrl=g}updateUserClick(){this.loadingService.startLoading("Mise \xE0 jour de l'utilisateur"),this.userService.updateUser(this.user).subscribe(e=>{console.log(e),this.loadingService.stopLoading()},e=>{console.error(e),this.loadingService.stopLoading(),this.alertService.simpleAlert("Erreur serveur","Probl\xE8me lors de la mise \xE0 jour","L'utilisateur n'a pas \xE9t\xE9 modifi\xE9. Veuillez recommencer.")})}deleteUserClick(){this.loadingService.startLoading("Suppression de l'utilisateur"),this.userService.deleteUser(this.user.id).subscribe(()=>{this.loadingService.stopLoading()},e=>{this.alertService.simpleAlert("Erreur","Suppression d'un utilisateur","Une erreur est survenue pendant la suppression de l'utilisateur. "+e.message),this.loadingService.stopLoading()})}closeUserSheetClick(){this.modalCtrl.dismiss()}updatePasswordClick(){return J(this,null,function*(){(yield this.modalCtrl.create({component:we,cssClass:"modal-adjusted"})).present()})}static \u0275fac=function(n){return new(n||t)(d(L),d(fe),d(N),d(de))};static \u0275cmp=b({type:t,selectors:[["app-user-sheet"]],inputs:{user:"user"},outputs:{stateChangeEv:"stateChangeEv"},standalone:!0,features:[w],decls:6,vars:1,consts:[["color","dark"],["slot","start"],["slot","end","name","close-circle","size","large",3,"click"],[4,"ngIf"],["type","text",3,"value"],["disabled","true","type","text",3,"value"],["slot","end","name","lock-closed-outline"],["slot","end","size","small",3,"click"],["slot","start","name","key-outline"],["slot","end"],["slot","start","name","save-outline"]],template:function(n,o){n&1&&(r(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),s(3," Fiche utilisateur"),i(),r(4,"ion-icon",2),f("click",function(){return o.closeUserSheetClick()}),i()()(),Y(5,xe,66,14,"ng-container",3)),n&2&&(c(5),u("ngIf",o.user))},dependencies:[T,_,k,U,j,A,P,$,F,R,q,M,x,ne,re],styles:["ion-content[_ngcontent-%COMP%]{height:50%}"]})}return t})();export{Se as a,be as b,Ie as c,he as d,N as e,vt as f};
