import{a as pa,b as fa,c as ha}from"./chunk-6A4FWNE2.js";import{b as ma,c as ga,d as ya,e as _a,f as xa,g as ba,h as Ca,i as va,j as Sa,k as wa,l as Ma,m as Ia,n as Ea,o as ka}from"./chunk-CXXEHQF3.js";import{a as lt,b as wo}from"./chunk-NHMY2DF4.js";import{a as pe,c as Ta,d as Oa,e as Da}from"./chunk-TXCEEY6F.js";import{A as Ul,B as fo,C as ho,D as mo,E as Rn,F as Dt,I as go,J as yo,K as _o,L as xo,M as Wl,P as Gl,R as Kl,S as Jl,X as aa,Z as ua,a as Nl,b as Rl,c as Al,d as Pl,f as Fl,g as so,h as Ll,i as Bl,j as zl,k as ql,l as lo,m as Re,p as ao,q as co,r as On,s as Dn,t as Vl,u as uo,v as Nn,w as po,x as Hl,y as $l,z as jl}from"./chunk-FQQ5WWCJ.js";import{d as So,e as Un}from"./chunk-4JAIPXOG.js";import{a as ca}from"./chunk-GESKWM6K.js";import{$a as hi,$d as ia,Aa as Qi,Ab as Il,Ad as Bn,B as pi,Ba as Xi,Bb as El,Bd as we,C as Ui,Ca as Zi,Cb as yt,D as ye,Da as f,Db as Ot,Dd as At,Ea as p,Eb as kl,Ed as Pe,F as pl,Fa as S,Fb as to,Fd as Zl,G as Z,Ga as G,Gb as Tr,Gc as oo,Gd as ea,H as Wi,Ha as K,Hc as Dl,I as Gi,Ia as _l,Ic as Or,J as Cn,Ja as H,Jb as In,Jc as $,K as T,Ka as xl,Kc as Je,Kd as Me,L as O,La as E,Lc as Ye,Ld as zn,M as Ki,Ma as v,Mc as yi,Md as ta,N as Ji,Na as Mr,Nc as Te,O as fl,Oa as Ir,Pc as Qe,Pd as na,Qa as Ue,Qb as Tl,Qc as Xe,R as hl,Ra as We,Rb as Yt,Rc as En,S as Et,Sa as Ge,Sb as no,Sc as Ze,T as R,Ta as gt,Tc as kn,U as A,Ua as y,Ub as io,Ud as qn,Va as ee,Vb as Ol,Vc as ro,Wa as F,Xa as bl,Xc as tt,Xd as Vn,Y as Sr,Ya as Cl,Yc as Tn,Yd as Hn,Z as ml,Za as Er,_ as ie,_a as vl,_d as Co,a as al,aa as vn,ab as L,ae as Pt,ba as Gt,bb as mi,be as oa,c as He,ca as Kt,cb as Jt,ce as st,d as $i,db as eo,e as Cr,eb as D,f as ji,fa as Sn,fb as B,ga as gl,gb as Tt,ge as ra,ha as fi,hb as Sl,hd as Yl,he as sa,i as $e,ia as _,id as Nt,ie as la,j as mt,ja as P,jd as Rt,k as cl,kb as wl,l as dl,le as J,ma as yl,me as $n,nd as Ae,ne as jn,o as vr,od as An,oe as vo,pa as Q,pb as kr,pd as nt,pe as da,qb as Ke,qd as it,ra as Yi,rb as Mn,rd as ot,sa as M,sb as Ml,sd as bo,t as Se,td as Pn,u as ul,ua as wr,va as x,vd as Fn,wa as wn,wd as rt,x as bn,xa as kt,xb as gi,xd as Ql,ya as je,yb as re,yd as Xl,z as Wt,zb as Y,zd as Ln}from"./chunk-U2GCEKKH.js";import"./chunk-XOPHGSMQ.js";import"./chunk-QUJFQN2Y.js";import"./chunk-7KG7SC73.js";import"./chunk-UINM2UFW.js";import"./chunk-MIBXNQ3H.js";import"./chunk-W7C3YL7V.js";import"./chunk-YXSG4PXW.js";import"./chunk-7KGURMOZ.js";import"./chunk-Z5EWWMJI.js";import"./chunk-PGGMNVKM.js";import"./chunk-4JISMLMH.js";import"./chunk-LQXFU6KZ.js";import"./chunk-C3V3U5PU.js";import"./chunk-C7XSXIEG.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-A2DMYIQX.js";import"./chunk-CKP3SGE2.js";import"./chunk-6GY5YBTO.js";import"./chunk-WVRPG2JR.js";import"./chunk-VEGO2JNG.js";import"./chunk-D3MN2HBL.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-L7HKPRYE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as V,b as ae,h as br}from"./chunk-B4AJQJMI.js";var ip=["menuTool"];function op(i,t){if(i&1&&(f(0,"ion-badge",12),y(1),p()),i&2){let e=v();_(),F("New ",e.newRequests,"")}}function rp(i,t){if(i&1&&(f(0,"ion-badge",12),y(1),p()),i&2){let e=t.ngIf;_(),F("New ",e.length,"")}}function sp(i,t){if(i&1&&(f(0,"ion-item-group")(1,"ion-item-divider")(2,"ion-label",3),y(3,"L'\xE9quipe"),p()(),f(4,"ion-menu-toggle",4)(5,"ion-item",13)(6,"ion-label"),y(7," Gestion de l'\xE9quipe "),p(),M(8,rp,2,1,"ion-badge",9),D(9,"async"),p()(),f(10,"ion-menu-toggle",4)(11,"ion-item",13)(12,"ion-label"),y(13," Indicateurs "),p()()()()),i&2){let e=v();_(5),x("button",!0)("routerLink","manage-tool-team"),_(3),x("ngIf",B(9,5,e.newUsers$)),_(3),x("button",!0)("routerLink","tool-indicators")}}var Na=(()=>{class i{userService=T(Un);authStore=T(vo);roleGuard=T(lt);menu;newRequests;isManager=!1;newUsers$;ngOnInit(){this.buildManagerPage()}loadIndicators(){this.newUsers$=this.userService.getUsersByService("5")}buildManagerPage(){this.isManager=this.roleGuard.isRole(["ROLE_ADMIN","ROLE_RESP_OUTIL","ROLE_CE_OUTIL"])&&this.authStore.user().isActive,this.isManager&&this.loadIndicators()}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-tool-request-menu"]],viewQuery:function(n,o){if(n&1&&Ue(ip,5),n&2){let r;We(r=Ge())&&(o.menu=r.first)}},standalone:!0,features:[L],decls:36,vars:9,consts:[["menuTool",""],["menuId","main-menu","open","true","side","start","type","push","contentId","tooling-content"],["color","succes"],["color","secondary"],["auto-hide","true"],["button","","routerLink","/tooling/new-tool",3,"disabled"],["button","","routerLink","/tooling/repair"],["button","","routerLink","/tooling/3d"],["routerLink","/tooling/requests",3,"button"],["color","danger",4,"ngIf"],["routerDirection","forward",3,"disabled","button","routerLink"],[4,"ngIf"],["color","danger"],["routerDirection","forward",3,"button","routerLink"]],template:function(n,o){n&1&&(f(0,"ion-menu",1,0)(2,"ion-header")(3,"ion-toolbar",2)(4,"ion-title"),y(5," Menu outillage "),p()()(),f(6,"ion-content")(7,"ion-list")(8,"ion-item-divider")(9,"ion-label",3),y(10,"Faire une demande"),p()(),f(11,"ion-menu-toggle",4)(12,"ion-item",5)(13,"ion-label"),y(14," Nouvel outillage (SBO) "),p()()(),f(15,"ion-menu-toggle",4)(16,"ion-item",6)(17,"ion-label"),y(18," Maintenance et r\xE9paration "),p()()(),f(19,"ion-menu-toggle",4)(20,"ion-item",7)(21,"ion-label"),y(22," Contr\xF4le 3D "),p()()(),f(23,"ion-item-divider")(24,"ion-label",3),y(25,"Suivi"),p()(),f(26,"ion-menu-toggle",4)(27,"ion-item",8)(28,"ion-label"),y(29," Liste des demandes outillages "),p(),M(30,op,2,1,"ion-badge",9),p()(),f(31,"ion-menu-toggle",4)(32,"ion-item",10)(33,"ion-label"),y(34," Liste des outillages "),p()()(),M(35,sp,14,7,"ion-item-group",11),p()()()),n&2&&(_(12),wn("boder-right","solid 4px yellow"),x("disabled",!1),_(15),x("button",!0),_(3),x("ngIf",o.newRequests&&o.isManager),_(2),x("disabled",!0)("button",!0)("routerLink","tool-list"),_(3),x("ngIf",o.isManager))},dependencies:[po,$l,Re,Ol,Y,yt,On,Dt,Rn,Vl,Nn,jl,Fl,Dn,uo]})}return i})();var Ra=(()=>{class i{titleService=T(ca);ionViewWillEnter(){this.titleService.setTitle("MODULE OUTILLAGE")}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-tooling"]],standalone:!0,features:[L],decls:4,vars:0,consts:[["title","OUTILLAGE"],["color","medium"],["id","tooling-content"]],template:function(n,o){n&1&&(S(0,"app-shared-user-header",0),f(1,"ion-content",1),S(2,"app-tool-request-menu")(3,"ion-router-outlet",2),p())},dependencies:[Re,Nl,ua,Na]})}return i})();var Aa=i=>typeof i>"u"||i===null,lp=i=>i.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`),ap=i=>{let t={};return Object.keys(i).forEach(e=>{i[e]&&(t[e]=i[e])}),t},Mo=i=>{let t=ap(i);return Object.entries(t).map(([e,n])=>`${lp(e)}:${n}`).join(";")},Wn=class extends Error{constructor(t){super(t),this.name=this.constructor.name}},Dr=()=>{let i=Date.now().toString(36),t=Math.random().toString(36).substring(2,7);return`${i}${t}`},Pa=(i,t,e)=>Math.min(Math.max(i,t),e);function fe(i){this.content=i}fe.prototype={constructor:fe,find:function(i){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===i)return t;return-1},get:function(i){var t=this.find(i);return t==-1?void 0:this.content[t+1]},update:function(i,t,e){var n=e&&e!=i?this.remove(e):this,o=n.find(i),r=n.content.slice();return o==-1?r.push(e||i,t):(r[o+1]=t,e&&(r[o]=e)),new fe(r)},remove:function(i){var t=this.find(i);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new fe(e)},addToStart:function(i,t){return new fe([i,t].concat(this.remove(i).content))},addToEnd:function(i,t){var e=this.remove(i).content.slice();return e.push(i,t),new fe(e)},addBefore:function(i,t,e){var n=this.remove(t),o=n.content.slice(),r=n.find(i);return o.splice(r==-1?o.length:r,0,t,e),new fe(o)},forEach:function(i){for(var t=0;t<this.content.length;t+=2)i(this.content[t],this.content[t+1])},prepend:function(i){return i=fe.from(i),i.size?new fe(i.content.concat(this.subtract(i).content)):this},append:function(i){return i=fe.from(i),i.size?new fe(this.subtract(i).content.concat(i.content)):this},subtract:function(i){var t=this;i=fe.from(i);for(var e=0;e<i.content.length;e+=2)t=t.remove(i.content[e]);return t},toObject:function(){var i={};return this.forEach(function(t,e){i[t]=e}),i},get size(){return this.content.length>>1}};fe.from=function(i){if(i instanceof fe)return i;var t=[];if(i)for(var e in i)t.push(e,i[e]);return new fe(t)};var Nr=fe;function Ua(i,t,e){for(let n=0;;n++){if(n==i.childCount||n==t.childCount)return i.childCount==t.childCount?null:e;let o=i.child(n),r=t.child(n);if(o==r){e+=o.nodeSize;continue}if(!o.sameMarkup(r))return e;if(o.isText&&o.text!=r.text){for(let s=0;o.text[s]==r.text[s];s++)e++;return e}if(o.content.size||r.content.size){let s=Ua(o.content,r.content,e+1);if(s!=null)return s}e+=o.nodeSize}}function Wa(i,t,e,n){for(let o=i.childCount,r=t.childCount;;){if(o==0||r==0)return o==r?null:{a:e,b:n};let s=i.child(--o),l=t.child(--r),a=s.nodeSize;if(s==l){e-=a,n-=a;continue}if(!s.sameMarkup(l))return{a:e,b:n};if(s.isText&&s.text!=l.text){let c=0,d=Math.min(s.text.length,l.text.length);for(;c<d&&s.text[s.text.length-c-1]==l.text[l.text.length-c-1];)c++,e--,n--;return{a:e,b:n}}if(s.content.size||l.content.size){let c=Wa(s.content,l.content,e-1,n-1);if(c)return c}e-=a,n-=a}}var w=class i{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,o=0,r){for(let s=0,l=0;l<e;s++){let a=this.content[s],c=l+a.nodeSize;if(c>t&&n(a,o+l,r||null,s)!==!1&&a.content.size){let d=l+1;a.nodesBetween(Math.max(0,t-d),Math.min(a.content.size,e-d),n,o+d)}l=c}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,o){let r="",s=!0;return this.nodesBetween(t,e,(l,a)=>{let c=l.isText?l.text.slice(Math.max(t,a)-a,e-a):l.isLeaf?o?typeof o=="function"?o(l):o:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&c||l.isTextblock)&&n&&(s?s=!1:r+=n),r+=c},0),r}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,o=this.content.slice(),r=0;for(e.isText&&e.sameMarkup(n)&&(o[o.length-1]=e.withText(e.text+n.text),r=1);r<t.content.length;r++)o.push(t.content[r]);return new i(o,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let n=[],o=0;if(e>t)for(let r=0,s=0;s<e;r++){let l=this.content[r],a=s+l.nodeSize;a>t&&((s<t||a>e)&&(l.isText?l=l.cut(Math.max(0,t-s),Math.min(l.text.length,e-s)):l=l.cut(Math.max(0,t-s-1),Math.min(l.content.size,e-s-1))),n.push(l),o+=l.nodeSize),s=a}return new i(n,o)}cutByIndex(t,e){return t==e?i.empty:t==0&&e==this.content.length?this:new i(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let o=this.content.slice(),r=this.size+e.nodeSize-n.nodeSize;return o[t]=e,new i(o,r)}addToStart(t){return new i([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new i(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let o=this.content[e];t(o,n,e),n+=o.nodeSize}}findDiffStart(t,e=0){return Ua(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return Wa(this,t,e,n)}findIndex(t){if(t==0)return Io(0,t);if(t==this.size)return Io(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let e=0,n=0;;e++){let o=this.child(e),r=n+o.nodeSize;if(r>=t)return r==t?Io(e+1,r):Io(e,n);n=r}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return i.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new i(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return i.empty;let e,n=0;for(let o=0;o<t.length;o++){let r=t[o];n+=r.nodeSize,o&&r.isText&&t[o-1].sameMarkup(r)?(e||(e=t.slice(0,o)),e[e.length-1]=r.withText(e[e.length-1].text+r.text)):e&&e.push(r)}return new i(e||t,n)}static from(t){if(!t)return i.empty;if(t instanceof i)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new i([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};w.empty=new w([],0);var Rr={index:0,offset:0};function Io(i,t){return Rr.index=i,Rr.offset=t,Rr}function ko(i,t){if(i===t)return!0;if(!(i&&typeof i=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(i);if(Array.isArray(t)!=e)return!1;if(e){if(i.length!=t.length)return!1;for(let n=0;n<i.length;n++)if(!ko(i[n],t[n]))return!1}else{for(let n in i)if(!(n in t)||!ko(i[n],t[n]))return!1;for(let n in t)if(!(n in i))return!1}return!0}var W=(()=>{class i{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,o=!1;for(let r=0;r<e.length;r++){let s=e[r];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,r));else{if(s.type.excludes(this.type))return e;!o&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,r)),n.push(this),o=!0),n&&n.push(s)}}return n||(n=e.slice()),o||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ko(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let o=e.marks[n.type];if(!o)throw new RangeError(`There is no mark type ${n.type} in this schema`);let r=o.create(n.attrs);return o.checkAttrs(r.attrs),r}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let o=0;o<e.length;o++)if(!e[o].eq(n[o]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return i.none;if(e instanceof i)return[e];let n=e.slice();return n.sort((o,r)=>o.type.rank-r.type.rank),n}}return i.none=[],i})(),Zt=class extends Error{},I=class i{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=Ka(this.content,t+this.openStart,e);return n&&new i(n,this.openStart,this.openEnd)}removeBetween(t,e){return new i(Ga(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return i.empty;let n=e.openStart||0,o=e.openEnd||0;if(typeof n!="number"||typeof o!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new i(w.fromJSON(t,e.content),n,o)}static maxOpen(t,e=!0){let n=0,o=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let r=t.lastChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.lastChild)o++;return new i(t,n,o)}};I.empty=new I(w.empty,0,0);function Ga(i,t,e){let{index:n,offset:o}=i.findIndex(t),r=i.maybeChild(n),{index:s,offset:l}=i.findIndex(e);if(o==t||r.isText){if(l!=e&&!i.child(s).isText)throw new RangeError("Removing non-flat range");return i.cut(0,t).append(i.cut(e))}if(n!=s)throw new RangeError("Removing non-flat range");return i.replaceChild(n,r.copy(Ga(r.content,t-o-1,e-o-1)))}function Ka(i,t,e,n){let{index:o,offset:r}=i.findIndex(t),s=i.maybeChild(o);if(r==t||s.isText)return n&&!n.canReplace(o,o,e)?null:i.cut(0,t).append(e).append(i.cut(t));let l=Ka(s.content,t-r-1,e,s);return l&&i.replaceChild(o,s.copy(l))}function cp(i,t,e){if(e.openStart>i.depth)throw new Zt("Inserted content deeper than insertion position");if(i.depth-e.openStart!=t.depth-e.openEnd)throw new Zt("Inconsistent open depths");return Ja(i,t,e,0)}function Ja(i,t,e,n){let o=i.index(n),r=i.node(n);if(o==t.index(n)&&n<i.depth-e.openStart){let s=Ja(i,t,e,n+1);return r.copy(r.content.replaceChild(o,s))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&i.depth==n&&t.depth==n){let s=i.parent,l=s.content;return Xt(s,l.cut(0,i.parentOffset).append(e.content).append(l.cut(t.parentOffset)))}else{let{start:s,end:l}=dp(e,i);return Xt(r,Qa(i,s,l,t,n))}else return Xt(r,To(i,t,n))}function Ya(i,t){if(!t.type.compatibleContent(i.type))throw new Zt("Cannot join "+t.type.name+" onto "+i.type.name)}function Pr(i,t,e){let n=i.node(e);return Ya(n,t.node(e)),n}function Qt(i,t){let e=t.length-1;e>=0&&i.isText&&i.sameMarkup(t[e])?t[e]=i.withText(t[e].text+i.text):t.push(i)}function _i(i,t,e,n){let o=(t||i).node(e),r=0,s=t?t.index(e):o.childCount;i&&(r=i.index(e),i.depth>e?r++:i.textOffset&&(Qt(i.nodeAfter,n),r++));for(let l=r;l<s;l++)Qt(o.child(l),n);t&&t.depth==e&&t.textOffset&&Qt(t.nodeBefore,n)}function Xt(i,t){return i.type.checkContent(t),i.copy(t)}function Qa(i,t,e,n,o){let r=i.depth>o&&Pr(i,t,o+1),s=n.depth>o&&Pr(e,n,o+1),l=[];return _i(null,i,o,l),r&&s&&t.index(o)==e.index(o)?(Ya(r,s),Qt(Xt(r,Qa(i,t,e,n,o+1)),l)):(r&&Qt(Xt(r,To(i,t,o+1)),l),_i(t,e,o,l),s&&Qt(Xt(s,To(e,n,o+1)),l)),_i(n,null,o,l),new w(l)}function To(i,t,e){let n=[];if(_i(null,i,e,n),i.depth>e){let o=Pr(i,t,e+1);Qt(Xt(o,To(i,t,e+1)),n)}return _i(t,null,e,n),new w(n)}function dp(i,t){let e=t.depth-i.openStart,o=t.node(e).copy(i.content);for(let r=e-1;r>=0;r--)o=t.node(r).copy(w.from(o));return{start:o.resolveNoCache(i.openStart+e),end:o.resolveNoCache(o.content.size-i.openEnd-e)}}var Oo=class i{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],o=t.child(e);return n?t.child(e).cut(n):o}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[e*3],o=e==0?0:this.path[e*3-1]+1;for(let r=0;r<t;r++)o+=n.child(r).nodeSize;return o}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return W.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),o=t.maybeChild(e);if(!n){let l=n;n=o,o=l}let r=n.marks;for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!o||!r[s].isInSet(o.marks))&&(r=r[s--].removeFromSet(r));return r}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,o=t.parent.maybeChild(t.index());for(var r=0;r<n.length;r++)n[r].type.spec.inclusive===!1&&(!o||!n[r].isInSet(o.marks))&&(n=n[r--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new en(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],o=0,r=e;for(let s=t;;){let{index:l,offset:a}=s.content.findIndex(r),c=r-a;if(n.push(s,l,o+a),!c||(s=s.child(l),s.isText))break;r=c-1,o+=a+1}return new i(e,n,r)}static resolveCached(t,e){let n=Fa.get(t);if(n)for(let r=0;r<n.elts.length;r++){let s=n.elts[r];if(s.pos==e)return s}else Fa.set(t,n=new Fr);let o=n.elts[n.i]=i.resolve(t,e);return n.i=(n.i+1)%up,o}},Fr=class{constructor(){this.elts=[],this.i=0}},up=12,Fa=new WeakMap,en=class{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},pp=Object.create(null),at=class i{constructor(t,e,n,o=W.none){this.type=t,this.attrs=e,this.marks=o,this.content=n||w.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,o=0){this.content.nodesBetween(t,e,n,o,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,o){return this.content.textBetween(t,e,n,o)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&ko(this.attrs,e||t.defaultAttrs||pp)&&W.sameSet(this.marks,n||W.none)}copy(t=null){return t==this.content?this:new i(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new i(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return I.empty;let o=this.resolve(t),r=this.resolve(e),s=n?0:o.sharedDepth(e),l=o.start(s),c=o.node(s).content.cut(o.pos-l,r.pos-l);return new I(c,o.depth-s,r.depth-s)}replace(t,e,n){return cp(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:o}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(o==t||e.isText)return e;t-=o+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let o=this.content.child(e-1);return{node:o,index:e-1,offset:n-o.nodeSize}}resolve(t){return Oo.resolveCached(this,t)}resolveNoCache(t){return Oo.resolve(this,t)}rangeHasMark(t,e,n){let o=!1;return e>t&&this.nodesBetween(t,e,r=>(n.isInSet(r.marks)&&(o=!0),!o)),o}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Xa(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=w.empty,o=0,r=n.childCount){let s=this.contentMatchAt(t).matchFragment(n,o,r),l=s&&s.matchFragment(this.content,e);if(!l||!l.validEnd)return!1;for(let a=o;a<r;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(t,e,n,o){if(o&&!this.type.allowsMarks(o))return!1;let r=this.contentMatchAt(t).matchType(n),s=r&&r.matchFragment(this.content,e);return s?s.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=W.none;for(let e=0;e<this.marks.length;e++){let n=this.marks[e];n.type.checkAttrs(n.attrs),t=n.addToSet(t)}if(!W.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let o=w.fromJSON(t,e.content),r=t.nodeType(e.type).create(e.attrs,o,n);return r.type.checkAttrs(r.attrs),r}};at.prototype.text=void 0;var Lr=class i extends at{constructor(t,e,n,o){if(super(t,e,null,o),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Xa(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new i(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new i(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return t==0&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}};function Xa(i,t){for(let e=i.length-1;e>=0;e--)t=i[e].type.name+"("+t+")";return t}var tn=class i{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new Br(t,e);if(n.next==null)return i.empty;let o=Za(n);n.next&&n.err("Unexpected trailing text");let r=xp(_p(o));return bp(r,n),r}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let o=this;for(let r=e;o&&r<n;r++)o=o.matchType(t.child(r).type);return o}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let o=[this];function r(s,l){let a=s.matchFragment(t,n);if(a&&(!e||a.validEnd))return w.from(l.map(c=>c.createAndFill()));for(let c=0;c<s.next.length;c++){let{type:d,next:u}=s.next[c];if(!(d.isText||d.hasRequiredAttrs())&&o.indexOf(u)==-1){o.push(u);let h=r(u,l.concat(d));if(h)return h}}return null}return r(this,[])}findWrapping(t){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let o=n.shift(),r=o.match;if(r.matchType(t)){let s=[];for(let l=o;l.type;l=l.via)s.push(l.type);return s.reverse()}for(let s=0;s<r.next.length;s++){let{type:l,next:a}=r.next[s];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in e)&&(!o.type||a.validEnd)&&(n.push({match:l.contentMatch,type:l,via:o}),e[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(n){t.push(n);for(let o=0;o<n.next.length;o++)t.indexOf(n.next[o].next)==-1&&e(n.next[o].next)}return e(this),t.map((n,o)=>{let r=o+(n.validEnd?"*":" ")+" ";for(let s=0;s<n.next.length;s++)r+=(s?", ":"")+n.next[s].type.name+"->"+t.indexOf(n.next[s].next);return r}).join(`
`)}};tn.empty=new tn(!0);var Br=class{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}};function Za(i){let t=[];do t.push(fp(i));while(i.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function fp(i){let t=[];do t.push(hp(i));while(i.next&&i.next!=")"&&i.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function hp(i){let t=yp(i);for(;;)if(i.eat("+"))t={type:"plus",expr:t};else if(i.eat("*"))t={type:"star",expr:t};else if(i.eat("?"))t={type:"opt",expr:t};else if(i.eat("{"))t=mp(i,t);else break;return t}function La(i){/\D/.test(i.next)&&i.err("Expected number, got '"+i.next+"'");let t=Number(i.next);return i.pos++,t}function mp(i,t){let e=La(i),n=e;return i.eat(",")&&(i.next!="}"?n=La(i):n=-1),i.eat("}")||i.err("Unclosed braced range"),{type:"range",min:e,max:n,expr:t}}function gp(i,t){let e=i.nodeTypes,n=e[t];if(n)return[n];let o=[];for(let r in e){let s=e[r];s.isInGroup(t)&&o.push(s)}return o.length==0&&i.err("No node type or group '"+t+"' found"),o}function yp(i){if(i.eat("(")){let t=Za(i);return i.eat(")")||i.err("Missing closing paren"),t}else if(/\W/.test(i.next))i.err("Unexpected token '"+i.next+"'");else{let t=gp(i,i.next).map(e=>(i.inline==null?i.inline=e.isInline:i.inline!=e.isInline&&i.err("Mixing inline and block content"),{type:"name",value:e}));return i.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function _p(i){let t=[[]];return o(r(i,0),e()),t;function e(){return t.push([])-1}function n(s,l,a){let c={term:a,to:l};return t[s].push(c),c}function o(s,l){s.forEach(a=>a.to=l)}function r(s,l){if(s.type=="choice")return s.exprs.reduce((a,c)=>a.concat(r(c,l)),[]);if(s.type=="seq")for(let a=0;;a++){let c=r(s.exprs[a],l);if(a==s.exprs.length-1)return c;o(c,l=e())}else if(s.type=="star"){let a=e();return n(l,a),o(r(s.expr,a),a),[n(a)]}else if(s.type=="plus"){let a=e();return o(r(s.expr,l),a),o(r(s.expr,a),a),[n(a)]}else{if(s.type=="opt")return[n(l)].concat(r(s.expr,l));if(s.type=="range"){let a=l;for(let c=0;c<s.min;c++){let d=e();o(r(s.expr,a),d),a=d}if(s.max==-1)o(r(s.expr,a),a);else for(let c=s.min;c<s.max;c++){let d=e();n(a,d),o(r(s.expr,a),d),a=d}return[n(a)]}else{if(s.type=="name")return[n(l,void 0,s.value)];throw new Error("Unknown expr type")}}}}function ec(i,t){return t-i}function Ba(i,t){let e=[];return n(t),e.sort(ec);function n(o){let r=i[o];if(r.length==1&&!r[0].term)return n(r[0].to);e.push(o);for(let s=0;s<r.length;s++){let{term:l,to:a}=r[s];!l&&e.indexOf(a)==-1&&n(a)}}}function xp(i){let t=Object.create(null);return e(Ba(i,0));function e(n){let o=[];n.forEach(s=>{i[s].forEach(({term:l,to:a})=>{if(!l)return;let c;for(let d=0;d<o.length;d++)o[d][0]==l&&(c=o[d][1]);Ba(i,a).forEach(d=>{c||o.push([l,c=[]]),c.indexOf(d)==-1&&c.push(d)})})});let r=t[n.join(",")]=new tn(n.indexOf(i.length-1)>-1);for(let s=0;s<o.length;s++){let l=o[s][1].sort(ec);r.next.push({type:o[s][0],next:t[l.join(",")]||e(l)})}return r}}function bp(i,t){for(let e=0,n=[i];e<n.length;e++){let o=n[e],r=!o.validEnd,s=[];for(let l=0;l<o.next.length;l++){let{type:a,next:c}=o.next[l];s.push(a.name),r&&!(a.isText||a.hasRequiredAttrs())&&(r=!1),n.indexOf(c)==-1&&n.push(c)}r&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function tc(i){let t=Object.create(null);for(let e in i){let n=i[e];if(!n.hasDefault)return null;t[e]=n.default}return t}function nc(i,t){let e=Object.create(null);for(let n in i){let o=t&&t[n];if(o===void 0){let r=i[n];if(r.hasDefault)o=r.default;else throw new RangeError("No value supplied for attribute "+n)}e[n]=o}return e}function ic(i,t,e,n){for(let o in t)if(!(o in i))throw new RangeError(`Unsupported attribute ${o} for ${e} of type ${o}`);for(let o in i){let r=i[o];r.validate&&r.validate(t[o])}}function oc(i,t){let e=Object.create(null);if(t)for(let n in t)e[n]=new zr(i,n,t[n]);return e}var Do=class i{constructor(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=oc(t,n.attrs),this.defaultAttrs=tc(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==tn.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:nc(this.attrs,t)}create(t=null,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new at(this,this.computeAttrs(t),w.from(e),W.setFrom(n))}createChecked(t=null,e,n){return e=w.from(e),this.checkContent(e),new at(this,this.computeAttrs(t),e,W.setFrom(n))}createAndFill(t=null,e,n){if(t=this.computeAttrs(t),e=w.from(e),e.size){let s=this.contentMatch.fillBefore(e);if(!s)return null;e=s.append(e)}let o=this.contentMatch.matchFragment(e),r=o&&o.fillBefore(w.empty,!0);return r?new at(this,t,e.append(r),W.setFrom(n)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){ic(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let e;for(let n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:W.none:t}static compile(t,e){let n=Object.create(null);t.forEach((r,s)=>n[r]=new i(r,e,s));let o=e.spec.topNode||"doc";if(!n[o])throw new RangeError("Schema is missing its top node type ('"+o+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let r in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function Cp(i,t,e){let n=e.split("|");return o=>{let r=o===null?"null":typeof o;if(n.indexOf(r)<0)throw new RangeError(`Expected value of type ${n} for attribute ${t} on type ${i}, got ${r}`)}}var zr=class{constructor(t,e,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?Cp(t,e,n.validate):n.validate}get isRequired(){return!this.hasDefault}},bi=class i{constructor(t,e,n,o){this.name=t,this.rank=e,this.schema=n,this.spec=o,this.attrs=oc(t,o.attrs),this.excluded=null;let r=tc(this.attrs);this.instance=r?new W(this,r):null}create(t=null){return!t&&this.instance?this.instance:new W(this,nc(this.attrs,t))}static compile(t,e){let n=Object.create(null),o=0;return t.forEach((r,s)=>n[r]=new i(r,o++,e,s)),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){ic(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}},No=class{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let o in t)e[o]=t[o];e.nodes=Nr.from(t.nodes),e.marks=Nr.from(t.marks||{}),this.nodes=Do.compile(this.spec.nodes,this),this.marks=bi.compile(this.spec.marks,this);let n=Object.create(null);for(let o in this.nodes){if(o in this.marks)throw new RangeError(o+" can not be both a node and a mark");let r=this.nodes[o],s=r.spec.content||"",l=r.spec.marks;if(r.contentMatch=n[s]||(n[s]=tn.parse(s,this.nodes)),r.inlineContent=r.contentMatch.inlineContent,r.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!r.isInline||!r.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=r}r.markSet=l=="_"?null:l?za(this,l.split(" ")):l==""||!r.inlineContent?[]:null}for(let o in this.marks){let r=this.marks[o],s=r.spec.excludes;r.excluded=s==null?[r]:s==""?[]:za(this,s.split(" "))}this.nodeFromJSON=o=>at.fromJSON(this,o),this.markFromJSON=o=>W.fromJSON(this,o),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,n,o){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof Do){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,n,o)}text(t,e){let n=this.nodes.text;return new Lr(n,n.defaultAttrs,t,W.setFrom(e))}mark(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}};function za(i,t){let e=[];for(let n=0;n<t.length;n++){let o=t[n],r=i.marks[o],s=r;if(r)e.push(r);else for(let l in i.marks){let a=i.marks[l];(o=="_"||a.spec.group&&a.spec.group.split(" ").indexOf(o)>-1)&&e.push(s=a)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}return e}function vp(i){return i.tag!=null}function Sp(i){return i.style!=null}var Ft=class i{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[];let n=this.matchedStyles=[];e.forEach(o=>{if(vp(o))this.tags.push(o);else if(Sp(o)){let r=/[^=]*/.exec(o.style)[0];n.indexOf(r)<0&&n.push(r),this.styles.push(o)}}),this.normalizeLists=!this.tags.some(o=>{if(!/^(ul|ol)\b/.test(o.tag)||!o.node)return!1;let r=t.nodes[o.node];return r.contentMatch.matchType(r)})}parse(t,e={}){let n=new Ro(this,e,!1);return n.addAll(t,W.none,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new Ro(this,e,!0);return n.addAll(t,W.none,e.from,e.to),I.maxOpen(n.finish())}matchTag(t,e,n){for(let o=n?this.tags.indexOf(n)+1:0;o<this.tags.length;o++){let r=this.tags[o];if(Ip(t,r.tag)&&(r.namespace===void 0||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){let s=r.getAttrs(t);if(s===!1)continue;r.attrs=s||void 0}return r}}}matchStyle(t,e,n,o){for(let r=o?this.styles.indexOf(o)+1:0;r<this.styles.length;r++){let s=this.styles[r],l=s.style;if(!(l.indexOf(t)!=0||s.context&&!n.matchesContext(s.context)||l.length>t.length&&(l.charCodeAt(t.length)!=61||l.slice(t.length+1)!=e))){if(s.getAttrs){let a=s.getAttrs(e);if(a===!1)continue;s.attrs=a||void 0}return s}}}static schemaRules(t){let e=[];function n(o){let r=o.priority==null?50:o.priority,s=0;for(;s<e.length;s++){let l=e[s];if((l.priority==null?50:l.priority)<r)break}e.splice(s,0,o)}for(let o in t.marks){let r=t.marks[o].spec.parseDOM;r&&r.forEach(s=>{n(s=Va(s)),s.mark||s.ignore||s.clearMark||(s.mark=o)})}for(let o in t.nodes){let r=t.nodes[o].spec.parseDOM;r&&r.forEach(s=>{n(s=Va(s)),s.node||s.ignore||s.mark||(s.node=o)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new i(t,i.schemaRules(t)))}},rc={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},wp={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},sc={ol:!0,ul:!0},Ci=1,qr=2,xi=4;function qa(i,t,e){return t!=null?(t?Ci:0)|(t==="full"?qr:0):i&&i.whitespace=="pre"?Ci|qr:e&~xi}var Gn=class{constructor(t,e,n,o,r,s){this.type=t,this.attrs=e,this.marks=n,this.solid=o,this.options=s,this.content=[],this.activeMarks=W.none,this.match=r||(s&xi?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(w.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let n=this.type.contentMatch,o;return(o=n.findWrapping(t.type))?(this.match=n,o):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&Ci)){let n=this.content[this.content.length-1],o;if(n&&n.isText&&(o=/[ \t\r\n\u000c]+$/.exec(n.text))){let r=n;n.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-o[0].length))}}let e=w.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(w.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!rc.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}},Ro=class{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let o=e.topNode,r,s=qa(null,e.preserveWhitespace,0)|(n?xi:0);o?r=new Gn(o.type,o.attrs,W.none,!0,e.topMatch||o.type.contentMatch,s):n?r=new Gn(null,null,W.none,!0,null,s):r=new Gn(t.schema.topNodeType,null,W.none,!0,null,s),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,e){t.nodeType==3?this.addTextNode(t,e):t.nodeType==1&&this.addElement(t,e)}addTextNode(t,e){let n=t.nodeValue,o=this.top,r=o.options&qr?"full":this.localPreserveWS||(o.options&Ci)>0,{schema:s}=this.parser;if(r==="full"||o.inlineContext(t)||/[^ \t\r\n\u000c]/.test(n)){if(r)if(r==="full")n=n.replace(/\r\n?/g,`
`);else if(s.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(s.linebreakReplacement.create())){let l=n.split(/\r?\n|\r/);for(let a=0;a<l.length;a++)a&&this.insertNode(s.linebreakReplacement.create(),e,!0),l[a]&&this.insertNode(s.text(l[a]),e,!/\S/.test(l[a]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let l=o.content[o.content.length-1],a=t.previousSibling;(!l||a&&a.nodeName=="BR"||l.isText&&/[ \t\r\n\u000c]$/.test(l.text))&&(n=n.slice(1))}n&&this.insertNode(s.text(n),e,!/\S/.test(n)),this.findInText(t)}else this.findInside(t)}addElement(t,e,n){let o=this.localPreserveWS,r=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let s=t.nodeName.toLowerCase(),l;sc.hasOwnProperty(s)&&this.parser.normalizeLists&&Mp(t);let a=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(l=this.parser.matchTag(t,this,n));e:if(a?a.ignore:wp.hasOwnProperty(s))this.findInside(t),this.ignoreFallback(t,e);else if(!a||a.skip||a.closeParent){a&&a.closeParent?this.open=Math.max(0,this.open-1):a&&a.skip.nodeType&&(t=a.skip);let c,d=this.needsBlock;if(rc.hasOwnProperty(s))r.content.length&&r.content[0].isInline&&this.open&&(this.open--,r=this.top),c=!0,r.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break e}let u=a&&a.skip?e:this.readStyles(t,e);u&&this.addAll(t,u),c&&this.sync(r),this.needsBlock=d}else{let c=this.readStyles(t,e);c&&this.addElementByRule(t,a,c,a.consuming===!1?l:void 0)}this.localPreserveWS=o}leafFallback(t,e){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),e)}ignoreFallback(t,e){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),e,!0)}readStyles(t,e){let n=t.style;if(n&&n.length)for(let o=0;o<this.parser.matchedStyles.length;o++){let r=this.parser.matchedStyles[o],s=n.getPropertyValue(r);if(s)for(let l=void 0;;){let a=this.parser.matchStyle(r,s,this,l);if(!a)break;if(a.ignore)return null;if(a.clearMark?e=e.filter(c=>!a.clearMark(c)):e=e.concat(this.parser.schema.marks[a.mark].create(a.attrs)),a.consuming===!1)l=a;else break}}return e}addElementByRule(t,e,n,o){let r,s;if(e.node)if(s=this.parser.schema.nodes[e.node],s.isLeaf)this.insertNode(s.create(e.attrs),n,t.nodeName=="BR")||this.leafFallback(t,n);else{let a=this.enter(s,e.attrs||null,n,e.preserveWhitespace);a&&(r=!0,n=a)}else{let a=this.parser.schema.marks[e.mark];n=n.concat(a.create(e.attrs))}let l=this.top;if(s&&s.isLeaf)this.findInside(t);else if(o)this.addElement(t,n,o);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(a=>this.insertNode(a,n,!1));else{let a=t;typeof e.contentElement=="string"?a=t.querySelector(e.contentElement):typeof e.contentElement=="function"?a=e.contentElement(t):e.contentElement&&(a=e.contentElement),this.findAround(t,a,!0),this.addAll(a,n),this.findAround(t,a,!1)}r&&this.sync(l)&&this.open--}addAll(t,e,n,o){let r=n||0;for(let s=n?t.childNodes[n]:t.firstChild,l=o==null?null:t.childNodes[o];s!=l;s=s.nextSibling,++r)this.findAtPoint(t,r),this.addDOM(s,e);this.findAtPoint(t,r)}findPlace(t,e,n){let o,r;for(let s=this.open,l=0;s>=0;s--){let a=this.nodes[s],c=a.findWrapping(t);if(c&&(!o||o.length>c.length+l)&&(o=c,r=a,!c.length))break;if(a.solid){if(n)break;l+=2}}if(!o)return null;this.sync(r);for(let s=0;s<o.length;s++)e=this.enterInner(o[s],null,e,!1);return e}insertNode(t,e,n){if(t.isInline&&this.needsBlock&&!this.top.type){let r=this.textblockFromContext();r&&(e=this.enterInner(r,null,e))}let o=this.findPlace(t,e,n);if(o){this.closeExtra();let r=this.top;r.match&&(r.match=r.match.matchType(t.type));let s=W.none;for(let l of o.concat(t.marks))(r.type?r.type.allowsMarkType(l.type):Ha(l.type,t.type))&&(s=l.addToSet(s));return r.content.push(t.mark(s)),!0}return!1}enter(t,e,n,o){let r=this.findPlace(t.create(e),n,!1);return r&&(r=this.enterInner(t,e,n,!0,o)),r}enterInner(t,e,n,o=!1,r){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(t);let l=qa(t,r,s.options);s.options&xi&&s.content.length==0&&(l|=xi);let a=W.none;return n=n.filter(c=>(s.type?s.type.allowsMarkType(c.type):Ha(c.type,t))?(a=c.addToSet(a),!1):!0),this.nodes.push(new Gn(t,e,a,o,null,l)),this.open++,n}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=Ci)}return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let o=n.length-1;o>=0;o--)t+=n[o].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let o=0;o<this.find.length;o++)this.find[o].pos==null&&t.nodeType==1&&t.contains(this.find[o].node)&&e.compareDocumentPosition(this.find[o].node)&(n?2:4)&&(this.find[o].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,o=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),r=-(n?n.depth+1:0)+(o?0:1),s=(l,a)=>{for(;l>=0;l--){let c=e[l];if(c==""){if(l==e.length-1||l==0)continue;for(;a>=r;a--)if(s(l-1,a))return!0;return!1}else{let d=a>0||a==0&&o?this.nodes[a].type:n&&a>=r?n.node(a-r).type:null;if(!d||d.name!=c&&!d.isInGroup(c))return!1;a--}}return!0};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let n=this.parser.schema.nodes[e];if(n.isTextblock&&n.defaultAttrs)return n}}};function Mp(i){for(let t=i.firstChild,e=null;t;t=t.nextSibling){let n=t.nodeType==1?t.nodeName.toLowerCase():null;n&&sc.hasOwnProperty(n)&&e?(e.appendChild(t),t=e):n=="li"?e=t:n&&(e=null)}}function Ip(i,t){return(i.matches||i.msMatchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector).call(i,t)}function Va(i){let t={};for(let e in i)t[e]=i[e];return t}function Ha(i,t){let e=t.schema.nodes;for(let n in e){let o=e[n];if(!o.allowsMarkType(i))continue;let r=[],s=l=>{r.push(l);for(let a=0;a<l.edgeCount;a++){let{type:c,next:d}=l.edge(a);if(c==t||r.indexOf(d)<0&&s(d))return!0}};if(s(o.contentMatch))return!0}}var _t=class i{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=Ar(e).createDocumentFragment());let o=n,r=[];return t.forEach(s=>{if(r.length||s.marks.length){let l=0,a=0;for(;l<r.length&&a<s.marks.length;){let c=s.marks[a];if(!this.marks[c.type.name]){a++;continue}if(!c.eq(r[l][0])||c.type.spec.spanning===!1)break;l++,a++}for(;l<r.length;)o=r.pop()[1];for(;a<s.marks.length;){let c=s.marks[a++],d=this.serializeMark(c,s.isInline,e);d&&(r.push([c,o]),o.appendChild(d.dom),o=d.contentDOM||d.dom)}}o.appendChild(this.serializeNodeInner(s,e))}),n}serializeNodeInner(t,e){let{dom:n,contentDOM:o}=Eo(Ar(e),this.nodes[t.type.name](t),null,t.attrs);if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,o)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let o=t.marks.length-1;o>=0;o--){let r=this.serializeMark(t.marks[o],t.isInline,e);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(t,e,n={}){let o=this.marks[t.type.name];return o&&Eo(Ar(n),o(t,e),null,t.attrs)}static renderSpec(t,e,n=null,o){return Eo(t,e,n,o)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new i(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=$a(t.nodes);return e.text||(e.text=n=>n.text),e}static marksFromSchema(t){return $a(t.marks)}};function $a(i){let t={};for(let e in i){let n=i[e].spec.toDOM;n&&(t[e]=n)}return t}function Ar(i){return i.document||window.document}var ja=new WeakMap;function Ep(i){let t=ja.get(i);return t===void 0&&ja.set(i,t=kp(i)),t}function kp(i){let t=null;function e(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")t||(t=[]),t.push(n);else for(let o=0;o<n.length;o++)e(n[o]);else for(let o in n)e(n[o])}return e(i),t}function Eo(i,t,e,n){if(typeof t=="string")return{dom:i.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let o=t[0],r;if(typeof o!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(r=Ep(n))&&r.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=o.indexOf(" ");s>0&&(e=o.slice(0,s),o=o.slice(s+1));let l,a=e?i.createElementNS(e,o):i.createElement(o),c=t[1],d=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){d=2;for(let u in c)if(c[u]!=null){let h=u.indexOf(" ");h>0?a.setAttributeNS(u.slice(0,h),u.slice(h+1),c[u]):u=="style"&&a.style?a.style.cssText=c[u]:a.setAttribute(u,c[u])}}for(let u=d;u<t.length;u++){let h=t[u];if(h===0){if(u<t.length-1||u>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}else{let{dom:g,contentDOM:m}=Eo(i,h,e,n);if(a.appendChild(g),m){if(l)throw new RangeError("Multiple content holes");l=m}}}return{dom:a,contentDOM:l}}var cc=65535,dc=Math.pow(2,16);function Tp(i,t){return i+t*dc}function lc(i){return i&cc}function Op(i){return(i-(i&cc))/dc}var uc=1,pc=2,Ao=4,fc=8,wi=class{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(this.delInfo&fc)>0}get deletedBefore(){return(this.delInfo&(uc|Ao))>0}get deletedAfter(){return(this.delInfo&(pc|Ao))>0}get deletedAcross(){return(this.delInfo&Ao)>0}},xt=class i{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&i.empty)return i.empty}recover(t){let e=0,n=lc(t);if(!this.inverted)for(let o=0;o<n;o++)e+=this.ranges[o*3+2]-this.ranges[o*3+1];return this.ranges[n*3]+e+Op(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let o=0,r=this.inverted?2:1,s=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?o:0);if(a>t)break;let c=this.ranges[l+r],d=this.ranges[l+s],u=a+c;if(t<=u){let h=c?t==a?-1:t==u?1:e:e,g=a+o+(h<0?0:d);if(n)return g;let m=t==(e<0?a:u)?null:Tp(l/3,t-a),b=t==a?pc:t==u?uc:Ao;return(e<0?t!=a:t!=u)&&(b|=fc),new wi(g,b,m)}o+=d-c}return n?t+o:new wi(t+o,0,null)}touches(t,e){let n=0,o=lc(e),r=this.inverted?2:1,s=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?n:0);if(a>t)break;let c=this.ranges[l+r],d=a+c;if(t<=d&&l==o*3)return!0;n+=this.ranges[l+s]-c}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let o=0,r=0;o<this.ranges.length;o+=3){let s=this.ranges[o],l=s-(this.inverted?r:0),a=s+(this.inverted?0:r),c=this.ranges[o+e],d=this.ranges[o+n];t(l,l+c,a,a+d),r+=d-c}}invert(){return new i(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?i.empty:new i(t<0?[0,-t,0]:[0,0,t])}};xt.empty=new xt([]);var Mi=class i{constructor(t,e,n=0,o=t?t.length:0){this.mirror=e,this.from=n,this.to=o,this._maps=t||[],this.ownData=!(t||e)}get maps(){return this._maps}slice(t=0,e=this.maps.length){return new i(this._maps,this.mirror,t,e)}appendMap(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),e!=null&&this.setMirror(this._maps.length-1,e)}appendMapping(t){for(let e=0,n=this._maps.length;e<t._maps.length;e++){let o=t.getMirror(e);this.appendMap(t._maps[e],o!=null&&o<e?n+o:void 0)}}getMirror(t){if(this.mirror){for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,n=this._maps.length+t._maps.length;e>=0;e--){let o=t.getMirror(e);this.appendMap(t._maps[e].invert(),o!=null&&o>e?n-o-1:void 0)}}invert(){let t=new i;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let n=this.from;n<this.to;n++)t=this._maps[n].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,n){let o=0;for(let r=this.from;r<this.to;r++){let s=this._maps[r],l=s.mapResult(t,e);if(l.recover!=null){let a=this.getMirror(r);if(a!=null&&a>r&&a<this.to){r=a,t=this._maps[a].recover(l.recover);continue}}o|=l.delInfo,t=l.pos}return n?t:new wi(t,o,null)}},Vr=Object.create(null),se=class{getMap(){return xt.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Vr[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in Vr)throw new RangeError("Duplicate use of step JSON ID "+t);return Vr[t]=e,e.prototype.jsonID=t,e}},ce=class i{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new i(t,null)}static fail(t){return new i(null,t)}static fromReplace(t,e,n,o){try{return i.ok(t.replace(e,n,o))}catch(r){if(r instanceof Zt)return i.fail(r.message);throw r}}};function Wr(i,t,e){let n=[];for(let o=0;o<i.childCount;o++){let r=i.child(o);r.content.size&&(r=r.copy(Wr(r.content,t,r))),r.isInline&&(r=t(r,e,o)),n.push(r)}return w.fromArray(n)}var Ii=class i extends se{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),o=n.node(n.sharedDepth(this.to)),r=new I(Wr(e.content,(s,l)=>!s.isAtom||!l.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),o),e.openStart,e.openEnd);return ce.fromReplace(t,this.from,this.to,r)}invert(){return new nn(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new i(e.pos,n.pos,this.mark)}merge(t){return t instanceof i&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new i(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new i(e.from,e.to,t.markFromJSON(e.mark))}};se.jsonID("addMark",Ii);var nn=class i extends se{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new I(Wr(e.content,o=>o.mark(this.mark.removeFromSet(o.marks)),t),e.openStart,e.openEnd);return ce.fromReplace(t,this.from,this.to,n)}invert(){return new Ii(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new i(e.pos,n.pos,this.mark)}merge(t){return t instanceof i&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new i(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new i(e.from,e.to,t.markFromJSON(e.mark))}};se.jsonID("removeMark",nn);var Ei=class i extends se{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return ce.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return ce.fromReplace(t,this.pos,this.pos+1,new I(w.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let n=this.mark.addToSet(e.marks);if(n.length==e.marks.length){for(let o=0;o<e.marks.length;o++)if(!e.marks[o].isInSet(n))return new i(this.pos,e.marks[o]);return new i(this.pos,this.mark)}}return new Kn(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new i(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new i(e.pos,t.markFromJSON(e.mark))}};se.jsonID("addNodeMark",Ei);var Kn=class i extends se{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return ce.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return ce.fromReplace(t,this.pos,this.pos+1,new I(w.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new Ei(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new i(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new i(e.pos,t.markFromJSON(e.mark))}};se.jsonID("removeNodeMark",Kn);var Oe=class i extends se{constructor(t,e,n,o=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=o}apply(t){return this.structure&&jr(t,this.from,this.to)?ce.fail("Structure replace would overwrite content"):ce.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new xt([this.from,this.to-this.from,this.slice.size])}invert(t){return new i(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new i(e.pos,Math.max(e.pos,n.pos),this.slice,this.structure)}merge(t){if(!(t instanceof i)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?I.empty:new I(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new i(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?I.empty:new I(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new i(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new i(e.from,e.to,I.fromJSON(t,e.slice),!!e.structure)}};se.jsonID("replace",Oe);var le=class i extends se{constructor(t,e,n,o,r,s,l=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=o,this.slice=r,this.insert=s,this.structure=l}apply(t){if(this.structure&&(jr(t,this.from,this.gapFrom)||jr(t,this.gapTo,this.to)))return ce.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return ce.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?ce.fromReplace(t,this.from,this.to,n):ce.fail("Content does not fit in gap")}getMap(){return new xt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new i(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),o=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),r=this.to==this.gapTo?n.pos:t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||o<e.pos||r>n.pos?null:new i(e.pos,n.pos,o,r,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new i(e.from,e.to,e.gapFrom,e.gapTo,I.fromJSON(t,e.slice),e.insert,!!e.structure)}};se.jsonID("replaceAround",le);function jr(i,t,e){let n=i.resolve(t),o=e-t,r=n.depth;for(;o>0&&r>0&&n.indexAfter(r)==n.node(r).childCount;)r--,o--;if(o>0){let s=n.node(r).maybeChild(n.indexAfter(r));for(;o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}}return!1}function Dp(i,t,e,n){let o=[],r=[],s,l;i.doc.nodesBetween(t,e,(a,c,d)=>{if(!a.isInline)return;let u=a.marks;if(!n.isInSet(u)&&d.type.allowsMarkType(n.type)){let h=Math.max(c,t),g=Math.min(c+a.nodeSize,e),m=n.addToSet(u);for(let b=0;b<u.length;b++)u[b].isInSet(m)||(s&&s.to==h&&s.mark.eq(u[b])?s.to=g:o.push(s=new nn(h,g,u[b])));l&&l.to==h?l.to=g:r.push(l=new Ii(h,g,n))}}),o.forEach(a=>i.step(a)),r.forEach(a=>i.step(a))}function Np(i,t,e,n){let o=[],r=0;i.doc.nodesBetween(t,e,(s,l)=>{if(!s.isInline)return;r++;let a=null;if(n instanceof bi){let c=s.marks,d;for(;d=n.isInSet(c);)(a||(a=[])).push(d),c=d.removeFromSet(c)}else n?n.isInSet(s.marks)&&(a=[n]):a=s.marks;if(a&&a.length){let c=Math.min(l+s.nodeSize,e);for(let d=0;d<a.length;d++){let u=a[d],h;for(let g=0;g<o.length;g++){let m=o[g];m.step==r-1&&u.eq(o[g].style)&&(h=m)}h?(h.to=c,h.step=r):o.push({style:u,from:Math.max(l,t),to:c,step:r})}}}),o.forEach(s=>i.step(new nn(s.from,s.to,s.style)))}function Gr(i,t,e,n=e.contentMatch,o=!0){let r=i.doc.nodeAt(t),s=[],l=t+1;for(let a=0;a<r.childCount;a++){let c=r.child(a),d=l+c.nodeSize,u=n.matchType(c.type);if(!u)s.push(new Oe(l,d,I.empty));else{n=u;for(let h=0;h<c.marks.length;h++)e.allowsMarkType(c.marks[h].type)||i.step(new nn(l,d,c.marks[h]));if(o&&c.isText&&e.whitespace!="pre"){let h,g=/\r?\n|\r/g,m;for(;h=g.exec(c.text);)m||(m=new I(w.from(e.schema.text(" ",e.allowedMarks(c.marks))),0,0)),s.push(new Oe(l+h.index,l+h.index+h[0].length,m))}}l=d}if(!n.validEnd){let a=n.fillBefore(w.empty,!0);i.replace(l,l,new I(a,0,0))}for(let a=s.length-1;a>=0;a--)i.step(s[a])}function Rp(i,t,e){return(t==0||i.canReplace(t,i.childCount))&&(e==i.childCount||i.canReplace(0,e))}function on(i){let e=i.parent.content.cutByIndex(i.startIndex,i.endIndex);for(let n=i.depth,o=0,r=0;;--n){let s=i.$from.node(n),l=i.$from.index(n)+o,a=i.$to.indexAfter(n)-r;if(n<i.depth&&s.canReplace(l,a,e))return n;if(n==0||s.type.spec.isolating||!Rp(s,l,a))break;l&&(o=1),a<s.childCount&&(r=1)}return null}function Ap(i,t,e){let{$from:n,$to:o,depth:r}=t,s=n.before(r+1),l=o.after(r+1),a=s,c=l,d=w.empty,u=0;for(let m=r,b=!1;m>e;m--)b||n.index(m)>0?(b=!0,d=w.from(n.node(m).copy(d)),u++):a--;let h=w.empty,g=0;for(let m=r,b=!1;m>e;m--)b||o.after(m+1)<o.end(m)?(b=!0,h=w.from(o.node(m).copy(h)),g++):c++;i.step(new le(a,c,s,l,new I(d.append(h),u,g),d.size-u,!0))}function Yn(i,t,e=null,n=i){let o=Pp(i,t),r=o&&Fp(n,t);return r?o.map(ac).concat({type:t,attrs:e}).concat(r.map(ac)):null}function ac(i){return{type:i,attrs:null}}function Pp(i,t){let{parent:e,startIndex:n,endIndex:o}=i,r=e.contentMatchAt(n).findWrapping(t);if(!r)return null;let s=r.length?r[0]:t;return e.canReplaceWith(n,o,s)?r:null}function Fp(i,t){let{parent:e,startIndex:n,endIndex:o}=i,r=e.child(n),s=t.contentMatch.findWrapping(r.type);if(!s)return null;let a=(s.length?s[s.length-1]:t).contentMatch;for(let c=n;a&&c<o;c++)a=a.matchType(e.child(c).type);return!a||!a.validEnd?null:s}function Lp(i,t,e){let n=w.empty;for(let s=e.length-1;s>=0;s--){if(n.size){let l=e[s].type.contentMatch.matchFragment(n);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=w.from(e[s].type.create(e[s].attrs,n))}let o=t.start,r=t.end;i.step(new le(o,r,o,r,new I(n,0,0),e.length,!0))}function Bp(i,t,e,n,o){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let r=i.steps.length;i.doc.nodesBetween(t,e,(s,l)=>{let a=typeof o=="function"?o(s):o;if(s.isTextblock&&!s.hasMarkup(n,a)&&zp(i.doc,i.mapping.slice(r).map(l),n)){let c=null;if(n.schema.linebreakReplacement){let g=n.whitespace=="pre",m=!!n.contentMatch.matchType(n.schema.linebreakReplacement);g&&!m?c=!1:!g&&m&&(c=!0)}c===!1&&mc(i,s,l,r),Gr(i,i.mapping.slice(r).map(l,1),n,void 0,c===null);let d=i.mapping.slice(r),u=d.map(l,1),h=d.map(l+s.nodeSize,1);return i.step(new le(u,h,u+1,h-1,new I(w.from(n.create(a,null,s.marks)),0,0),1,!0)),c===!0&&hc(i,s,l,r),!1}})}function hc(i,t,e,n){t.forEach((o,r)=>{if(o.isText){let s,l=/\r?\n|\r/g;for(;s=l.exec(o.text);){let a=i.mapping.slice(n).map(e+1+r+s.index);i.replaceWith(a,a+1,t.type.schema.linebreakReplacement.create())}}})}function mc(i,t,e,n){t.forEach((o,r)=>{if(o.type==o.type.schema.linebreakReplacement){let s=i.mapping.slice(n).map(e+1+r);i.replaceWith(s,s+1,t.type.schema.text(`
`))}})}function zp(i,t,e){let n=i.resolve(t),o=n.index();return n.parent.canReplaceWith(o,o+1,e)}function qp(i,t,e,n,o){let r=i.doc.nodeAt(t);if(!r)throw new RangeError("No node at given position");e||(e=r.type);let s=e.create(n,null,o||r.marks);if(r.isLeaf)return i.replaceWith(t,t+r.nodeSize,s);if(!e.validContent(r.content))throw new RangeError("Invalid content for node type "+e.name);i.step(new le(t,t+r.nodeSize,t+1,t+r.nodeSize-1,new I(w.from(s),0,0),1,!0))}function Lt(i,t,e=1,n){let o=i.resolve(t),r=o.depth-e,s=n&&n[n.length-1]||o.parent;if(r<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(let c=o.depth-1,d=e-2;c>r;c--,d--){let u=o.node(c),h=o.index(c);if(u.type.spec.isolating)return!1;let g=u.content.cutByIndex(h,u.childCount),m=n&&n[d+1];m&&(g=g.replaceChild(0,m.type.create(m.attrs)));let b=n&&n[d]||u;if(!u.canReplace(h+1,u.childCount)||!b.type.validContent(g))return!1}let l=o.indexAfter(r),a=n&&n[0];return o.node(r).canReplaceWith(l,l,a?a.type:o.node(r+1).type)}function Vp(i,t,e=1,n){let o=i.doc.resolve(t),r=w.empty,s=w.empty;for(let l=o.depth,a=o.depth-e,c=e-1;l>a;l--,c--){r=w.from(o.node(l).copy(r));let d=n&&n[c];s=w.from(d?d.type.create(d.attrs,s):o.node(l).copy(s))}i.step(new Oe(t,t,new I(r.append(s),e,e),!0))}function rn(i,t){let e=i.resolve(t),n=e.index();return $p(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(n,n+1)}function Hp(i,t){t.content.size||i.type.compatibleContent(t.type);let e=i.contentMatchAt(i.childCount),{linebreakReplacement:n}=i.type.schema;for(let o=0;o<t.childCount;o++){let r=t.child(o),s=r.type==n?i.type.schema.nodes.text:r.type;if(e=e.matchType(s),!e||!i.type.allowsMarks(r.marks))return!1}return e.validEnd}function $p(i,t){return!!(i&&t&&!i.isLeaf&&Hp(i,t))}function jp(i,t,e){let n=null,{linebreakReplacement:o}=i.doc.type.schema,r=i.doc.resolve(t-e),s=r.node().type;if(o&&s.inlineContent){let d=s.whitespace=="pre",u=!!s.contentMatch.matchType(o);d&&!u?n=!1:!d&&u&&(n=!0)}let l=i.steps.length;if(n===!1){let d=i.doc.resolve(t+e);mc(i,d.node(),d.before(),l)}s.inlineContent&&Gr(i,t+e-1,s,r.node().contentMatchAt(r.index()),n==null);let a=i.mapping.slice(l),c=a.map(t-e);if(i.step(new Oe(c,a.map(t+e,-1),I.empty,!0)),n===!0){let d=i.doc.resolve(c);hc(i,d.node(),d.before(),i.steps.length)}return i}function Up(i,t,e){let n=i.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),e))return t;if(n.parentOffset==0)for(let o=n.depth-1;o>=0;o--){let r=n.index(o);if(n.node(o).canReplaceWith(r,r,e))return n.before(o+1);if(r>0)return null}if(n.parentOffset==n.parent.content.size)for(let o=n.depth-1;o>=0;o--){let r=n.indexAfter(o);if(n.node(o).canReplaceWith(r,r,e))return n.after(o+1);if(r<n.node(o).childCount)return null}return null}function gc(i,t,e){let n=i.resolve(t);if(!e.content.size)return t;let o=e.content;for(let r=0;r<e.openStart;r++)o=o.firstChild.content;for(let r=1;r<=(e.openStart==0&&e.size?2:1);r++)for(let s=n.depth;s>=0;s--){let l=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1,a=n.index(s)+(l>0?1:0),c=n.node(s),d=!1;if(r==1)d=c.canReplace(a,a,o);else{let u=c.contentMatchAt(a).findWrapping(o.firstChild.type);d=u&&c.canReplaceWith(a,a,u[0])}if(d)return l==0?n.pos:l<0?n.before(s+1):n.after(s+1)}return null}function Bo(i,t,e=t,n=I.empty){if(t==e&&!n.size)return null;let o=i.resolve(t),r=i.resolve(e);return yc(o,r,n)?new Oe(t,e,n):new Ur(o,r,n).fit()}function yc(i,t,e){return!e.openStart&&!e.openEnd&&i.start()==t.start()&&i.parent.canReplace(i.index(),t.index(),e.content)}var Ur=class{constructor(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=w.empty;for(let o=0;o<=t.depth;o++){let r=t.node(o);this.frontier.push({type:r.type,match:r.contentMatchAt(t.indexAfter(o))})}for(let o=t.depth;o>0;o--)this.placed=w.from(t.node(o).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,n=this.$from,o=this.close(t<0?this.$to:n.doc.resolve(t));if(!o)return null;let r=this.placed,s=n.depth,l=o.depth;for(;s&&l&&r.childCount==1;)r=r.firstChild.content,s--,l--;let a=new I(r,s,l);return t>-1?new le(n.pos,t,this.$to.pos,this.$to.end(),a,e):a.size||n.pos!=this.$to.pos?new Oe(n.pos,o.pos,a):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,n=0,o=this.unplaced.openEnd;n<t;n++){let r=e.firstChild;if(e.childCount>1&&(o=0),r.type.spec.isolating&&o<=n){t=n;break}e=r.content}for(let e=1;e<=2;e++)for(let n=e==1?t:this.unplaced.openStart;n>=0;n--){let o,r=null;n?(r=Hr(this.unplaced.content,n-1).firstChild,o=r.content):o=this.unplaced.content;let s=o.firstChild;for(let l=this.depth;l>=0;l--){let{type:a,match:c}=this.frontier[l],d,u=null;if(e==1&&(s?c.matchType(s.type)||(u=c.fillBefore(w.from(s),!1)):r&&a.compatibleContent(r.type)))return{sliceDepth:n,frontierDepth:l,parent:r,inject:u};if(e==2&&s&&(d=c.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:l,parent:r,wrap:d};if(r&&c.matchType(r.type))break}}}openMore(){let{content:t,openStart:e,openEnd:n}=this.unplaced,o=Hr(t,e);return!o.childCount||o.firstChild.isLeaf?!1:(this.unplaced=new I(t,e+1,Math.max(n,o.size+e>=t.size-n?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:n}=this.unplaced,o=Hr(t,e);if(o.childCount<=1&&e>0){let r=t.size-e<=e+o.size;this.unplaced=new I(vi(t,e-1,1),e-1,r?e-1:n)}else this.unplaced=new I(vi(t,e,1),e,n)}placeNodes({sliceDepth:t,frontierDepth:e,parent:n,inject:o,wrap:r}){for(;this.depth>e;)this.closeFrontierNode();if(r)for(let b=0;b<r.length;b++)this.openFrontierNode(r[b]);let s=this.unplaced,l=n?n.content:s.content,a=s.openStart-t,c=0,d=[],{match:u,type:h}=this.frontier[e];if(o){for(let b=0;b<o.childCount;b++)d.push(o.child(b));u=u.matchFragment(o)}let g=l.size+t-(s.content.size-s.openEnd);for(;c<l.childCount;){let b=l.child(c),C=u.matchType(b.type);if(!C)break;c++,(c>1||a==0||b.content.size)&&(u=C,d.push(_c(b.mark(h.allowedMarks(b.marks)),c==1?a:0,c==l.childCount?g:-1)))}let m=c==l.childCount;m||(g=-1),this.placed=Si(this.placed,e,w.from(d)),this.frontier[e].match=u,m&&g<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let b=0,C=l;b<g;b++){let k=C.lastChild;this.frontier.push({type:k.type,match:k.contentMatchAt(k.childCount)}),C=k.content}this.unplaced=m?t==0?I.empty:new I(vi(s.content,t-1,1),t-1,g<0?s.openEnd:t-1):new I(vi(s.content,t,c),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!$r(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,o=this.$to.after(n);for(;n>1&&o==this.$to.end(--n);)++o;return o}findCloseLevel(t){e:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:n,type:o}=this.frontier[e],r=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=$r(t,e,o,n,r);if(s){for(let l=e-1;l>=0;l--){let{match:a,type:c}=this.frontier[l],d=$r(t,l,c,a,!0);if(!d||d.childCount)continue e}return{depth:e,fit:s,move:r?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Si(this.placed,e.depth,e.fit)),t=e.move;for(let n=e.depth+1;n<=t.depth;n++){let o=t.node(n),r=o.type.contentMatch.fillBefore(o.content,!0,t.index(n));this.openFrontierNode(o.type,o.attrs,r)}return t}openFrontierNode(t,e=null,n){let o=this.frontier[this.depth];o.match=o.match.matchType(t),this.placed=Si(this.placed,this.depth,w.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(w.empty,!0);e.childCount&&(this.placed=Si(this.placed,this.frontier.length,e))}};function vi(i,t,e){return t==0?i.cutByIndex(e,i.childCount):i.replaceChild(0,i.firstChild.copy(vi(i.firstChild.content,t-1,e)))}function Si(i,t,e){return t==0?i.append(e):i.replaceChild(i.childCount-1,i.lastChild.copy(Si(i.lastChild.content,t-1,e)))}function Hr(i,t){for(let e=0;e<t;e++)i=i.firstChild.content;return i}function _c(i,t,e){if(t<=0)return i;let n=i.content;return t>1&&(n=n.replaceChild(0,_c(n.firstChild,t-1,n.childCount==1?e-1:0))),t>0&&(n=i.type.contentMatch.fillBefore(n).append(n),e<=0&&(n=n.append(i.type.contentMatch.matchFragment(n).fillBefore(w.empty,!0)))),i.copy(n)}function $r(i,t,e,n,o){let r=i.node(t),s=o?i.indexAfter(t):i.index(t);if(s==r.childCount&&!e.compatibleContent(r.type))return null;let l=n.fillBefore(r.content,!0,s);return l&&!Wp(e,r.content,s)?l:null}function Wp(i,t,e){for(let n=e;n<t.childCount;n++)if(!i.allowsMarks(t.child(n).marks))return!0;return!1}function Gp(i){return i.spec.defining||i.spec.definingForContent}function Kp(i,t,e,n){if(!n.size)return i.deleteRange(t,e);let o=i.doc.resolve(t),r=i.doc.resolve(e);if(yc(o,r,n))return i.step(new Oe(t,e,n));let s=bc(o,r);s[s.length-1]==0&&s.pop();let l=-(o.depth+1);s.unshift(l);for(let h=o.depth,g=o.pos-1;h>0;h--,g--){let m=o.node(h).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;s.indexOf(h)>-1?l=h:o.before(h)==g&&s.splice(1,0,-h)}let a=s.indexOf(l),c=[],d=n.openStart;for(let h=n.content,g=0;;g++){let m=h.firstChild;if(c.push(m),g==n.openStart)break;h=m.content}for(let h=d-1;h>=0;h--){let g=c[h],m=Gp(g.type);if(m&&!g.sameMarkup(o.node(Math.abs(l)-1)))d=h;else if(m||!g.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let g=(h+d+1)%(n.openStart+1),m=c[g];if(m)for(let b=0;b<s.length;b++){let C=s[(b+a)%s.length],k=!0;C<0&&(k=!1,C=-C);let X=o.node(C-1),te=o.index(C-1);if(X.canReplaceWith(te,te,m.type,m.marks))return i.replace(o.before(C),k?r.after(C):e,new I(xc(n.content,0,n.openStart,g),g,n.openEnd))}}let u=i.steps.length;for(let h=s.length-1;h>=0&&(i.replace(t,e,n),!(i.steps.length>u));h--){let g=s[h];g<0||(t=o.before(g),e=r.after(g))}}function xc(i,t,e,n,o){if(t<e){let r=i.firstChild;i=i.replaceChild(0,r.copy(xc(r.content,t+1,e,n,r)))}if(t>n){let r=o.contentMatchAt(0),s=r.fillBefore(i).append(i);i=s.append(r.matchFragment(s).fillBefore(w.empty,!0))}return i}function Jp(i,t,e,n){if(!n.isInline&&t==e&&i.doc.resolve(t).parent.content.size){let o=Up(i.doc,t,n.type);o!=null&&(t=e=o)}i.replaceRange(t,e,new I(w.from(n),0,0))}function Yp(i,t,e){let n=i.doc.resolve(t),o=i.doc.resolve(e),r=bc(n,o);for(let s=0;s<r.length;s++){let l=r[s],a=s==r.length-1;if(a&&l==0||n.node(l).type.contentMatch.validEnd)return i.delete(n.start(l),o.end(l));if(l>0&&(a||n.node(l-1).canReplace(n.index(l-1),o.indexAfter(l-1))))return i.delete(n.before(l),o.after(l))}for(let s=1;s<=n.depth&&s<=o.depth;s++)if(t-n.start(s)==n.depth-s&&e>n.end(s)&&o.end(s)-e!=o.depth-s&&n.start(s-1)==o.start(s-1)&&n.node(s-1).canReplace(n.index(s-1),o.index(s-1)))return i.delete(n.before(s),e);i.delete(t,e)}function bc(i,t){let e=[],n=Math.min(i.depth,t.depth);for(let o=n;o>=0;o--){let r=i.start(o);if(r<i.pos-(i.depth-o)||t.end(o)>t.pos+(t.depth-o)||i.node(o).type.spec.isolating||t.node(o).type.spec.isolating)break;(r==t.start(o)||o==i.depth&&o==t.depth&&i.parent.inlineContent&&t.parent.inlineContent&&o&&t.start(o-1)==r-1)&&e.push(o)}return e}var Po=class i extends se{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return ce.fail("No node at attribute step's position");let n=Object.create(null);for(let r in e.attrs)n[r]=e.attrs[r];n[this.attr]=this.value;let o=e.type.create(n,null,e.marks);return ce.fromReplace(t,this.pos,this.pos+1,new I(w.from(o),0,e.isLeaf?0:1))}getMap(){return xt.empty}invert(t){return new i(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new i(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new i(e.pos,e.attr,e.value)}};se.jsonID("attr",Po);var Fo=class i extends se{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let o in t.attrs)e[o]=t.attrs[o];e[this.attr]=this.value;let n=t.type.create(e,t.content,t.marks);return ce.ok(n)}getMap(){return xt.empty}invert(t){return new i(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new i(e.attr,e.value)}};se.jsonID("docAttr",Fo);var Jn=class extends Error{};Jn=function i(t){let e=Error.call(this,t);return e.__proto__=i.prototype,e};Jn.prototype=Object.create(Error.prototype);Jn.prototype.constructor=Jn;Jn.prototype.name="TransformError";var Lo=class{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Mi}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new Jn(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,n=I.empty){let o=Bo(this.doc,t,e,n);return o&&this.step(o),this}replaceWith(t,e,n){return this.replace(t,e,new I(w.from(n),0,0))}delete(t,e){return this.replace(t,e,I.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,n){return Kp(this,t,e,n),this}replaceRangeWith(t,e,n){return Jp(this,t,e,n),this}deleteRange(t,e){return Yp(this,t,e),this}lift(t,e){return Ap(this,t,e),this}join(t,e=1){return jp(this,t,e),this}wrap(t,e){return Lp(this,t,e),this}setBlockType(t,e=t,n,o=null){return Bp(this,t,e,n,o),this}setNodeMarkup(t,e,n=null,o){return qp(this,t,e,n,o),this}setNodeAttribute(t,e,n){return this.step(new Po(t,e,n)),this}setDocAttribute(t,e){return this.step(new Fo(t,e)),this}addNodeMark(t,e){return this.step(new Ei(t,e)),this}removeNodeMark(t,e){let n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(e instanceof W)e.isInSet(n.marks)&&this.step(new Kn(t,e));else{let o=n.marks,r,s=[];for(;r=e.isInSet(o);)s.push(new Kn(t,r)),o=r.removeFromSet(o);for(let l=s.length-1;l>=0;l--)this.step(s[l])}return this}split(t,e=1,n){return Vp(this,t,e,n),this}addMark(t,e,n){return Dp(this,t,e,n),this}removeMark(t,e,n){return Np(this,t,e,n),this}clearIncompatible(t,e,n){return Gr(this,t,e,n),this}};var Kr=Object.create(null),z=class{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new Xn(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=I.empty){let n=e.content.lastChild,o=null;for(let l=0;l<e.openEnd;l++)o=n,n=n.lastChild;let r=t.steps.length,s=this.ranges;for(let l=0;l<s.length;l++){let{$from:a,$to:c}=s[l],d=t.mapping.slice(r);t.replaceRange(d.map(a.pos),d.map(c.pos),l?I.empty:e),l==0&&Sc(t,r,(n?n.isInline:o&&o.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,o=this.ranges;for(let r=0;r<o.length;r++){let{$from:s,$to:l}=o[r],a=t.mapping.slice(n),c=a.map(s.pos),d=a.map(l.pos);r?t.deleteRange(c,d):(t.replaceRangeWith(c,d,e),Sc(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let o=t.parent.inlineContent?new U(t):Qn(t.node(0),t.parent,t.pos,t.index(),e,n);if(o)return o;for(let r=t.depth-1;r>=0;r--){let s=e<0?Qn(t.node(0),t.node(r),t.before(r+1),t.index(r),e,n):Qn(t.node(0),t.node(r),t.after(r+1),t.index(r)+1,e,n);if(s)return s}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new De(t.node(0))}static atStart(t){return Qn(t,t,0,0,1)||new De(t)}static atEnd(t){return Qn(t,t,t.content.size,t.childCount,-1)||new De(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=Kr[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in Kr)throw new RangeError("Duplicate use of selection JSON ID "+t);return Kr[t]=e,e.prototype.jsonID=t,e}getBookmark(){return U.between(this.$anchor,this.$head).getBookmark()}};z.prototype.visible=!0;var Xn=class{constructor(t,e){this.$from=t,this.$to=e}},Cc=!1;function vc(i){!Cc&&!i.parent.inlineContent&&(Cc=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+i.parent.type.name+")"))}var U=class i extends z{constructor(t,e=t){vc(t),vc(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return z.near(n);let o=t.resolve(e.map(this.anchor));return new i(o.parent.inlineContent?o:n,n)}replace(t,e=I.empty){if(super.replace(t,e),e==I.empty){let n=this.$from.marksAcross(this.$to);n&&t.ensureMarks(n)}}eq(t){return t instanceof i&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new qo(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if(typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new i(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let o=t.resolve(e);return new this(o,n==e?o:t.resolve(n))}static between(t,e,n){let o=t.pos-e.pos;if((!n||o)&&(n=o>=0?1:-1),!e.parent.inlineContent){let r=z.findFrom(e,n,!0)||z.findFrom(e,-n,!0);if(r)e=r.$head;else return z.near(e,n)}return t.parent.inlineContent||(o==0?t=e:(t=(z.findFrom(t,-n,!0)||z.findFrom(t,n,!0)).$anchor,t.pos<e.pos!=o<0&&(t=e))),new i(t,e)}};z.jsonID("text",U);var qo=class i{constructor(t,e){this.anchor=t,this.head=e}map(t){return new i(t.map(this.anchor),t.map(this.head))}resolve(t){return U.between(t.resolve(this.anchor),t.resolve(this.head))}},N=class i extends z{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:o}=e.mapResult(this.anchor),r=t.resolve(o);return n?z.near(r):new i(r)}content(){return new I(w.from(this.node),0,0)}eq(t){return t instanceof i&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Yr(this.anchor)}static fromJSON(t,e){if(typeof e.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new i(t.resolve(e.anchor))}static create(t,e){return new i(t.resolve(e))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}};N.prototype.visible=!1;z.jsonID("node",N);var Yr=class i{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new qo(n,n):new i(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&N.isSelectable(n)?new N(e):z.near(e)}},De=class i extends z{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=I.empty){if(e==I.empty){t.delete(0,t.doc.content.size);let n=z.atStart(t.doc);n.eq(t.selection)||t.setSelection(n)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new i(t)}map(t){return new i(t)}eq(t){return t instanceof i}getBookmark(){return Qp}};z.jsonID("all",De);var Qp={map(){return this},resolve(i){return new De(i)}};function Qn(i,t,e,n,o,r=!1){if(t.inlineContent)return U.create(i,e);for(let s=n-(o>0?0:1);o>0?s<t.childCount:s>=0;s+=o){let l=t.child(s);if(l.isAtom){if(!r&&N.isSelectable(l))return N.create(i,e-(o<0?l.nodeSize:0))}else{let a=Qn(i,l,e+o,o<0?l.childCount:0,o,r);if(a)return a}e+=l.nodeSize*o}return null}function Sc(i,t,e){let n=i.steps.length-1;if(n<t)return;let o=i.steps[n];if(!(o instanceof Oe||o instanceof le))return;let r=i.mapping.maps[n],s;r.forEach((l,a,c,d)=>{s==null&&(s=d)}),i.setSelection(z.near(i.doc.resolve(s),e))}var wc=1,zo=2,Mc=4,Qr=class extends Lo{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|wc)&~zo,this.storedMarks=null,this}get selectionSet(){return(this.updated&wc)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=zo,this}ensureMarks(t){return W.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&zo)>0}addStep(t,e){super.addStep(t,e),this.updated=this.updated&~zo,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let n=this.selection;return e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||W.none))),n.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,n){let o=this.doc.type.schema;if(e==null)return t?this.replaceSelectionWith(o.text(t),!0):this.deleteSelection();{if(n==null&&(n=e),!t)return this.deleteRange(e,n);let r=this.storedMarks;if(!r){let s=this.doc.resolve(e);r=n==e?s.marks():s.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,o.text(t,r)),!this.selection.empty&&this.selection.to==e+t.length&&this.setSelection(z.near(this.selection.$to)),this}}setMeta(t,e){return this.meta[typeof t=="string"?t:t.key]=e,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Mc,this}get scrolledIntoView(){return(this.updated&Mc)>0}};function Ic(i,t){return!t||!i?i:i.bind(t)}var sn=class{constructor(t,e,n){this.name=t,this.init=Ic(e.init,n),this.apply=Ic(e.apply,n)}},Xp=[new sn("doc",{init(i){return i.doc||i.schema.topNodeType.createAndFill()},apply(i){return i.doc}}),new sn("selection",{init(i,t){return i.selection||z.atStart(t.doc)},apply(i){return i.selection}}),new sn("storedMarks",{init(i){return i.storedMarks||null},apply(i,t,e,n){return n.selection.$cursor?i.storedMarks:null}}),new sn("scrollToSelection",{init(){return 0},apply(i,t){return i.scrolledIntoView?t+1:t}})],ki=class{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Xp.slice(),e&&e.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new sn(n.key,n.spec.state,n))})}},Vo=class i{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=e){let o=this.config.plugins[n];if(o.spec.filterTransaction&&!o.spec.filterTransaction.call(o,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],n=this.applyInner(t),o=null;for(;;){let r=!1;for(let s=0;s<this.config.plugins.length;s++){let l=this.config.plugins[s];if(l.spec.appendTransaction){let a=o?o[s].n:0,c=o?o[s].state:this,d=a<e.length&&l.spec.appendTransaction.call(l,a?e.slice(a):e,c,n);if(d&&n.filterTransaction(d,s)){if(d.setMeta("appendedTransaction",t),!o){o=[];for(let u=0;u<this.config.plugins.length;u++)o.push(u<s?{state:n,n:e.length}:{state:this,n:0})}e.push(d),n=n.applyInner(d),r=!0}o&&(o[s]={state:n,n:e.length})}}if(!r)return{state:n,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new i(this.config),n=this.config.fields;for(let o=0;o<n.length;o++){let r=n[o];e[r.name]=r.apply(t,this[r.name],this,e)}return e}get tr(){return new Qr(this)}static create(t){let e=new ki(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new i(e);for(let o=0;o<e.fields.length;o++)n[e.fields[o].name]=e.fields[o].init(t,n);return n}reconfigure(t){let e=new ki(this.schema,t.plugins),n=e.fields,o=new i(e);for(let r=0;r<n.length;r++){let s=n[r].name;o[s]=this.hasOwnProperty(s)?this[s]:n[r].init(t,o)}return o}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(n=>n.toJSON())),t&&typeof t=="object")for(let n in t){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let o=t[n],r=o.spec.state;r&&r.toJSON&&(e[n]=r.toJSON.call(o,this[o.key]))}return e}static fromJSON(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let o=new ki(t.schema,t.plugins),r=new i(o);return o.fields.forEach(s=>{if(s.name=="doc")r.doc=at.fromJSON(t.schema,e.doc);else if(s.name=="selection")r.selection=z.fromJSON(r.doc,e.selection);else if(s.name=="storedMarks")e.storedMarks&&(r.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(let l in n){let a=n[l],c=a.spec.state;if(a.key==s.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(e,l)){r[s.name]=c.fromJSON.call(a,t,e[l],r);return}}r[s.name]=s.init(t,r)}}),r}};function Ec(i,t,e){for(let n in i){let o=i[n];o instanceof Function?o=o.bind(t):n=="handleDOMEvents"&&(o=Ec(o,t,{})),e[n]=o}return e}var he=class{constructor(t){this.spec=t,this.props={},t.props&&Ec(t.props,this,this.props),this.key=t.key?t.key.key:kc("plugin")}getState(t){return t[this.key]}},Jr=Object.create(null);function kc(i){return i in Jr?i+"$"+ ++Jr[i]:(Jr[i]=0,i+"$")}var Ne=class{constructor(t="key"){this.key=kc(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}};var de=function(i){for(var t=0;;t++)if(i=i.previousSibling,!i)return t},ii=function(i){let t=i.assignedSlot||i.parentNode;return t&&t.nodeType==11?t.host:t},is=null,Ct=function(i,t,e){let n=is||(is=document.createRange());return n.setEnd(i,e??i.nodeValue.length),n.setStart(i,t||0),n},Zp=function(){is=null},fn=function(i,t,e,n){return e&&(Tc(i,t,e,n,-1)||Tc(i,t,e,n,1))},ef=/^(img|br|input|textarea|hr)$/i;function Tc(i,t,e,n,o){for(var r;;){if(i==e&&t==n)return!0;if(t==(o<0?0:Le(i))){let s=i.parentNode;if(!s||s.nodeType!=1||Fi(i)||ef.test(i.nodeName)||i.contentEditable=="false")return!1;t=de(i)+(o<0?0:1),i=s}else if(i.nodeType==1){let s=i.childNodes[t+(o<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((r=s.pmViewDesc)===null||r===void 0)&&r.ignoreForSelection)t+=o;else return!1;else i=s,t=o<0?Le(i):0}else return!1}}function Le(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function tf(i,t){for(;;){if(i.nodeType==3&&t)return i;if(i.nodeType==1&&t>0){if(i.contentEditable=="false")return null;i=i.childNodes[t-1],t=Le(i)}else if(i.parentNode&&!Fi(i))t=de(i),i=i.parentNode;else return null}}function nf(i,t){for(;;){if(i.nodeType==3&&t<i.nodeValue.length)return i;if(i.nodeType==1&&t<i.childNodes.length){if(i.contentEditable=="false")return null;i=i.childNodes[t],t=0}else if(i.parentNode&&!Fi(i))t=de(i)+1,i=i.parentNode;else return null}}function of(i,t,e){for(let n=t==0,o=t==Le(i);n||o;){if(i==e)return!0;let r=de(i);if(i=i.parentNode,!i)return!1;n=n&&r==0,o=o&&r==Le(i)}}function Fi(i){let t;for(let e=i;e&&!(t=e.pmViewDesc);e=e.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==i||t.contentDOM==i)}var Xo=function(i){return i.focusNode&&fn(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)};function ln(i,t){let e=document.createEvent("Event");return e.initEvent("keydown",!0,!0),e.keyCode=i,e.key=e.code=t,e}function rf(i){let t=i.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function sf(i,t,e){if(i.caretPositionFromPoint)try{let n=i.caretPositionFromPoint(t,e);if(n)return{node:n.offsetNode,offset:Math.min(Le(n.offsetNode),n.offset)}}catch{}if(i.caretRangeFromPoint){let n=i.caretRangeFromPoint(t,e);if(n)return{node:n.startContainer,offset:Math.min(Le(n.startContainer),n.startOffset)}}}var ct=typeof navigator<"u"?navigator:null,Oc=typeof document<"u"?document:null,$t=ct&&ct.userAgent||"",rs=/Edge\/(\d+)/.exec($t),ad=/MSIE \d/.exec($t),ss=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec($t),Ie=!!(ad||ss||rs),Vt=ad?document.documentMode:ss?+ss[1]:rs?+rs[1]:0,Be=!Ie&&/gecko\/(\d+)/i.test($t);Be&&+(/Firefox\/(\d+)/.exec($t)||[0,0])[1];var ls=!Ie&&/Chrome\/(\d+)/.exec($t),ge=!!ls,cd=ls?+ls[1]:0,xe=!Ie&&!!ct&&/Apple Computer/.test(ct.vendor),oi=xe&&(/Mobile\/\w+/.test($t)||!!ct&&ct.maxTouchPoints>2),Fe=oi||(ct?/Mac/.test(ct.platform):!1),lf=ct?/Win/.test(ct.platform):!1,vt=/Android \d/.test($t),Li=!!Oc&&"webkitFontSmoothing"in Oc.documentElement.style,af=Li?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function cf(i){let t=i.defaultView&&i.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:i.documentElement.clientWidth,top:0,bottom:i.documentElement.clientHeight}}function bt(i,t){return typeof i=="number"?i:i[t]}function df(i){let t=i.getBoundingClientRect(),e=t.width/i.offsetWidth||1,n=t.height/i.offsetHeight||1;return{left:t.left,right:t.left+i.clientWidth*e,top:t.top,bottom:t.top+i.clientHeight*n}}function Dc(i,t,e){let n=i.someProp("scrollThreshold")||0,o=i.someProp("scrollMargin")||5,r=i.dom.ownerDocument;for(let s=e||i.dom;s;){if(s.nodeType!=1){s=ii(s);continue}let l=s,a=l==r.body,c=a?cf(r):df(l),d=0,u=0;if(t.top<c.top+bt(n,"top")?u=-(c.top-t.top+bt(o,"top")):t.bottom>c.bottom-bt(n,"bottom")&&(u=t.bottom-t.top>c.bottom-c.top?t.top+bt(o,"top")-c.top:t.bottom-c.bottom+bt(o,"bottom")),t.left<c.left+bt(n,"left")?d=-(c.left-t.left+bt(o,"left")):t.right>c.right-bt(n,"right")&&(d=t.right-c.right+bt(o,"right")),d||u)if(a)r.defaultView.scrollBy(d,u);else{let g=l.scrollLeft,m=l.scrollTop;u&&(l.scrollTop+=u),d&&(l.scrollLeft+=d);let b=l.scrollLeft-g,C=l.scrollTop-m;t={left:t.left-b,top:t.top-C,right:t.right-b,bottom:t.bottom-C}}let h=a?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(h))break;s=h=="absolute"?s.offsetParent:ii(s)}}function uf(i){let t=i.dom.getBoundingClientRect(),e=Math.max(0,t.top),n,o;for(let r=(t.left+t.right)/2,s=e+1;s<Math.min(innerHeight,t.bottom);s+=5){let l=i.root.elementFromPoint(r,s);if(!l||l==i.dom||!i.dom.contains(l))continue;let a=l.getBoundingClientRect();if(a.top>=e-20){n=l,o=a.top;break}}return{refDOM:n,refTop:o,stack:dd(i.dom)}}function dd(i){let t=[],e=i.ownerDocument;for(let n=i;n&&(t.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),i!=e);n=ii(n));return t}function pf({refDOM:i,refTop:t,stack:e}){let n=i?i.getBoundingClientRect().top:0;ud(e,n==0?0:n-t)}function ud(i,t){for(let e=0;e<i.length;e++){let{dom:n,top:o,left:r}=i[e];n.scrollTop!=o+t&&(n.scrollTop=o+t),n.scrollLeft!=r&&(n.scrollLeft=r)}}var Zn=null;function ff(i){if(i.setActive)return i.setActive();if(Zn)return i.focus(Zn);let t=dd(i);i.focus(Zn==null?{get preventScroll(){return Zn={preventScroll:!0},!0}}:void 0),Zn||(Zn=!1,ud(t,0))}function pd(i,t){let e,n=2e8,o,r=0,s=t.top,l=t.top,a,c;for(let d=i.firstChild,u=0;d;d=d.nextSibling,u++){let h;if(d.nodeType==1)h=d.getClientRects();else if(d.nodeType==3)h=Ct(d).getClientRects();else continue;for(let g=0;g<h.length;g++){let m=h[g];if(m.top<=s&&m.bottom>=l){s=Math.max(m.bottom,s),l=Math.min(m.top,l);let b=m.left>t.left?m.left-t.left:m.right<t.left?t.left-m.right:0;if(b<n){e=d,n=b,o=b&&e.nodeType==3?{left:m.right<t.left?m.right:m.left,top:t.top}:t,d.nodeType==1&&b&&(r=u+(t.left>=(m.left+m.right)/2?1:0));continue}}else m.top>t.top&&!a&&m.left<=t.left&&m.right>=t.left&&(a=d,c={left:Math.max(m.left,Math.min(m.right,t.left)),top:m.top});!e&&(t.left>=m.right&&t.top>=m.top||t.left>=m.left&&t.top>=m.bottom)&&(r=u+1)}}return!e&&a&&(e=a,o=c,n=0),e&&e.nodeType==3?hf(e,o):!e||n&&e.nodeType==1?{node:i,offset:r}:pd(e,o)}function hf(i,t){let e=i.nodeValue.length,n=document.createRange();for(let o=0;o<e;o++){n.setEnd(i,o+1),n.setStart(i,o);let r=Bt(n,1);if(r.top!=r.bottom&&vs(t,r))return{node:i,offset:o+(t.left>=(r.left+r.right)/2?1:0)}}return{node:i,offset:0}}function vs(i,t){return i.left>=t.left-1&&i.left<=t.right+1&&i.top>=t.top-1&&i.top<=t.bottom+1}function mf(i,t){let e=i.parentNode;return e&&/^li$/i.test(e.nodeName)&&t.left<i.getBoundingClientRect().left?e:i}function gf(i,t,e){let{node:n,offset:o}=pd(t,e),r=-1;if(n.nodeType==1&&!n.firstChild){let s=n.getBoundingClientRect();r=s.left!=s.right&&e.left>(s.left+s.right)/2?1:-1}return i.docView.posFromDOM(n,o,r)}function yf(i,t,e,n){let o=-1;for(let r=t,s=!1;r!=i.dom;){let l=i.docView.nearestDesc(r,!0),a;if(!l)return null;if(l.dom.nodeType==1&&(l.node.isBlock&&l.parent||!l.contentDOM)&&((a=l.dom.getBoundingClientRect()).width||a.height)&&(l.node.isBlock&&l.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(l.dom.nodeName)&&(!s&&a.left>n.left||a.top>n.top?o=l.posBefore:(!s&&a.right<n.left||a.bottom<n.top)&&(o=l.posAfter),s=!0),!l.contentDOM&&o<0&&!l.node.isText))return(l.node.isBlock?n.top<(a.top+a.bottom)/2:n.left<(a.left+a.right)/2)?l.posBefore:l.posAfter;r=l.dom.parentNode}return o>-1?o:i.docView.posFromDOM(t,e,-1)}function fd(i,t,e){let n=i.childNodes.length;if(n&&e.top<e.bottom)for(let o=Math.max(0,Math.min(n-1,Math.floor(n*(t.top-e.top)/(e.bottom-e.top))-2)),r=o;;){let s=i.childNodes[r];if(s.nodeType==1){let l=s.getClientRects();for(let a=0;a<l.length;a++){let c=l[a];if(vs(t,c))return fd(s,t,c)}}if((r=(r+1)%n)==o)break}return i}function _f(i,t){let e=i.dom.ownerDocument,n,o=0,r=sf(e,t.left,t.top);r&&({node:n,offset:o}=r);let s=(i.root.elementFromPoint?i.root:e).elementFromPoint(t.left,t.top),l;if(!s||!i.dom.contains(s.nodeType!=1?s.parentNode:s)){let c=i.dom.getBoundingClientRect();if(!vs(t,c)||(s=fd(i.dom,t,c),!s))return null}if(xe)for(let c=s;n&&c;c=ii(c))c.draggable&&(n=void 0);if(s=mf(s,t),n){if(Be&&n.nodeType==1&&(o=Math.min(o,n.childNodes.length),o<n.childNodes.length)){let d=n.childNodes[o],u;d.nodeName=="IMG"&&(u=d.getBoundingClientRect()).right<=t.left&&u.bottom>t.top&&o++}let c;Li&&o&&n.nodeType==1&&(c=n.childNodes[o-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=t.top&&o--,n==i.dom&&o==n.childNodes.length-1&&n.lastChild.nodeType==1&&t.top>n.lastChild.getBoundingClientRect().bottom?l=i.state.doc.content.size:(o==0||n.nodeType!=1||n.childNodes[o-1].nodeName!="BR")&&(l=yf(i,n,o,t))}l==null&&(l=gf(i,s,t));let a=i.docView.nearestDesc(s,!0);return{pos:l,inside:a?a.posAtStart-a.border:-1}}function Nc(i){return i.top<i.bottom||i.left<i.right}function Bt(i,t){let e=i.getClientRects();if(e.length){let n=e[t<0?0:e.length-1];if(Nc(n))return n}return Array.prototype.find.call(e,Nc)||i.getBoundingClientRect()}var xf=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function hd(i,t,e){let{node:n,offset:o,atom:r}=i.docView.domFromPos(t,e<0?-1:1),s=Li||Be;if(n.nodeType==3)if(s&&(xf.test(n.nodeValue)||(e<0?!o:o==n.nodeValue.length))){let a=Bt(Ct(n,o,o),e);if(Be&&o&&/\s/.test(n.nodeValue[o-1])&&o<n.nodeValue.length){let c=Bt(Ct(n,o-1,o-1),-1);if(c.top==a.top){let d=Bt(Ct(n,o,o+1),-1);if(d.top!=a.top)return Ti(d,d.left<c.left)}}return a}else{let a=o,c=o,d=e<0?1:-1;return e<0&&!o?(c++,d=-1):e>=0&&o==n.nodeValue.length?(a--,d=1):e<0?a--:c++,Ti(Bt(Ct(n,a,c),d),d<0)}if(!i.state.doc.resolve(t-(r||0)).parent.inlineContent){if(r==null&&o&&(e<0||o==Le(n))){let a=n.childNodes[o-1];if(a.nodeType==1)return Xr(a.getBoundingClientRect(),!1)}if(r==null&&o<Le(n)){let a=n.childNodes[o];if(a.nodeType==1)return Xr(a.getBoundingClientRect(),!0)}return Xr(n.getBoundingClientRect(),e>=0)}if(r==null&&o&&(e<0||o==Le(n))){let a=n.childNodes[o-1],c=a.nodeType==3?Ct(a,Le(a)-(s?0:1)):a.nodeType==1&&(a.nodeName!="BR"||!a.nextSibling)?a:null;if(c)return Ti(Bt(c,1),!1)}if(r==null&&o<Le(n)){let a=n.childNodes[o];for(;a.pmViewDesc&&a.pmViewDesc.ignoreForCoords;)a=a.nextSibling;let c=a?a.nodeType==3?Ct(a,0,s?0:1):a.nodeType==1?a:null:null;if(c)return Ti(Bt(c,-1),!0)}return Ti(Bt(n.nodeType==3?Ct(n):n,-e),e>=0)}function Ti(i,t){if(i.width==0)return i;let e=t?i.left:i.right;return{top:i.top,bottom:i.bottom,left:e,right:e}}function Xr(i,t){if(i.height==0)return i;let e=t?i.top:i.bottom;return{top:e,bottom:e,left:i.left,right:i.right}}function md(i,t,e){let n=i.state,o=i.root.activeElement;n!=t&&i.updateState(t),o!=i.dom&&i.focus();try{return e()}finally{n!=t&&i.updateState(n),o!=i.dom&&o&&o.focus()}}function bf(i,t,e){let n=t.selection,o=e=="up"?n.$from:n.$to;return md(i,t,()=>{let{node:r}=i.docView.domFromPos(o.pos,e=="up"?-1:1);for(;;){let l=i.docView.nearestDesc(r,!0);if(!l)break;if(l.node.isBlock){r=l.contentDOM||l.dom;break}r=l.dom.parentNode}let s=hd(i,o.pos,1);for(let l=r.firstChild;l;l=l.nextSibling){let a;if(l.nodeType==1)a=l.getClientRects();else if(l.nodeType==3)a=Ct(l,0,l.nodeValue.length).getClientRects();else continue;for(let c=0;c<a.length;c++){let d=a[c];if(d.bottom>d.top+1&&(e=="up"?s.top-d.top>(d.bottom-s.top)*2:d.bottom-s.bottom>(s.bottom-d.top)*2))return!1}}return!0})}var Cf=/[\u0590-\u08ac]/;function vf(i,t,e){let{$head:n}=t.selection;if(!n.parent.isTextblock)return!1;let o=n.parentOffset,r=!o,s=o==n.parent.content.size,l=i.domSelection();return l?!Cf.test(n.parent.textContent)||!l.modify?e=="left"||e=="backward"?r:s:md(i,t,()=>{let{focusNode:a,focusOffset:c,anchorNode:d,anchorOffset:u}=i.domSelectionRange(),h=l.caretBidiLevel;l.modify("move",e,"character");let g=n.depth?i.docView.domAfterPos(n.before()):i.dom,{focusNode:m,focusOffset:b}=i.domSelectionRange(),C=m&&!g.contains(m.nodeType==1?m:m.parentNode)||a==m&&c==b;try{l.collapse(d,u),a&&(a!=d||c!=u)&&l.extend&&l.extend(a,c)}catch{}return h!=null&&(l.caretBidiLevel=h),C}):n.pos==n.start()||n.pos==n.end()}var Rc=null,Ac=null,Pc=!1;function Sf(i,t,e){return Rc==t&&Ac==e?Pc:(Rc=t,Ac=e,Pc=e=="up"||e=="down"?bf(i,t,e):vf(i,t,e))}var ze=0,Fc=1,an=2,dt=3,hn=class{constructor(t,e,n,o){this.parent=t,this.children=e,this.dom=n,this.contentDOM=o,this.dirty=ze,n.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,n){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,n=this.posAtStart;;e++){let o=this.children[e];if(o==t)return n;n+=o.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,n){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(n<0){let r,s;if(t==this.contentDOM)r=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;r=t.previousSibling}for(;r&&!((s=r.pmViewDesc)&&s.parent==this);)r=r.previousSibling;return r?this.posBeforeChild(s)+s.size:this.posAtStart}else{let r,s;if(t==this.contentDOM)r=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;r=t.nextSibling}for(;r&&!((s=r.pmViewDesc)&&s.parent==this);)r=r.nextSibling;return r?this.posBeforeChild(s):this.posAtEnd}let o;if(t==this.dom&&this.contentDOM)o=e>de(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))o=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(e==0)for(let r=t;;r=r.parentNode){if(r==this.dom){o=!1;break}if(r.previousSibling)break}if(o==null&&e==t.childNodes.length)for(let r=t;;r=r.parentNode){if(r==this.dom){o=!0;break}if(r.nextSibling)break}}return o??n>0?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let n=!0,o=t;o;o=o.parentNode){let r=this.getDesc(o),s;if(r&&(!e||r.node))if(n&&(s=r.nodeDOM)&&!(s.nodeType==1?s.contains(t.nodeType==1?t:t.parentNode):s==t))n=!1;else return r}}getDesc(t){let e=t.pmViewDesc;for(let n=e;n;n=n.parent)if(n==this)return e}posFromDOM(t,e,n){for(let o=t;o;o=o.parentNode){let r=this.getDesc(o);if(r)return r.localPosFromDOM(t,e,n)}return-1}descAt(t){for(let e=0,n=0;e<this.children.length;e++){let o=this.children[e],r=n+o.size;if(n==t&&r!=n){for(;!o.border&&o.children.length;)for(let s=0;s<o.children.length;s++){let l=o.children[s];if(l.size){o=l;break}}return o}if(t<r)return o.descAt(t-n-o.border);n=r}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let n=0,o=0;for(let r=0;n<this.children.length;n++){let s=this.children[n],l=r+s.size;if(l>t||s instanceof jo){o=t-r;break}r=l}if(o)return this.children[n].domFromPos(o-this.children[n].border,e);for(let r;n&&!(r=this.children[n-1]).size&&r instanceof Ho&&r.side>=0;n--);if(e<=0){let r,s=!0;for(;r=n?this.children[n-1]:null,!(!r||r.dom.parentNode==this.contentDOM);n--,s=!1);return r&&e&&s&&!r.border&&!r.domAtom?r.domFromPos(r.size,e):{node:this.contentDOM,offset:r?de(r.dom)+1:0}}else{let r,s=!0;for(;r=n<this.children.length?this.children[n]:null,!(!r||r.dom.parentNode==this.contentDOM);n++,s=!1);return r&&s&&!r.border&&!r.domAtom?r.domFromPos(0,e):{node:this.contentDOM,offset:r?de(r.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,n=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let o=-1,r=-1;for(let s=n,l=0;;l++){let a=this.children[l],c=s+a.size;if(o==-1&&t<=c){let d=s+a.border;if(t>=d&&e<=c-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(t,e,d);t=s;for(let u=l;u>0;u--){let h=this.children[u-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){o=de(h.dom)+1;break}t-=h.size}o==-1&&(o=0)}if(o>-1&&(c>e||l==this.children.length-1)){e=c;for(let d=l+1;d<this.children.length;d++){let u=this.children[d];if(u.size&&u.dom.parentNode==this.contentDOM&&!u.emptyChildAt(-1)){r=de(u.dom);break}e+=u.size}r==-1&&(r=this.contentDOM.childNodes.length);break}s=c}return{node:this.contentDOM,from:t,to:e,fromOffset:o,toOffset:r}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return e.size==0||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:n}=this.domFromPos(t,0);if(e.nodeType!=1||n==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[n]}setSelection(t,e,n,o=!1){let r=Math.min(t,e),s=Math.max(t,e);for(let g=0,m=0;g<this.children.length;g++){let b=this.children[g],C=m+b.size;if(r>m&&s<C)return b.setSelection(t-m-b.border,e-m-b.border,n,o);m=C}let l=this.domFromPos(t,t?-1:1),a=e==t?l:this.domFromPos(e,e?-1:1),c=n.root.getSelection(),d=n.domSelectionRange(),u=!1;if((Be||xe)&&t==e){let{node:g,offset:m}=l;if(g.nodeType==3){if(u=!!(m&&g.nodeValue[m-1]==`
`),u&&m==g.nodeValue.length)for(let b=g,C;b;b=b.parentNode){if(C=b.nextSibling){C.nodeName=="BR"&&(l=a={node:C.parentNode,offset:de(C)+1});break}let k=b.pmViewDesc;if(k&&k.node&&k.node.isBlock)break}}else{let b=g.childNodes[m-1];u=b&&(b.nodeName=="BR"||b.contentEditable=="false")}}if(Be&&d.focusNode&&d.focusNode!=a.node&&d.focusNode.nodeType==1){let g=d.focusNode.childNodes[d.focusOffset];g&&g.contentEditable=="false"&&(o=!0)}if(!(o||u&&xe)&&fn(l.node,l.offset,d.anchorNode,d.anchorOffset)&&fn(a.node,a.offset,d.focusNode,d.focusOffset))return;let h=!1;if((c.extend||t==e)&&!(u&&Be)){c.collapse(l.node,l.offset);try{t!=e&&c.extend(a.node,a.offset),h=!0}catch{}}if(!h){if(t>e){let m=l;l=a,a=m}let g=document.createRange();g.setEnd(a.node,a.offset),g.setStart(l.node,l.offset),c.removeAllRanges(),c.addRange(g)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let n=0,o=0;o<this.children.length;o++){let r=this.children[o],s=n+r.size;if(n==s?t<=s&&e>=n:t<s&&e>n){let l=n+r.border,a=s-r.border;if(t>=l&&e<=a){this.dirty=t==n||e==s?an:Fc,t==l&&e==a&&(r.contentLost||r.dom.parentNode!=this.contentDOM)?r.dirty=dt:r.markDirty(t-l,e-l);return}else r.dirty=r.dom==r.contentDOM&&r.dom.parentNode==this.contentDOM&&!r.children.length?an:dt}n=s}this.dirty=an}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let n=t==1?an:Fc;e.dirty<n&&(e.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(t){return!1}},Ho=class extends hn{constructor(t,e,n,o){let r,s=e.type.toDOM;if(typeof s=="function"&&(s=s(n,()=>{if(!r)return o;if(r.parent)return r.parent.posBeforeChild(r)})),!e.type.spec.raw){if(s.nodeType!=1){let l=document.createElement("span");l.appendChild(s),s=l}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(t,[],s,null),this.widget=e,this.widget=e,r=this}matchesWidget(t){return this.dirty==ze&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return e?e(t):!1}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}},as=class extends hn{constructor(t,e,n,o){super(t,[],e,null),this.textDOM=n,this.text=o}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}},ri=class i extends hn{constructor(t,e,n,o,r){super(t,[],n,o),this.mark=e,this.spec=r}static create(t,e,n,o){let r=o.nodeViews[e.type.name],s=r&&r(e,o,n);return(!s||!s.dom)&&(s=_t.renderSpec(document,e.type.spec.toDOM(e,n),null,e.attrs)),new i(t,e,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&dt||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=dt&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),this.dirty!=ze){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=ze}}slice(t,e,n){let o=i.create(this.parent,this.mark,!0,n),r=this.children,s=this.size;e<s&&(r=ps(r,e,s,n)),t>0&&(r=ps(r,0,t,n));for(let l=0;l<r.length;l++)r[l].parent=o;return o.children=r,o}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}},Ht=class i extends hn{constructor(t,e,n,o,r,s,l,a,c){super(t,[],r,s),this.node=e,this.outerDeco=n,this.innerDeco=o,this.nodeDOM=l}static create(t,e,n,o,r,s){let l=r.nodeViews[e.type.name],a,c=l&&l(e,r,()=>{if(!a)return s;if(a.parent)return a.parent.posBeforeChild(a)},n,o),d=c&&c.dom,u=c&&c.contentDOM;if(e.isText){if(!d)d=document.createTextNode(e.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:u}=_t.renderSpec(document,e.type.spec.toDOM(e),null,e.attrs));!u&&!e.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),e.type.spec.draggable&&(d.draggable=!0));let h=d;return d=_d(d,n,e),c?a=new cs(t,e,n,o,d,u||null,h,c,r,s+1):e.isText?new $o(t,e,n,o,d,h,r):new i(t,e,n,o,d,u||null,h,r,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),!this.contentDOM)t.getContent=()=>this.node.content;else if(!this.contentLost)t.contentElement=this.contentDOM;else{for(let e=this.children.length-1;e>=0;e--){let n=this.children[e];if(this.dom.contains(n.dom.parentNode)){t.contentElement=n.dom.parentNode;break}}t.contentElement||(t.getContent=()=>w.empty)}return t}matchesNode(t,e,n){return this.dirty==ze&&t.eq(this.node)&&Uo(e,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let n=this.node.inlineContent,o=e,r=t.composing?this.localCompositionInfo(t,e):null,s=r&&r.pos>-1?r:null,l=r&&r.pos<0,a=new us(this,s&&s.node,t);Ef(this.node,this.innerDeco,(c,d,u)=>{c.spec.marks?a.syncToMarks(c.spec.marks,n,t):c.type.side>=0&&!u&&a.syncToMarks(d==this.node.childCount?W.none:this.node.child(d).marks,n,t),a.placeWidget(c,t,o)},(c,d,u,h)=>{a.syncToMarks(c.marks,n,t);let g;a.findNodeMatch(c,d,u,h)||l&&t.state.selection.from>o&&t.state.selection.to<o+c.nodeSize&&(g=a.findIndexWithChild(r.node))>-1&&a.updateNodeAt(c,d,u,g,t)||a.updateNextNode(c,d,u,t,h,o)||a.addNode(c,d,u,t,o),o+=c.nodeSize}),a.syncToMarks([],n,t),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||this.dirty==an)&&(s&&this.protectLocalComposition(t,s),gd(this.contentDOM,this.children,t),oi&&kf(this.dom))}localCompositionInfo(t,e){let{from:n,to:o}=t.state.selection;if(!(t.state.selection instanceof U)||n<e||o>e+this.node.content.size)return null;let r=t.input.compositionNode;if(!r||!this.dom.contains(r.parentNode))return null;if(this.node.inlineContent){let s=r.nodeValue,l=Tf(this.node.content,s,n-e,o-e);return l<0?null:{node:r,pos:l,text:s}}else return{node:r,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:n,text:o}){if(this.getDesc(e))return;let r=e;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let s=new as(this,r,e,o);t.input.compositionNodes.push(s),this.children=ps(this.children,n,n+o.length,t,s)}update(t,e,n,o){return this.dirty==dt||!t.sameMarkup(this.node)?!1:(this.updateInner(t,e,n,o),!0)}updateInner(t,e,n,o){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(o,this.posAtStart),this.dirty=ze}updateOuterDeco(t){if(Uo(t,this.outerDeco))return;let e=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=yd(this.dom,this.nodeDOM,ds(this.outerDeco,this.node,e),ds(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}};function Lc(i,t,e,n,o){_d(n,t,i);let r=new Ht(void 0,i,t,e,n,n,n,o,0);return r.contentDOM&&r.updateChildren(o,0),r}var $o=class i extends Ht{constructor(t,e,n,o,r,s,l){super(t,e,n,o,r,null,s,l,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,e,n,o){return this.dirty==dt||this.dirty!=ze&&!this.inParent()||!t.sameMarkup(this.node)?!1:(this.updateOuterDeco(e),(this.dirty!=ze||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=t.text,o.trackWrites==this.nodeDOM&&(o.trackWrites=null)),this.node=t,this.dirty=ze,!0)}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,n){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,n)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,e,n){let o=this.node.cut(t,e),r=document.createTextNode(o.text);return new i(this.parent,o,this.outerDeco,this.innerDeco,r,r,n)}markDirty(t,e){super.markDirty(t,e),this.dom!=this.nodeDOM&&(t==0||e==this.nodeDOM.nodeValue.length)&&(this.dirty=dt)}get domAtom(){return!1}isText(t){return this.node.text==t}},jo=class extends hn{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==ze&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}},cs=class extends Ht{constructor(t,e,n,o,r,s,l,a,c,d){super(t,e,n,o,r,s,l,c,d),this.spec=a}update(t,e,n,o){if(this.dirty==dt)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let r=this.spec.update(t,e,n);return r&&this.updateInner(t,e,n,o),r}else return!this.contentDOM&&!t.isLeaf?!1:super.update(t,e,n,o)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,n,o){this.spec.setSelection?this.spec.setSelection(t,e,n.root):super.setSelection(t,e,n,o)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return this.spec.stopEvent?this.spec.stopEvent(t):!1}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}};function gd(i,t,e){let n=i.firstChild,o=!1;for(let r=0;r<t.length;r++){let s=t[r],l=s.dom;if(l.parentNode==i){for(;l!=n;)n=Bc(n),o=!0;n=n.nextSibling}else o=!0,i.insertBefore(l,n);if(s instanceof ri){let a=n?n.previousSibling:i.lastChild;gd(s.contentDOM,s.children,e),n=a?a.nextSibling:i.firstChild}}for(;n;)n=Bc(n),o=!0;o&&e.trackWrites==i&&(e.trackWrites=null)}var Oi=function(i){i&&(this.nodeName=i)};Oi.prototype=Object.create(null);var cn=[new Oi];function ds(i,t,e){if(i.length==0)return cn;let n=e?cn[0]:new Oi,o=[n];for(let r=0;r<i.length;r++){let s=i[r].type.attrs;if(s){s.nodeName&&o.push(n=new Oi(s.nodeName));for(let l in s){let a=s[l];a!=null&&(e&&o.length==1&&o.push(n=new Oi(t.isInline?"span":"div")),l=="class"?n.class=(n.class?n.class+" ":"")+a:l=="style"?n.style=(n.style?n.style+";":"")+a:l!="nodeName"&&(n[l]=a))}}}return o}function yd(i,t,e,n){if(e==cn&&n==cn)return t;let o=t;for(let r=0;r<n.length;r++){let s=n[r],l=e[r];if(r){let a;l&&l.nodeName==s.nodeName&&o!=i&&(a=o.parentNode)&&a.nodeName.toLowerCase()==s.nodeName||(a=document.createElement(s.nodeName),a.pmIsDeco=!0,a.appendChild(o),l=cn[0]),o=a}wf(o,l||cn[0],s)}return o}function wf(i,t,e){for(let n in t)n!="class"&&n!="style"&&n!="nodeName"&&!(n in e)&&i.removeAttribute(n);for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&e[n]!=t[n]&&i.setAttribute(n,e[n]);if(t.class!=e.class){let n=t.class?t.class.split(" ").filter(Boolean):[],o=e.class?e.class.split(" ").filter(Boolean):[];for(let r=0;r<n.length;r++)o.indexOf(n[r])==-1&&i.classList.remove(n[r]);for(let r=0;r<o.length;r++)n.indexOf(o[r])==-1&&i.classList.add(o[r]);i.classList.length==0&&i.removeAttribute("class")}if(t.style!=e.style){if(t.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,o;for(;o=n.exec(t.style);)i.style.removeProperty(o[1])}e.style&&(i.style.cssText+=e.style)}}function _d(i,t,e){return yd(i,i,cn,ds(t,e,i.nodeType!=1))}function Uo(i,t){if(i.length!=t.length)return!1;for(let e=0;e<i.length;e++)if(!i[e].type.eq(t[e].type))return!1;return!0}function Bc(i){let t=i.nextSibling;return i.parentNode.removeChild(i),t}var us=class{constructor(t,e,n){this.lock=e,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=Mf(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,n){let o=0,r=this.stack.length>>1,s=Math.min(r,t.length);for(;o<s&&(o==r-1?this.top:this.stack[o+1<<1]).matchesMark(t[o])&&t[o].type.spec.spanning!==!1;)o++;for(;o<r;)this.destroyRest(),this.top.dirty=ze,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<t.length;){this.stack.push(this.top,this.index+1);let l=-1;for(let a=this.index;a<Math.min(this.index+3,this.top.children.length);a++){let c=this.top.children[a];if(c.matchesMark(t[r])&&!this.isLocked(c.dom)){l=a;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let a=ri.create(this.top,t[r],e,n);this.top.children.splice(this.index,0,a),this.top=a,this.changed=!0}this.index=0,r++}}findNodeMatch(t,e,n,o){let r=-1,s;if(o>=this.preMatch.index&&(s=this.preMatch.matches[o-this.preMatch.index]).parent==this.top&&s.matchesNode(t,e,n))r=this.top.children.indexOf(s,this.index);else for(let l=this.index,a=Math.min(this.top.children.length,l+5);l<a;l++){let c=this.top.children[l];if(c.matchesNode(t,e,n)&&!this.preMatch.matched.has(c)){r=l;break}}return r<0?!1:(this.destroyBetween(this.index,r),this.index++,!0)}updateNodeAt(t,e,n,o,r){let s=this.top.children[o];return s.dirty==dt&&s.dom==s.contentDOM&&(s.dirty=an),s.update(t,e,n,r)?(this.destroyBetween(this.index,o),this.index++,!0):!1}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let n=t.pmViewDesc;if(n){for(let o=this.index;o<this.top.children.length;o++)if(this.top.children[o]==n)return o}return-1}t=e}}updateNextNode(t,e,n,o,r,s){for(let l=this.index;l<this.top.children.length;l++){let a=this.top.children[l];if(a instanceof Ht){let c=this.preMatch.matched.get(a);if(c!=null&&c!=r)return!1;let d=a.dom,u,h=this.isLocked(d)&&!(t.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==t.text&&a.dirty!=dt&&Uo(e,a.outerDeco));if(!h&&a.update(t,e,n,o))return this.destroyBetween(this.index,l),a.dom!=d&&(this.changed=!0),this.index++,!0;if(!h&&(u=this.recreateWrapper(a,t,e,n,o,s)))return this.destroyBetween(this.index,l),this.top.children[this.index]=u,u.contentDOM&&(u.dirty=an,u.updateChildren(o,s+1),u.dirty=ze),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,e,n,o,r,s){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content)||!Uo(n,t.outerDeco)||!o.eq(t.innerDeco))return null;let l=Ht.create(this.top,e,n,o,r,s);if(l.contentDOM){l.children=t.children,t.children=[];for(let a of l.children)a.parent=l}return t.destroy(),l}addNode(t,e,n,o,r){let s=Ht.create(this.top,t,e,n,o,r);s.contentDOM&&s.updateChildren(o,r+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(t,e,n){let o=this.index<this.top.children.length?this.top.children[this.index]:null;if(o&&o.matchesWidget(t)&&(t==o.widget||!o.widget.type.toDOM.parentNode))this.index++;else{let r=new Ho(this.top,t,e,n);this.top.children.splice(this.index++,0,r),this.changed=!0}}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;for(;t instanceof ri;)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof $o)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((xe||ge)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let n=document.createElement(t);t=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),t=="BR"&&(n.className="ProseMirror-trailingBreak");let o=new jo(this.top,[],n,null);e!=this.top?e.children.push(o):e.children.splice(this.index++,0,o),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}};function Mf(i,t){let e=t,n=e.children.length,o=i.childCount,r=new Map,s=[];e:for(;o>0;){let l;for(;;)if(n){let c=e.children[n-1];if(c instanceof ri)e=c,n=c.children.length;else{l=c,n--;break}}else{if(e==t)break e;n=e.parent.children.indexOf(e),e=e.parent}let a=l.node;if(a){if(a!=i.child(o-1))break;--o,r.set(l,o),s.push(l)}}return{index:o,matched:r,matches:s.reverse()}}function If(i,t){return i.type.side-t.type.side}function Ef(i,t,e,n){let o=t.locals(i),r=0;if(o.length==0){for(let c=0;c<i.childCount;c++){let d=i.child(c);n(d,o,t.forChild(r,d),c),r+=d.nodeSize}return}let s=0,l=[],a=null;for(let c=0;;){let d,u;for(;s<o.length&&o[s].to==r;){let C=o[s++];C.widget&&(d?(u||(u=[d])).push(C):d=C)}if(d)if(u){u.sort(If);for(let C=0;C<u.length;C++)e(u[C],c,!!a)}else e(d,c,!!a);let h,g;if(a)g=-1,h=a,a=null;else if(c<i.childCount)g=c,h=i.child(c++);else break;for(let C=0;C<l.length;C++)l[C].to<=r&&l.splice(C--,1);for(;s<o.length&&o[s].from<=r&&o[s].to>r;)l.push(o[s++]);let m=r+h.nodeSize;if(h.isText){let C=m;s<o.length&&o[s].from<C&&(C=o[s].from);for(let k=0;k<l.length;k++)l[k].to<C&&(C=l[k].to);C<m&&(a=h.cut(C-r),h=h.cut(0,C-r),m=C,g=-1)}else for(;s<o.length&&o[s].to<m;)s++;let b=h.isInline&&!h.isLeaf?l.filter(C=>!C.inline):l.slice();n(h,b,t.forChild(r,h),g),r=m}}function kf(i){if(i.nodeName=="UL"||i.nodeName=="OL"){let t=i.style.cssText;i.style.cssText=t+"; list-style: square !important",window.getComputedStyle(i).listStyle,i.style.cssText=t}}function Tf(i,t,e,n){for(let o=0,r=0;o<i.childCount&&r<=n;){let s=i.child(o++),l=r;if(r+=s.nodeSize,!s.isText)continue;let a=s.text;for(;o<i.childCount;){let c=i.child(o++);if(r+=c.nodeSize,!c.isText)break;a+=c.text}if(r>=e){if(r>=n&&a.slice(n-t.length-l,n-l)==t)return n-t.length;let c=l<n?a.lastIndexOf(t,n-l-1):-1;if(c>=0&&c+t.length+l>=e)return l+c;if(e==n&&a.length>=n+t.length-l&&a.slice(n-l,n-l+t.length)==t)return n}}return-1}function ps(i,t,e,n,o){let r=[];for(let s=0,l=0;s<i.length;s++){let a=i[s],c=l,d=l+=a.size;c>=e||d<=t?r.push(a):(c<t&&r.push(a.slice(0,t-c,n)),o&&(r.push(o),o=void 0),d>e&&r.push(a.slice(e-c,a.size,n)))}return r}function Ss(i,t=null){let e=i.domSelectionRange(),n=i.state.doc;if(!e.focusNode)return null;let o=i.docView.nearestDesc(e.focusNode),r=o&&o.size==0,s=i.docView.posFromDOM(e.focusNode,e.focusOffset,1);if(s<0)return null;let l=n.resolve(s),a,c;if(Xo(e)){for(a=s;o&&!o.node;)o=o.parent;let u=o.node;if(o&&u.isAtom&&N.isSelectable(u)&&o.parent&&!(u.isInline&&of(e.focusNode,e.focusOffset,o.dom))){let h=o.posBefore;c=new N(s==h?l:n.resolve(h))}}else{if(e instanceof i.dom.ownerDocument.defaultView.Selection&&e.rangeCount>1){let u=s,h=s;for(let g=0;g<e.rangeCount;g++){let m=e.getRangeAt(g);u=Math.min(u,i.docView.posFromDOM(m.startContainer,m.startOffset,1)),h=Math.max(h,i.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(u<0)return null;[a,s]=h==i.state.selection.anchor?[h,u]:[u,h],l=n.resolve(s)}else a=i.docView.posFromDOM(e.anchorNode,e.anchorOffset,1);if(a<0)return null}let d=n.resolve(a);if(!c){let u=t=="pointer"||i.state.selection.head<l.pos&&!r?1:-1;c=ws(i,d,l,u)}return c}function xd(i){return i.editable?i.hasFocus():Cd(i)&&document.activeElement&&document.activeElement.contains(i.dom)}function St(i,t=!1){let e=i.state.selection;if(bd(i,e),!!xd(i)){if(!t&&i.input.mouseDown&&i.input.mouseDown.allowDefault&&ge){let n=i.domSelectionRange(),o=i.domObserver.currentSelection;if(n.anchorNode&&o.anchorNode&&fn(n.anchorNode,n.anchorOffset,o.anchorNode,o.anchorOffset)){i.input.mouseDown.delayedSelectionSync=!0,i.domObserver.setCurSelection();return}}if(i.domObserver.disconnectSelection(),i.cursorWrapper)Df(i);else{let{anchor:n,head:o}=e,r,s;zc&&!(e instanceof U)&&(e.$from.parent.inlineContent||(r=qc(i,e.from)),!e.empty&&!e.$from.parent.inlineContent&&(s=qc(i,e.to))),i.docView.setSelection(n,o,i,t),zc&&(r&&Vc(r),s&&Vc(s)),e.visible?i.dom.classList.remove("ProseMirror-hideselection"):(i.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Of(i))}i.domObserver.setCurSelection(),i.domObserver.connectSelection()}}var zc=xe||ge&&cd<63;function qc(i,t){let{node:e,offset:n}=i.docView.domFromPos(t,0),o=n<e.childNodes.length?e.childNodes[n]:null,r=n?e.childNodes[n-1]:null;if(xe&&o&&o.contentEditable=="false")return Zr(o);if((!o||o.contentEditable=="false")&&(!r||r.contentEditable=="false")){if(o)return Zr(o);if(r)return Zr(r)}}function Zr(i){return i.contentEditable="true",xe&&i.draggable&&(i.draggable=!1,i.wasDraggable=!0),i}function Vc(i){i.contentEditable="false",i.wasDraggable&&(i.draggable=!0,i.wasDraggable=null)}function Of(i){let t=i.dom.ownerDocument;t.removeEventListener("selectionchange",i.input.hideSelectionGuard);let e=i.domSelectionRange(),n=e.anchorNode,o=e.anchorOffset;t.addEventListener("selectionchange",i.input.hideSelectionGuard=()=>{(e.anchorNode!=n||e.anchorOffset!=o)&&(t.removeEventListener("selectionchange",i.input.hideSelectionGuard),setTimeout(()=>{(!xd(i)||i.state.selection.visible)&&i.dom.classList.remove("ProseMirror-hideselection")},20))})}function Df(i){let t=i.domSelection();if(!t)return;let e=i.cursorWrapper.dom,n=e.nodeName=="IMG";n?t.collapse(e.parentNode,de(e)+1):t.collapse(e,0),!n&&!i.state.selection.visible&&Ie&&Vt<=11&&(e.disabled=!0,e.disabled=!1)}function bd(i,t){if(t instanceof N){let e=i.docView.descAt(t.from);e!=i.lastSelectedViewDesc&&(Hc(i),e&&e.selectNode(),i.lastSelectedViewDesc=e)}else Hc(i)}function Hc(i){i.lastSelectedViewDesc&&(i.lastSelectedViewDesc.parent&&i.lastSelectedViewDesc.deselectNode(),i.lastSelectedViewDesc=void 0)}function ws(i,t,e,n){return i.someProp("createSelectionBetween",o=>o(i,t,e))||U.between(t,e,n)}function $c(i){return i.editable&&!i.hasFocus()?!1:Cd(i)}function Cd(i){let t=i.domSelectionRange();if(!t.anchorNode)return!1;try{return i.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(i.editable||i.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function Nf(i){let t=i.docView.domFromPos(i.state.selection.anchor,0),e=i.domSelectionRange();return fn(t.node,t.offset,e.anchorNode,e.anchorOffset)}function fs(i,t){let{$anchor:e,$head:n}=i.selection,o=t>0?e.max(n):e.min(n),r=o.parent.inlineContent?o.depth?i.doc.resolve(t>0?o.after():o.before()):null:o;return r&&z.findFrom(r,t)}function zt(i,t){return i.dispatch(i.state.tr.setSelection(t).scrollIntoView()),!0}function jc(i,t,e){let n=i.state.selection;if(n instanceof U)if(e.indexOf("s")>-1){let{$head:o}=n,r=o.textOffset?null:t<0?o.nodeBefore:o.nodeAfter;if(!r||r.isText||!r.isLeaf)return!1;let s=i.state.doc.resolve(o.pos+r.nodeSize*(t<0?-1:1));return zt(i,new U(n.$anchor,s))}else if(n.empty){if(i.endOfTextblock(t>0?"forward":"backward")){let o=fs(i.state,t);return o&&o instanceof N?zt(i,o):!1}else if(!(Fe&&e.indexOf("m")>-1)){let o=n.$head,r=o.textOffset?null:t<0?o.nodeBefore:o.nodeAfter,s;if(!r||r.isText)return!1;let l=t<0?o.pos-r.nodeSize:o.pos;return r.isAtom||(s=i.docView.descAt(l))&&!s.contentDOM?N.isSelectable(r)?zt(i,new N(t<0?i.state.doc.resolve(o.pos-r.nodeSize):o)):Li?zt(i,new U(i.state.doc.resolve(t<0?l:l+r.nodeSize))):!1:!1}}else return!1;else{if(n instanceof N&&n.node.isInline)return zt(i,new U(t>0?n.$to:n.$from));{let o=fs(i.state,t);return o?zt(i,o):!1}}}function Wo(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function Di(i,t){let e=i.pmViewDesc;return e&&e.size==0&&(t<0||i.nextSibling||i.nodeName!="BR")}function ei(i,t){return t<0?Rf(i):Af(i)}function Rf(i){let t=i.domSelectionRange(),e=t.focusNode,n=t.focusOffset;if(!e)return;let o,r,s=!1;for(Be&&e.nodeType==1&&n<Wo(e)&&Di(e.childNodes[n],-1)&&(s=!0);;)if(n>0){if(e.nodeType!=1)break;{let l=e.childNodes[n-1];if(Di(l,-1))o=e,r=--n;else if(l.nodeType==3)e=l,n=e.nodeValue.length;else break}}else{if(vd(e))break;{let l=e.previousSibling;for(;l&&Di(l,-1);)o=e.parentNode,r=de(l),l=l.previousSibling;if(l)e=l,n=Wo(e);else{if(e=e.parentNode,e==i.dom)break;n=0}}}s?hs(i,e,n):o&&hs(i,o,r)}function Af(i){let t=i.domSelectionRange(),e=t.focusNode,n=t.focusOffset;if(!e)return;let o=Wo(e),r,s;for(;;)if(n<o){if(e.nodeType!=1)break;let l=e.childNodes[n];if(Di(l,1))r=e,s=++n;else break}else{if(vd(e))break;{let l=e.nextSibling;for(;l&&Di(l,1);)r=l.parentNode,s=de(l)+1,l=l.nextSibling;if(l)e=l,n=0,o=Wo(e);else{if(e=e.parentNode,e==i.dom)break;n=o=0}}}r&&hs(i,r,s)}function vd(i){let t=i.pmViewDesc;return t&&t.node&&t.node.isBlock}function Pf(i,t){for(;i&&t==i.childNodes.length&&!Fi(i);)t=de(i)+1,i=i.parentNode;for(;i&&t<i.childNodes.length;){let e=i.childNodes[t];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;i=e,t=0}}function Ff(i,t){for(;i&&!t&&!Fi(i);)t=de(i),i=i.parentNode;for(;i&&t;){let e=i.childNodes[t-1];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;i=e,t=i.childNodes.length}}function hs(i,t,e){if(t.nodeType!=3){let r,s;(s=Pf(t,e))?(t=s,e=0):(r=Ff(t,e))&&(t=r,e=r.nodeValue.length)}let n=i.domSelection();if(!n)return;if(Xo(n)){let r=document.createRange();r.setEnd(t,e),r.setStart(t,e),n.removeAllRanges(),n.addRange(r)}else n.extend&&n.extend(t,e);i.domObserver.setCurSelection();let{state:o}=i;setTimeout(()=>{i.state==o&&St(i)},50)}function Uc(i,t){let e=i.state.doc.resolve(t);if(!(ge||lf)&&e.parent.inlineContent){let o=i.coordsAtPos(t);if(t>e.start()){let r=i.coordsAtPos(t-1),s=(r.top+r.bottom)/2;if(s>o.top&&s<o.bottom&&Math.abs(r.left-o.left)>1)return r.left<o.left?"ltr":"rtl"}if(t<e.end()){let r=i.coordsAtPos(t+1),s=(r.top+r.bottom)/2;if(s>o.top&&s<o.bottom&&Math.abs(r.left-o.left)>1)return r.left>o.left?"ltr":"rtl"}}return getComputedStyle(i.dom).direction=="rtl"?"rtl":"ltr"}function Wc(i,t,e){let n=i.state.selection;if(n instanceof U&&!n.empty||e.indexOf("s")>-1||Fe&&e.indexOf("m")>-1)return!1;let{$from:o,$to:r}=n;if(!o.parent.inlineContent||i.endOfTextblock(t<0?"up":"down")){let s=fs(i.state,t);if(s&&s instanceof N)return zt(i,s)}if(!o.parent.inlineContent){let s=t<0?o:r,l=n instanceof De?z.near(s,t):z.findFrom(s,t);return l?zt(i,l):!1}return!1}function Gc(i,t){if(!(i.state.selection instanceof U))return!0;let{$head:e,$anchor:n,empty:o}=i.state.selection;if(!e.sameParent(n))return!0;if(!o)return!1;if(i.endOfTextblock(t>0?"forward":"backward"))return!0;let r=!e.textOffset&&(t<0?e.nodeBefore:e.nodeAfter);if(r&&!r.isText){let s=i.state.tr;return t<0?s.delete(e.pos-r.nodeSize,e.pos):s.delete(e.pos,e.pos+r.nodeSize),i.dispatch(s),!0}return!1}function Kc(i,t,e){i.domObserver.stop(),t.contentEditable=e,i.domObserver.start()}function Lf(i){if(!xe||i.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:e}=i.domSelectionRange();if(t&&t.nodeType==1&&e==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let n=t.firstChild;Kc(i,n,"true"),setTimeout(()=>Kc(i,n,"false"),20)}return!1}function Bf(i){let t="";return i.ctrlKey&&(t+="c"),i.metaKey&&(t+="m"),i.altKey&&(t+="a"),i.shiftKey&&(t+="s"),t}function zf(i,t){let e=t.keyCode,n=Bf(t);if(e==8||Fe&&e==72&&n=="c")return Gc(i,-1)||ei(i,-1);if(e==46&&!t.shiftKey||Fe&&e==68&&n=="c")return Gc(i,1)||ei(i,1);if(e==13||e==27)return!0;if(e==37||Fe&&e==66&&n=="c"){let o=e==37?Uc(i,i.state.selection.from)=="ltr"?-1:1:-1;return jc(i,o,n)||ei(i,o)}else if(e==39||Fe&&e==70&&n=="c"){let o=e==39?Uc(i,i.state.selection.from)=="ltr"?1:-1:1;return jc(i,o,n)||ei(i,o)}else{if(e==38||Fe&&e==80&&n=="c")return Wc(i,-1,n)||ei(i,-1);if(e==40||Fe&&e==78&&n=="c")return Lf(i)||Wc(i,1,n)||ei(i,1);if(n==(Fe?"m":"c")&&(e==66||e==73||e==89||e==90))return!0}return!1}function Ms(i,t){i.someProp("transformCopied",g=>{t=g(t,i)});let e=[],{content:n,openStart:o,openEnd:r}=t;for(;o>1&&r>1&&n.childCount==1&&n.firstChild.childCount==1;){o--,r--;let g=n.firstChild;e.push(g.type.name,g.attrs!=g.type.defaultAttrs?g.attrs:null),n=g.content}let s=i.someProp("clipboardSerializer")||_t.fromSchema(i.state.schema),l=kd(),a=l.createElement("div");a.appendChild(s.serializeFragment(n,{document:l}));let c=a.firstChild,d,u=0;for(;c&&c.nodeType==1&&(d=Ed[c.nodeName.toLowerCase()]);){for(let g=d.length-1;g>=0;g--){let m=l.createElement(d[g]);for(;a.firstChild;)m.appendChild(a.firstChild);a.appendChild(m),u++}c=a.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${o} ${r}${u?` -${u}`:""} ${JSON.stringify(e)}`);let h=i.someProp("clipboardTextSerializer",g=>g(t,i))||t.content.textBetween(0,t.content.size,`

`);return{dom:a,text:h,slice:t}}function Sd(i,t,e,n,o){let r=o.parent.type.spec.code,s,l;if(!e&&!t)return null;let a=!!t&&(n||r||!e);if(a){if(i.someProp("transformPastedText",h=>{t=h(t,r||n,i)}),r)return l=new I(w.from(i.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0),i.someProp("transformPasted",h=>{l=h(l,i,!0)}),l;let u=i.someProp("clipboardTextParser",h=>h(t,o,n,i));if(u)l=u;else{let h=o.marks(),{schema:g}=i.state,m=_t.fromSchema(g);s=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(b=>{let C=s.appendChild(document.createElement("p"));b&&C.appendChild(m.serializeNode(g.text(b,h)))})}}else i.someProp("transformPastedHTML",u=>{e=u(e,i)}),s=$f(e),Li&&jf(s);let c=s&&s.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let u=+d[3];u>0;u--){let h=s.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;s=h}if(l||(l=(i.someProp("clipboardParser")||i.someProp("domParser")||Ft.fromSchema(i.state.schema)).parseSlice(s,{preserveWhitespace:!!(a||d),context:o,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!qf.test(h.parentNode.nodeName)?{ignore:!0}:null}})),d)l=Uf(Jc(l,+d[1],+d[2]),d[4]);else if(l=I.maxOpen(Vf(l.content,o),!0),l.openStart||l.openEnd){let u=0,h=0;for(let g=l.content.firstChild;u<l.openStart&&!g.type.spec.isolating;u++,g=g.firstChild);for(let g=l.content.lastChild;h<l.openEnd&&!g.type.spec.isolating;h++,g=g.lastChild);l=Jc(l,u,h)}return i.someProp("transformPasted",u=>{l=u(l,i,a)}),l}var qf=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Vf(i,t){if(i.childCount<2)return i;for(let e=t.depth;e>=0;e--){let o=t.node(e).contentMatchAt(t.index(e)),r,s=[];if(i.forEach(l=>{if(!s)return;let a=o.findWrapping(l.type),c;if(!a)return s=null;if(c=s.length&&r.length&&Md(a,r,l,s[s.length-1],0))s[s.length-1]=c;else{s.length&&(s[s.length-1]=Id(s[s.length-1],r.length));let d=wd(l,a);s.push(d),o=o.matchType(d.type),r=a}}),s)return w.from(s)}return i}function wd(i,t,e=0){for(let n=t.length-1;n>=e;n--)i=t[n].create(null,w.from(i));return i}function Md(i,t,e,n,o){if(o<i.length&&o<t.length&&i[o]==t[o]){let r=Md(i,t,e,n.lastChild,o+1);if(r)return n.copy(n.content.replaceChild(n.childCount-1,r));if(n.contentMatchAt(n.childCount).matchType(o==i.length-1?e.type:i[o+1]))return n.copy(n.content.append(w.from(wd(e,i,o+1))))}}function Id(i,t){if(t==0)return i;let e=i.content.replaceChild(i.childCount-1,Id(i.lastChild,t-1)),n=i.contentMatchAt(i.childCount).fillBefore(w.empty,!0);return i.copy(e.append(n))}function ms(i,t,e,n,o,r){let s=t<0?i.firstChild:i.lastChild,l=s.content;return i.childCount>1&&(r=0),o<n-1&&(l=ms(l,t,e,n,o+1,r)),o>=e&&(l=t<0?s.contentMatchAt(0).fillBefore(l,r<=o).append(l):l.append(s.contentMatchAt(s.childCount).fillBefore(w.empty,!0))),i.replaceChild(t<0?0:i.childCount-1,s.copy(l))}function Jc(i,t,e){return t<i.openStart&&(i=new I(ms(i.content,-1,t,i.openStart,0,i.openEnd),t,i.openEnd)),e<i.openEnd&&(i=new I(ms(i.content,1,e,i.openEnd,0,0),i.openStart,e)),i}var Ed={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Yc=null;function kd(){return Yc||(Yc=document.implementation.createHTMLDocument("title"))}var es=null;function Hf(i){let t=window.trustedTypes;return t?(es||(es=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e})),es.createHTML(i)):i}function $f(i){let t=/^(\s*<meta [^>]*>)*/.exec(i);t&&(i=i.slice(t[0].length));let e=kd().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(i),o;if((o=n&&Ed[n[1].toLowerCase()])&&(i=o.map(r=>"<"+r+">").join("")+i+o.map(r=>"</"+r+">").reverse().join("")),e.innerHTML=Hf(i),o)for(let r=0;r<o.length;r++)e=e.querySelector(o[r])||e;return e}function jf(i){let t=i.querySelectorAll(ge?"span:not([class]):not([style])":"span.Apple-converted-space");for(let e=0;e<t.length;e++){let n=t[e];n.childNodes.length==1&&n.textContent=="\xA0"&&n.parentNode&&n.parentNode.replaceChild(i.ownerDocument.createTextNode(" "),n)}}function Uf(i,t){if(!i.size)return i;let e=i.content.firstChild.type.schema,n;try{n=JSON.parse(t)}catch{return i}let{content:o,openStart:r,openEnd:s}=i;for(let l=n.length-2;l>=0;l-=2){let a=e.nodes[n[l]];if(!a||a.hasRequiredAttrs())break;o=w.from(a.create(n[l+1],o)),r++,s++}return new I(o,r,s)}var be={},Ce={},Wf={touchstart:!0,touchmove:!0},gs=class{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};function Gf(i){for(let t in be){let e=be[t];i.dom.addEventListener(t,i.input.eventHandlers[t]=n=>{Jf(i,n)&&!Is(i,n)&&(i.editable||!(n.type in Ce))&&e(i,n)},Wf[t]?{passive:!0}:void 0)}xe&&i.dom.addEventListener("input",()=>null),ys(i)}function qt(i,t){i.input.lastSelectionOrigin=t,i.input.lastSelectionTime=Date.now()}function Kf(i){i.domObserver.stop();for(let t in i.input.eventHandlers)i.dom.removeEventListener(t,i.input.eventHandlers[t]);clearTimeout(i.input.composingTimeout),clearTimeout(i.input.lastIOSEnterFallbackTimeout)}function ys(i){i.someProp("handleDOMEvents",t=>{for(let e in t)i.input.eventHandlers[e]||i.dom.addEventListener(e,i.input.eventHandlers[e]=n=>Is(i,n))})}function Is(i,t){return i.someProp("handleDOMEvents",e=>{let n=e[t.type];return n?n(i,t)||t.defaultPrevented:!1})}function Jf(i,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target;e!=i.dom;e=e.parentNode)if(!e||e.nodeType==11||e.pmViewDesc&&e.pmViewDesc.stopEvent(t))return!1;return!0}function Yf(i,t){!Is(i,t)&&be[t.type]&&(i.editable||!(t.type in Ce))&&be[t.type](i,t)}Ce.keydown=(i,t)=>{let e=t;if(i.input.shiftKey=e.keyCode==16||e.shiftKey,!Od(i,e)&&(i.input.lastKeyCode=e.keyCode,i.input.lastKeyCodeTime=Date.now(),!(vt&&ge&&e.keyCode==13)))if(e.keyCode!=229&&i.domObserver.forceFlush(),oi&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){let n=Date.now();i.input.lastIOSEnter=n,i.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{i.input.lastIOSEnter==n&&(i.someProp("handleKeyDown",o=>o(i,ln(13,"Enter"))),i.input.lastIOSEnter=0)},200)}else i.someProp("handleKeyDown",n=>n(i,e))||zf(i,e)?e.preventDefault():qt(i,"key")};Ce.keyup=(i,t)=>{t.keyCode==16&&(i.input.shiftKey=!1)};Ce.keypress=(i,t)=>{let e=t;if(Od(i,e)||!e.charCode||e.ctrlKey&&!e.altKey||Fe&&e.metaKey)return;if(i.someProp("handleKeyPress",o=>o(i,e))){e.preventDefault();return}let n=i.state.selection;if(!(n instanceof U)||!n.$from.sameParent(n.$to)){let o=String.fromCharCode(e.charCode),r=()=>i.state.tr.insertText(o).scrollIntoView();!/[\r\n]/.test(o)&&!i.someProp("handleTextInput",s=>s(i,n.$from.pos,n.$to.pos,o,r))&&i.dispatch(r()),e.preventDefault()}};function Zo(i){return{left:i.clientX,top:i.clientY}}function Qf(i,t){let e=t.x-i.clientX,n=t.y-i.clientY;return e*e+n*n<100}function Es(i,t,e,n,o){if(n==-1)return!1;let r=i.state.doc.resolve(n);for(let s=r.depth+1;s>0;s--)if(i.someProp(t,l=>s>r.depth?l(i,e,r.nodeAfter,r.before(s),o,!0):l(i,e,r.node(s),r.before(s),o,!1)))return!0;return!1}function ni(i,t,e){if(i.focused||i.focus(),i.state.selection.eq(t))return;let n=i.state.tr.setSelection(t);e=="pointer"&&n.setMeta("pointer",!0),i.dispatch(n)}function Xf(i,t){if(t==-1)return!1;let e=i.state.doc.resolve(t),n=e.nodeAfter;return n&&n.isAtom&&N.isSelectable(n)?(ni(i,new N(e),"pointer"),!0):!1}function Zf(i,t){if(t==-1)return!1;let e=i.state.selection,n,o;e instanceof N&&(n=e.node);let r=i.state.doc.resolve(t);for(let s=r.depth+1;s>0;s--){let l=s>r.depth?r.nodeAfter:r.node(s);if(N.isSelectable(l)){n&&e.$from.depth>0&&s>=e.$from.depth&&r.before(e.$from.depth+1)==e.$from.pos?o=r.before(e.$from.depth):o=r.before(s);break}}return o!=null?(ni(i,N.create(i.state.doc,o),"pointer"),!0):!1}function eh(i,t,e,n,o){return Es(i,"handleClickOn",t,e,n)||i.someProp("handleClick",r=>r(i,t,n))||(o?Zf(i,e):Xf(i,e))}function th(i,t,e,n){return Es(i,"handleDoubleClickOn",t,e,n)||i.someProp("handleDoubleClick",o=>o(i,t,n))}function nh(i,t,e,n){return Es(i,"handleTripleClickOn",t,e,n)||i.someProp("handleTripleClick",o=>o(i,t,n))||ih(i,e,n)}function ih(i,t,e){if(e.button!=0)return!1;let n=i.state.doc;if(t==-1)return n.inlineContent?(ni(i,U.create(n,0,n.content.size),"pointer"),!0):!1;let o=n.resolve(t);for(let r=o.depth+1;r>0;r--){let s=r>o.depth?o.nodeAfter:o.node(r),l=o.before(r);if(s.inlineContent)ni(i,U.create(n,l+1,l+1+s.content.size),"pointer");else if(N.isSelectable(s))ni(i,N.create(n,l),"pointer");else continue;return!0}}function ks(i){return Go(i)}var Td=Fe?"metaKey":"ctrlKey";be.mousedown=(i,t)=>{let e=t;i.input.shiftKey=e.shiftKey;let n=ks(i),o=Date.now(),r="singleClick";o-i.input.lastClick.time<500&&Qf(e,i.input.lastClick)&&!e[Td]&&i.input.lastClick.button==e.button&&(i.input.lastClick.type=="singleClick"?r="doubleClick":i.input.lastClick.type=="doubleClick"&&(r="tripleClick")),i.input.lastClick={time:o,x:e.clientX,y:e.clientY,type:r,button:e.button};let s=i.posAtCoords(Zo(e));s&&(r=="singleClick"?(i.input.mouseDown&&i.input.mouseDown.done(),i.input.mouseDown=new _s(i,s,e,!!n)):(r=="doubleClick"?th:nh)(i,s.pos,s.inside,e)?e.preventDefault():qt(i,"pointer"))};var _s=class{constructor(t,e,n,o){this.view=t,this.pos=e,this.event=n,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!n[Td],this.allowDefault=n.shiftKey;let r,s;if(e.inside>-1)r=t.state.doc.nodeAt(e.inside),s=e.inside;else{let d=t.state.doc.resolve(e.pos);r=d.parent,s=d.depth?d.before():0}let l=o?null:n.target,a=l?t.docView.nearestDesc(l,!0):null;this.target=a&&a.nodeDOM.nodeType==1?a.nodeDOM:null;let{selection:c}=t.state;(n.button==0&&r.type.spec.draggable&&r.type.spec.selectable!==!1||c instanceof N&&c.from<=s&&c.to>s)&&(this.mightDrag={node:r,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Be&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),qt(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>St(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Zo(t))),this.updateAllowDefault(t),this.allowDefault||!e?qt(this.view,"pointer"):eh(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||xe&&this.mightDrag&&!this.mightDrag.node.isAtom||ge&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(ni(this.view,z.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):qt(this.view,"pointer")}move(t){this.updateAllowDefault(t),qt(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}};be.touchstart=i=>{i.input.lastTouch=Date.now(),ks(i),qt(i,"pointer")};be.touchmove=i=>{i.input.lastTouch=Date.now(),qt(i,"pointer")};be.contextmenu=i=>ks(i);function Od(i,t){return i.composing?!0:xe&&Math.abs(t.timeStamp-i.input.compositionEndedAt)<500?(i.input.compositionEndedAt=-2e8,!0):!1}var oh=vt?5e3:-1;Ce.compositionstart=Ce.compositionupdate=i=>{if(!i.composing){i.domObserver.flush();let{state:t}=i,e=t.selection.$to;if(t.selection instanceof U&&(t.storedMarks||!e.textOffset&&e.parentOffset&&e.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)))i.markCursor=i.state.storedMarks||e.marks(),Go(i,!0),i.markCursor=null;else if(Go(i,!t.selection.empty),Be&&t.selection.empty&&e.parentOffset&&!e.textOffset&&e.nodeBefore.marks.length){let n=i.domSelectionRange();for(let o=n.focusNode,r=n.focusOffset;o&&o.nodeType==1&&r!=0;){let s=r<0?o.lastChild:o.childNodes[r-1];if(!s)break;if(s.nodeType==3){let l=i.domSelection();l&&l.collapse(s,s.nodeValue.length);break}else o=s,r=-1}}i.input.composing=!0}Dd(i,oh)};Ce.compositionend=(i,t)=>{i.composing&&(i.input.composing=!1,i.input.compositionEndedAt=t.timeStamp,i.input.compositionPendingChanges=i.domObserver.pendingRecords().length?i.input.compositionID:0,i.input.compositionNode=null,i.input.compositionPendingChanges&&Promise.resolve().then(()=>i.domObserver.flush()),i.input.compositionID++,Dd(i,20))};function Dd(i,t){clearTimeout(i.input.composingTimeout),t>-1&&(i.input.composingTimeout=setTimeout(()=>Go(i),t))}function Nd(i){for(i.composing&&(i.input.composing=!1,i.input.compositionEndedAt=sh());i.input.compositionNodes.length>0;)i.input.compositionNodes.pop().markParentsDirty()}function rh(i){let t=i.domSelectionRange();if(!t.focusNode)return null;let e=tf(t.focusNode,t.focusOffset),n=nf(t.focusNode,t.focusOffset);if(e&&n&&e!=n){let o=n.pmViewDesc,r=i.domObserver.lastChangedTextNode;if(e==r||n==r)return r;if(!o||!o.isText(n.nodeValue))return n;if(i.input.compositionNode==n){let s=e.pmViewDesc;if(!(!s||!s.isText(e.nodeValue)))return n}}return e||n}function sh(){let i=document.createEvent("Event");return i.initEvent("event",!0,!0),i.timeStamp}function Go(i,t=!1){if(!(vt&&i.domObserver.flushingSoon>=0)){if(i.domObserver.forceFlush(),Nd(i),t||i.docView&&i.docView.dirty){let e=Ss(i),n=i.state.selection;return e&&!e.eq(n)?i.dispatch(i.state.tr.setSelection(e)):(i.markCursor||t)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?i.dispatch(i.state.tr.deleteSelection()):i.updateState(i.state),!0}return!1}}function lh(i,t){if(!i.dom.parentNode)return;let e=i.dom.parentNode.appendChild(document.createElement("div"));e.appendChild(t),e.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),o=document.createRange();o.selectNodeContents(t),i.dom.blur(),n.removeAllRanges(),n.addRange(o),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),i.focus()},50)}var Ni=Ie&&Vt<15||oi&&af<604;be.copy=Ce.cut=(i,t)=>{let e=t,n=i.state.selection,o=e.type=="cut";if(n.empty)return;let r=Ni?null:e.clipboardData,s=n.content(),{dom:l,text:a}=Ms(i,s);r?(e.preventDefault(),r.clearData(),r.setData("text/html",l.innerHTML),r.setData("text/plain",a)):lh(i,l),o&&i.dispatch(i.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function ah(i){return i.openStart==0&&i.openEnd==0&&i.content.childCount==1?i.content.firstChild:null}function ch(i,t){if(!i.dom.parentNode)return;let e=i.input.shiftKey||i.state.selection.$from.parent.type.spec.code,n=i.dom.parentNode.appendChild(document.createElement(e?"textarea":"div"));e||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let o=i.input.shiftKey&&i.input.lastKeyCode!=45;setTimeout(()=>{i.focus(),n.parentNode&&n.parentNode.removeChild(n),e?Ri(i,n.value,null,o,t):Ri(i,n.textContent,n.innerHTML,o,t)},50)}function Ri(i,t,e,n,o){let r=Sd(i,t,e,n,i.state.selection.$from);if(i.someProp("handlePaste",a=>a(i,o,r||I.empty)))return!0;if(!r)return!1;let s=ah(r),l=s?i.state.tr.replaceSelectionWith(s,n):i.state.tr.replaceSelection(r);return i.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Rd(i){let t=i.getData("text/plain")||i.getData("Text");if(t)return t;let e=i.getData("text/uri-list");return e?e.replace(/\r?\n/g," "):""}Ce.paste=(i,t)=>{let e=t;if(i.composing&&!vt)return;let n=Ni?null:e.clipboardData,o=i.input.shiftKey&&i.input.lastKeyCode!=45;n&&Ri(i,Rd(n),n.getData("text/html"),o,e)?e.preventDefault():ch(i,e)};var Ko=class{constructor(t,e,n){this.slice=t,this.move=e,this.node=n}},dh=Fe?"altKey":"ctrlKey";function Ad(i,t){let e=i.someProp("dragCopies",n=>!n(t));return e??!t[dh]}be.dragstart=(i,t)=>{let e=t,n=i.input.mouseDown;if(n&&n.done(),!e.dataTransfer)return;let o=i.state.selection,r=o.empty?null:i.posAtCoords(Zo(e)),s;if(!(r&&r.pos>=o.from&&r.pos<=(o instanceof N?o.to-1:o.to))){if(n&&n.mightDrag)s=N.create(i.state.doc,n.mightDrag.pos);else if(e.target&&e.target.nodeType==1){let u=i.docView.nearestDesc(e.target,!0);u&&u.node.type.spec.draggable&&u!=i.docView&&(s=N.create(i.state.doc,u.posBefore))}}let l=(s||i.state.selection).content(),{dom:a,text:c,slice:d}=Ms(i,l);(!e.dataTransfer.files.length||!ge||cd>120)&&e.dataTransfer.clearData(),e.dataTransfer.setData(Ni?"Text":"text/html",a.innerHTML),e.dataTransfer.effectAllowed="copyMove",Ni||e.dataTransfer.setData("text/plain",c),i.dragging=new Ko(d,Ad(i,e),s)};be.dragend=i=>{let t=i.dragging;window.setTimeout(()=>{i.dragging==t&&(i.dragging=null)},50)};Ce.dragover=Ce.dragenter=(i,t)=>t.preventDefault();Ce.drop=(i,t)=>{let e=t,n=i.dragging;if(i.dragging=null,!e.dataTransfer)return;let o=i.posAtCoords(Zo(e));if(!o)return;let r=i.state.doc.resolve(o.pos),s=n&&n.slice;s?i.someProp("transformPasted",m=>{s=m(s,i,!1)}):s=Sd(i,Rd(e.dataTransfer),Ni?null:e.dataTransfer.getData("text/html"),!1,r);let l=!!(n&&Ad(i,e));if(i.someProp("handleDrop",m=>m(i,e,s||I.empty,l))){e.preventDefault();return}if(!s)return;e.preventDefault();let a=s?gc(i.state.doc,r.pos,s):r.pos;a==null&&(a=r.pos);let c=i.state.tr;if(l){let{node:m}=n;m?m.replace(c):c.deleteSelection()}let d=c.mapping.map(a),u=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,h=c.doc;if(u?c.replaceRangeWith(d,d,s.content.firstChild):c.replaceRange(d,d,s),c.doc.eq(h))return;let g=c.doc.resolve(d);if(u&&N.isSelectable(s.content.firstChild)&&g.nodeAfter&&g.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new N(g));else{let m=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach((b,C,k,X)=>m=X),c.setSelection(ws(i,g,c.doc.resolve(m)))}i.focus(),i.dispatch(c.setMeta("uiEvent","drop"))};be.focus=i=>{i.input.lastFocus=Date.now(),i.focused||(i.domObserver.stop(),i.dom.classList.add("ProseMirror-focused"),i.domObserver.start(),i.focused=!0,setTimeout(()=>{i.docView&&i.hasFocus()&&!i.domObserver.currentSelection.eq(i.domSelectionRange())&&St(i)},20))};be.blur=(i,t)=>{let e=t;i.focused&&(i.domObserver.stop(),i.dom.classList.remove("ProseMirror-focused"),i.domObserver.start(),e.relatedTarget&&i.dom.contains(e.relatedTarget)&&i.domObserver.currentSelection.clear(),i.focused=!1)};be.beforeinput=(i,t)=>{if(ge&&vt&&t.inputType=="deleteContentBackward"){i.domObserver.flushSoon();let{domChangeCount:n}=i.input;setTimeout(()=>{if(i.input.domChangeCount!=n||(i.dom.blur(),i.focus(),i.someProp("handleKeyDown",r=>r(i,ln(8,"Backspace")))))return;let{$cursor:o}=i.state.selection;o&&o.pos>0&&i.dispatch(i.state.tr.delete(o.pos-1,o.pos).scrollIntoView())},50)}};for(let i in Ce)be[i]=Ce[i];function Ai(i,t){if(i==t)return!0;for(let e in i)if(i[e]!==t[e])return!1;for(let e in t)if(!(e in i))return!1;return!0}var Jo=class i{constructor(t,e){this.toDOM=t,this.spec=e||un,this.side=this.spec.side||0}map(t,e,n,o){let{pos:r,deleted:s}=t.mapResult(e.from+o,this.side<0?-1:1);return s?null:new ut(r-n,r-n,this)}valid(){return!0}eq(t){return this==t||t instanceof i&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Ai(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}},dn=class i{constructor(t,e){this.attrs=t,this.spec=e||un}map(t,e,n,o){let r=t.map(e.from+o,this.spec.inclusiveStart?-1:1)-n,s=t.map(e.to+o,this.spec.inclusiveEnd?1:-1)-n;return r>=s?null:new ut(r,s,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof i&&Ai(this.attrs,t.attrs)&&Ai(this.spec,t.spec)}static is(t){return t.type instanceof i}destroy(){}},xs=class i{constructor(t,e){this.attrs=t,this.spec=e||un}map(t,e,n,o){let r=t.mapResult(e.from+o,1);if(r.deleted)return null;let s=t.mapResult(e.to+o,-1);return s.deleted||s.pos<=r.pos?null:new ut(r.pos-n,s.pos-n,this)}valid(t,e){let{index:n,offset:o}=t.content.findIndex(e.from),r;return o==e.from&&!(r=t.child(n)).isText&&o+r.nodeSize==e.to}eq(t){return this==t||t instanceof i&&Ai(this.attrs,t.attrs)&&Ai(this.spec,t.spec)}destroy(){}},ut=class i{constructor(t,e,n){this.from=t,this.to=e,this.type=n}copy(t,e){return new i(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,n){return this.type.map(t,this,e,n)}static widget(t,e,n){return new i(t,t,new Jo(e,n))}static inline(t,e,n,o){return new i(t,e,new dn(n,o))}static node(t,e,n,o){return new i(t,e,new xs(n,o))}get spec(){return this.type.spec}get inline(){return this.type instanceof dn}get widget(){return this.type instanceof Jo}},ti=[],un={},_e=class i{constructor(t,e){this.local=t.length?t:ti,this.children=e.length?e:ti}static create(t,e){return e.length?Qo(e,t,0,un):me}find(t,e,n){let o=[];return this.findInner(t??0,e??1e9,o,0,n),o}findInner(t,e,n,o,r){for(let s=0;s<this.local.length;s++){let l=this.local[s];l.from<=e&&l.to>=t&&(!r||r(l.spec))&&n.push(l.copy(l.from+o,l.to+o))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<e&&this.children[s+1]>t){let l=this.children[s]+1;this.children[s+2].findInner(t-l,e-l,n,o+l,r)}}map(t,e,n){return this==me||t.maps.length==0?this:this.mapInner(t,e,0,0,n||un)}mapInner(t,e,n,o,r){let s;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(t,n,o);a&&a.type.valid(e,a)?(s||(s=[])).push(a):r.onRemove&&r.onRemove(this.local[l].spec)}return this.children.length?uh(this.children,s||[],t,e,n,o,r):s?new i(s.sort(pn),ti):me}add(t,e){return e.length?this==me?i.create(t,e):this.addInner(t,e,0):this}addInner(t,e,n){let o,r=0;t.forEach((l,a)=>{let c=a+n,d;if(d=Fd(e,l,c)){for(o||(o=this.children.slice());r<o.length&&o[r]<a;)r+=3;o[r]==a?o[r+2]=o[r+2].addInner(l,d,c+1):o.splice(r,0,a,a+l.nodeSize,Qo(d,l,c+1,un)),r+=3}});let s=Pd(r?Ld(e):e,-n);for(let l=0;l<s.length;l++)s[l].type.valid(t,s[l])||s.splice(l--,1);return new i(s.length?this.local.concat(s).sort(pn):this.local,o||this.children)}remove(t){return t.length==0||this==me?this:this.removeInner(t,0)}removeInner(t,e){let n=this.children,o=this.local;for(let r=0;r<n.length;r+=3){let s,l=n[r]+e,a=n[r+1]+e;for(let d=0,u;d<t.length;d++)(u=t[d])&&u.from>l&&u.to<a&&(t[d]=null,(s||(s=[])).push(u));if(!s)continue;n==this.children&&(n=this.children.slice());let c=n[r+2].removeInner(s,l+1);c!=me?n[r+2]=c:(n.splice(r,3),r-=3)}if(o.length){for(let r=0,s;r<t.length;r++)if(s=t[r])for(let l=0;l<o.length;l++)o[l].eq(s,e)&&(o==this.local&&(o=this.local.slice()),o.splice(l--,1))}return n==this.children&&o==this.local?this:o.length||n.length?new i(o,n):me}forChild(t,e){if(this==me)return this;if(e.isLeaf)return i.empty;let n,o;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=t){this.children[l]==t&&(n=this.children[l+2]);break}let r=t+1,s=r+e.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<s&&a.to>r&&a.type instanceof dn){let c=Math.max(r,a.from)-r,d=Math.min(s,a.to)-r;c<d&&(o||(o=[])).push(a.copy(c,d))}}if(o){let l=new i(o.sort(pn),ti);return n?new Yo([l,n]):l}return n||me}eq(t){if(this==t)return!0;if(!(t instanceof i)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return Ts(this.localsInner(t))}localsInner(t){if(this==me)return ti;if(t.inlineContent||!this.local.some(dn.is))return this.local;let e=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof dn||e.push(this.local[n]);return e}forEachSet(t){t(this)}};_e.empty=new _e([],[]);_e.removeOverlap=Ts;var me=_e.empty,Yo=class i{constructor(t){this.members=t}map(t,e){let n=this.members.map(o=>o.map(t,e,un));return i.from(n)}forChild(t,e){if(e.isLeaf)return _e.empty;let n=[];for(let o=0;o<this.members.length;o++){let r=this.members[o].forChild(t,e);r!=me&&(r instanceof i?n=n.concat(r.members):n.push(r))}return i.from(n)}eq(t){if(!(t instanceof i)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,n=!0;for(let o=0;o<this.members.length;o++){let r=this.members[o].localsInner(t);if(r.length)if(!e)e=r;else{n&&(e=e.slice(),n=!1);for(let s=0;s<r.length;s++)e.push(r[s])}}return e?Ts(n?e:e.sort(pn)):ti}static from(t){switch(t.length){case 0:return me;case 1:return t[0];default:return new i(t.every(e=>e instanceof _e)?t:t.reduce((e,n)=>e.concat(n instanceof _e?n:n.members),[]))}}forEachSet(t){for(let e=0;e<this.members.length;e++)this.members[e].forEachSet(t)}};function uh(i,t,e,n,o,r,s){let l=i.slice();for(let c=0,d=r;c<e.maps.length;c++){let u=0;e.maps[c].forEach((h,g,m,b)=>{let C=b-m-(g-h);for(let k=0;k<l.length;k+=3){let X=l[k+1];if(X<0||h>X+d-u)continue;let te=l[k]+d-u;g>=te?l[k+1]=h<=te?-2:-1:h>=d&&C&&(l[k]+=C,l[k+1]+=C)}u+=C}),d=e.maps[c].map(d,-1)}let a=!1;for(let c=0;c<l.length;c+=3)if(l[c+1]<0){if(l[c+1]==-2){a=!0,l[c+1]=-1;continue}let d=e.map(i[c]+r),u=d-o;if(u<0||u>=n.content.size){a=!0;continue}let h=e.map(i[c+1]+r,-1),g=h-o,{index:m,offset:b}=n.content.findIndex(u),C=n.maybeChild(m);if(C&&b==u&&b+C.nodeSize==g){let k=l[c+2].mapInner(e,C,d+1,i[c]+r+1,s);k!=me?(l[c]=u,l[c+1]=g,l[c+2]=k):(l[c+1]=-2,a=!0)}else a=!0}if(a){let c=ph(l,i,t,e,o,r,s),d=Qo(c,n,0,s);t=d.local;for(let u=0;u<l.length;u+=3)l[u+1]<0&&(l.splice(u,3),u-=3);for(let u=0,h=0;u<d.children.length;u+=3){let g=d.children[u];for(;h<l.length&&l[h]<g;)h+=3;l.splice(h,0,d.children[u],d.children[u+1],d.children[u+2])}}return new _e(t.sort(pn),l)}function Pd(i,t){if(!t||!i.length)return i;let e=[];for(let n=0;n<i.length;n++){let o=i[n];e.push(new ut(o.from+t,o.to+t,o.type))}return e}function ph(i,t,e,n,o,r,s){function l(a,c){for(let d=0;d<a.local.length;d++){let u=a.local[d].map(n,o,c);u?e.push(u):s.onRemove&&s.onRemove(a.local[d].spec)}for(let d=0;d<a.children.length;d+=3)l(a.children[d+2],a.children[d]+c+1)}for(let a=0;a<i.length;a+=3)i[a+1]==-1&&l(i[a+2],t[a]+r+1);return e}function Fd(i,t,e){if(t.isLeaf)return null;let n=e+t.nodeSize,o=null;for(let r=0,s;r<i.length;r++)(s=i[r])&&s.from>e&&s.to<n&&((o||(o=[])).push(s),i[r]=null);return o}function Ld(i){let t=[];for(let e=0;e<i.length;e++)i[e]!=null&&t.push(i[e]);return t}function Qo(i,t,e,n){let o=[],r=!1;t.forEach((l,a)=>{let c=Fd(i,l,a+e);if(c){r=!0;let d=Qo(c,l,e+a+1,n);d!=me&&o.push(a,a+l.nodeSize,d)}});let s=Pd(r?Ld(i):i,-e).sort(pn);for(let l=0;l<s.length;l++)s[l].type.valid(t,s[l])||(n.onRemove&&n.onRemove(s[l].spec),s.splice(l--,1));return s.length||o.length?new _e(s,o):me}function pn(i,t){return i.from-t.from||i.to-t.to}function Ts(i){let t=i;for(let e=0;e<t.length-1;e++){let n=t[e];if(n.from!=n.to)for(let o=e+1;o<t.length;o++){let r=t[o];if(r.from==n.from){r.to!=n.to&&(t==i&&(t=i.slice()),t[o]=r.copy(r.from,n.to),Qc(t,o+1,r.copy(n.to,r.to)));continue}else{r.from<n.to&&(t==i&&(t=i.slice()),t[e]=n.copy(n.from,r.from),Qc(t,o,n.copy(r.from,n.to)));break}}}return t}function Qc(i,t,e){for(;t<i.length&&pn(e,i[t])>0;)t++;i.splice(t,0,e)}function ts(i){let t=[];return i.someProp("decorations",e=>{let n=e(i.state);n&&n!=me&&t.push(n)}),i.cursorWrapper&&t.push(_e.create(i.state.doc,[i.cursorWrapper.deco])),Yo.from(t)}var fh={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},hh=Ie&&Vt<=11,bs=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}},Cs=class{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new bs,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let o=0;o<n.length;o++)this.queue.push(n[o]);Ie&&Vt<=11&&n.some(o=>o.type=="childList"&&o.removedNodes.length||o.type=="characterData"&&o.oldValue.length>o.target.nodeValue.length)?this.flushSoon():this.flush()}),hh&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,fh)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if($c(this.view)){if(this.suppressingSelectionUpdates)return St(this.view);if(Ie&&Vt<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&fn(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e=new Set,n;for(let r=t.focusNode;r;r=ii(r))e.add(r);for(let r=t.anchorNode;r;r=ii(r))if(e.has(r)){n=r;break}let o=n&&this.view.docView.nearestDesc(n);if(o&&o.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let n=t.domSelectionRange(),o=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&$c(t)&&!this.ignoreSelectionChange(n),r=-1,s=-1,l=!1,a=[];if(t.editable)for(let d=0;d<e.length;d++){let u=this.registerMutation(e[d],a);u&&(r=r<0?u.from:Math.min(u.from,r),s=s<0?u.to:Math.max(u.to,s),u.typeOver&&(l=!0))}if(Be&&a.length){let d=a.filter(u=>u.nodeName=="BR");if(d.length==2){let[u,h]=d;u.parentNode&&u.parentNode.parentNode==h.parentNode?h.remove():u.remove()}else{let{focusNode:u}=this.currentSelection;for(let h of d){let g=h.parentNode;g&&g.nodeName=="LI"&&(!u||yh(t,u)!=g)&&h.remove()}}}let c=null;r<0&&o&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&Xo(n)&&(c=Ss(t))&&c.eq(z.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,St(t),this.currentSelection.set(n),t.scrollToSelection()):(r>-1||o)&&(r>-1&&(t.docView.markDirty(r,s),mh(t)),this.handleDOMChange(r,s,l,a),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(n)||St(t),this.currentSelection.set(n))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let n=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(n==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!n||n.ignoreMutation(t))return null;if(t.type=="childList"){for(let d=0;d<t.addedNodes.length;d++){let u=t.addedNodes[d];e.push(u),u.nodeType==3&&(this.lastChangedTextNode=u)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};let o=t.previousSibling,r=t.nextSibling;if(Ie&&Vt<=11&&t.addedNodes.length)for(let d=0;d<t.addedNodes.length;d++){let{previousSibling:u,nextSibling:h}=t.addedNodes[d];(!u||Array.prototype.indexOf.call(t.addedNodes,u)<0)&&(o=u),(!h||Array.prototype.indexOf.call(t.addedNodes,h)<0)&&(r=h)}let s=o&&o.parentNode==t.target?de(o)+1:0,l=n.localPosFromDOM(t.target,s,-1),a=r&&r.parentNode==t.target?de(r):t.target.childNodes.length,c=n.localPosFromDOM(t.target,a,1);return{from:l,to:c}}else return t.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=t.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}},Xc=new WeakMap,Zc=!1;function mh(i){if(!Xc.has(i)&&(Xc.set(i,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(i.dom).whiteSpace)!==-1)){if(i.requiresGeckoHackNode=Be,Zc)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Zc=!0}}function ed(i,t){let e=t.startContainer,n=t.startOffset,o=t.endContainer,r=t.endOffset,s=i.domAtPos(i.state.selection.anchor);return fn(s.node,s.offset,o,r)&&([e,n,o,r]=[o,r,e,n]),{anchorNode:e,anchorOffset:n,focusNode:o,focusOffset:r}}function gh(i,t){if(t.getComposedRanges){let o=t.getComposedRanges(i.root)[0];if(o)return ed(i,o)}let e;function n(o){o.preventDefault(),o.stopImmediatePropagation(),e=o.getTargetRanges()[0]}return i.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),i.dom.removeEventListener("beforeinput",n,!0),e?ed(i,e):null}function yh(i,t){for(let e=t.parentNode;e&&e!=i.dom;e=e.parentNode){let n=i.docView.nearestDesc(e,!0);if(n&&n.node.isBlock)return e}return null}function _h(i,t,e){let{node:n,fromOffset:o,toOffset:r,from:s,to:l}=i.docView.parseRange(t,e),a=i.domSelectionRange(),c,d=a.anchorNode;if(d&&i.dom.contains(d.nodeType==1?d:d.parentNode)&&(c=[{node:d,offset:a.anchorOffset}],Xo(a)||c.push({node:a.focusNode,offset:a.focusOffset})),ge&&i.input.lastKeyCode===8)for(let C=r;C>o;C--){let k=n.childNodes[C-1],X=k.pmViewDesc;if(k.nodeName=="BR"&&!X){r=C;break}if(!X||X.size)break}let u=i.state.doc,h=i.someProp("domParser")||Ft.fromSchema(i.state.schema),g=u.resolve(s),m=null,b=h.parse(n,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:o,to:r,preserveWhitespace:g.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:xh,context:g});if(c&&c[0].pos!=null){let C=c[0].pos,k=c[1]&&c[1].pos;k==null&&(k=C),m={anchor:C+s,head:k+s}}return{doc:b,sel:m,from:s,to:l}}function xh(i){let t=i.pmViewDesc;if(t)return t.parseRule();if(i.nodeName=="BR"&&i.parentNode){if(xe&&/^(ul|ol)$/i.test(i.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}else if(i.parentNode.lastChild==i||xe&&/^(tr|table)$/i.test(i.parentNode.nodeName))return{ignore:!0}}else if(i.nodeName=="IMG"&&i.getAttribute("mark-placeholder"))return{ignore:!0};return null}var bh=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Ch(i,t,e,n,o){let r=i.input.compositionPendingChanges||(i.composing?i.input.compositionID:0);if(i.input.compositionPendingChanges=0,t<0){let q=i.input.lastSelectionTime>Date.now()-50?i.input.lastSelectionOrigin:null,oe=Ss(i,q);if(oe&&!i.state.selection.eq(oe)){if(ge&&vt&&i.input.lastKeyCode===13&&Date.now()-100<i.input.lastKeyCodeTime&&i.someProp("handleKeyDown",np=>np(i,ln(13,"Enter"))))return;let ve=i.state.tr.setSelection(oe);q=="pointer"?ve.setMeta("pointer",!0):q=="key"&&ve.scrollIntoView(),r&&ve.setMeta("composition",r),i.dispatch(ve)}return}let s=i.state.doc.resolve(t),l=s.sharedDepth(e);t=s.before(l+1),e=i.state.doc.resolve(e).after(l+1);let a=i.state.selection,c=_h(i,t,e),d=i.state.doc,u=d.slice(c.from,c.to),h,g;i.input.lastKeyCode===8&&Date.now()-100<i.input.lastKeyCodeTime?(h=i.state.selection.to,g="end"):(h=i.state.selection.from,g="start"),i.input.lastKeyCode=null;let m=wh(u.content,c.doc.content,c.from,h,g);if(m&&i.input.domChangeCount++,(oi&&i.input.lastIOSEnter>Date.now()-225||vt)&&o.some(q=>q.nodeType==1&&!bh.test(q.nodeName))&&(!m||m.endA>=m.endB)&&i.someProp("handleKeyDown",q=>q(i,ln(13,"Enter")))){i.input.lastIOSEnter=0;return}if(!m)if(n&&a instanceof U&&!a.empty&&a.$head.sameParent(a.$anchor)&&!i.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))m={start:a.from,endA:a.to,endB:a.to};else{if(c.sel){let q=td(i,i.state.doc,c.sel);if(q&&!q.eq(i.state.selection)){let oe=i.state.tr.setSelection(q);r&&oe.setMeta("composition",r),i.dispatch(oe)}}return}i.state.selection.from<i.state.selection.to&&m.start==m.endB&&i.state.selection instanceof U&&(m.start>i.state.selection.from&&m.start<=i.state.selection.from+2&&i.state.selection.from>=c.from?m.start=i.state.selection.from:m.endA<i.state.selection.to&&m.endA>=i.state.selection.to-2&&i.state.selection.to<=c.to&&(m.endB+=i.state.selection.to-m.endA,m.endA=i.state.selection.to)),Ie&&Vt<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>c.from&&c.doc.textBetween(m.start-c.from-1,m.start-c.from+1)==" \xA0"&&(m.start--,m.endA--,m.endB--);let b=c.doc.resolveNoCache(m.start-c.from),C=c.doc.resolveNoCache(m.endB-c.from),k=d.resolve(m.start),X=b.sameParent(C)&&b.parent.inlineContent&&k.end()>=m.endA;if((oi&&i.input.lastIOSEnter>Date.now()-225&&(!X||o.some(q=>q.nodeName=="DIV"||q.nodeName=="P"))||!X&&b.pos<c.doc.content.size&&(!b.sameParent(C)||!b.parent.inlineContent)&&b.pos<C.pos&&!/\S/.test(c.doc.textBetween(b.pos,C.pos,"","")))&&i.someProp("handleKeyDown",q=>q(i,ln(13,"Enter")))){i.input.lastIOSEnter=0;return}if(i.state.selection.anchor>m.start&&Sh(d,m.start,m.endA,b,C)&&i.someProp("handleKeyDown",q=>q(i,ln(8,"Backspace")))){vt&&ge&&i.domObserver.suppressSelectionUpdates();return}ge&&m.endB==m.start&&(i.input.lastChromeDelete=Date.now()),vt&&!X&&b.start()!=C.start()&&C.parentOffset==0&&b.depth==C.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==m.endA&&(m.endB-=2,C=c.doc.resolveNoCache(m.endB-c.from),setTimeout(()=>{i.someProp("handleKeyDown",function(q){return q(i,ln(13,"Enter"))})},20));let te=m.start,et=m.endA,Ut=q=>{let oe=q||i.state.tr.replace(te,et,c.doc.slice(m.start-c.from,m.endB-c.from));if(c.sel){let ve=td(i,oe.doc,c.sel);ve&&!(ge&&i.composing&&ve.empty&&(m.start!=m.endB||i.input.lastChromeDelete<Date.now()-100)&&(ve.head==te||ve.head==oe.mapping.map(et)-1)||Ie&&ve.empty&&ve.head==te)&&oe.setSelection(ve)}return r&&oe.setMeta("composition",r),oe.scrollIntoView()},Hi;if(X)if(b.pos==C.pos){Ie&&Vt<=11&&b.parentOffset==0&&(i.domObserver.suppressSelectionUpdates(),setTimeout(()=>St(i),20));let q=Ut(i.state.tr.delete(te,et)),oe=d.resolve(m.start).marksAcross(d.resolve(m.endA));oe&&q.ensureMarks(oe),i.dispatch(q)}else if(m.endA==m.endB&&(Hi=vh(b.parent.content.cut(b.parentOffset,C.parentOffset),k.parent.content.cut(k.parentOffset,m.endA-k.start())))){let q=Ut(i.state.tr);Hi.type=="add"?q.addMark(te,et,Hi.mark):q.removeMark(te,et,Hi.mark),i.dispatch(q)}else if(b.parent.child(b.index()).isText&&b.index()==C.index()-(C.textOffset?0:1)){let q=b.parent.textBetween(b.parentOffset,C.parentOffset),oe=()=>Ut(i.state.tr.insertText(q,te,et));i.someProp("handleTextInput",ve=>ve(i,te,et,q,oe))||i.dispatch(oe())}else i.dispatch(Ut());else i.dispatch(Ut())}function td(i,t,e){return Math.max(e.anchor,e.head)>t.content.size?null:ws(i,t.resolve(e.anchor),t.resolve(e.head))}function vh(i,t){let e=i.firstChild.marks,n=t.firstChild.marks,o=e,r=n,s,l,a;for(let d=0;d<n.length;d++)o=n[d].removeFromSet(o);for(let d=0;d<e.length;d++)r=e[d].removeFromSet(r);if(o.length==1&&r.length==0)l=o[0],s="add",a=d=>d.mark(l.addToSet(d.marks));else if(o.length==0&&r.length==1)l=r[0],s="remove",a=d=>d.mark(l.removeFromSet(d.marks));else return null;let c=[];for(let d=0;d<t.childCount;d++)c.push(a(t.child(d)));if(w.from(c).eq(i))return{mark:l,type:s}}function Sh(i,t,e,n,o){if(e-t<=o.pos-n.pos||ns(n,!0,!1)<o.pos)return!1;let r=i.resolve(t);if(!n.parent.isTextblock){let l=r.nodeAfter;return l!=null&&e==t+l.nodeSize}if(r.parentOffset<r.parent.content.size||!r.parent.isTextblock)return!1;let s=i.resolve(ns(r,!0,!0));return!s.parent.isTextblock||s.pos>e||ns(s,!0,!1)<e?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function ns(i,t,e){let n=i.depth,o=t?i.end():i.pos;for(;n>0&&(t||i.indexAfter(n)==i.node(n).childCount);)n--,o++,t=!1;if(e){let r=i.node(n).maybeChild(i.indexAfter(n));for(;r&&!r.isLeaf;)r=r.firstChild,o++}return o}function wh(i,t,e,n,o){let r=i.findDiffStart(t,e);if(r==null)return null;let{a:s,b:l}=i.findDiffEnd(t,e+i.size,e+t.size);if(o=="end"){let a=Math.max(0,r-Math.min(s,l));n-=s+a-r}if(s<r&&i.size<t.size){let a=n<=r&&n>=s?r-n:0;r-=a,r&&r<t.size&&nd(t.textBetween(r-1,r+1))&&(r+=a?1:-1),l=r+(l-s),s=r}else if(l<r){let a=n<=r&&n>=l?r-n:0;r-=a,r&&r<i.size&&nd(i.textBetween(r-1,r+1))&&(r+=a?1:-1),s=r+(s-l),l=r}return{start:r,endA:s,endB:l}}function nd(i){if(i.length!=2)return!1;let t=i.charCodeAt(0),e=i.charCodeAt(1);return t>=56320&&t<=57343&&e>=55296&&e<=56319}var Pi=class{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new gs,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(ld),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):typeof t=="function"?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=rd(this),od(this),this.nodeViews=sd(this),this.docView=Lc(this.state.doc,id(this),ts(this),this.dom,this),this.domObserver=new Cs(this,(n,o,r,s)=>Ch(this,n,o,r,s)),this.domObserver.start(),Gf(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&ys(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(ld),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let n in this._props)e[n]=this._props[n];e.state=this.state;for(let n in t)e[n]=t[n];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){var n;let o=this.state,r=!1,s=!1;t.storedMarks&&this.composing&&(Nd(this),s=!0),this.state=t;let l=o.plugins!=t.plugins||this._props.plugins!=e.plugins;if(l||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let g=sd(this);Ih(g,this.nodeViews)&&(this.nodeViews=g,r=!0)}(l||e.handleDOMEvents!=this._props.handleDOMEvents)&&ys(this),this.editable=rd(this),od(this);let a=ts(this),c=id(this),d=o.plugins!=t.plugins&&!o.doc.eq(t.doc)?"reset":t.scrollToSelection>o.scrollToSelection?"to selection":"preserve",u=r||!this.docView.matchesNode(t.doc,c,a);(u||!t.selection.eq(o.selection))&&(s=!0);let h=d=="preserve"&&s&&this.dom.style.overflowAnchor==null&&uf(this);if(s){this.domObserver.stop();let g=u&&(Ie||ge)&&!this.composing&&!o.selection.empty&&!t.selection.empty&&Mh(o.selection,t.selection);if(u){let m=ge?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=rh(this)),(r||!this.docView.update(t.doc,c,a,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=Lc(t.doc,c,a,this.dom,this)),m&&!this.trackWrites&&(g=!0)}g||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Nf(this))?St(this,g):(bd(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(o),!((n=this.dragging)===null||n===void 0)&&n.node&&!o.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,o),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():h&&pf(h)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(!(!t||!this.dom.contains(t.nodeType==1?t:t.parentNode))){if(!this.someProp("handleScrollToSelection",e=>e(this)))if(this.state.selection instanceof N){let e=this.docView.domAfterPos(this.state.selection.from);e.nodeType==1&&Dc(this,e.getBoundingClientRect(),t)}else Dc(this,this.coordsAtPos(this.state.selection.head,1),t)}}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let n=this.directPlugins[e];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let n=this.state.plugins[e];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let e=0;e<this.pluginViews.length;e++){let n=this.pluginViews[e];n.update&&n.update(this,t)}}updateDraggedNode(t,e){let n=t.node,o=-1;if(this.state.doc.nodeAt(n.from)==n.node)o=n.from;else{let r=n.from+(this.state.doc.content.size-e.doc.content.size);(r>0&&this.state.doc.nodeAt(r))==n.node&&(o=r)}this.dragging=new Ko(t.slice,t.move,o<0?void 0:N.create(this.state.doc,o))}someProp(t,e){let n=this._props&&this._props[t],o;if(n!=null&&(o=e?e(n):n))return o;for(let s=0;s<this.directPlugins.length;s++){let l=this.directPlugins[s].props[t];if(l!=null&&(o=e?e(l):l))return o}let r=this.state.plugins;if(r)for(let s=0;s<r.length;s++){let l=r[s].props[t];if(l!=null&&(o=e?e(l):l))return o}}hasFocus(){if(Ie){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&ff(this.dom),St(this),this.domObserver.start()}get root(){let t=this._root;if(t==null){for(let e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e}return t||document}updateRoot(){this._root=null}posAtCoords(t){return _f(this,t)}coordsAtPos(t,e=1){return hd(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,n=-1){let o=this.docView.posFromDOM(t,e,n);if(o==null)throw new RangeError("DOM position not inside the editor");return o}endOfTextblock(t,e){return Sf(this,e||this.state,t)}pasteHTML(t,e){return Ri(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return Ri(this,t,null,!0,e||new ClipboardEvent("paste"))}serializeForClipboard(t){return Ms(this,t)}destroy(){this.docView&&(Kf(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],ts(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Zp())}get isDestroyed(){return this.docView==null}dispatchEvent(t){return Yf(this,t)}domSelectionRange(){let t=this.domSelection();return t?xe&&this.root.nodeType===11&&rf(this.dom.ownerDocument)==this.dom&&gh(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}};Pi.prototype.dispatch=function(i){let t=this._props.dispatchTransaction;t?t.call(this,i):this.updateState(this.state.apply(i))};function id(i){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(i.editable),i.someProp("attributes",e=>{if(typeof e=="function"&&(e=e(i.state)),e)for(let n in e)n=="class"?t.class+=" "+e[n]:n=="style"?t.style=(t.style?t.style+";":"")+e[n]:!t[n]&&n!="contenteditable"&&n!="nodeName"&&(t[n]=String(e[n]))}),t.translate||(t.translate="no"),[ut.node(0,i.state.doc.content.size,t)]}function od(i){if(i.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),i.cursorWrapper={dom:t,deco:ut.widget(i.state.selection.from,t,{raw:!0,marks:i.markCursor})}}else i.cursorWrapper=null}function rd(i){return!i.someProp("editable",t=>t(i.state)===!1)}function Mh(i,t){let e=Math.min(i.$anchor.sharedDepth(i.head),t.$anchor.sharedDepth(t.head));return i.$anchor.start(e)!=t.$anchor.start(e)}function sd(i){let t=Object.create(null);function e(n){for(let o in n)Object.prototype.hasOwnProperty.call(t,o)||(t[o]=n[o])}return i.someProp("nodeViews",e),i.someProp("markViews",e),t}function Ih(i,t){let e=0,n=0;for(let o in i){if(i[o]!=t[o])return!0;e++}for(let o in t)n++;return e!=n}function ld(i){if(i.spec.state||i.spec.filterTransaction||i.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Eh=["ol",0],kh=["ul",0],Th=["li",0],Bd={attrs:{order:{default:1,validate:"number"}},parseDOM:[{tag:"ol",getAttrs(i){return{order:i.hasAttribute("start")?+i.getAttribute("start"):1}}}],toDOM(i){return i.attrs.order==1?Eh:["ol",{start:i.attrs.order},0]}},zd={parseDOM:[{tag:"ul"}],toDOM(){return kh}},qd={parseDOM:[{tag:"li"}],toDOM(){return Th},defining:!0};function Vd(i,t=null){return function(e,n){let{$from:o,$to:r}=e.selection,s=o.blockRange(r);if(!s)return!1;let l=n?e.tr:null;return Oh(l,s,i,t)?(n&&n(l.scrollIntoView()),!0):!1}}function Oh(i,t,e,n=null){let o=!1,r=t,s=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(e)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let a=s.resolve(t.start-2);r=new en(a,a,t.depth),t.endIndex<t.parent.childCount&&(t=new en(t.$from,s.resolve(t.$to.end(t.depth)),t.depth)),o=!0}let l=Yn(r,e,n,t);return l?(i&&Dh(i,t,l,o,e),!0):!1}function Dh(i,t,e,n,o){let r=w.empty;for(let d=e.length-1;d>=0;d--)r=w.from(e[d].type.create(e[d].attrs,r));i.step(new le(t.start-(n?2:0),t.end,t.start,t.end,new I(r,0,0),e.length,!0));let s=0;for(let d=0;d<e.length;d++)e[d].type==o&&(s=d+1);let l=e.length-s,a=t.start+e.length-(n?2:0),c=t.parent;for(let d=t.startIndex,u=t.endIndex,h=!0;d<u;d++,h=!1)!h&&Lt(i.doc,a,l)&&(i.split(a,l),a+=2*l),a+=c.child(d).nodeSize;return i}function Hd(i,t){return function(e,n){let{$from:o,$to:r,node:s}=e.selection;if(s&&s.isBlock||o.depth<2||!o.sameParent(r))return!1;let l=o.node(-1);if(l.type!=i)return!1;if(o.parent.content.size==0&&o.node(-1).childCount==o.indexAfter(-1)){if(o.depth==3||o.node(-3).type!=i||o.index(-2)!=o.node(-2).childCount-1)return!1;if(n){let u=w.empty,h=o.index(-1)?1:o.index(-2)?2:3;for(let k=o.depth-h;k>=o.depth-3;k--)u=w.from(o.node(k).copy(u));let g=o.indexAfter(-1)<o.node(-2).childCount?1:o.indexAfter(-2)<o.node(-3).childCount?2:3;u=u.append(w.from(i.createAndFill()));let m=o.before(o.depth-(h-1)),b=e.tr.replace(m,o.after(-g),new I(u,4-h,0)),C=-1;b.doc.nodesBetween(m,b.doc.content.size,(k,X)=>{if(C>-1)return!1;k.isTextblock&&k.content.size==0&&(C=X+1)}),C>-1&&b.setSelection(z.near(b.doc.resolve(C))),n(b.scrollIntoView())}return!0}let a=r.pos==o.end()?l.contentMatchAt(0).defaultType:null,c=e.tr.delete(o.pos,r.pos),d=a?[t?{type:i,attrs:t}:null,{type:a}]:void 0;return Lt(c.doc,o.pos,2,d)?(n&&n(c.split(o.pos,2,d).scrollIntoView()),!0):!1}}function Os(i){return function(t,e){let{$from:n,$to:o}=t.selection,r=n.blockRange(o,s=>s.childCount>0&&s.firstChild.type==i);return r?e?n.node(r.depth-1).type==i?Nh(t,e,i,r):Rh(t,e,r):!0:!1}}function Nh(i,t,e,n){let o=i.tr,r=n.end,s=n.$to.end(n.depth);r<s&&(o.step(new le(r-1,s,r,s,new I(w.from(e.create(null,n.parent.copy())),1,0),1,!0)),n=new en(o.doc.resolve(n.$from.pos),o.doc.resolve(s),n.depth));let l=on(n);if(l==null)return!1;o.lift(n,l);let a=o.doc.resolve(o.mapping.map(r,-1)-1);return rn(o.doc,a.pos)&&a.nodeBefore.type==a.nodeAfter.type&&o.join(a.pos),t(o.scrollIntoView()),!0}function Rh(i,t,e){let n=i.tr,o=e.parent;for(let g=e.end,m=e.endIndex-1,b=e.startIndex;m>b;m--)g-=o.child(m).nodeSize,n.delete(g-1,g+1);let r=n.doc.resolve(e.start),s=r.nodeAfter;if(n.mapping.map(e.end)!=e.start+r.nodeAfter.nodeSize)return!1;let l=e.startIndex==0,a=e.endIndex==o.childCount,c=r.node(-1),d=r.index(-1);if(!c.canReplace(d+(l?0:1),d+1,s.content.append(a?w.empty:w.from(o))))return!1;let u=r.pos,h=u+s.nodeSize;return n.step(new le(u-(l?1:0),h+(a?1:0),u+1,h-1,new I((l?w.empty:w.from(o.copy(w.empty))).append(a?w.empty:w.from(o.copy(w.empty))),l?0:1,a?0:1),l?0:1)),t(n.scrollIntoView()),!0}function Ds(i){return function(t,e){let{$from:n,$to:o}=t.selection,r=n.blockRange(o,c=>c.childCount>0&&c.firstChild.type==i);if(!r)return!1;let s=r.startIndex;if(s==0)return!1;let l=r.parent,a=l.child(s-1);if(a.type!=i)return!1;if(e){let c=a.lastChild&&a.lastChild.type==l.type,d=w.from(c?i.create():null),u=new I(w.from(i.create(null,w.from(l.type.create(null,d)))),c?3:1,0),h=r.start,g=r.end;e(t.tr.step(new le(h-(c?3:1),g,h,g,u,1,!0)).scrollIntoView())}return!0}}var Ph={attrs:{href:{},title:{default:null},target:{default:"_blank"}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(i){return{href:i.getAttribute("href"),title:i.getAttribute("title"),target:i.getAttribute("target")}}}],toDOM(i){let{href:t,title:e,target:n}=i.attrs;return["a",{href:t,title:e,target:n},0]}},Fh={parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM(){return["em",0]}},Lh={parseDOM:[{tag:"strong"},{tag:"b",getAttrs:i=>i.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:i=>/^(?:bold(?:er)?|[5-9]\d{2,})$/.test(i)&&null}],toDOM(){return["strong",0]}},Bh={parseDOM:[{tag:"code"}],toDOM(){return["code",0]}},zh={parseDOM:[{tag:"u"},{style:"text-decoration=underline",consuming:!1}],toDOM(){return["u",0]}},qh={parseDOM:[{tag:"s"},{tag:"strike"},{style:"text-decoration=line-through"}],toDOM(){return["s",0]}},Vh={attrs:{color:{default:null}},parseDOM:[{style:"color",getAttrs:i=>({color:i})}],toDOM(i){let{color:t}=i.attrs;return["span",{style:`color:${t};`},0]}},Hh={attrs:{backgroundColor:{default:null}},parseDOM:[{style:"background-color",getAttrs:i=>({backgroundColor:i})}],toDOM(i){let{backgroundColor:t}=i.attrs;return["span",{style:`background-color:${t};`},0]}},$h={attrs:{},parseDOM:[{tag:"sup"},{style:"vertical-align=super"}],toDOM(){return["sup",0]}},jh={attrs:{},parseDOM:[{tag:"sub"},{style:"vertical-align=sub"}],toDOM(){return["sub",0]}},Uh={link:Ph,em:Fh,strong:Lh,code:Bh,u:zh,s:qh,text_color:Vh,text_background_color:Hh,sup:$h,sub:jh},Wh={content:"block+"},Gh={group:"inline"},Kh={content:"inline*",group:"block",attrs:{align:{default:null},indent:{default:null}},parseDOM:[{tag:"p",getAttrs(i){let{textAlign:t}=i.style,e=i.getAttribute("align")||t||null,n=i.getAttribute("data-indent")||null;return{align:e,indent:parseInt(n,10)||null}}}],toDOM(i){let{align:t,indent:e}=i.attrs,n={textAlign:t!=="left"?t:null,marginLeft:e!==null?`${e*40}px`:null};return["p",{style:Mo(n)||null,"data-indent":e??null},0]}},Jh={content:"block+",group:"block",defining:!0,attrs:{indent:{default:null}},parseDOM:[{tag:"blockquote",getAttrs(i){let t=i.getAttribute("data-indent")||null;return{indent:parseInt(t,10)||null}}}],toDOM(i){let{indent:t}=i.attrs,e={marginLeft:t!==null?`${t*40}px`:null};return["blockquote",{style:Mo(e)||null,"data-indent":t??null},0]}},Yh={group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["hr"]}},Qh={attrs:{level:{default:1},align:{default:null},indent:{default:null}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",getAttrs(i){let{textAlign:t}=i.style,e=i.getAttribute("align")||t||null,n=i.getAttribute("data-indent")||null;return{level:1,align:e,indent:parseInt(n,10)||null}}},{tag:"h2",getAttrs(i){let{textAlign:t}=i.style,e=i.getAttribute("align")||t||null,n=i.getAttribute("data-indent")||null;return{level:2,align:e,indent:parseInt(n,10)||null}}},{tag:"h3",getAttrs(i){let{textAlign:t}=i.style,e=i.getAttribute("align")||t||null,n=i.getAttribute("data-indent")||null;return{level:3,align:e,indent:parseInt(n,10)||null}}},{tag:"h4",getAttrs(i){let{textAlign:t}=i.style,e=i.getAttribute("align")||t||null,n=i.getAttribute("data-indent")||null;return{level:4,align:e,indent:parseInt(n,10)||null}}},{tag:"h5",getAttrs(i){let{textAlign:t}=i.style,e=i.getAttribute("align")||t||null,n=i.getAttribute("data-indent")||null;return{level:5,align:e,indent:parseInt(n,10)||null}}},{tag:"h6",getAttrs(i){let{textAlign:t}=i.style,e=i.getAttribute("align")||t||null,n=i.getAttribute("data-indent")||null;return{level:6,align:e,indent:parseInt(n,10)||null}}}],toDOM(i){let{level:t,align:e,indent:n}=i.attrs,o={textAlign:e!=="left"?e:null,marginLeft:n!==null?`${n*40}px`:null},s={style:Mo(o)||null,"data-indent":n??null};return[`h${t}`,s,0]}},Xh={content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM(){return["pre",["code",0]]}},Zh={inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return["br"]}},em={inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(i){return{src:i.getAttribute("src"),title:i.getAttribute("title"),alt:i.getAttribute("alt"),width:i.getAttribute("width")}}}],toDOM(i){let{src:t,alt:e,title:n,width:o}=i.attrs;return["img",{src:t,alt:e,title:n,width:o}]}},tm=ae(V({},qd),{content:"paragraph block*"}),nm=ae(V({},Bd),{content:"list_item+",group:"block"}),im=ae(V({},zd),{content:"list_item+",group:"block"}),om={doc:Wh,text:Gh,paragraph:Kh,blockquote:Jh,horizontal_rule:Yh,heading:Qh,hard_break:Zh,code_block:Xh,image:em,list_item:tm,ordered_list:nm,bullet_list:im},Bi=new No({marks:Uh,nodes:om});var jd=(i,t)=>i.selection.empty?!1:(t&&t(i.tr.deleteSelection().scrollIntoView()),!0);function rm(i,t){let{$cursor:e}=i.selection;return!e||(t?!t.endOfTextblock("backward",i):e.parentOffset>0)?null:e}var sm=(i,t,e)=>{let n=rm(i,e);if(!n)return!1;let o=Ud(n);if(!o){let s=n.blockRange(),l=s&&on(s);return l==null?!1:(t&&t(i.tr.lift(s,l).scrollIntoView()),!0)}let r=o.nodeBefore;if(Kd(i,o,t,-1))return!0;if(n.parent.content.size==0&&(si(r,"end")||N.isSelectable(r)))for(let s=n.depth;;s--){let l=Bo(i.doc,n.before(s),n.after(s),I.empty);if(l&&l.slice.size<l.to-l.from){if(t){let a=i.tr.step(l);a.setSelection(si(r,"end")?z.findFrom(a.doc.resolve(a.mapping.map(o.pos,-1)),-1):N.create(a.doc,o.pos-r.nodeSize)),t(a.scrollIntoView())}return!0}if(s==1||n.node(s-1).childCount>1)break}return r.isAtom&&o.depth==n.depth-1?(t&&t(i.tr.delete(o.pos-r.nodeSize,o.pos).scrollIntoView()),!0):!1};function si(i,t,e=!1){for(let n=i;n;n=t=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(e&&n.childCount!=1)return!1}return!1}var lm=(i,t,e)=>{let{$head:n,empty:o}=i.selection,r=n;if(!o)return!1;if(n.parent.isTextblock){if(e?!e.endOfTextblock("backward",i):n.parentOffset>0)return!1;r=Ud(n)}let s=r&&r.nodeBefore;return!s||!N.isSelectable(s)?!1:(t&&t(i.tr.setSelection(N.create(i.doc,r.pos-s.nodeSize)).scrollIntoView()),!0)};function Ud(i){if(!i.parent.type.spec.isolating)for(let t=i.depth-1;t>=0;t--){if(i.index(t)>0)return i.doc.resolve(i.before(t+1));if(i.node(t).type.spec.isolating)break}return null}function am(i,t){let{$cursor:e}=i.selection;return!e||(t?!t.endOfTextblock("forward",i):e.parentOffset<e.parent.content.size)?null:e}var cm=(i,t,e)=>{let n=am(i,e);if(!n)return!1;let o=Wd(n);if(!o)return!1;let r=o.nodeAfter;if(Kd(i,o,t,1))return!0;if(n.parent.content.size==0&&(si(r,"start")||N.isSelectable(r))){let s=Bo(i.doc,n.before(),n.after(),I.empty);if(s&&s.slice.size<s.to-s.from){if(t){let l=i.tr.step(s);l.setSelection(si(r,"start")?z.findFrom(l.doc.resolve(l.mapping.map(o.pos)),1):N.create(l.doc,l.mapping.map(o.pos))),t(l.scrollIntoView())}return!0}}return r.isAtom&&o.depth==n.depth-1?(t&&t(i.tr.delete(o.pos,o.pos+r.nodeSize).scrollIntoView()),!0):!1},dm=(i,t,e)=>{let{$head:n,empty:o}=i.selection,r=n;if(!o)return!1;if(n.parent.isTextblock){if(e?!e.endOfTextblock("forward",i):n.parentOffset<n.parent.content.size)return!1;r=Wd(n)}let s=r&&r.nodeAfter;return!s||!N.isSelectable(s)?!1:(t&&t(i.tr.setSelection(N.create(i.doc,r.pos)).scrollIntoView()),!0)};function Wd(i){if(!i.parent.type.spec.isolating)for(let t=i.depth-1;t>=0;t--){let e=i.node(t);if(i.index(t)+1<e.childCount)return i.doc.resolve(i.after(t+1));if(e.type.spec.isolating)break}return null}var Gd=(i,t)=>{let{$from:e,$to:n}=i.selection,o=e.blockRange(n),r=o&&on(o);return r==null?!1:(t&&t(i.tr.lift(o,r).scrollIntoView()),!0)},Rs=(i,t)=>{let{$head:e,$anchor:n}=i.selection;return!e.parent.type.spec.code||!e.sameParent(n)?!1:(t&&t(i.tr.insertText(`
`).scrollIntoView()),!0)};function As(i){for(let t=0;t<i.edgeCount;t++){let{type:e}=i.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}var Ps=(i,t)=>{let{$head:e,$anchor:n}=i.selection;if(!e.parent.type.spec.code||!e.sameParent(n))return!1;let o=e.node(-1),r=e.indexAfter(-1),s=As(o.contentMatchAt(r));if(!s||!o.canReplaceWith(r,r,s))return!1;if(t){let l=e.after(),a=i.tr.replaceWith(l,l,s.createAndFill());a.setSelection(z.near(a.doc.resolve(l),1)),t(a.scrollIntoView())}return!0},Fs=(i,t)=>{let e=i.selection,{$from:n,$to:o}=e;if(e instanceof De||n.parent.inlineContent||o.parent.inlineContent)return!1;let r=As(o.parent.contentMatchAt(o.indexAfter()));if(!r||!r.isTextblock)return!1;if(t){let s=(!n.parentOffset&&o.index()<o.parent.childCount?n:o).pos,l=i.tr.insert(s,r.createAndFill());l.setSelection(U.create(l.doc,s+1)),t(l.scrollIntoView())}return!0},Ls=(i,t)=>{let{$cursor:e}=i.selection;if(!e||e.parent.content.size)return!1;if(e.depth>1&&e.after()!=e.end(-1)){let r=e.before();if(Lt(i.doc,r))return t&&t(i.tr.split(r).scrollIntoView()),!0}let n=e.blockRange(),o=n&&on(n);return o==null?!1:(t&&t(i.tr.lift(n,o).scrollIntoView()),!0)};function um(i){return(t,e)=>{let{$from:n,$to:o}=t.selection;if(t.selection instanceof N&&t.selection.node.isBlock)return!n.parentOffset||!Lt(t.doc,n.pos)?!1:(e&&e(t.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let r=[],s,l,a=!1,c=!1;for(let g=n.depth;;g--)if(n.node(g).isBlock){a=n.end(g)==n.pos+(n.depth-g),c=n.start(g)==n.pos-(n.depth-g),l=As(n.node(g-1).contentMatchAt(n.indexAfter(g-1)));let b=i&&i(o.parent,a,n);r.unshift(b||(a&&l?{type:l}:null)),s=g;break}else{if(g==1)return!1;r.unshift(null)}let d=t.tr;(t.selection instanceof U||t.selection instanceof De)&&d.deleteSelection();let u=d.mapping.map(n.pos),h=Lt(d.doc,u,r.length,r);if(h||(r[0]=l?{type:l}:null,h=Lt(d.doc,u,r.length,r)),!h)return!1;if(d.split(u,r.length,r),!a&&c&&n.node(s).type!=l){let g=d.mapping.map(n.before(s)),m=d.doc.resolve(g);l&&n.node(s-1).canReplaceWith(m.index(),m.index()+1,l)&&d.setNodeMarkup(d.mapping.map(n.before(s)),l)}return e&&e(d.scrollIntoView()),!0}}var Bs=um();var pm=(i,t)=>(t&&t(i.tr.setSelection(new De(i.doc))),!0);function fm(i,t,e){let n=t.nodeBefore,o=t.nodeAfter,r=t.index();return!n||!o||!n.type.compatibleContent(o.type)?!1:!n.content.size&&t.parent.canReplace(r-1,r)?(e&&e(i.tr.delete(t.pos-n.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(r,r+1)||!(o.isTextblock||rn(i.doc,t.pos))?!1:(e&&e(i.tr.join(t.pos).scrollIntoView()),!0)}function Kd(i,t,e,n){let o=t.nodeBefore,r=t.nodeAfter,s,l,a=o.type.spec.isolating||r.type.spec.isolating;if(!a&&fm(i,t,e))return!0;let c=!a&&t.parent.canReplace(t.index(),t.index()+1);if(c&&(s=(l=o.contentMatchAt(o.childCount)).findWrapping(r.type))&&l.matchType(s[0]||r.type).validEnd){if(e){let g=t.pos+r.nodeSize,m=w.empty;for(let k=s.length-1;k>=0;k--)m=w.from(s[k].create(null,m));m=w.from(o.copy(m));let b=i.tr.step(new le(t.pos-1,g,t.pos,g,new I(m,1,0),s.length,!0)),C=b.doc.resolve(g+2*s.length);C.nodeAfter&&C.nodeAfter.type==o.type&&rn(b.doc,C.pos)&&b.join(C.pos),e(b.scrollIntoView())}return!0}let d=r.type.spec.isolating||n>0&&a?null:z.findFrom(t,1),u=d&&d.$from.blockRange(d.$to),h=u&&on(u);if(h!=null&&h>=t.depth)return e&&e(i.tr.lift(u,h).scrollIntoView()),!0;if(c&&si(r,"start",!0)&&si(o,"end")){let g=o,m=[];for(;m.push(g),!g.isTextblock;)g=g.lastChild;let b=r,C=1;for(;!b.isTextblock;b=b.firstChild)C++;if(g.canReplace(g.childCount,g.childCount,b.content)){if(e){let k=w.empty;for(let te=m.length-1;te>=0;te--)k=w.from(m[te].copy(k));let X=i.tr.step(new le(t.pos-m.length,t.pos+r.nodeSize,t.pos+C,t.pos+r.nodeSize-C,new I(k,m.length,0),0,!0));e(X.scrollIntoView())}return!0}}return!1}function Jd(i){return function(t,e){let n=t.selection,o=i<0?n.$from:n.$to,r=o.depth;for(;o.node(r).isInline;){if(!r)return!1;r--}return o.node(r).isTextblock?(e&&e(t.tr.setSelection(U.create(t.doc,i<0?o.start(r):o.end(r)))),!0):!1}}var hm=Jd(-1),mm=Jd(1);function Yd(i,t=null){return function(e,n){let{$from:o,$to:r}=e.selection,s=o.blockRange(r),l=s&&Yn(s,i,t);return l?(n&&n(e.tr.wrap(s,l).scrollIntoView()),!0):!1}}function er(i,t=null){return function(e,n){let o=!1;for(let r=0;r<e.selection.ranges.length&&!o;r++){let{$from:{pos:s},$to:{pos:l}}=e.selection.ranges[r];e.doc.nodesBetween(s,l,(a,c)=>{if(o)return!1;if(!(!a.isTextblock||a.hasMarkup(i,t)))if(a.type==i)o=!0;else{let d=e.doc.resolve(c),u=d.index();o=d.parent.canReplaceWith(u,u+1,i)}})}if(!o)return!1;if(n){let r=e.tr;for(let s=0;s<e.selection.ranges.length;s++){let{$from:{pos:l},$to:{pos:a}}=e.selection.ranges[s];r.setBlockType(l,a,i,t)}n(r.scrollIntoView())}return!0}}function gm(i,t,e,n){for(let o=0;o<t.length;o++){let{$from:r,$to:s}=t[o],l=r.depth==0?i.inlineContent&&i.type.allowsMarkType(e):!1;if(i.nodesBetween(r.pos,s.pos,(a,c)=>{if(l||!n&&a.isAtom&&a.isInline&&c>=r.pos&&c+a.nodeSize<=s.pos)return!1;l=a.inlineContent&&a.type.allowsMarkType(e)}),l)return!0}return!1}function ym(i){let t=[];for(let e=0;e<i.length;e++){let{$from:n,$to:o}=i[e];n.doc.nodesBetween(n.pos,o.pos,(r,s)=>{if(r.isAtom&&r.content.size&&r.isInline&&s>=n.pos&&s+r.nodeSize<=o.pos)return s+1>n.pos&&t.push(new Xn(n,n.doc.resolve(s+1))),n=n.doc.resolve(s+1+r.content.size),!1}),n.pos<o.pos&&t.push(new Xn(n,o))}return t}function mn(i,t=null,e){let n=(e&&e.removeWhenPresent)!==!1,o=(e&&e.enterInlineAtoms)!==!1,r=!(e&&e.includeWhitespace);return function(s,l){let{empty:a,$cursor:c,ranges:d}=s.selection;if(a&&!c||!gm(s.doc,d,i,o))return!1;if(l)if(c)i.isInSet(s.storedMarks||c.marks())?l(s.tr.removeStoredMark(i)):l(s.tr.addStoredMark(i.create(t)));else{let u,h=s.tr;o||(d=ym(d)),n?u=!d.some(g=>s.doc.rangeHasMark(g.$from.pos,g.$to.pos,i)):u=!d.every(g=>{let m=!1;return h.doc.nodesBetween(g.$from.pos,g.$to.pos,(b,C,k)=>{if(m)return!1;m=!i.isInSet(b.marks)&&!!k&&k.type.allowsMarkType(i)&&!(b.isText&&/^\s*$/.test(b.textBetween(Math.max(0,g.$from.pos-C),Math.min(b.nodeSize,g.$to.pos-C))))}),!m});for(let g=0;g<d.length;g++){let{$from:m,$to:b}=d[g];if(!u)h.removeMark(m.pos,b.pos,i);else{let C=m.pos,k=b.pos,X=m.nodeAfter,te=b.nodeBefore,et=r&&X&&X.isText?/^\s*/.exec(X.text)[0].length:0,Ut=r&&te&&te.isText?/\s*$/.exec(te.text)[0].length:0;C+et<k&&(C+=et,k-=Ut),h.addMark(C,k,i.create(t))}}l(h.scrollIntoView())}return!0}}function li(...i){return function(t,e,n){for(let o=0;o<i.length;o++)if(i[o](t,e,n))return!0;return!1}}var Ns=li(jd,sm,lm),$d=li(jd,cm,dm),wt={Enter:li(Rs,Fs,Ls,Bs),"Mod-Enter":Ps,Backspace:Ns,"Mod-Backspace":Ns,"Shift-Backspace":Ns,Delete:$d,"Mod-Delete":$d,"Mod-a":pm},Qd={"Ctrl-h":wt.Backspace,"Alt-Backspace":wt["Mod-Backspace"],"Ctrl-d":wt.Delete,"Ctrl-Alt-Backspace":wt["Mod-Delete"],"Alt-Delete":wt["Mod-Delete"],"Alt-d":wt["Mod-Delete"],"Ctrl-a":hm,"Ctrl-e":mm};for(let i in wt)Qd[i]=wt[i];var _m=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,Xd=_m?Qd:wt;var qe=class{constructor(t,e,n={}){this.match=t,this.match=t,this.handler=typeof e=="string"?xm(e):e,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1,this.inCodeMark=n.inCodeMark!==!1}};function xm(i){return function(t,e,n,o){let r=i;if(e[1]){let s=e[0].lastIndexOf(e[1]);r+=e[0].slice(s+e[1].length),n+=s;let l=n-o;l>0&&(r=e[0].slice(s-l,s)+r,n=o)}return t.tr.insertText(r,n,o)}}var bm=500;function eu({rules:i}){let t=new he({state:{init(){return null},apply(e,n){let o=e.getMeta(this);return o||(e.selectionSet||e.docChanged?null:n)}},props:{handleTextInput(e,n,o,r){return Zd(e,n,o,r,i,t)},handleDOMEvents:{compositionend:e=>{setTimeout(()=>{let{$cursor:n}=e.state.selection;n&&Zd(e,n.pos,n.pos,"",i,t)})}}},isInputRules:!0});return t}function Zd(i,t,e,n,o,r){if(i.composing)return!1;let s=i.state,l=s.doc.resolve(t),a=l.parent.textBetween(Math.max(0,l.parentOffset-bm),l.parentOffset,null,"\uFFFC")+n;for(let c=0;c<o.length;c++){let d=o[c];if(!d.inCodeMark&&l.marks().some(m=>m.type.spec.code))continue;if(l.parent.type.spec.code){if(!d.inCode)continue}else if(d.inCode==="only")continue;let u=d.match.exec(a);if(!u||u[0].length<n.length)continue;let h=t-(u[0].length-n.length);if(!d.inCodeMark){let m=!1;if(s.doc.nodesBetween(h,l.pos,b=>{b.isInline&&b.marks.some(C=>C.type.spec.code)&&(m=!0)}),m)continue}let g=d.handler(s,u,h,e);if(g)return d.undoable&&g.setMeta(r,{transform:g,from:t,to:e,text:n}),i.dispatch(g),!0}return!1}var tu=new qe(/--$/,"\u2014",{inCodeMark:!1}),nu=new qe(/\.\.\.$/,"\u2026",{inCodeMark:!1}),Cm=new qe(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"\u201C",{inCodeMark:!1}),vm=new qe(/"$/,"\u201D",{inCodeMark:!1}),Sm=new qe(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"\u2018",{inCodeMark:!1}),wm=new qe(/'$/,"\u2019",{inCodeMark:!1}),iu=[Cm,vm,Sm,wm];function tr(i,t,e=null,n){return new qe(i,(o,r,s,l)=>{let a=e instanceof Function?e(r):e,c=o.tr.delete(s,l),d=c.doc.resolve(s),u=d.blockRange(),h=u&&Yn(u,t,a);if(!h)return null;c.wrap(u,h);let g=c.doc.resolve(s-1).nodeBefore;return g&&g.type==t&&rn(c.doc,s-1)&&(!n||n(r,g))&&c.join(s-1),c})}function zs(i,t,e=null){return new qe(i,(n,o,r,s)=>{let l=n.doc.resolve(r),a=e instanceof Function?e(o):e;return l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),t)?n.tr.delete(r,s).setBlockType(r,r,t,a):null})}var nr=(i,t)=>{let{from:e,$from:n,to:o,empty:r}=i.selection;return r?!!t.isInSet(i.storedMarks||n.marks()):i.doc.rangeHasMark(e,o,t)},Mm=(i,t)=>{for(let e=t.depth;e>0;e-=1)if(t.node(e).type===i)return t.node(e).type;return null},qs=(i,t,e={})=>{let{selection:n}=i,{$from:o,to:r}=n,s=Mm(t,o);return!Object.entries(e).length||!s?!!s:r<=o.end()&&o.parent.hasMarkup(t,e)},ou=i=>{let t=[],{selection:e,storedMarks:n}=i,{from:o,to:r,empty:s,$from:l}=e;return s?t=n||l.marks():i.doc.nodesBetween(o,r,a=>{t=[...t,...a.marks]}),t},Vs=i=>{let t=[],{selection:{from:e,to:n}}=i;return i.doc.nodesBetween(e,n,o=>{t.push(o)}),t},Hs=(i,t,e)=>{for(let n of t){let{$from:o,$to:r}=n,s=o.depth===0?i.type.allowsMarkType(e):!1;if(i.nodesBetween(o.pos,r.pos,l=>s?!1:(s=l.inlineContent&&l.type.allowsMarkType(e),!0)),s)return!0}return!1},$s=(i,t,e)=>new qe(i,(n,o,r,s)=>{let{tr:l}=n,a=r,c=s,[d,,u]=o,h=d.search(/\S/);if(u){let g=r+d.indexOf(u),m=g+u.length;m<s&&l.delete(m,s),g>r&&l.delete(r+h,g),c=r+u.length+h}return l.addMark(a,c,t.create(e)),l.removeStoredMark(t),l}),ru=(i,t)=>{let{$from:e}=i.selection;for(let n=e.depth;n>=0;n-=1){let o=e.index(n);if(e.node(n).canReplaceWith(o,o,t))return!0}return!1};var su=()=>(i,t)=>{let{doc:e,selection:n,tr:o,schema:r}=i,{$head:{pos:s},from:l,to:a}=n,c=r.marks.link;if(l===a){let d=e.resolve(s),u=s-d.textOffset,h=u+d.parent.child(d.index()).nodeSize;o.removeMark(u,h,c)}else o.removeMark(l,a,c);return o.docChanged?(t?.(o),!0):!1},js=(i,t={})=>(e,n)=>{let{tr:o,selection:r}=e,{empty:s,ranges:l,$from:a,$to:c}=r;if(s&&r instanceof U){let{$cursor:d}=r;if(!d||!Hs(e.doc,l,i)||(o.addStoredMark(i.create(t)),!o.storedMarksSet))return!1;n?.(o)}else{if(o.addMark(a.pos,c.pos,i.create(t)),!o.docChanged)return!1;n?.(o.scrollIntoView())}return!0},lu=i=>(t,e)=>{let{tr:n,selection:o,storedMarks:r,doc:s}=t,{empty:l,ranges:a}=o;if(l&&o instanceof U){let{$cursor:c}=o;if(!c||!Hs(t.doc,a,i))return!1;if(i.isInSet(r||c.marks()))return n.removeStoredMark(i),e?.(n),!0}else{for(let c of a){let{$from:d,$to:u}=c;s.rangeHasMark(d.pos,u.pos,i)&&n.removeMark(d.pos,u.pos,i)}if(!n.docChanged)return!1;e?.(n.scrollIntoView())}return!1};var ir=200,ue=function(){};ue.prototype.append=function(t){return t.length?(t=ue.from(t),!this.length&&t||t.length<ir&&this.leafAppend(t)||this.length<ir&&t.leafPrepend(this)||this.appendInner(t)):this};ue.prototype.prepend=function(t){return t.length?ue.from(t).append(this):this};ue.prototype.appendInner=function(t){return new Im(this,t)};ue.prototype.slice=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=this.length),t>=e?ue.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))};ue.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};ue.prototype.forEach=function(t,e,n){e===void 0&&(e=0),n===void 0&&(n=this.length),e<=n?this.forEachInner(t,e,n,0):this.forEachInvertedInner(t,e,n,0)};ue.prototype.map=function(t,e,n){e===void 0&&(e=0),n===void 0&&(n=this.length);var o=[];return this.forEach(function(r,s){return o.push(t(r,s))},e,n),o};ue.from=function(t){return t instanceof ue?t:t&&t.length?new au(t):ue.empty};var au=function(i){function t(n){i.call(this),this.values=n}i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t;var e={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(o,r){return o==0&&r==this.length?this:new t(this.values.slice(o,r))},t.prototype.getInner=function(o){return this.values[o]},t.prototype.forEachInner=function(o,r,s,l){for(var a=r;a<s;a++)if(o(this.values[a],l+a)===!1)return!1},t.prototype.forEachInvertedInner=function(o,r,s,l){for(var a=r-1;a>=s;a--)if(o(this.values[a],l+a)===!1)return!1},t.prototype.leafAppend=function(o){if(this.length+o.length<=ir)return new t(this.values.concat(o.flatten()))},t.prototype.leafPrepend=function(o){if(this.length+o.length<=ir)return new t(o.flatten().concat(this.values))},e.length.get=function(){return this.values.length},e.depth.get=function(){return 0},Object.defineProperties(t.prototype,e),t}(ue);ue.empty=new au([]);var Im=function(i){function t(e,n){i.call(this),this.left=e,this.right=n,this.length=e.length+n.length,this.depth=Math.max(e.depth,n.depth)+1}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},t.prototype.forEachInner=function(n,o,r,s){var l=this.left.length;if(o<l&&this.left.forEachInner(n,o,Math.min(r,l),s)===!1||r>l&&this.right.forEachInner(n,Math.max(o-l,0),Math.min(this.length,r)-l,s+l)===!1)return!1},t.prototype.forEachInvertedInner=function(n,o,r,s){var l=this.left.length;if(o>l&&this.right.forEachInvertedInner(n,o-l,Math.max(r,l)-l,s+l)===!1||r<l&&this.left.forEachInvertedInner(n,Math.min(o,l),r,s)===!1)return!1},t.prototype.sliceInner=function(n,o){if(n==0&&o==this.length)return this;var r=this.left.length;return o<=r?this.left.slice(n,o):n>=r?this.right.slice(n-r,o-r):this.left.slice(n,r).append(this.right.slice(0,o-r))},t.prototype.leafAppend=function(n){var o=this.right.leafAppend(n);if(o)return new t(this.left,o)},t.prototype.leafPrepend=function(n){var o=this.left.leafPrepend(n);if(o)return new t(o,this.right)},t.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new t(this.left,new t(this.right,n)):new t(this,n)},t}(ue),Us=ue;var Em=500,yn=class i{constructor(t,e){this.items=t,this.eventCount=e}popEvent(t,e){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let o,r;e&&(o=this.remapping(n,this.items.length),r=o.maps.length);let s=t.tr,l,a,c=[],d=[];return this.items.forEach((u,h)=>{if(!u.step){o||(o=this.remapping(n,h+1),r=o.maps.length),r--,d.push(u);return}if(o){d.push(new pt(u.map));let g=u.step.map(o.slice(r)),m;g&&s.maybeStep(g).doc&&(m=s.mapping.maps[s.mapping.maps.length-1],c.push(new pt(m,void 0,void 0,c.length+d.length))),r--,m&&o.appendMap(m,r)}else s.maybeStep(u.step);if(u.selection)return l=o?u.selection.map(o.slice(r)):u.selection,a=new i(this.items.slice(0,n).append(d.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:a,transform:s,selection:l}}addTransform(t,e,n,o){let r=[],s=this.eventCount,l=this.items,a=!o&&l.length?l.get(l.length-1):null;for(let d=0;d<t.steps.length;d++){let u=t.steps[d].invert(t.docs[d]),h=new pt(t.mapping.maps[d],u,e),g;(g=a&&a.merge(h))&&(h=g,d?r.pop():l=l.slice(0,l.length-1)),r.push(h),e&&(s++,e=void 0),o||(a=h)}let c=s-n.depth;return c>Tm&&(l=km(l,c),s-=c),new i(l.append(r),s)}remapping(t,e){let n=new Mi;return this.items.forEach((o,r)=>{let s=o.mirrorOffset!=null&&r-o.mirrorOffset>=t?n.maps.length-o.mirrorOffset:void 0;n.appendMap(o.map,s)},t,e),n}addMaps(t){return this.eventCount==0?this:new i(this.items.append(t.map(e=>new pt(e))),this.eventCount)}rebased(t,e){if(!this.eventCount)return this;let n=[],o=Math.max(0,this.items.length-e),r=t.mapping,s=t.steps.length,l=this.eventCount;this.items.forEach(h=>{h.selection&&l--},o);let a=e;this.items.forEach(h=>{let g=r.getMirror(--a);if(g==null)return;s=Math.min(s,g);let m=r.maps[g];if(h.step){let b=t.steps[g].invert(t.docs[g]),C=h.selection&&h.selection.map(r.slice(a+1,g));C&&l++,n.push(new pt(m,b,C))}else n.push(new pt(m))},o);let c=[];for(let h=e;h<s;h++)c.push(new pt(r.maps[h]));let d=this.items.slice(0,o).append(c).append(n),u=new i(d,l);return u.emptyItemCount()>Em&&(u=u.compress(this.items.length-n.length)),u}emptyItemCount(){let t=0;return this.items.forEach(e=>{e.step||t++}),t}compress(t=this.items.length){let e=this.remapping(0,t),n=e.maps.length,o=[],r=0;return this.items.forEach((s,l)=>{if(l>=t)o.push(s),s.selection&&r++;else if(s.step){let a=s.step.map(e.slice(n)),c=a&&a.getMap();if(n--,c&&e.appendMap(c,n),a){let d=s.selection&&s.selection.map(e.slice(n));d&&r++;let u=new pt(c.invert(),a,d),h,g=o.length-1;(h=o.length&&o[g].merge(u))?o[g]=h:o.push(u)}}else s.map&&n--},this.items.length,0),new i(Us.from(o.reverse()),r)}};yn.empty=new yn(Us.empty,0);function km(i,t){let e;return i.forEach((n,o)=>{if(n.selection&&t--==0)return e=o,!1}),i.slice(e)}var pt=class i{constructor(t,e,n,o){this.map=t,this.step=e,this.selection=n,this.mirrorOffset=o}merge(t){if(this.step&&t.step&&!t.selection){let e=t.step.merge(this.step);if(e)return new i(e.getMap().invert(),e,this.selection)}}},ft=class{constructor(t,e,n,o,r){this.done=t,this.undone=e,this.prevRanges=n,this.prevTime=o,this.prevComposition=r}},Tm=20;function Om(i,t,e,n){let o=e.getMeta(gn),r;if(o)return o.historyState;e.getMeta(Rm)&&(i=new ft(i.done,i.undone,null,0,-1));let s=e.getMeta("appendedTransaction");if(e.steps.length==0)return i;if(s&&s.getMeta(gn))return s.getMeta(gn).redo?new ft(i.done.addTransform(e,void 0,n,or(t)),i.undone,cu(e.mapping.maps),i.prevTime,i.prevComposition):new ft(i.done,i.undone.addTransform(e,void 0,n,or(t)),null,i.prevTime,i.prevComposition);if(e.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let l=e.getMeta("composition"),a=i.prevTime==0||!s&&i.prevComposition!=l&&(i.prevTime<(e.time||0)-n.newGroupDelay||!Dm(e,i.prevRanges)),c=s?Ws(i.prevRanges,e.mapping):cu(e.mapping.maps);return new ft(i.done.addTransform(e,a?t.selection.getBookmark():void 0,n,or(t)),yn.empty,c,e.time,l??i.prevComposition)}else return(r=e.getMeta("rebased"))?new ft(i.done.rebased(e,r),i.undone.rebased(e,r),Ws(i.prevRanges,e.mapping),i.prevTime,i.prevComposition):new ft(i.done.addMaps(e.mapping.maps),i.undone.addMaps(e.mapping.maps),Ws(i.prevRanges,e.mapping),i.prevTime,i.prevComposition)}function Dm(i,t){if(!t)return!1;if(!i.docChanged)return!0;let e=!1;return i.mapping.maps[0].forEach((n,o)=>{for(let r=0;r<t.length;r+=2)n<=t[r+1]&&o>=t[r]&&(e=!0)}),e}function cu(i){let t=[];for(let e=i.length-1;e>=0&&t.length==0;e--)i[e].forEach((n,o,r,s)=>t.push(r,s));return t}function Ws(i,t){if(!i)return null;let e=[];for(let n=0;n<i.length;n+=2){let o=t.map(i[n],1),r=t.map(i[n+1],-1);o<=r&&e.push(o,r)}return e}function Nm(i,t,e){let n=or(t),o=gn.get(t).spec.config,r=(e?i.undone:i.done).popEvent(t,n);if(!r)return null;let s=r.selection.resolve(r.transform.doc),l=(e?i.done:i.undone).addTransform(r.transform,t.selection.getBookmark(),o,n),a=new ft(e?l:r.remaining,e?r.remaining:l,null,0,-1);return r.transform.setSelection(s).setMeta(gn,{redo:e,historyState:a})}var Gs=!1,du=null;function or(i){let t=i.plugins;if(du!=t){Gs=!1,du=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){Gs=!0;break}}return Gs}var gn=new Ne("history"),Rm=new Ne("closeHistory");function uu(i={}){return i={depth:i.depth||100,newGroupDelay:i.newGroupDelay||500},new he({key:gn,state:{init(){return new ft(yn.empty,yn.empty,null,0,-1)},apply(t,e,n){return Om(e,n,t,i)}},config:i,props:{handleDOMEvents:{beforeinput(t,e){let n=e.inputType,o=n=="historyUndo"?sr:n=="historyRedo"?zi:null;return!o||!t.editable?!1:(e.preventDefault(),o(t.state,t.dispatch))}}}})}function rr(i,t){return(e,n)=>{let o=gn.getState(e);if(!o||(i?o.undone:o.done).eventCount==0)return!1;if(n){let r=Nm(o,e,i);r&&n(t?r.scrollIntoView():r)}return!0}}var sr=rr(!1,!0),zi=rr(!0,!0),M_=rr(!1,!1),I_=rr(!0,!1);var Mt={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ar={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Am=typeof navigator<"u"&&/Mac/.test(navigator.platform),Pm=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(ne=0;ne<10;ne++)Mt[48+ne]=Mt[96+ne]=String(ne);var ne;for(ne=1;ne<=24;ne++)Mt[ne+111]="F"+ne;var ne;for(ne=65;ne<=90;ne++)Mt[ne]=String.fromCharCode(ne+32),ar[ne]=String.fromCharCode(ne);var ne;for(lr in Mt)ar.hasOwnProperty(lr)||(ar[lr]=Mt[lr]);var lr;function pu(i){var t=Am&&i.metaKey&&i.shiftKey&&!i.ctrlKey&&!i.altKey||Pm&&i.shiftKey&&i.key&&i.key.length==1||i.key=="Unidentified",e=!t&&i.key||(i.shiftKey?ar:Mt)[i.keyCode]||i.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}var Fm=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Lm=typeof navigator<"u"&&/Win/.test(navigator.platform);function Bm(i){let t=i.split(/-(?!$)/),e=t[t.length-1];e=="Space"&&(e=" ");let n,o,r,s;for(let l=0;l<t.length-1;l++){let a=t[l];if(/^(cmd|meta|m)$/i.test(a))s=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))o=!0;else if(/^s(hift)?$/i.test(a))r=!0;else if(/^mod$/i.test(a))Fm?s=!0:o=!0;else throw new Error("Unrecognized modifier name: "+a)}return n&&(e="Alt-"+e),o&&(e="Ctrl-"+e),s&&(e="Meta-"+e),r&&(e="Shift-"+e),e}function zm(i){let t=Object.create(null);for(let e in i)t[Bm(e)]=i[e];return t}function Ks(i,t,e=!0){return t.altKey&&(i="Alt-"+i),t.ctrlKey&&(i="Ctrl-"+i),t.metaKey&&(i="Meta-"+i),e&&t.shiftKey&&(i="Shift-"+i),i}function qi(i){return new he({props:{handleKeyDown:qm(i)}})}function qm(i){let t=zm(i);return function(e,n){let o=pu(n),r,s=t[Ks(o,n)];if(s&&s(e.state,e.dispatch,e))return!0;if(o.length==1&&o!=" "){if(n.shiftKey){let l=t[Ks(o,n,!1)];if(l&&l(e.state,e.dispatch,e))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Lm&&n.ctrlKey&&n.altKey)&&(r=Mt[n.keyCode])&&r!=o){let l=t[Ks(r,n)];if(l&&l(e.state,e.dispatch,e))return!0}}return!1}}var Vm=["imgEl"],Hm=i=>({"NgxEditor__Resizer--Active":i});function $m(i,t){if(i&1){let e=H();f(0,"span",4)(1,"span",5),E("mousedown",function(o){R(e);let r=v();return A(r.startResizing(o,"left"))}),p(),f(2,"span",6),E("mousedown",function(o){R(e);let r=v();return A(r.startResizing(o,"right"))}),p(),f(3,"span",7),E("mousedown",function(o){R(e);let r=v();return A(r.startResizing(o,"left"))}),p(),f(4,"span",8),E("mousedown",function(o){R(e);let r=v();return A(r.startResizing(o,"right"))}),p()()}}var jm=["ngxEditor"],Um=["*"];function Wm(i,t){if(i&1&&(f(0,"div",12),y(1),D(2,"async"),p()),i&2){let e=v(2);_(),F(" ",B(2,1,(e.href.errors==null?null:e.href.errors.pattern)&&e.getLabel("enterValidUrl"))," ")}}function Gm(i,t){if(i&1&&(f(0,"div",12),y(1),p()),i&2){let e=v(2);_(),F(" ",(e.text.errors==null?null:e.text.errors.required)&&"This is required"," ")}}function Km(i,t){if(i&1&&(f(0,"div",4)(1,"div",5)(2,"label"),S(3,"input",13),y(4),D(5,"async"),p()()()),i&2){let e=v(2);_(4),F(" ",B(5,1,e.getLabel("openInNewTab"))," ")}}function Jm(i,t){if(i&1){let e=H();f(0,"div",2)(1,"form",3),E("ngSubmit",function(o){R(e);let r=v();return A(r.insertLink(o))}),f(2,"div",4)(3,"div",5)(4,"label",6),y(5),D(6,"async"),p(),S(7,"input",7),M(8,Wm,3,3,"div",8),p()(),f(9,"div",4)(10,"div",5)(11,"label",6),y(12),D(13,"async"),p(),S(14,"input",9),M(15,Gm,2,1,"div",8),p()(),M(16,Km,6,3,"div",10),f(17,"button",11),y(18),D(19,"async"),p()()()}if(i&2){let e=v();_(),x("formGroup",e.form),_(3),x("htmlFor",e.getId("link-popup-url")),_(),ee(B(6,12,e.getLabel("url"))),_(2),x("id",e.getId("link-popup-url")),_(),x("ngIf",e.href.touched&&e.href.invalid),_(3),x("htmlFor",e.getId("link-popup-label")),_(),ee(B(13,14,e.getLabel("text"))),_(2),x("id",e.getId("link-popup-label")),_(),x("ngIf",e.text.touched&&e.text.invalid),_(),x("ngIf",e.options.showOpenInNewTab),_(),x("disabled",!e.form.valid),_(),ee(B(19,16,e.getLabel("insert")))}}var Ym=(i,t)=>({"NgxEditor__Dropdown--Active":i,"NgxEditor--Disabled":t});function Qm(i,t){if(i&1){let e=H();f(0,"button",4),D(1,"async"),E("mousedown",function(o){let r=R(e).$implicit,s=v(2);return A(s.onDropdownItemMouseClick(o,r))})("keydown.enter",function(o){let r=R(e).$implicit,s=v(2);return A(s.onDropdownItemKeydown(o,r))})("keydown.space",function(o){let r=R(e).$implicit,s=v(2);return A(s.onDropdownItemKeydown(o,r))}),y(2),D(3,"async"),p()}if(i&2){let e=t.$implicit,n=v(2);x("ngClass",eo(8,Ym,e===n.activeItem,n.disabledItems.includes(e)))("ariaLabel",B(1,4,n.getName(e))),wr("aria-selected",e===n.activeItem),_(2),F(" ",B(3,6,n.getName(e))," ")}}function Xm(i,t){if(i&1&&(f(0,"div",2),M(1,Qm,4,11,"button",3),p()),i&2){let e=v();_(),x("ngForOf",e.items)("ngForTrackBy",e.trackByIndex)}}function Zm(i,t){if(i&1&&(f(0,"div",12),y(1),D(2,"async"),p()),i&2){let e=v(2);_(),F(" ",B(2,1,(e.src.errors==null?null:e.src.errors.pattern)&&e.getLabel("enterValidUrl"))," ")}}function eg(i,t){if(i&1){let e=H();f(0,"div",2)(1,"form",3),E("ngSubmit",function(o){R(e);let r=v();return A(r.insertLink(o))}),f(2,"div",4)(3,"div",5)(4,"label",6),y(5),D(6,"async"),p(),S(7,"input",7),M(8,Zm,3,3,"div",8),p()(),f(9,"div",4)(10,"div",5)(11,"label",6),y(12),D(13,"async"),p(),S(14,"input",9),p()(),f(15,"div",4)(16,"div",5)(17,"label",6),y(18),D(19,"async"),p(),S(20,"input",10),p()(),f(21,"button",11),y(22),D(23,"async"),p()()()}if(i&2){let e=v();_(),x("formGroup",e.form),_(3),x("htmlFor",e.getId("image-popup-url")),_(),ee(B(6,13,e.getLabel("url"))),_(2),x("id",e.getId("image-popup-url")),_(),x("ngIf",e.src.touched&&e.src.invalid),_(3),x("htmlFor",e.getId("image-popup-label")),_(),ee(B(13,15,e.getLabel("altText"))),_(2),x("id",e.getId("image-popup-label")),_(3),x("htmlFor",e.getId("image-popup-title")),_(),ee(B(19,17,e.getLabel("title"))),_(2),x("id",e.getId("image-popup-title")),_(),x("disabled",!e.form.valid||!e.form.dirty),_(),ee(B(23,19,e.getLabel("insert")))}}var tg=(i,t)=>({backgroundColor:i,color:t}),ng=i=>({"NgxEditor__Color--Active":i});function ig(i,t){if(i&1){let e=H();f(0,"button",7),E("mousedown",function(o){let r=R(e).$implicit,s=v(3);return A(s.onColorSelectMouseClick(o,r))})("keydown.enter",function(){let o=R(e).$implicit,r=v(3);return A(r.onColorSelectKeydown(o))})("keydown.space",function(){let o=R(e).$implicit,r=v(3);return A(r.onColorSelectKeydown(o))}),p()}if(i&2){let e=t.$implicit,n=v(3);x("ngStyle",eo(3,tg,e,n.getContrastYIQ(e)))("title",e)("ngClass",Jt(6,ng,n.activeColors.includes(e)))}}function og(i,t){if(i&1&&(f(0,"div",5),M(1,ig,1,8,"button",6),p()),i&2){let e=t.$implicit,n=v(2);_(),x("ngForOf",e)("ngForTrackBy",n.trackByIndex)}}function rg(i,t){if(i&1){let e=H();f(0,"div",2),M(1,og,2,2,"div",3),f(2,"button",4),E("mousedown",function(o){R(e);let r=v();return A(r.onRemoveMouseClick(o))})("keydown.enter",function(){R(e);let o=v();return A(o.onRemoveKeydown())})("keydown.space",function(){R(e);let o=v();return A(o.onRemoveKeydown())}),y(3),D(4,"async"),p()()}if(i&2){let e=v();_(),x("ngForOf",e.presets)("ngForTrackBy",e.trackByIndex),_(),x("disabled",!e.isActive),_(),F(" ",B(4,4,e.getLabel("remove"))," ")}}var sg=(i,t)=>({"NgxEditor--Disabled":i,"NgxEditor__MenuBar--Reverse":t});function lg(i,t){if(i&1&&S(0,"ngx-toggle-command",7),i&2){let e=v().$implicit,n=v(2);je(n.iconContainerClass),x("toolbarItem",e)}}function ag(i,t){if(i&1&&S(0,"ngx-insert-command",7),i&2){let e=v().$implicit,n=v(2);je(n.iconContainerClass),x("toolbarItem",e)}}function cg(i,t){if(i&1&&(G(0),S(1,"ngx-link",8),K()),i&2){let e=v().$implicit,n=v(2);_(),je(n.iconContainerClass),x("options",n.getLinkOptions(e))}}function dg(i,t){if(i&1&&S(0,"ngx-image"),i&2){let e=v(3);je(e.iconContainerClass)}}function ug(i,t){if(i&1&&S(0,"ngx-dropdown",10),i&2){let e=t.$implicit,n=v(4);je(n.dropdownContainerClass),x("group",e.key)("items",e.value)}}function pg(i,t){if(i&1&&(G(0),M(1,ug,1,4,"ngx-dropdown",9),D(2,"keyvalue"),K()),i&2){let e=v().$implicit,n=v(2);_(),x("ngForOf",B(2,2,n.getDropdownItems(e)))("ngForTrackBy",n.trackByIndex)}}function fg(i,t){if(i&1&&S(0,"ngx-color-picker",11),i&2){let e=v(3);je(e.iconContainerClass),x("presets",e.presets)}}function hg(i,t){if(i&1&&S(0,"ngx-color-picker",12),i&2){let e=v(3);je(e.iconContainerClass),x("presets",e.presets)}}function mg(i,t){if(i&1&&S(0,"div"),i&2){let e=v(3);je(e.seperatorClass)}}function gg(i,t){if(i&1&&(G(0),M(1,lg,1,3,"ngx-toggle-command",3)(2,ag,1,3,"ngx-insert-command",3)(3,cg,2,3,"ng-container",2)(4,dg,1,2,"ngx-image",4)(5,pg,3,4,"ng-container",2)(6,fg,1,3,"ngx-color-picker",5)(7,hg,1,3,"ngx-color-picker",6)(8,mg,1,2,"div",4),K()),i&2){let e=t.$implicit,n=t.last,o=v().last,r=v();_(),x("ngIf",r.toggleCommands.includes(e)),_(),x("ngIf",r.insertCommands.includes(e)),_(),x("ngIf",r.isLinkItem(e)),_(),x("ngIf",e==="image"),_(),x("ngIf",r.isDropDown(e)),_(),x("ngIf",e==="text_color"),_(),x("ngIf",e==="background_color"),_(),x("ngIf",n&&!o)}}function yg(i,t){if(i&1&&(G(0),M(1,gg,9,8,"ng-container",1),K()),i&2){let e=t.$implicit,n=v();_(),x("ngForOf",e)("ngForTrackBy",n.trackByIndex)}}function _g(i,t){if(i&1&&(G(0),_l(1,13),K()),i&2){let e=v();_(),x("ngTemplateOutlet",e.customMenuRef)}}var xg=(i=!0)=>new he({key:new Ne("editable"),state:{init(){return i},apply(t,e){return t.getMeta("UPDATE_EDITABLE")??e}},props:{editable(t){return this.getState(t)},attributes(t){return this.getState(t)?null:{class:"NgxEditor__Content--Disabled"}}}}),bg="NgxEditor__Placeholder",Cg=i=>new he({key:new Ne("placeholder"),state:{init(){return i??""},apply(t,e){return t.getMeta("UPDATE_PLACEHOLDER")??e}},props:{decorations(t){let{doc:e}=t,{textContent:n,childCount:o}=e,r=this.getState(t);if(!r||o>1)return _e.empty;let s=[],l=(a,c)=>{if(a.type.isBlock&&a.childCount===0&&n.length===0){let d=c,u=c+a.nodeSize,h=ut.node(d,u,{class:bg,"data-placeholder":r,"data-align":a.attrs.align??null});s.push(h)}return!1};return e.descendants(l),_e.create(e,s)}}}),vg=(i={})=>new he({key:new Ne("attributes"),props:{attributes:i}}),Sg=i=>new he({key:new Ne("focus"),props:{handleDOMEvents:{focus:()=>(i(),!1)}}}),wg=i=>new he({key:new Ne("blur"),props:{handleDOMEvents:{blur:()=>(i(),!1)}}}),Mg=(()=>{class i{src;alt="";title="";outerWidth="";selected=!1;view;imageResize=new ie;imgEl;startResizing(e,n){e.preventDefault(),this.resizeImage(e,n)}resizeImage(e,n){let o=e.pageX,r=this.imgEl.nativeElement.clientWidth,s=n==="left",{width:l}=window.getComputedStyle(this.view.dom),a=parseInt(l,10),c=u=>{let g=u.pageX-o,m=s?r-g:r+g;m>a||m<20||(this.outerWidth=`${m}px`)},d=u=>{u.preventDefault(),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",d),this.imageResize.emit()};document.addEventListener("mousemove",c),document.addEventListener("mouseup",d)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["ngx-image-view"]],viewQuery:function(n,o){if(n&1&&Ue(Vm,7),n&2){let r;We(r=Ge())&&(o.imgEl=r.first)}},inputs:{src:"src",alt:"alt",title:"title",outerWidth:"outerWidth",selected:"selected",view:"view"},outputs:{imageResize:"imageResize"},decls:4,vars:9,consts:[["imgEl",""],[1,"NgxEditor__ImageWrapper",3,"ngClass"],["class","NgxEditor__ResizeHandle",4,"ngIf"],[3,"src","alt","title"],[1,"NgxEditor__ResizeHandle"],[1,"NgxEditor__ResizeHandle--TL",3,"mousedown"],[1,"NgxEditor__ResizeHandle--TR",3,"mousedown"],[1,"NgxEditor__ResizeHandle--BL",3,"mousedown"],[1,"NgxEditor__ResizeHandle--BR",3,"mousedown"]],template:function(n,o){n&1&&(f(0,"span",1),M(1,$m,5,0,"span",2),S(2,"img",3,0),p()),n&2&&(wn("width",o.outerWidth),x("ngClass",Jt(7,Hm,o.selected)),_(),x("ngIf",o.selected),_(),x("src",o.src,gl)("alt",o.alt)("title",o.title))},dependencies:[gi,Y],styles:["*[_ngcontent-%COMP%], *[_ngcontent-%COMP%]:before, *[_ngcontent-%COMP%]:after{box-sizing:border-box}img[_ngcontent-%COMP%]{width:100%;height:100%}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]{position:relative;display:inline-block;line-height:0;padding:2px}.NgxEditor__ImageWrapper.NgxEditor__Resizer--Active[_ngcontent-%COMP%]{padding:1px;border:1px solid #1a73e8}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TL[_ngcontent-%COMP%], .NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BL[_ngcontent-%COMP%], .NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TR[_ngcontent-%COMP%], .NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BR[_ngcontent-%COMP%]{position:absolute;width:7px;height:7px;background-color:#1a73e8;border:1px solid white}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BR[_ngcontent-%COMP%]{bottom:-5px;right:-5px;cursor:se-resize}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TR[_ngcontent-%COMP%]{top:-5px;right:-5px;cursor:ne-resize}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TL[_ngcontent-%COMP%]{top:-5px;left:-5px;cursor:nw-resize}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BL[_ngcontent-%COMP%]{bottom:-5px;left:-5px;cursor:sw-resize}"]})}return i})(),Js=class{dom;view;getPos;applicationRef;imageComponentRef;resizeSubscription;node;updating=!1;constructor(t,e,n,o){this.applicationRef=o.get(wl),this.imageComponentRef=Ml(Mg,{environmentInjector:this.applicationRef.injector}),this.applicationRef.attachView(this.imageComponentRef.hostView),this.setNodeAttributes(t.attrs),this.imageComponentRef.instance.view=e,this.dom=this.imageComponentRef.location.nativeElement,this.view=e,this.node=t,this.getPos=n,this.resizeSubscription=this.imageComponentRef.instance.imageResize.subscribe(()=>{this.handleResize()})}computeChanges(t,e){return JSON.stringify(t)===JSON.stringify(e)}setNodeAttributes(t){this.imageComponentRef.instance.src=t.src,this.imageComponentRef.instance.alt=t.alt,this.imageComponentRef.instance.title=t.title,this.imageComponentRef.instance.outerWidth=t.width}handleResize=()=>{if(this.updating)return;let{state:t,dispatch:e}=this.view,{tr:n}=t,o=n.setNodeMarkup(this.getPos(),void 0,ae(V({},this.node.attrs),{width:this.imageComponentRef.instance.outerWidth})),r=o.doc.resolve(this.getPos()),s=new N(r);o.setSelection(s),e(o)};update(t){return t.type!==this.node.type?!1:(this.node=t,this.computeChanges(this.node.attrs,t.attrs)&&(this.updating=!0,this.setNodeAttributes(t.attrs),this.updating=!1),!0)}ignoreMutation(){return!0}selectNode(){this.imageComponentRef.instance.selected=!0}deselectNode(){this.imageComponentRef.instance.selected=!1}destroy(){this.resizeSubscription.unsubscribe(),this.applicationRef.detachView(this.imageComponentRef.hostView)}},Ig=i=>new he({key:new Ne("image-resize"),props:{nodeViews:{image:(t,e,n)=>new Js(t,e,n,i)}}}),Eg=/(?:https?:\/\/)?[\w-]+(?:\.[\w-]+)+\.?(?:\d+)?(?:\/\S*)?$/,vu=i=>{let t=[];return i.forEach(e=>{if(e.isText){let n=e.text,o=0,r=Eg.exec(n);if(r){let s=r.index,l=s+r[0].length,{link:a}=e.type.schema.marks;s>0&&t.push(e.cut(o,s));let c=n.slice(s,l);t.push(e.cut(s,l).mark(a.create({href:c}).addToSet(e.marks))),o=l}o<n.length&&t.push(e.cut(o))}else t.push(e.copy(vu(e.content)))}),w.fromArray(t)},kg=()=>new he({key:new Ne("linkify"),props:{transformPasted:i=>new I(vu(i.content),i.openStart,i.openEnd)}}),Su=i=>typeof i=="string",Tg=()=>window.trustedTypes,wu=i=>Tg()?.isHTML(i)??!1,Mu=i=>Su(i)||wu(i),Iu={type:"doc",content:[{type:"paragraph"}]},Og=(i,t)=>{let e=t??Bi,n=e.nodeFromJSON(i),o=_t.fromSchema(e).serializeFragment(n.content),r=document.createElement("div");return r.appendChild(o),r.innerHTML},Dg=(i,t,e)=>{let n=t??Bi,o=document.createElement("div");return o.innerHTML=i,Ft.fromSchema(n).parse(o,e).toJSON()},fu=(i,t,e)=>{if(!i)return t.nodeFromJSON(Iu);if(!Mu(i))return t.nodeFromJSON(i);let n=Dg(i,t,e);return t.nodeFromJSON(n)},Eu=(()=>{class i{renderer;injector;elementRef;constructor(e,n,o){this.renderer=e,this.injector=n,this.elementRef=o}ngxEditor;editor;outputFormat;placeholder="Type Here...";focusOut=new ie;focusIn=new ie;unsubscribe=new He;onChange=()=>{};onTouched=()=>{};writeValue(e){!this.outputFormat&&Mu(e)&&(this.outputFormat="html"),this.editor.setContent(e??Iu)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.setMeta("UPDATE_EDITABLE",!e),this.renderer.setProperty(this.elementRef.nativeElement,"disabled",e)}handleChange(e){if(this.outputFormat==="html"){let n=Og(e,this.editor.schema);this.onChange(n);return}this.onChange(e)}setMeta(e,n){let{dispatch:o,state:{tr:r}}=this.editor.view;o(r.setMeta(e,n))}setPlaceholder(e){this.setMeta("UPDATE_PLACEHOLDER",e)}registerPlugins(){this.editor.registerPlugin(xg()),this.editor.registerPlugin(Cg(this.placeholder)),this.editor.registerPlugin(vg({class:"NgxEditor__Content"})),this.editor.registerPlugin(Sg(()=>{this.focusIn.emit()})),this.editor.registerPlugin(wg(()=>{this.focusOut.emit(),this.onTouched()})),this.editor.features.resizeImage&&this.editor.registerPlugin(Ig(this.injector)),this.editor.features.linkOnPaste&&this.editor.registerPlugin(kg())}ngOnInit(){if(!this.editor)throw new Wn("Required editor instance for initializing editor component");this.registerPlugins(),this.renderer.appendChild(this.ngxEditor.nativeElement,this.editor.view.dom),this.editor.valueChanges.pipe(Ui(this.unsubscribe)).subscribe(e=>{this.handleChange(e)})}ngOnChanges(e){e.placeholder&&!e.placeholder.isFirstChange()&&this.setPlaceholder(e.placeholder.currentValue)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}static \u0275fac=function(n){return new(n||i)(P(yl),P(Sr),P(Kt))};static \u0275cmp=O({type:i,selectors:[["ngx-editor"]],viewQuery:function(n,o){if(n&1&&Ue(jm,7),n&2){let r;We(r=Ge())&&(o.ngxEditor=r.first)}},inputs:{editor:"editor",outputFormat:"outputFormat",placeholder:"placeholder"},outputs:{focusOut:"focusOut",focusIn:"focusIn"},features:[hi([{provide:oo,useExisting:pl(()=>i),multi:!0}]),Et],ngContentSelectors:Um,decls:3,vars:0,consts:[["ngxEditor",""],[1,"NgxEditor"]],template:function(n,o){n&1&&(Mr(),f(0,"div",1,0),Ir(2),p())},styles:[`:root{--ngx-editor-border-radius: 4px;--ngx-editor-background-color: #fff;--ngx-editor-text-color: #000;--ngx-editor-placeholder-color: #6c757d;--ngx-editor-border-color: rgba(0, 0, 0, .2);--ngx-editor-wrapper-border-color: rgba(0, 0, 0, .2);--ngx-editor-menubar-bg-color: #fff;--ngx-editor-menubar-padding: 3px;--ngx-editor-menubar-height: 30px;--ngx-editor-blockquote-color: #ddd;--ngx-editor-blockquote-border-width: 3px;--ngx-editor-icon-size: 30px;--ngx-editor-popup-bg-color: #fff;--ngx-editor-popup-border-radius: 4px;--ngx-editor-popup-shadow: rgba(60, 64, 67, .15) 0px 2px 6px 2px;--ngx-editor-menu-item-border-radius: 2px;--ngx-editor-menu-item-active-color: #1a73e8;--ngx-editor-menu-item-hover-bg-color: #f1f1f1;--ngx-editor-menu-item-active-bg-color: #e8f0fe;--ngx-editor-seperator-color: #ccc;--ngx-editor-bubble-bg-color: #000;--ngx-editor-bubble-text-color: #fff;--ngx-editor-bubble-item-hover-color: #636262;--ngx-editor-bubble-seperator-color: #fff;--ngx-editor-focus-ring-color: #5e9ed6;--ngx-editor-error-color: red;--ngx-editor-click-pointer: default}.NgxEditor{background:var(--ngx-editor-background-color);color:var(--ngx-editor-text-color);background-clip:padding-box;border-radius:var(--ngx-editor-border-radius);border:1px solid var(--ngx-editor-border-color);position:relative}.NgxEditor--Disabled{opacity:.5!important;pointer-events:none!important}.NgxEditor__Placeholder:before{color:var(--ngx-editor-placeholder-color);opacity:1;-webkit-user-select:none;user-select:none;position:absolute;cursor:text;content:attr(data-placeholder)}.NgxEditor__Placeholder[data-align=right]:before{position:relative}.NgxEditor__Content{padding:8px;white-space:pre-wrap;outline:none;font-variant-ligatures:none;font-feature-settings:"liga" 0}.NgxEditor__Content p{margin:0 0 10px}.NgxEditor__Content blockquote{padding-left:16px;border-left:var(--ngx-editor-blockquote-border-width) solid var(--ngx-editor-blockquote-color);margin-left:0;margin-right:0}.NgxEditor__Content--Disabled{-webkit-user-select:none;user-select:none;pointer-events:none}.NgxEditor__Wrapper{border:1px solid var(--ngx-editor-wrapper-border-color);border-radius:var(--ngx-editor-border-radius)}.NgxEditor__Wrapper .NgxEditor__MenuBar{border-top-left-radius:var(--ngx-editor-border-radius);border-top-right-radius:var(--ngx-editor-border-radius);border-bottom:1px solid var(--ngx-editor-border-color)}.NgxEditor__Wrapper .NgxEditor{border-top-left-radius:0;border-top-right-radius:0;border:none}.NgxEditor__MenuBar{display:flex;flex-wrap:wrap;padding:var(--ngx-editor-menubar-padding);background-color:var(--ngx-editor-menubar-bg-color);gap:.25rem .1rem}.NgxEditor__MenuBar button:not(:disabled),.NgxEditor__MenuBar [role=button]:not(:disabled){cursor:var(--ngx-editor-click-pointer, default)}.NgxEditor__MenuItem{display:flex;align-items:center;justify-content:center;position:relative;flex-shrink:0}.NgxEditor__MenuItem.NgxEditor__MenuItem--IconContainer{display:flex;align-items:center;justify-content:center}.NgxEditor__MenuItem .NgxEditor__MenuItem--Icon{all:unset;appearance:none;height:var(--ngx-editor-icon-size);width:var(--ngx-editor-icon-size);transition:.2s ease-in-out;display:inline-flex;align-items:center;justify-content:center;border-radius:var(--ngx-editor-menu-item-border-radius)}.NgxEditor__MenuItem .NgxEditor__MenuItem--Icon+.NgxEditor__MenuItem--Icon{margin-left:2px}.NgxEditor__MenuItem .NgxEditor__MenuItem--Icon:focus-visible{outline:1px solid var(--ngx-editor-focus-ring-color)}.NgxEditor__MenuItem .NgxEditor__MenuItem--Icon:hover{background-color:var(--ngx-editor-menu-item-hover-bg-color)}.NgxEditor__MenuItem.NgxEditor__MenuItem--Text{padding:0 5px}.NgxEditor__MenuItem.NgxEditor__MenuItem--Active,.NgxEditor__MenuItem .NgxEditor__MenuItem--Active{background-color:var(--ngx-editor-menu-item-active-bg-color);color:var(--ngx-editor-menu-item-active-color)}.NgxEditor__Dropdown{min-width:64px;position:relative;display:flex;align-items:center;flex-shrink:0}.NgxEditor__Dropdown:hover{background-color:var(--ngx-editor-menu-item-hover-bg-color)}.NgxEditor__Dropdown .NgxEditor__Dropdown--Text{all:unset;appearance:none;display:flex;align-items:center;justify-content:center;padding:0 5px;height:100%;width:100%}.NgxEditor__Dropdown .NgxEditor__Dropdown--Text:focus-visible{outline:1px solid var(--ngx-editor-focus-ring-color)}.NgxEditor__Dropdown .NgxEditor__Dropdown--Text:after{display:inline-block;content:"";margin-left:24px;vertical-align:4px;border-top:4px solid;border-right:4px solid transparent;border-bottom:0;border-left:4px solid transparent}.NgxEditor__Dropdown .NgxEditor__Dropdown--DropdownMenu{position:absolute;left:0;box-shadow:var(--ngx-editor-popup-shadow);border-radius:var(--ngx-editor-popup-border-radius);background-color:var(--ngx-editor-popup-bg-color);z-index:10;width:100%;top:calc(var(--ngx-editor-menubar-height) + 2px);display:flex;flex-direction:column}.NgxEditor__Dropdown .NgxEditor__Dropdown--Item{all:unset;appearance:none;padding:8px;white-space:nowrap;color:inherit}.NgxEditor__Dropdown .NgxEditor__Dropdown--Item:focus-visible{outline:1px solid var(--ngx-editor-focus-ring-color)}.NgxEditor__Dropdown .NgxEditor__Dropdown--Item:hover{background-color:var(--ngx-editor-menu-item-hover-bg-color)}.NgxEditor__Dropdown .NgxEditor__Dropdown--Selected,.NgxEditor__Dropdown .NgxEditor__Dropdown--Open{color:var(--ngx-editor-menu-item-active-color);background-color:var(--ngx-editor-menu-item-active-bg-color)}.NgxEditor__Dropdown .NgxEditor__Dropdown--Active{background-color:var(--ngx-editor-menu-item-active-bg-color)}.NgxEditor__Dropdown .NgxEditor__Dropdown--Active:hover{background-color:var(--ngx-editor-menu-item-hover-bg-color)}.NgxEditor__MenuBar--Reverse .NgxEditor__Dropdown--DropdownMenu{top:unset;bottom:calc(var(--ngx-editor-menubar-height) + 2px)}.NgxEditor__MenuBar--Reverse .NgxEditor__Dropdown--Text:after{transform:rotate(180deg)}.NgxEditor__MenuBar--Reverse .NgxEditor__Popup{top:unset;bottom:calc(var(--ngx-editor-menubar-height) + 2px)}.NgxEditor__Popup{position:absolute;top:calc(var(--ngx-editor-menubar-height) + 2px);box-shadow:var(--ngx-editor-popup-shadow);border-radius:var(--ngx-editor-popup-border-radius);background-color:var(--ngx-editor-popup-bg-color);z-index:10;min-width:192px;padding:8px}.NgxEditor__Popup .NgxEditor__Popup--FormGroup{margin-bottom:8px}.NgxEditor__Popup .NgxEditor__Popup--FormGroup label{margin-bottom:3px}.NgxEditor__Popup .NgxEditor__Popup--FormGroup input[type=text],.NgxEditor__Popup .NgxEditor__Popup--FormGroup input[type=url]{padding:2px 4px}.NgxEditor__Popup .NgxEditor__Popup--Col{display:flex;flex-direction:column;position:relative}.NgxEditor__Popup .NgxEditor__Popup--Label{font-size:85%}.NgxEditor__Seperator{border-left:1px solid var(--ngx-editor-seperator-color);margin:0 5px}.NgxEditor__HelpText{font-size:80%}.NgxEditor__HelpText.NgxEditor__HelpText--Error{color:var(--ngx-editor-error-color)}
`],encapsulation:2})}return i})(),jt=(()=>{class i{editor;customMenuRefChange=new He;setCustomMenuRef(e){this.customMenuRefChange.next(e)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ht=class{name;constructor(t){this.name=t}apply(){return(t,e)=>{let{schema:n}=t,o=n.marks[this.name];return o?js(o)(t,e):!1}}toggle(){return(t,e)=>{let{schema:n}=t,o=n.marks[this.name];return o?mn(o)(t,e):!1}}isActive(t){let{schema:e}=t,n=e.marks[this.name];return n?nr(t,n):!1}canExecute(t){return this.toggle()(t)}},Ys=class{toggle(){return(t,e)=>{let{schema:n}=t,o=n.nodes.blockquote;return o?this.isActive(t)?Gd(t,e):Yd(o)(t,e):!1}}isActive(t){let{schema:e}=t,n=e.nodes.blockquote;return n?qs(t,n):!1}canExecute(t){return this.toggle()(t)}},Qs=class{insert(){return(t,e)=>{let{schema:n,tr:o}=t,r=n.nodes.horizontal_rule;return r?(e(o.replaceSelectionWith(r.create()).scrollIntoView()),!0):!1}}canExecute(t){return ru(t,t.schema.nodes.horizontal_rule)}},ci=class{isBulletList=!1;constructor(t=!1){this.isBulletList=t}getType(t){return this.isBulletList?t.nodes.bullet_list:t.nodes.ordered_list}toggle(){return(t,e)=>{let{schema:n}=t,o=this.getType(n);return o?this.isActive(t)?Os(n.nodes.list_item)(t,e):Vd(o)(t,e):!1}}isActive(t){let{schema:e}=t,n=this.getType(e);return n?qs(t,n):!1}canExecute(t){return this.toggle()(t)}},It=class{level;constructor(t){this.level=t}apply(){return(t,e)=>{let{schema:n}=t,o=n.nodes.heading;return o?er(o)(t,e):!1}}toggle(){return(t,e)=>{let{schema:n,selection:o,doc:r}=t,s=n.nodes.heading;if(!s)return!1;let l=o.$from.before(1),c=r.nodeAt(l)?.attrs??{};return this.isActive(t)?er(n.nodes.paragraph,c)(t,e):er(s,ae(V({},c),{level:this.level}))(t,e)}}isActive(t){let{schema:e}=t,n=Vs(t),o=e.nodes.heading;if(!o)return!1;let r=[o,e.nodes.text,e.nodes.blockquote];return!!n.filter(a=>r.includes(a.type)).find(a=>a.attrs.level===this.level)}canExecute(t){return this.toggle()(t)}},_n=class{align;constructor(t){this.align=t}toggle(){return(t,e)=>{let{doc:n,selection:o,tr:r,schema:s}=t,{from:l,to:a}=o,c=!1;return n.nodesBetween(l,a,(d,u)=>{let h=d.type;if([s.nodes.paragraph,s.nodes.heading].includes(h)){c=!0;let g=d.attrs.align===this.align?null:this.align;r.setNodeMarkup(u,h,ae(V({},d.attrs),{align:g}))}return!0}),c?(r.docChanged&&e?.(r),!0):!1}}isActive(t){return!!Vs(t).find(o=>o.attrs.align===this.align)}canExecute(t){return this.toggle()(t)}},Ng={strict:!0},Xs=class{update(t){return(e,n)=>{let{schema:o,selection:r}=e,s=o.marks.link;return!s||r.empty?!1:mn(s,t)(e,n)}}insert(t,e){return(n,o)=>{let{schema:r,tr:s}=n;if(!r.marks.link)return!1;let a={href:e.href,title:e.title??t,target:e.target??"_blank"},c=r.text(t,[r.marks.link.create(a)]);return s.replaceSelectionWith(c,!1).scrollIntoView(),s.docChanged?(o?.(s),!0):!1}}isActive(t,e=Ng){if(e.strict)return!0;let{schema:n}=t,o=n.marks.link;return o?nr(t,o):!1}remove(t,e){return su()(t,e)}canExecute(t){let e={href:""};return this.insert("Exec",e)(t)||this.update(e)(t)}},ku=class{insert(t,e){return(n,o)=>{let{schema:r,tr:s,selection:l}=n,a=r.nodes.image;if(!a)return!1;let c=V({width:null,src:t},e);!c.width&&l instanceof N&&l.node.type===a&&(c.width=l.node.attrs.width),s.replaceSelectionWith(a.createAndFill(c));let d=s.doc.resolve(s.selection.anchor-s.selection.$anchor.nodeBefore.nodeSize);return s.setSelection(new N(d)).scrollIntoView(),s.docChanged?(o?.(s),!0):!1}}isActive(t){let{selection:e}=t;return e instanceof N?e.node.type.name==="image":!1}},ai=class{name;attrName;constructor(t,e="color"){this.name=t,this.attrName=e}apply(t){return(e,n)=>{let{schema:o,selection:r,doc:s}=e,l=o.marks[this.name];if(!l)return!1;let{from:a,to:c,empty:d}=r;if(!d&&a+1===c){let u=s.nodeAt(a);if(u?.isAtom&&!u.isText&&u.isLeaf)return!1}return js(l,t)(e,n)}}isActive(t){let{schema:e}=t,n=e.marks[this.name];return n?nr(t,n):!1}getActiveColors(t){if(!this.isActive(t))return[];let{schema:e}=t;return ou(t).filter(r=>r.type===e.marks[this.name]).map(r=>r.attrs[this.attrName]).filter(Boolean)}remove(){return(t,e)=>{let{schema:n}=t,o=n.marks[this.name];return o?lu(o)(t,e):!1}}canExecute(t){let e=this.name==="text_color"?{color:""}:{backgroundColor:""};return this.apply(e)(t)}},Rg=["link"],Zs=class{insert(){return(t,e)=>{let{tr:n}=t,{ranges:o,empty:r}=n.selection;return r||(Object.entries(t.schema.marks).forEach(([s,l])=>{Rg.includes(s)||o.forEach(a=>{n.removeMark(a.$from.pos,a.$to.pos,l)})}),e(n)),!0}}canExecute(){return!0}},Ag=["paragraph","heading","blockquote"],hu=0,mu=10,Pg=(i,t,e)=>{let n=i.doc.nodeAt(t);if(!n)return!1;let o=n.attrs.indent??0,r=Pa(o+(e==="increase"?1:-1),hu,mu);if(r===o||r<hu||r>mu)return!1;let s=ae(V({},n.attrs),{indent:r});return i.setNodeMarkup(t,n.type,s),!0},di=class{method="increase";constructor(t){this.method=t}insert(){return(t,e)=>{let{tr:n,doc:o}=t,{from:r,to:s}=n.selection,l=!1;return o.nodesBetween(r,s,(a,c)=>{let d=a.type;return Ag.includes(d.name)?(l=Pg(n,c,this.method),!1):!a.type.name.includes("list")}),l?(n.docChanged&&e?.(n),!0):!1}}canExecute(t){return this.insert()(t)}},dr=class{mode="undo";constructor(t){this.mode=t}insert(){return(t,e)=>this.mode==="undo"?sr(t,e):zi(t,e)}canExecute(t){return this.insert()(t)}},Fg=new ht("strong"),Lg=new ht("em"),Bg=new ht("code"),zg=new ht("u"),qg=new ht("s"),Vg=new Ys,Hg=new Qs,$g=new Zs,jg=new ci(!0),Ug=new ci(!1),Wg=new It(1),Gg=new It(2),Kg=new It(3),Jg=new It(4),Yg=new It(5),Qg=new It(6),Xg=new _n("left"),Zg=new _n("center"),e0=new _n("right"),t0=new _n("justify"),n0=new Xs,i0=new ku,o0=new ai("text_color","color"),r0=new ai("text_background_color","backgroundColor"),s0=new di("increase"),l0=new di("decrease"),a0=new ht("sup"),c0=new ht("sub"),d0=new dr("undo"),u0=new dr("redo"),ur={bold:Fg,italic:Lg,code:Bg,underline:zg,strike:qg,blockquote:Vg,bullet_list:jg,ordered_list:Ug,h1:Wg,h2:Gg,h3:Kg,h4:Jg,h5:Yg,h6:Qg,align_left:Xg,align_center:Zg,align_right:e0,align_justify:t0,superscript:a0,subscript:c0},gu={horizontal_rule:Hg,format_clear:$g,indent:s0,outdent:l0,undo:d0,redo:u0},Vi=n0,yu=i0,p0=o0,f0=r0,el={bold:"Bold",italic:"Italic",code:"Code",underline:"Underline",strike:"Strike",blockquote:"Blockquote",bullet_list:"Bullet List",ordered_list:"Ordered List",heading:"Heading",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6",align_left:"Left Align",align_center:"Center Align",align_right:"Right Align",align_justify:"Justify",text_color:"Text Color",background_color:"Background Color",horizontal_rule:"Horizontal rule",format_clear:"Clear Formatting",insertLink:"Insert Link",removeLink:"Remove Link",insertImage:"Insert Image",indent:"Increase Indent",outdent:"Decrease Indent",superscript:"Superscript",subscript:"Subscript",undo:"Undo",redo:"Redo",url:"URL",text:"Text",openInNewTab:"Open in new tab",insert:"Insert",altText:"Alt Text",title:"Title",remove:"Remove",enterValidUrl:"Please enter a valid URL"},tl=class{locals=el;constructor(t={}){this.locals=V(V({},el),t)}get=t=>{let e=this.locals[t];return e?cl(e)?e:$e(e):$e("")}},h0=`
  <path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z" />
`,m0=`
  <path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z" />
`,g0=`
<path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
`,y0=`
<path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>
`,_0=`
<path d="M6.85,7.08C6.85,4.37,9.45,3,12.24,3c1.64,0,3,0.49,3.9,1.28c0.77,0.65,1.46,1.73,1.46,3.24h-3.01 c0-0.31-0.05-0.59-0.15-0.85c-0.29-0.86-1.2-1.28-2.25-1.28c-1.86,0-2.34,1.02-2.34,1.7c0,0.48,0.25,0.88,0.74,1.21 C10.97,8.55,11.36,8.78,12,9H7.39C7.18,8.66,6.85,8.11,6.85,7.08z M21,12v-2H3v2h9.62c1.15,0.45,1.96,0.75,1.96,1.97 c0,1-0.81,1.67-2.28,1.67c-1.54,0-2.93-0.54-2.93-2.51H6.4c0,0.55,0.08,1.13,0.24,1.58c0.81,2.29,3.29,3.3,5.67,3.3 c2.27,0,5.3-0.89,5.3-4.05c0-0.3-0.01-1.16-0.48-1.94H21V12z"/>
`,x0=`
<path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/>
`,b0=`
<path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
`,C0=`
<path d="M0 0h24v24H0z" fill="none"/><path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/>
`,v0=`
<path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
`,S0=`
<path d="M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.98l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zm-1 4h-2.19l2 2H16zM2 4.27l3.11 3.11C3.29 8.12 2 9.91 2 12c0 2.76 2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1 0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4L20 19.74 3.27 3 2 4.27z"/>
`,w0=`
<path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
`,M0=`
<path d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"/>
`,I0=`
<path d="M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z"/>
`,E0=`
<path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/>
`,k0=`
<path d="M3 21h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18V7H3v2zm0-6v2h18V3H3z"/>
`,T0=`
<path d="M2,20h20v4H2V20z M5.49,17h2.42l1.27-3.58h5.65L16.09,17h2.42L13.25,3h-2.5L5.49,17z M9.91,11.39l2.03-5.79h0.12l2.03,5.79 H9.91z"/>
`,O0=`
<path d="M16.56,8.94L7.62,0L6.21,1.41l2.38,2.38L3.44,8.94c-0.59,0.59-0.59,1.54,0,2.12l5.5,5.5C9.23,16.85,9.62,17,10,17 s0.77-0.15,1.06-0.44l5.5-5.5C17.15,10.48,17.15,9.53,16.56,8.94z M5.21,10L10,5.21L14.79,10H5.21z M19,11.5c0,0-2,2.17-2,3.5 c0,1.1,0.9,2,2,2s2-0.9,2-2C21,13.67,19,11.5,19,11.5z M2,20h20v4H2V20z"/>
`,D0=`
  <g>
    <rect fill="none" fill-rule="evenodd" height="24" width="24"/>
    <rect fill-rule="evenodd" height="2" width="16" x="4" y="11"/>
  </g>
`,N0=`
<path d="M0 0h24v24H0z" fill="none"/><path d="M3.27 5L2 6.27l6.97 6.97L6.5 19h3l1.57-3.66L16.73 21 18 19.73 3.55 5.27 3.27 5zM6 5v.18L8.82 8h2.4l-.72 1.68 2.1 2.1L14.21 8H20V5H6z"/>
`,R0='<path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 21h18v-2H3v2zM3 8v8l4-4-4-4zm8 9h10v-2H11v2zM3 3v2h18V3H3zm8 6h10V7H11v2zm0 4h10v-2H11v2z"/>',A0='<path d="M0 0h24v24H0V0z" fill="none"/><path d="M11 17h10v-2H11v2zm-8-5l4 4V8l-4 4zm0 9h18v-2H3v2zM3 3v2h18V3H3zm8 6h10V7H11v2zm0 4h10v-2H11v2z"/>',P0='<g><rect fill="none" height="20" width="20"/><path d="M17,6l-1,0v1h2v1l-3,0V6c0-0.55,0.45-1,1-1l1,0l0-1h-2V3l2,0c0.55,0,1,0.45,1,1v1C18,5.55,17.55,6,17,6z M5.63,16h1.9 l2.43-3.87h0.08L12.47,16h1.9l-3.32-5.2l3.1-4.8h-1.91l-2.19,3.56H9.96L7.75,6h-1.9l3.09,4.8L5.63,16z"/></g>',F0='<g><rect fill="none" height="20" width="20"/><path d="M17,15l-1,0v1h2v1h-3v-2c0-0.55,0.45-1,1-1l1,0l0-1h-2v-1l2,0c0.55,0,1,0.45,1,1v1C18,14.55,17.55,15,17,15z M5.63,14h1.9 l2.43-3.87h0.08L12.47,14h1.9l-3.32-5.2l3.1-4.8h-1.91l-2.19,3.56H9.96L7.75,4h-1.9l3.09,4.8L5.63,14z"/></g>',L0='<path d="M0 0h24v24H0V0z" fill="none"/><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/>',B0='<path d="M0 0h24v24H0V0z" fill="none"/><path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/>',z0=20,q0=20,V0="currentColor",Tu={bold:h0,italic:m0,code:g0,underline:y0,strike:_0,ordered_list:x0,bullet_list:b0,blockquote:C0,link:v0,unlink:S0,image:w0,align_left:M0,align_center:I0,align_right:E0,align_justify:k0,text_color:T0,color_fill:O0,horizontal_rule:D0,format_clear:N0,indent:R0,outdent:A0,superscript:P0,subscript:F0,undo:L0,redo:B0,path:"<path></path>"},nl=class{static get(t,e=V0){let n=Tu[t];return n&&(n.includes("<path")||n.includes("<g"))?`
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill=${e}
          height=${z0}
          width=${q0}
        >
          ${n}
        </svg>
      `:n}},il=(()=>{class i{locals={};icons={};static \u0275fac=function(n){return new(n||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),xn=(()=>{class i{config;constructor(e){this.config=e}get locals(){return new tl(this.config.locals)}getIcon(e){return this.config.icons[e]?this.config.icons[e]:nl.get(e)}static \u0275fac=function(n){return new(n||i)(Cn(il,8))};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),_u=i=>({locals:i.locals??{},icons:i.icons??{}}),ui=(()=>{class i{sanitizer;constructor(e){this.sanitizer=e}transform(e){return wu(e)?e:this.sanitizer.bypassSecurityTrustHtml(e)}static \u0275fac=function(n){return new(n||i)(P(Tl,16))};static \u0275pipe=fl({name:"sanitizeHtml",type:i,pure:!0})}return i})(),H0=(()=>{class i{ngxeService;menuService;toolbarItem;get name(){return this.toolbarItem}html;editorView;isActive=!1;disabled=!1;updateSubscription;constructor(e,n){this.ngxeService=e,this.menuService=n}toggle(){let{state:e,dispatch:n}=this.editorView;ur[this.name].toggle()(e,n)}onMouseClick(e){e.preventDefault(),e.button===0&&this.toggle()}onKeydown(){this.toggle()}update=e=>{let{state:n}=e,o=ur[this.name];this.isActive=o.isActive(n),this.disabled=!o.canExecute(n)};getTitle(e){return this.ngxeService.locals.get(e)}ngOnInit(){this.html=this.ngxeService.getIcon(this.name),this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}static \u0275fac=function(n){return new(n||i)(P(xn),P(jt))};static \u0275cmp=O({type:i,selectors:[["ngx-toggle-command"]],inputs:{toolbarItem:"toolbarItem"},decls:4,vars:14,consts:[["type","button",1,"NgxEditor__MenuItem--Icon",3,"mousedown","keydown.enter","keydown.space","disabled","innerHTML","title","ariaLabel"]],template:function(n,o){n&1&&(f(0,"button",0),D(1,"sanitizeHtml"),D(2,"async"),D(3,"async"),E("mousedown",function(s){return o.onMouseClick(s)})("keydown.enter",function(){return o.onKeydown()})("keydown.space",function(){return o.onKeydown()}),p()),n&2&&(kt("NgxEditor__MenuItem--Active",o.isActive)("NgxEditor--Disabled",o.disabled),x("disabled",o.disabled)("innerHTML",B(1,8,o.html),Sn)("title",B(2,10,o.getTitle(o.name)))("ariaLabel",B(3,12,o.getTitle(o.name))))},dependencies:[yt,ui]})}return i})(),$0=(()=>{class i{ngxeService;menuService;toolbarItem;get name(){return this.toolbarItem}html;editorView;disabled=!1;updateSubscription;constructor(e,n){this.ngxeService=e,this.menuService=n}onMouseClick(e){e.preventDefault(),e.button===0&&this.insert()}onKeydown(){this.insert()}insert(){let{state:e,dispatch:n}=this.editorView;gu[this.name].insert()(e,n)}update=e=>{let{state:n}=e,o=gu[this.name];this.disabled=!o.canExecute(n)};getTitle(e){return this.ngxeService.locals.get(e)}ngOnInit(){this.html=this.ngxeService.getIcon(this.name),this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}static \u0275fac=function(n){return new(n||i)(P(xn),P(jt))};static \u0275cmp=O({type:i,selectors:[["ngx-insert-command"]],inputs:{toolbarItem:"toolbarItem"},decls:4,vars:12,consts:[[1,"NgxEditor__MenuItem--Icon",3,"mousedown","keydown.enter","keydown.space","disabled","innerHTML","title","ariaLabel"]],template:function(n,o){n&1&&(f(0,"button",0),D(1,"sanitizeHtml"),D(2,"async"),D(3,"async"),E("mousedown",function(s){return o.onMouseClick(s)})("keydown.enter",function(){return o.onKeydown()})("keydown.space",function(){return o.onKeydown()}),p()),n&2&&(kt("NgxEditor--Disabled",o.disabled),x("disabled",o.disabled)("innerHTML",B(1,6,o.html),Sn)("title",B(2,8,o.getTitle(o.name)))("ariaLabel",B(3,10,o.getTitle(o.name))))},dependencies:[yt,ui]})}return i})(),xu={showOpenInNewTab:!0},j0=(()=>{class i{el;ngxeService;menuService;options=xu;showPopup=!1;isActive=!1;canExecute=!0;componentId=Dr();form;editorView;updateSubscription;constructor(e,n,o){this.el=e,this.ngxeService=n,this.menuService=o}get icon(){return this.ngxeService.getIcon(this.isActive?"unlink":"link")}get title(){return this.ngxeService.locals.get(this.isActive?"removeLink":"insertLink")}get href(){return this.form.get("href")}get text(){return this.form.get("text")}onDocumentClick(e){!this.el.nativeElement.contains(e.target)&&this.showPopup&&this.hidePopup()}getId(e){return`${e}-${this.componentId}`}getLabel(e){return this.ngxeService.locals.get(e)}hidePopup(){this.showPopup=!1,this.form.reset({href:"",text:"",openInNewTab:!0}),this.text.enable()}togglePopup(){let{state:e,dispatch:n}=this.editorView;if(this.isActive){Vi.remove(e,n);return}this.showPopup=!this.showPopup,this.showPopup&&this.setText()}onTogglePopupMouseClick(e){e.button===0&&this.togglePopup()}onTogglePopupKeydown(){this.togglePopup()}setText=()=>{let{state:{selection:e,doc:n}}=this.editorView,{empty:o,from:r,to:s}=e,l=o?"":n.textBetween(r,s);l&&(this.text.patchValue(l),this.text.disable())};update=e=>{let{state:n}=e;this.isActive=Vi.isActive(n,{strict:!1}),this.canExecute=Vi.canExecute(n)};insertLink(e){e.preventDefault();let{text:n,href:o,openInNewTab:r}=this.form.getRawValue(),{dispatch:s,state:l}=this.editorView,{selection:a}=l,c;this.options.showOpenInNewTab&&(c=r?"_blank":"_self");let d={title:o,href:o,target:c};a.empty?(Vi.insert(n,d)(l,s),this.editorView.focus()):Vi.update(d)(l,s),this.hidePopup()}ngOnInit(){this.editorView=this.menuService.editor.view,this.form=new yi({href:new Te("",[$.required,$.pattern(this.menuService.editor.linkValidationPattern)]),text:new Te("",[$.required]),openInNewTab:new Te(!0)}),this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}static \u0275fac=function(n){return new(n||i)(P(Kt),P(xn),P(jt))};static \u0275cmp=O({type:i,selectors:[["ngx-link"]],hostBindings:function(n,o){n&1&&E("mousedown",function(s){return o.onDocumentClick(s)},!1,fi)},inputs:{options:[2,"options","options",e=>V(V({},xu),e)]},features:[Yi],decls:5,vars:16,consts:[["type","button","aria-haspopup","dialog",1,"NgxEditor__MenuItem--Icon",3,"mousedown","keydown.enter","keydown.space","disabled","innerHTML","title","ariaLabel","ariaExpanded"],["class","NgxEditor__Popup",4,"ngIf"],[1,"NgxEditor__Popup"],[1,"NgxEditor__Popup--Form",3,"ngSubmit","formGroup"],[1,"NgxEditor__Popup--FormGroup"],[1,"NgxEditor__Popup--Col"],[1,"NgxEditor__Popup--Label",3,"htmlFor"],["type","url","formControlName","href","autocomplete","off",3,"id"],["class","NgxEditor__HelpText NgxEditor__HelpText--Error",4,"ngIf"],["type","text","formControlName","text","autocomplete","off",3,"id"],["class","NgxEditor__Popup--FormGroup",4,"ngIf"],["type","submit",3,"disabled"],[1,"NgxEditor__HelpText","NgxEditor__HelpText--Error"],["type","checkbox","formControlName","openInNewTab"]],template:function(n,o){n&1&&(f(0,"button",0),D(1,"sanitizeHtml"),D(2,"async"),D(3,"async"),E("mousedown",function(s){return o.onTogglePopupMouseClick(s)})("keydown.enter",function(){return o.onTogglePopupKeydown()})("keydown.space",function(){return o.onTogglePopupKeydown()}),p(),M(4,Jm,20,18,"div",1)),n&2&&(kt("NgxEditor__MenuItem--Active",o.isActive||o.showPopup)("NgxEditor--Disabled",!o.canExecute),x("disabled",!o.canExecute)("innerHTML",B(1,10,o.icon),Sn)("title",B(2,12,o.title))("ariaLabel",B(3,14,o.title))("ariaExpanded",o.showPopup),_(4),x("ngIf",o.showPopup))},dependencies:[Y,Qe,Or,Dl,Je,Ye,Xe,Ze,yt,ui]})}return i})(),U0=(()=>{class i{ngxeService;menuService;el;editorView;updateSubscription;group;items;isDropdownOpen=!1;disabledItems=[];activeItem;constructor(e,n,o){this.ngxeService=e,this.menuService=n,this.el=o}get isSelected(){return!!(this.activeItem||this.isDropdownOpen)}get isDropdownDisabled(){return this.disabledItems.length===this.items.length}onDocumentClick(e){!this.el.nativeElement.contains(e)&&this.isDropdownOpen&&(this.isDropdownOpen=!1)}getName(e){return this.ngxeService.locals.get(e)}getIsDropdownActive(e){return this.activeItem===e}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen}onToggleDropdownMouseClick(e){e.preventDefault(),e.button===0&&this.toggleDropdown()}onToggleDropdownKeydown(){this.toggleDropdown()}trackByIndex(e){return e}selectItem(e){let n=ur[e],{state:o,dispatch:r}=this.editorView;n.toggle()(o,r),this.isDropdownOpen=!1}onDropdownItemMouseClick(e,n){e.preventDefault(),e.button===0&&this.selectItem(n)}onDropdownItemKeydown(e,n){e.preventDefault(),this.selectItem(n)}update=e=>{let{state:n}=e;this.disabledItems=[];let o=[];this.items.forEach(r=>{let s=ur[r];s.isActive(n)&&o.push(r),s.canExecute(n)||this.disabledItems.push(r)}),o.length===1?[this.activeItem]=o:this.activeItem=null};ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}static \u0275fac=function(n){return new(n||i)(P(xn),P(jt),P(Kt))};static \u0275cmp=O({type:i,selectors:[["ngx-dropdown"]],hostBindings:function(n,o){n&1&&E("mousedown",function(s){return o.onDocumentClick(s.target)},!1,fi)},inputs:{group:"group",items:"items"},decls:5,vars:13,consts:[["type","button","aria-haspopup","listbox",1,"NgxEditor__Dropdown--Text",3,"mousedown","keydown.enter","keydown.space","disabled","ariaLabel","ariaExpanded"],["class","NgxEditor__Dropdown--DropdownMenu","role","listbox",4,"ngIf"],["role","listbox",1,"NgxEditor__Dropdown--DropdownMenu"],["type","button","class","NgxEditor__Dropdown--Item","role","option",3,"ngClass","ariaLabel","mousedown","keydown.enter","keydown.space",4,"ngFor","ngForOf","ngForTrackBy"],["type","button","role","option",1,"NgxEditor__Dropdown--Item",3,"mousedown","keydown.enter","keydown.space","ngClass","ariaLabel"]],template:function(n,o){n&1&&(f(0,"button",0),D(1,"async"),E("mousedown",function(s){return o.onToggleDropdownMouseClick(s)})("keydown.enter",function(){return o.onToggleDropdownKeydown()})("keydown.space",function(){return o.onToggleDropdownKeydown()}),y(2),D(3,"async"),p(),M(4,Xm,2,2,"div",1)),n&2&&(kt("NgxEditor__Dropdown--Selected",o.isSelected)("NgxEditor--Disabled",o.isDropdownDisabled),x("disabled",o.isDropdownDisabled)("ariaLabel",B(1,9,o.getName(o.activeItem||o.group)))("ariaExpanded",o.isDropdownOpen),_(2),F(" ",B(3,11,o.getName(o.activeItem||o.group)),`
`),_(2),x("ngIf",o.isDropdownOpen))},dependencies:[gi,re,Y,yt]})}return i})(),W0=(()=>{class i{el;ngxeService;menuService;showPopup=!1;isActive=!1;componentId=Dr();updateSubscription;form=new yi({src:new Te("",[$.required,$.pattern(`(https?://)?([\\da-z.-]+)\\.([a-z.]{2,6})[/\\w .-]*/??([^#
\r]*)?#?([^
\r]*)`)]),alt:new Te(""),title:new Te("")});editorView;constructor(e,n,o){this.el=e,this.ngxeService=n,this.menuService=o}get icon(){return this.ngxeService.getIcon("image")}get src(){return this.form.get("src")}onDocumentClick(e){!this.el.nativeElement.contains(e.target)&&this.showPopup&&this.hideForm()}getId(e){return`${e}-${this.componentId}`}getLabel(e){return this.ngxeService.locals.get(e)}hideForm(){this.showPopup=!1,this.form.reset({src:"",alt:"",title:""})}togglePopup(){this.showPopup=!this.showPopup,this.showPopup&&this.fillForm()}onTogglePopupMouseClick(e){e.button===0&&this.togglePopup()}onTogglePopupKeydown(){this.togglePopup()}fillForm(){let{state:e}=this.editorView,{selection:n}=e;if(n instanceof N&&this.isActive){let{src:o,alt:r="",title:s=""}=n.node.attrs;this.form.setValue({src:o,alt:r,title:s})}}update=e=>{let{state:n}=e;this.isActive=yu.isActive(n)};insertLink(e){e.preventDefault();let{src:n,alt:o,title:r}=this.form.getRawValue(),{dispatch:s,state:l}=this.editorView,a={alt:o,title:r};yu.insert(n,a)(l,s),this.editorView.focus(),this.hideForm()}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}static \u0275fac=function(n){return new(n||i)(P(Kt),P(xn),P(jt))};static \u0275cmp=O({type:i,selectors:[["ngx-image"]],hostBindings:function(n,o){n&1&&E("mousedown",function(s){return o.onDocumentClick(s)},!1,fi)},decls:5,vars:13,consts:[["type","button","aria-haspopup","dialog",1,"NgxEditor__MenuItem--Icon",3,"mousedown","keydown.enter","keydown.space","innerHTML","title","ariaLabel","ariaExpanded"],["class","NgxEditor__Popup",4,"ngIf"],[1,"NgxEditor__Popup"],[1,"NgxEditor__Popup--Form",3,"ngSubmit","formGroup"],[1,"NgxEditor__Popup--FormGroup"],[1,"NgxEditor__Popup--Col"],[1,"NgxEditor__Popup--Label",3,"htmlFor"],["type","url","formControlName","src","autocomplete","off",3,"id"],["class","NgxEditor__HelpText NgxEditor__HelpText--Error",4,"ngIf"],["type","text","formControlName","alt","autocomplete","off",3,"id"],["type","text","formControlName","title","autocomplete","off",3,"id"],["type","submit",3,"disabled"],[1,"NgxEditor__HelpText","NgxEditor__HelpText--Error"]],template:function(n,o){n&1&&(f(0,"button",0),D(1,"sanitizeHtml"),D(2,"async"),D(3,"async"),E("mousedown",function(s){return o.onTogglePopupMouseClick(s)})("keydown.enter",function(){return o.onTogglePopupKeydown()})("keydown.space",function(){return o.onTogglePopupKeydown()}),p(),M(4,eg,24,21,"div",1)),n&2&&(kt("NgxEditor__MenuItem--Active",o.isActive||o.showPopup),x("innerHTML",B(1,7,o.icon),Sn)("title",B(2,9,o.getLabel("insertImage")))("ariaLabel",B(3,11,o.getLabel("insertImage")))("ariaExpanded",o.showPopup),_(4),x("ngIf",o.showPopup))},dependencies:[Y,Qe,Or,Je,Ye,Xe,Ze,yt,ui]})}return i})(),G0=(()=>{class i{el;menuService;ngxeService;presets;type;constructor(e,n,o){this.el=e,this.menuService=n,this.ngxeService=o}get title(){return this.getLabel(this.type==="text_color"?"text_color":"background_color")}get icon(){return this.ngxeService.getIcon(this.type==="text_color"?"text_color":"color_fill")}get command(){return this.type==="text_color"?p0:f0}updateSubscription;editorView;showPopup=!1;isActive=!1;activeColors=[];canExecute=!0;getContrastYIQ(e){let n=e.replace("#",""),o=parseInt(n.substring(0,2),16),r=parseInt(n.substring(2,4),16),s=parseInt(n.substring(4,6),16);return(o*299+r*587+s*114)/1e3>=128?"black":"white"}onDocumentClick(e){!this.el.nativeElement.contains(e.target)&&this.showPopup&&this.hidePopup()}hidePopup(){this.showPopup=!1}togglePopup(){this.showPopup=!this.showPopup}onTogglePopupMouseClick(e){e.preventDefault(),e.button===0&&this.togglePopup()}onTogglePopupKeydown(){this.togglePopup()}remove(){let{state:e,dispatch:n}=this.editorView;this.command.remove()(e,n),this.hidePopup()}onRemoveMouseClick(e){e.preventDefault(),e.button===0&&(e.preventDefault(),this.remove())}onRemoveKeydown(){this.remove()}trackByIndex(e){return e}selectColor(e){let{state:n,dispatch:o}=this.editorView;if(this.type==="text_color"){let r={color:e};this.command.apply(r)(n,o)}else{let r={backgroundColor:e};this.command.apply(r)(n,o)}this.editorView.hasFocus()||this.editorView.focus(),this.hidePopup()}onColorSelectMouseClick(e,n){e.preventDefault(),e.button===0&&this.selectColor(n)}onColorSelectKeydown(e){this.selectColor(e)}update=e=>{let{state:n}=e;this.canExecute=this.command.canExecute(n),this.isActive=this.command.isActive(n),this.activeColors=[],this.isActive&&(this.activeColors=this.command.getActiveColors(n))};getLabel(e){return this.ngxeService.locals.get(e)}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}static \u0275fac=function(n){return new(n||i)(P(Kt),P(jt),P(xn))};static \u0275cmp=O({type:i,selectors:[["ngx-color-picker"]],hostBindings:function(n,o){n&1&&E("mousedown",function(s){return o.onDocumentClick(s)},!1,fi)},inputs:{presets:"presets",type:"type"},decls:5,vars:15,consts:[["type","button",1,"NgxEditor__MenuItem--Icon",3,"mousedown","keydown.enter","keydown.space","disabled","innerHTML","title","ariaLabel"],["class","NgxEditor__Popup",4,"ngIf"],[1,"NgxEditor__Popup"],["class","NgxEditor__ColorContainer",4,"ngFor","ngForOf","ngForTrackBy"],[1,"NgxEditor__MenuItem--Button",3,"mousedown","keydown.enter","keydown.space","disabled"],[1,"NgxEditor__ColorContainer"],["class","NgxEditor__Color",3,"ngStyle","title","ngClass","mousedown","keydown.enter","keydown.space",4,"ngFor","ngForOf","ngForTrackBy"],[1,"NgxEditor__Color",3,"mousedown","keydown.enter","keydown.space","ngStyle","title","ngClass"]],template:function(n,o){n&1&&(f(0,"button",0),D(1,"sanitizeHtml"),D(2,"async"),D(3,"async"),E("mousedown",function(s){return o.onTogglePopupMouseClick(s)})("keydown.enter",function(){return o.onTogglePopupKeydown()})("keydown.space",function(){return o.onTogglePopupKeydown()}),p(),M(4,rg,5,6,"div",1)),n&2&&(kt("NgxEditor__MenuItem--Active",o.isActive||o.showPopup)("NgxEditor--Disabled",!o.canExecute),x("disabled",!o.canExecute)("innerHTML",B(1,9,o.icon),Sn)("title",B(2,11,o.title))("ariaLabel",B(3,13,o.title)),_(4),x("ngIf",o.showPopup))},dependencies:[gi,re,Y,Il,yt,ui],styles:['@charset "UTF-8";.NgxEditor__Popup[_ngcontent-%COMP%]{width:230px}.NgxEditor__ColorContainer[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.NgxEditor__ColorContainer[_ngcontent-%COMP%] + .NgxEditor__ColorContainer[_ngcontent-%COMP%]{margin-top:5px}.NgxEditor__Color[_ngcontent-%COMP%]{border:none;outline:none;border-radius:6px;width:24px;height:24px;flex-shrink:0}.NgxEditor__Color[_ngcontent-%COMP%]:focus-visible{outline:1px solid var(--ngx-editor-focus-ring-color);outline-offset:1px}.NgxEditor__Color--Active[_ngcontent-%COMP%]:after{content:"\\2714";font-size:90%}.NgxEditor__MenuItem--Button[_ngcontent-%COMP%]{margin-top:5px}']})}return i})();var K0=[["bold","italic"],[{heading:["h1","h2","h3","h4","h5","h6"]}],["link","image"],["text_color","background_color"]];var J0=["#b60205","#d93f0b","#fbca04","#0e8a16","#006b75","#1d76db","#0052cc","#5319e7","#e99695","#f9d0c4","#fef2c0","#c2e0c6","#bfdadc","#c5def5","#bfd4f2","#d4c5f9"],Ou=(()=>{class i{menuService;toolbar=K0;colorPresets=J0;disabled=!1;editor;customMenuRef=null;dropdownPlacement="bottom";toggleCommands=["bold","italic","underline","strike","code","blockquote","ordered_list","bullet_list","align_left","align_center","align_right","align_justify","superscript","subscript"];insertCommands=["horizontal_rule","format_clear","indent","outdent","undo","redo"];iconContainerClass=["NgxEditor__MenuItem","NgxEditor__MenuItem--IconContainer"];dropdownContainerClass=["NgxEditor__Dropdown"];seperatorClass=["NgxEditor__Seperator"];constructor(e){this.menuService=e}get presets(){let n=[];return this.colorPresets.forEach((o,r)=>{let s=Math.floor(r/8);n[s]||n.push([]),n[s].push(o)}),n}trackByIndex(e){return e}isDropDown(e){return!!e?.heading}getDropdownItems(e){return e}isLinkItem(e){return e==="link"?!0:typeof e=="object"&&typeof e?.link=="object"}isLinkWithOptions(e){return typeof e=="object"&&typeof e?.link=="object"}getLinkOptions(e){return e?.link}ngOnInit(){if(!this.editor)throw new Wn("Required editor instance to initialize menu component");this.menuService.editor=this.editor}static \u0275fac=function(n){return new(n||i)(P(jt))};static \u0275cmp=O({type:i,selectors:[["ngx-editor-menu"]],inputs:{toolbar:"toolbar",colorPresets:"colorPresets",disabled:"disabled",editor:"editor",customMenuRef:"customMenuRef",dropdownPlacement:"dropdownPlacement"},features:[hi([jt])],decls:3,vars:7,consts:[[1,"NgxEditor__MenuBar",3,"ngClass"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[3,"toolbarItem","class",4,"ngIf"],[3,"class",4,"ngIf"],["type","text_color",3,"class","presets",4,"ngIf"],["type","background_color",3,"class","presets",4,"ngIf"],[3,"toolbarItem"],[3,"options"],[3,"class","group","items",4,"ngFor","ngForOf","ngForTrackBy"],[3,"group","items"],["type","text_color",3,"presets"],["type","background_color",3,"presets"],[3,"ngTemplateOutlet"]],template:function(n,o){n&1&&(f(0,"div",0),M(1,yg,2,2,"ng-container",1)(2,_g,2,1,"ng-container",2),p()),n&2&&(x("ngClass",eo(4,sg,o.disabled,o.dropdownPlacement==="top")),_(),x("ngForOf",o.toolbar)("ngForTrackBy",o.trackByIndex),_(),x("ngIf",o.customMenuRef))},dependencies:[gi,re,Y,El,H0,$0,j0,U0,W0,G0,to]})}return i})();var Y0=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ki({type:i});static \u0275inj=Wi({providers:[ui],imports:[Tr,tt]})}return i})(),cr=new Gi("NgxEditorConfig"),bu={locals:el,icons:Tu},Du=(()=>{class i{static forRoot(e=bu){return{ngModule:i,providers:[{provide:cr,useValue:e},{provide:il,useFactory:_u,deps:[cr]}]}}static forChild(e=bu){return{ngModule:i,providers:[{provide:cr,useValue:e},{provide:il,useFactory:_u,deps:[cr]},xn]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ki({type:i});static \u0275inj=Wi({imports:[Tr,Y0]})}return i})();var Ee=(i,t=!1)=>(e,n)=>{let o=new ht(i);return t?o.toggle()(e,n):o.apply()(e,n)},ol=class{view;state;tr;constructor(t){if(!t)throw new Wn("Required view to initialize commands.");this.view=t,this.state=t.state,this.tr=this.view.state.tr}applyTrx=t=>{this.state=this.state.apply(t??this.tr),this.tr=this.state.tr,this.tr.setMeta("APPLIED_TRX",!0)};dispatch=t=>{this.applyTrx(t)};exec(){if(!this.tr.getMeta("APPLIED_TRX"))return!1;let t=!this.view.state.doc.eq(this.state.doc);this.view.updateState(this.state);let e=this.tr.setMeta("FORCE_EMIT",t);return this.view.dispatch(e),!0}focus(t="end"){let e=t==="start"?z.atStart(this.state.doc):z.atEnd(this.state.doc);return this.tr.setSelection(e),this.applyTrx(),this.view.focus(),this}scrollIntoView(){return this.tr.scrollIntoView(),this.applyTrx(),this}insertText(t){return this.tr.insertText(t),this.applyTrx(),this}insertNewLine(){return li(...[Rs,Fs,Ls,Bs])(this.state,this.dispatch),this}applyMark(t){return Ee(t,!1)(this.state,this.dispatch),this}toggleMark(t){return Ee(t,!0)(this.state,this.dispatch),this}bold(){return Ee("strong")(this.state,this.dispatch),this}toggleBold(){return Ee("strong",!0)(this.state,this.dispatch),this}italics(){return Ee("em")(this.state,this.dispatch),this}toggleItalics(){return Ee("em",!0)(this.state,this.dispatch),this}underline(){return Ee("u")(this.state,this.dispatch),this}toggleUnderline(){return Ee("u",!0)(this.state,this.dispatch),this}strike(){return Ee("s")(this.state,this.dispatch),this}toggleStrike(){return Ee("s",!0)(this.state,this.dispatch),this}code(){return Ee("code")(this.state,this.dispatch),this}toggleCode(){return Ee("code",!0)(this.state,this.dispatch),this}superscript(){return Ee("sup")(this.state,this.dispatch),this}subscript(){return Ee("sub")(this.state,this.dispatch),this}toggleOrderedList(){return new ci(!1).toggle()(this.state,this.dispatch),this}toggleBulletList(){return new ci(!0).toggle()(this.state,this.dispatch),this}toggleHeading(t){return new It(t).toggle()(this.state,this.dispatch),this}insertLink(t,e){return new Xs().insert(t,e)(this.state,this.dispatch),this}updateLink(t){return new Xs().update(t)(this.state,this.dispatch),this}insertImage(t,e={}){return new ku().insert(t,e)(this.state,this.dispatch),this}textColor(t){return new ai("text_color").apply({color:t})(this.state,this.dispatch),this}backgroundColor(t){return new ai("text_background_color").apply({backgroundColor:t})(this.state,this.dispatch),this}removeTextColor(){return new ai("text_color").remove()(this.state,this.dispatch),this}removeBackgroundColor(){return new ai("text_background_color").remove()(this.state,this.dispatch),this}align(t){return new _n(t).toggle()(this.state,this.dispatch),this}insertHTML(t){let{selection:e,schema:n,tr:o}=this.state,{from:r,to:s}=e,l=document.createElement("div");l.innerHTML=Su(t)?t.trim():t;let a=Ft.fromSchema(n).parseSlice(l),c=o.replaceRange(r,s,a);return this.applyTrx(c),this}indent(){return new di("increase").insert()(this.state,this.dispatch),this}outdent(){return new di("decrease").insert()(this.state,this.dispatch),this}},Q0=typeof navigator<"u"?/Mac/.test(navigator.platform):!1,X0=i=>tr(/^\s*>\s$/,i),Z0=i=>tr(/^(?:\d+)\.\s$/,i,t=>({order:Number(t[1])}),(t,e)=>e.childCount+e.attrs.order===Number(t[1])),e1=i=>tr(/^\s*(?:[-+*])\s$/,i),t1=i=>zs(/^```$/,i),n1=(i,t)=>zs(new RegExp(`^(#{1,${t}})\\s$`),i,e=>({level:e[1].length})),i1=i=>$s(/(?:^|\s)(?:(\*\*|__)(?:([^*_]+))(\*\*|__))$/,i),o1=i=>$s(/(?:^|\s)(?:(\*|_)(?:([^*_]+))(\*|_))$/,i),r1=i=>{let t=iu.concat(nu,tu);return t.push(i1(i.marks.strong)),t.push(o1(i.marks.em)),t.push(X0(i.nodes.blockquote)),t.push(Z0(i.nodes.ordered_list)),t.push(e1(i.nodes.bullet_list)),t.push(t1(i.nodes.code_block)),t.push(n1(i.nodes.heading,6)),eu({rules:t})},s1=(i,t)=>{let e={};e["Mod-z"]=sr,Q0?e["Shift-Mod-z"]=zi:e["Mod-y"]=zi;let n=[qi({"Mod-b":mn(i.marks.strong),"Mod-i":mn(i.marks.em),"Mod-u":mn(i.marks.u),"Mod-`":mn(i.marks.code)}),qi({Enter:Hd(i.nodes.list_item),"Shift-Enter":li(Ps,(o,r)=>{let{tr:s}=o,l=i.nodes.hard_break;return r(s.replaceSelectionWith(l.create()).scrollIntoView()),!0}),"Mod-[":Os(i.nodes.list_item),"Mod-]":Ds(i.nodes.list_item),Tab:Ds(i.nodes.list_item)}),qi(Xd)];return t.history&&n.push(qi(e)),n},l1=(i,t)=>{let e=[];return t.keyboardShortcuts&&e.push(...s1(i,{history:t.history})),t.history&&e.push(uu()),t.inputRules&&e.push(r1(i)),e},Nu={linkOnPaste:!0,resizeImage:!0},Cu={content:null,history:!0,keyboardShortcuts:!0,inputRules:!0,schema:Bi,plugins:[],nodeViews:{},attributes:{},features:Nu,handleScrollToSelection:null,linkValidationPattern:`(https?://)?([\\da-z.-]+)\\.([a-z.]{2,6})[/\\w .-]*/??([^#
\r]*)?#?([^
\r]*)|(mailto:.*[@].*)`},pr=class{options;view;constructor(t=Cu){this.options=V(V({},Cu),t),this.createEditor()}valueChangesSubject=new He;updateSubject=new He;get valueChanges(){return this.valueChangesSubject.asObservable()}get update(){return this.updateSubject.asObservable()}get schema(){return this.options.schema||Bi}get linkValidationPattern(){return this.options.linkValidationPattern}get commands(){return new ol(this.view)}get features(){return V(V({},Nu),this.options.features)}handleTransactions(t){let e=this.view.state.apply(t);if(this.view.updateState(e),this.updateSubject.next(this.view),!t.docChanged&&!t.getMeta("FORCE_EMIT"))return;let n=e.doc.toJSON();this.valueChangesSubject.next(n)}createEditor(){let{options:t,schema:e}=this,{content:n=null,nodeViews:o}=t,{history:r=!0,keyboardShortcuts:s=!0,inputRules:l=!0}=t,a=fu(n,e,t.parseOptions),c=t.plugins??[],d=t.attributes??{},u=l1(e,{history:r,keyboardShortcuts:s,inputRules:l});this.view=new Pi(null,{state:Vo.create({doc:a,schema:e,plugins:[...u,...c]}),nodeViews:o,dispatchTransaction:this.handleTransactions.bind(this),attributes:d,handleScrollToSelection:t.handleScrollToSelection})}setContent(t){if(Aa(t))return;let{state:e}=this.view,{tr:n,doc:o}=e,r=fu(t,this.schema,this.options.parseOptions);n.replaceWith(0,e.doc.content.size,r),!o.eq(n.doc)&&n.docChanged&&this.view.dispatch(n)}registerPlugin(t){let{state:e}=this.view,n=[...e.plugins,t],o=e.reconfigure({plugins:n});this.view.updateState(o)}destroy(){this.view.destroy()}};var ke=(()=>{class i{http=T(In);loaderService=T($n);toolRequestList=Q([]);constructor(){console.log("hello toolRequestService"),this.initializeToolRequests()}initializeToolRequests(){this.getToolRequests().subscribe({next:e=>{this.toolRequestList.set(e),console.log("ToolRequests initialis\xE9es:",e)},error:e=>{console.error("Erreur lors de l'initialisation des toolRequests:",e),this.toolRequestList.set([])}})}refreshToolRequests(){this.initializeToolRequests()}updateToolRequest(e){return this.http.patch(`${Yt.toolApi}demandes/${e.id}`,e).pipe(ye(()=>{this.refreshToolRequests()}))}getType(e){if(typeof e=="string")return e;if(e.type===pe.CONTROLE)return"controle";if(e.type===pe.MAINTENANCE)return"maintenance"}createToolRequest(e){return this.http.post("api/tools/request",e)}getToolRequest(e){return console.log("get ToolRequest ",e),e?this.http.get(`api/tools/request/${e}`):$e(new Da)}getToolRequests(){return this.loaderService.startLoading("Chargement des demandes"),this.http.get("api/tools/request").pipe(Wt(),Se(e=>(console.error("Erreur lors du chargement des demandes:",e),$e([]))),bn(()=>this.loaderService.stopLoading()))}removeRequest(e){return this.http.delete(`demandes/${e.id}`).pipe(ye(()=>{this.refreshToolRequests()}))}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var hr=(()=>{class i{fb=T(ro);createToolRequestForm(e){return this.fb.group({type:[e?.type??pe.SBO,$.required],bloquantProd:[e?.bloquantProd??!1,$.required],aircraftProgram:[e?.aircraftProgram??""],groupeAffectation:[e?.groupeAffectation??null],toolingNote:[e?.toolingNote??""],typeData:e?.typeData??null})}createOutillNoRefSAPForm(e){return this.fb.group({identification:[e?.identification??"",$.required],description:[e?.description??"",$.required],localisation:[e?.localisation??"",$.required]})}createSpecCtrlForm(e){return this.fb.group({refPlan:[e?.refPlan??"",$.required],indPlan:[e?.indPlan??"",$.required],cheminCAO:[e?.cheminCAO??""],description:[e?.description??"",$.required],detailsControle:[e?.detailsControle??""],tolerances:[e?.tolerances??""],dateBesoin:[e?.dateBesoin??null,$.required],dispoOut:[e?.dispoOut??null],typeRapport:[e?.typeRapport??null],moyenMesure:[e?.moyenMesure??null],infosComplementaire:[e?.infosComplementaire??""],ligneBudgetaire:[e?.ligneBudgetaire??"",$.required],visaControleur:[e?.visaControleur??""],outillage:[e?.outillage??null],outillNoRefSAP:this.createOutillNoRefSAPForm(e?.outillNoRefSAP),bloquantProd:[e?.bloquantProd??!1],immobilisationOutillage:[e?.immobilisationOutillage??!1]})}createMaintenanceItemForm(e,n){return this.fb.group({rep:[{value:e,disabled:!0}],nonConformite:[n?.nonConformite??"",$.required],actionsCorrectives:[n?.actionsCorrectives??"",$.required],respo:[n?.respo??""],delaiAction:[n?.delaiAction??null,$.required],userReal:[n?.userReal??""],dateReal:[n?.dateReal??null]})}createSpecMaintenanceForm(e){let n=this.fb.array(e?.itemActionCorrective?.length?e.itemActionCorrective.map((o,r)=>this.createMaintenanceItemForm(r+1,o)):[this.createMaintenanceItemForm(1)]);return this.fb.group({outillage:[e?.outillage??null],outillNoRefSAP:this.createOutillNoRefSAPForm(e?.outillNoRefSAP),dateBesoin:[e?.dateBesoin??null],image:[e?.image??""],fichier:[e?.fichier??""],sigle:[e?.sigle??""],userValideur:[e?.userValideur??null],dateValid:[e?.dateValid??null],itemActionCorrective:n})}addMaintenanceItem(e){let n=e.get("itemActionCorrective"),o=n.length+1;n.push(this.createMaintenanceItemForm(o))}removeMaintenanceItem(e,n){let o=e.get("itemActionCorrective");o.length>1&&(o.removeAt(n),o.controls.forEach((r,s)=>{r.get("rep")?.setValue(s+1)}))}createSpecSBOForm(e){return this.fb.group({title:[e?.title??"",$.required],description:[e?.description??"",$.required],dateBesoin:[e?.dateBesoin??null,$.required]})}createNewToolForm(e){return this.fb.group({sapToolNumber:[e?.sapToolNumber??"",$.required],identification:[e?.identification??"",$.required],designation:[e?.designation??"",$.required]})}createNewToolRequestForm(){return this.fb.group({tool:this.createNewToolForm(),toolRequest:this.createToolRequestForm(),specSbo:this.createSpecSBOForm()})}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function c1(i,t){if(i&1&&(f(0,"ion-select-option",21),y(1),p()),i&2){let e=t.$implicit;x("value",e.id),_(),F(" ",e.designation," ")}}var d1=[{title:"Nouvelle demande outillage",path:"new-tool",type:"button"},{title:"Liste des demandes outillages",path:"/tool-requests",type:"button"}],Au=(()=>{class i{authStore=T(vo);formBuilderService=T(hr);programService=T(So);toolService=T(wo);toolRequestService=T(ke);router=T(io);page={pageTitle:"Cr\xE9ation d'une demande",menuTitle:"Menu outillage",menuItems:d1,contentId:"tooling-content"};newToolForm;newToolRequestForm;specSboForm;programs=Q([]);createdTool=Q(null);isCreatingTool=Q(!1);isCreatingRequest=Q(!1);RequestType=pe;editor;ngOnInit(){this.initializeForms(),this.loadPrograms(),this.editor=new pr}initializeForms(){this.newToolForm=this.formBuilderService.createNewToolForm(),this.specSboForm=this.formBuilderService.createSpecSBOForm(),this.newToolRequestForm=this.formBuilderService.createToolRequestForm({type:pe.SBO,typeData:this.specSboForm}),this.specSboForm.get("dateBesoin")?.valueChanges.subscribe(e=>{this.newToolRequestForm.get("dateBesoin")?.setValue(e,{emitEvent:!1})})}loadPrograms(){this.programService.getPrograms().subscribe({next:e=>{this.programs.set(e)},error:e=>{console.error("Erreur lors du chargement des programmes:",e)}})}onCreateTool(){if(this.newToolForm.invalid){this.newToolForm.markAllAsTouched();return}this.isCreatingTool.set(!0);let e=this.newToolForm.value;this.toolService.createTool(e).subscribe({next:n=>{console.log("Outil cr\xE9\xE9:",n),this.createdTool.set(n),this.isCreatingTool.set(!1)},error:n=>{console.error("Erreur lors de la cr\xE9ation de l'outil:",n),this.isCreatingTool.set(!1)}})}onCreateToolRequest(){if(!this.createdTool()){console.error("Aucun outil cr\xE9\xE9");return}if(this.newToolRequestForm.invalid||this.specSboForm.invalid){this.newToolRequestForm.markAllAsTouched(),this.specSboForm.markAllAsTouched();return}this.isCreatingRequest.set(!0);let e={type:pe.SBO,createdAt:new Date,bloquantProd:this.newToolRequestForm.value.bloquantProd,dateBesoin:this.newToolRequestForm.value.dateBesoin,demandeur:this.authStore.user(),outillage:this.createdTool(),toolingNote:this.newToolRequestForm.value.toolingNote,typeData:this.specSboForm.value};this.toolRequestService.createToolRequest(e).subscribe({next:()=>{console.log("Demande cr\xE9\xE9e avec succ\xE8s"),this.isCreatingRequest.set(!1),this.resetForms(),this.router.navigate(["/tool-requests"])},error:n=>{console.error("Erreur lors de la cr\xE9ation de la demande:",n),this.isCreatingRequest.set(!1)}})}resetForms(){this.newToolForm.reset(),this.newToolRequestForm.reset({type:pe.SBO,bloquantProd:!1}),this.specSboForm.reset(),this.createdTool.set(null)}get canCreateTool(){return this.newToolForm.valid&&!this.isCreatingTool()}get canCreateRequest(){return this.createdTool()!==null&&this.newToolRequestForm.valid&&this.specSboForm.valid&&!this.isCreatingRequest()}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-new-tool"]],standalone:!0,features:[L],decls:72,vars:11,consts:[["color","light"],[3,"multiple"],["color",""],["slot","header"],["slot","content"],[3,"formGroup"],["position","floating"],["color","danger"],["required","","formControlName","sapToolNumber","type","text","placeholder","ex. OT095999"],["required","","formControlName","identification","type","text","placeholder","ex. 19900Z01-T700P5522000123"],["required","","formControlName","designation","type","text"],["slot","end","expand","block","color","primary",3,"click"],["formControlName","aircraftProgram","multiple","true","placeholder","S\xE9lectionner le programme avion"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","typeData"],["required","","formControlName","title"],[1,"NgxEditor__Wrapper"],[3,"editor"],["formControlName","description",3,"editor","placeholder"],["display-format","DD.MM.YYYY HH:mm","formControlName","dateBesoin"],["slot","end","expand","block","color","primary",3,"click","disabled"],[3,"value"]],template:function(n,o){n&1&&(f(0,"ion-content",0)(1,"ion-accordion-group",1)(2,"ion-accordion",2)(3,"ion-item",3)(4,"ion-label"),y(5," D\xE9finition "),p(),f(6,"ion-text"),y(7," Cr\xE9er ou s\xE9lectionner l'outillage "),p()(),f(8,"ion-item",4)(9,"form",5)(10,"ion-item-group")(11,"ion-item")(12,"ion-label",6),y(13,"Num\xE9ro d'OT SAP "),f(14,"ion-text",7),y(15,"*"),p()(),S(16,"ion-input",8),p(),f(17,"ion-item")(18,"ion-label",6),y(19,"Num\xE9ro d'identification "),f(20,"ion-text",7),y(21,"*"),p()(),S(22,"ion-input",9),p(),f(23,"ion-item")(24,"ion-label",6),y(25,"D\xE9signation "),f(26,"ion-text",7),y(27,"*"),p()(),S(28,"ion-input",10),p()(),f(29,"ion-toolbar")(30,"ion-button",11),E("click",function(){return o.onCreateTool()}),y(31," Cr\xE9er l'OT "),p()()()()(),f(32,"ion-accordion")(33,"ion-item",3)(34,"ion-label"),y(35," Descritpion "),p()(),f(36,"ion-item",4)(37,"form",5)(38,"ion-item-group")(39,"ion-item")(40,"ion-label"),y(41,"Programme avion"),p(),f(42,"ion-select",12),M(43,c1,2,2,"ion-select-option",13),p()()(),f(44,"ion-item-group",14)(45,"ion-item")(46,"ion-label"),y(47,"Titre "),f(48,"ion-text",7),y(49,"*"),p()(),S(50,"ion-input",15),p(),f(51,"ion-item")(52,"ion-label"),y(53,"Description "),f(54,"ion-text",7),y(55,"*"),p()(),f(56,"div",16),S(57,"ngx-editor-menu",17)(58,"ngx-editor",18),p()(),f(59,"ion-item")(60,"ion-label"),y(61,"Date "),f(62,"ion-text",7),y(63,"*"),p()(),S(64,"ion-datetime",19),p()()()()()(),f(65,"div"),y(66),D(67,"json"),p()(),f(68,"ion-footer")(69,"ion-toolbar",0)(70,"ion-button",20),E("click",function(){return o.onCreateToolRequest()}),y(71," Cr\xE9er la demande "),p()()()),n&2&&(_(),x("multiple",!0),_(8),x("formGroup",o.newToolForm),_(28),x("formGroup",o.newToolRequestForm),_(6),x("ngForOf",o.programs()),_(14),x("editor",o.editor),_(),x("editor",o.editor)("placeholder","Taper la description ici"),_(8),F(" ",B(67,9,o.newToolRequestForm.value)," "),_(4),x("disabled",o.newToolRequestForm.invalid))},dependencies:[Dn,Al,Re,Pl,uo,Nn,mo,ao,Dt,_o,so,go,xo,ho,tt,Qe,Je,Ye,kn,Xe,Ze,En,re,Du,Eu,Ou,kl]})}return i})();function u1(i,t){if(i&1&&(f(0,"ion-select-option",6),y(1),p()),i&2){let e=t.$implicit;x("value",e),_(),F("",e," ")}}function p1(i,t){if(i&1){let e=H();f(0,"ion-item",1)(1,"ion-label"),y(2),p(),f(3,"ion-select",4),E("ionChange",function(o){let r=R(e).$implicit,s=v();return A(s.filterChange(r,o))}),M(4,u1,2,2,"ion-select-option",5),p()()}if(i&2){let e=t.$implicit;_(2),ee(e.name),_(),x("placeholder","Filtre "+e.name),_(),x("ngForOf",e.options)}}var Pu=(()=>{class i{toolRequestFilters=Gt([]);onFilterChange=vn();activeFilters=[];resetFiltersClick(){this.activeFilters.forEach(e=>{e.value=null}),this.activeFilters=[],this.onFilterChange.emit({columnProp:"reset",selectedValues:[]})}filterChange(e,n){let o=n.detail.value;n.target&&!this.activeFilters.includes(n.target)&&this.activeFilters.push(n.target),this.onFilterChange.emit({columnProp:e.columnProp,selectedValues:Array.isArray(o)?o:[o]})}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-tool-request-filters"]],inputs:{toolRequestFilters:[1,"toolRequestFilters"]},outputs:{onFilterChange:"onFilterChange"},standalone:!0,features:[L],decls:11,vars:0,consts:[["slot","start","name","filter-outline"],[1,"filter-item","ion-margin"],["slot","start"],["fill","solid","slot","end","color","primary","slot","end",3,"click"],["multiple","true",1,"filter",3,"ionChange","placeholder"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,o){n&1&&(f(0,"ion-toolbar")(1,"ion-title"),S(2,"ion-icon",0),y(3," Filtres "),p()(),f(4,"ion-list"),Xi(5,p1,5,3,"ion-item",1,Qi),p(),f(7,"ion-toolbar")(8,"ion-buttons",2)(9,"ion-button",3),E("click",function(){return o.resetFiltersClick()}),y(10," Supprimer les filtres "),p()()()),n&2&&(_(5),Zi(o.toolRequestFilters()))},dependencies:[J,Ae,An,we,Pe,Me,zn,Vn,Hn,Pt,st,Nt,re],styles:[".filters[_ngcontent-%COMP%]{display:flex;max-width:100%;flex-wrap:wrap;width:max-content}.filters[_ngcontent-%COMP%]   .filter-item[_ngcontent-%COMP%]{width:auto}.filters[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin:0}"]})}return i})();var f1=new Gi("MAT_SORT_DEFAULT_OPTIONS"),Fu=(()=>{class i{get direction(){return this._direction}set direction(e){this._direction=e}constructor(e){this._defaultOptions=e,this._initializedStream=new Cr(1),this.sortables=new Map,this._stateChanges=new He,this.start="asc",this._direction="",this.disabled=!1,this.sortChange=new ie,this.initialized=this._initializedStream}register(e){this.sortables.set(e.id,e)}deregister(e){this.sortables.delete(e.id)}sort(e){this.active!=e.id?(this.active=e.id,this.direction=e.start?e.start:this.start):this.direction=this.getNextSortDirection(e),this.sortChange.emit({active:this.active,direction:this.direction})}getNextSortDirection(e){if(!e)return"";let n=e?.disableClear??this.disableClear??!!this._defaultOptions?.disableClear,o=h1(e.start||this.start,n),r=o.indexOf(this.direction)+1;return r>=o.length&&(r=0),o[r]}ngOnInit(){this._initializedStream.next()}ngOnChanges(){this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete(),this._initializedStream.complete()}static{this.\u0275fac=function(n){return new(n||i)(P(f1,8))}}static{this.\u0275dir=Ji({type:i,selectors:[["","matSort",""]],hostAttrs:[1,"mat-sort"],inputs:{active:[0,"matSortActive","active"],start:[0,"matSortStart","start"],direction:[0,"matSortDirection","direction"],disableClear:[2,"matSortDisableClear","disableClear",kr],disabled:[2,"matSortDisabled","disabled",kr]},outputs:{sortChange:"matSortChange"},exportAs:["matSort"],standalone:!0,features:[Yi,Et]})}}return i})();function h1(i,t){let e=["asc","desc"];return i=="desc"&&e.reverse(),t||e.push(""),e}var mb=ga.ENTERING+" "+ma.STANDARD_CURVE;var Lu=(()=>{class i{http=T(In);requestsAreLoading;filtersList=new He;allToolRequests=new $i([]);filters=new $i([]);toolRequestsList=[];pageCounter=new $i(1);constructor(){}getAllToolRequests(){return this.http.get(`${Yt.toolApi}demandes`).pipe(Wt())}getToolRequests(e=1,n=25){return this.http.get("api/tools/request",{params:{page:e,itemsPerPage:n}}).pipe(Wt())}getNextPage(){let e=this.pageCounter.getValue();this.pageCounter.next(e+1)}addFilter(e){let n=this.filters.getValue(),o=n.findIndex(r=>r.data===e.data);o!==-1?n[o]=e:n.push(e),this.filters.next(n)}resetFilters(){this.filters.next([])}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function y1(i,t){if(i&1){let e=H();f(0,"ion-row",9),E("click",function(){let o=R(e).$implicit,r=v();return A(r.openRequestClick(o))}),f(1,"ion-col",3)(2,"div",10),y(3),p()(),f(4,"ion-col",4),y(5),p(),f(6,"ion-col",5)(7,"ion-label"),y(8),p()(),f(9,"ion-col",6),y(10),D(11,"date"),p(),f(12,"ion-col",11),E("click",function(){R(e);let o=v();return A(o.userClick())}),f(13,"ion-label"),y(14),p()()()}if(i&2){let e=t.$implicit,n=v();x("isUrgent",e.bloquantProd),_(2),wn("border",n.getBorder(e)),_(),F(" ",e.id," "),_(2),ee(e.statut),_(3),bl("OT",e.outillage.sapToolNumber," - ",e.outillage.designation,""),_(2),F(" ",Sl(11,9,e.createdAt,"EE dd MMM yyyy","local"),""),_(4),ee(e.demandeur.nom)}}var Bu=(()=>{class i{navCtrl;authGuard;toolRequestsService;toolRequestList=Gt([]);RequestType=pe;sort;newToolRequestsList$;displayedRequestColumns=["statut","id","tool","createdAt","userCreat","needDate","buttons"];isAdmin=!1;constructor(e,n,o){this.navCtrl=e,this.authGuard=n,this.toolRequestsService=o,this.newToolRequestsList$=this.toolRequestsService.filtersList.asObservable()}openRequestClick(e){e.type===pe.CONTROLE&&this.navCtrl.navigateForward("tooling/3d/"+e.id),e.type===pe.MAINTENANCE&&this.navCtrl.navigateForward("tooling/repair/"+e.id)}ngOnInit(){this.isAdmin=this.authGuard.isRole(["ROLE_ADMIN"])}userClick(){}openControlClick(e){this.navCtrl.navigateForward("tooling/3D-tool/"+e.id)}openMaintenanceClick(e){this.navCtrl.navigateForward("tooling/repair-tool/"+e.id)}removeRequestClick(e){}getBorder(e){if(this.getType(e)==="controle")return"solid 2px lawngreen";if(this.getType(e)==="maintenance")return"solid 2px yellow"}getType(e){if(typeof e=="string")return e;if(e.type===pe.CONTROLE)return"controle";if(e.type===pe.MAINTENANCE)return"maintenance"}static \u0275fac=function(n){return new(n||i)(P(Tn),P(lt),P(Lu))};static \u0275cmp=O({type:i,selectors:[["app-tool-request-table"]],viewQuery:function(n,o){if(n&1&&Ue(Fu,5),n&2){let r;We(r=Ge())&&(o.sort=r.first)}},inputs:{toolRequestList:[1,"toolRequestList"]},standalone:!0,features:[L],decls:17,vars:1,consts:[["menu","tool-request-menu"],[3,"fixed"],["appHeaderRow",""],["size","1"],["size","2"],["size","8"],["size","4"],["size","3"],["appDataRow","",3,"isUrgent"],["appDataRow","",3,"click","isUrgent"],[1,"circle"],["size","3",3,"click"]],template:function(n,o){n&1&&(G(0),f(1,"ion-menu-toggle",0)(2,"ion-button"),y(3,"Click to open the menu"),p()(),f(4,"ion-grid",1)(5,"ion-row",2),S(6,"ion-col",3),f(7,"ion-col",4),y(8,"Statut"),p(),f(9,"ion-col",5),y(10,"Outillage"),p(),f(11,"ion-col",6),y(12,"Date de la demande"),p(),f(13,"ion-col",7),y(14,"Demandeur"),p()(),Xi(15,y1,15,13,"ion-row",8,Qi),p(),K()),n&2&&(_(4),x("fixed",!1),_(11),Zi(o.toolRequestList()))},dependencies:[J,Ae,Fn,Ln,Me,na,qn,fa,ha,Ot],styles:["[_nghost-%COMP%]{height:100%;overflow:hidden}ion-grid[_ngcontent-%COMP%]{--ion-grid-columns: 18}ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%] > ion-col[_ngcontent-%COMP%]{padding:10px 0}ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%] > ion-col[_ngcontent-%COMP%]:first-child{justify-content:center!important}.circle[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%;display:flex;justify-content:center;align-items:center}"],data:{animation:[Gl("openClose",[Jl("open",Kl({backgroundColor:"DarkOrange",opacity:"0.7"}))])]}})}return i})();var zu=[{name:"Statut",columnProp:"statut",options:[]},{name:"Type de demande",columnProp:"type",options:[]},{name:"Demandeur",columnProp:"demandeur",options:[]},{name:"Outillage",columnProp:"outillage",options:[]}];var qu=(()=>{class i{toolRequestService=T(ke);_filters=zu;filters=Ke(()=>{let e=this.filteredToolRequestList(),n=this.selectedFilters();return this._filters.map(o=>{let r=ae(V({},o),{options:[]}),s=new Set;e.forEach(a=>{let c=this.getCompareElement(o.columnProp,a);c&&s.add(c)}),r.options=Array.from(s).sort();let l=n[o.columnProp];return l&&(l.forEach(a=>{s.has(a)||s.add(a)}),r.options=Array.from(s).sort()),r})});filteredToolRequestList=Ke(()=>{let e=this.toolRequestService.toolRequestList(),n=this.selectedFilters();return Object.keys(n).length===0?e:e.filter(o=>Object.entries(n).every(([r,s])=>{if(!s||s.length===0)return!0;let l=r,a=this.getCompareElement(l,o);return s.includes(a||"")}))});selectedFilters=Q({});constructor(){console.log("hello toolRequestFilterService")}updateFilter(e,n){let o=V({},this.selectedFilters());n.length===0?delete o[e]:o[e]=n,this.selectedFilters.set(o)}resetFilters(){this.selectedFilters.set({})}getCompareElement(e,n){return e==="outillage"?n.outillage.sapToolNumber:e==="demandeur"?n.demandeur.nom:n[e]}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Vu=(()=>{class i{toolRequestFilterService=T(qu);filteredToolRequestList=this.toolRequestFilterService.filteredToolRequestList;toolRequestFilters=this.toolRequestFilterService.filters;isAdmin=!1;constructor(){console.log("hello toolRequestPage")}filterChange(e){e.columnProp==="reset"?this.toolRequestFilterService.resetFilters():this.toolRequestFilterService.updateFilter(e.columnProp,e.selectedValues)}reloadClick(){}nextClick(){}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["ng-component"]],standalone:!0,features:[L],decls:17,vars:3,consts:[["color","dark"],["color","secondary","slot","end","expand","block","fill","outline",3,"click"],["color","secondary","slot","end",3,"click"],["slot","start","name","refresh-circle-outline"],["id","tool-request-content",3,"fullscreen"],[1,"ion-no-padding"],["size","4"],[3,"onFilterChange","toolRequestFilters"],["size","8"],[3,"toolRequestList"]],template:function(n,o){n&1&&(f(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),y(3,"Liste des demandes"),p(),f(4,"ion-button",1),E("click",function(){return o.nextClick()}),y(5," Charger plus de demandes "),p(),f(6,"ion-button",2),E("click",function(){return o.reloadClick()}),S(7,"ion-icon",3),y(8," Recharger "),p()()(),f(9,"ion-content",4),G(10),f(11,"ion-grid",5)(12,"ion-row")(13,"ion-col",6)(14,"app-tool-request-filters",7),E("onFilterChange",function(s){return o.filterChange(s)}),p()(),f(15,"ion-col",8),S(16,"app-tool-request-table",9),p()()(),K(),p()),n&2&&(_(9),x("fullscreen",!1),_(5),x("toolRequestFilters",o.toolRequestFilters()),_(2),x("toolRequestList",o.filteredToolRequestList()))},dependencies:[On,Dt,Rn,so,yo,Re,co,fo,lo,Pu,Bu],styles:["ion-grid[_ngcontent-%COMP%]{height:100%}ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{height:100%}ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]:first-child{border-right:2px solid var(--ion-color-medium)}"]})}return i})();function _1(i,t){i&1&&(f(0,"ion-row",4)(1,"ion-col",2),y(2,"Test"),p(),f(3,"ion-col",2),y(4,"Test"),p()())}var Hu=(()=>{class i{toolRequestService;alertControleService;requestList;constructor(e,n){this.toolRequestService=e,this.alertControleService=n}ngOnInit(){this.updateToolList()}updateToolList(){}static \u0275fac=function(n){return new(n||i)(P(ke),P(jn))};static \u0275cmp=O({type:i,selectors:[["app-tool-list"]],standalone:!0,features:[L],decls:12,vars:1,consts:[["fixed",""],[1,"header-row"],["size","6"],["class","request-row",4,"ngFor","ngForOf"],[1,"request-row"]],template:function(n,o){n&1&&(f(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),y(3,"toolList"),p()()(),f(4,"ion-content")(5,"ion-grid",0)(6,"ion-row",1)(7,"ion-col",2),y(8,"header test"),p(),f(9,"ion-col",2),y(10,"header test"),p()(),M(11,_1,5,0,"ion-row",3),p()()),n&2&&(_(11),x("ngForOf",o.requestList))},dependencies:[J,Fn,rt,Ln,Bn,qn,Pt,st,re]})}return i})();var $u=(()=>{class i{http=T(In);loaderService=T($n);toolReqService=T(ke);maintenanceUrl=`${Yt.toolApi}maintenances`;maintenanceItemUrl=`${Yt.toolApi}maintenance_items`;createMaintenanceRequest(e){return this.loaderService.startLoading("Cr\xE9ation de la demande de maintenance..."),this.createAllMaintenanceItems(e.itemActionCorrective).pipe(pi(n=>{let o=this.buildMaintenancePayload(e,n);return this.http.post(this.maintenanceUrl,o)}),ye(n=>{console.log("\u2705 Demande de maintenance cr\xE9\xE9e:",n)}),Se(n=>(console.error("\u274C Erreur lors de la cr\xE9ation de la maintenance:",n),mt(()=>new Error("\xC9chec de la cr\xE9ation de la demande de maintenance")))),bn(()=>this.loaderService.stopLoading()))}updateMaintenanceRequest(e){return e.id?(this.loaderService.startLoading("Mise \xE0 jour de la demande de maintenance..."),this.updateOrCreateMaintenanceItems(e.itemActionCorrective).pipe(pi(n=>{let o=this.buildMaintenancePayload(e,n);return this.http.put(`${this.maintenanceUrl}/${e.id}`,o)}),ye(n=>{console.log("\u2705 Demande de maintenance mise \xE0 jour:",n)}),Se(n=>(console.error("\u274C Erreur lors de la mise \xE0 jour de la maintenance:",n),mt(()=>new Error("\xC9chec de la mise \xE0 jour de la demande de maintenance")))),bn(()=>this.loaderService.stopLoading()))):mt(()=>new Error("ID de maintenance manquant pour la mise \xE0 jour"))}loadMaintenanceData(e){return this.loaderService.startLoading("Chargement de la demande de maintenance..."),this.toolReqService.getToolRequest(e).pipe(ul(n=>n.typeData.id?this.getMaintenance(n.typeData.id).pipe(dl(o=>({toolRequest:n,specMaintenance:o}))):mt(()=>new Error("Aucune maintenance associ\xE9e \xE0 cette demande"))),ye(n=>{console.log("\u2705 Donn\xE9es de maintenance charg\xE9es:",n)}),Se(n=>(console.error("\u274C Erreur lors du chargement de la maintenance:",n),mt(()=>n))),bn(()=>this.loaderService.stopLoading()))}getMaintenance(e){return e?this.http.get(`${this.maintenanceUrl}/${e}`).pipe(Se(n=>(console.error("\u274C Erreur lors du chargement de la maintenance:",n),$e(this.createEmptyMaintenance())))):$e(this.createEmptyMaintenance())}createAllMaintenanceItems(e){if(!e||e.length===0)return $e([]);let n=e.map(o=>this.http.post(this.maintenanceItemUrl,this.cleanMaintenanceItem(o)).pipe(ye(r=>{console.log(`\u2705 Item de maintenance cr\xE9\xE9: #${r.id}`)}),Se(r=>(console.error("\u274C Erreur cr\xE9ation item:",r),mt(()=>r)))));return vr(n)}updateOrCreateMaintenanceItems(e){if(!e||e.length===0)return $e([]);let n=e.map(o=>{let r=this.cleanMaintenanceItem(o);return o.id?this.http.put(`${this.maintenanceItemUrl}/${o.id}`,r).pipe(ye(s=>{console.log(`\u2705 Item de maintenance mis \xE0 jour: #${s.id}`)})):this.http.post(this.maintenanceItemUrl,r).pipe(ye(s=>{console.log(`\u2705 Nouvel item de maintenance cr\xE9\xE9: #${s.id}`)}))});return vr(n).pipe(Se(o=>(console.error("\u274C Erreur lors de la gestion des items:",o),mt(()=>o))))}deleteMaintenanceItem(e){return this.http.delete(`${this.maintenanceItemUrl}/${e}`).pipe(ye(()=>{console.log(`\u2705 Item de maintenance supprim\xE9: #${e}`)}),Se(n=>(console.error("\u274C Erreur suppression item:",n),mt(()=>n))))}buildMaintenancePayload(e,n){return ae(V({},e),{itemActionCorrective:n.map(o=>`/api/maintenance_items/${o.id}`),outillage:e.outillage?typeof e.outillage=="string"?e.outillage:`/api/tools/${e.outillage.id}`:null,userCreat:e.userCreat?typeof e.userCreat=="string"?e.userCreat:`/api/users/${e.userCreat.id}`:null})}cleanMaintenanceItem(e){let n=V({},e);return delete n.id,n.delaiAction&&(n.delaiAction=new Date(n.delaiAction).toISOString()),n.dateReal&&(n.dateReal=new Date(n.dateReal).toISOString()),n}createEmptyMaintenance(){return{itemActionCorrective:[],rep:[],outillNoRefSAP:{description:"",identification:"",localisation:""}}}itemsToIris(e){return e.map(n=>`/api/maintenance_items/${n.id}`)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var mr=class{canUpdate=!1;canManage=!1;canEdit=!1},gr=(()=>{class i{roleGuard;getStatus(e){let n=e==="NOUVELLE",o=this.roleGuard.isRole(["ROLE_RESP_OUTIL","ROLE_ADMIN"]);return n?{canUpdate:!0,canManage:o,canEdit:!0}:{canUpdate:o,canManage:o,canEdit:o}}constructor(e){this.roleGuard=e}static \u0275fac=function(n){return new(n||i)(Cn(lt))};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var yr=(()=>{class i{ngOnInit(){this.inputTool$.pipe(Wt())}toolInput=new He;inputTool$=this.toolInput.asObservable();emitTool(e){this.toolInput.next(e)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Uu=(()=>{class i{toolService;toolInputService;onChangeToolInput(e){this.inputToolAction(e.value)}toolInputValue;constructor(e,n){this.toolService=e,this.toolInputService=n}inputToolAction(e){this.toolService.getToolByInput(e).then(n=>{this.toolInputService.emitTool(n)})}static \u0275fac=function(n){return new(n||i)(P(wo),P(yr))};static \u0275dir=Ji({type:i,selectors:[["","toolInput",""]],hostVars:1,hostBindings:function(n,o){n&1&&E("change",function(s){return o.onChangeToolInput(s.target)}),n&2&&xl("value",o.toolInputValue)},standalone:!0})}return i})();function x1(i,t){i&1&&(G(0),S(1,"ion-icon",3),K())}function b1(i,t){i&1&&S(0,"ion-icon",4)}function C1(i,t){if(i&1&&(G(0),f(1,"ion-item")(2,"ion-label"),y(3," D\xE9signation outillage "),p(),S(4,"ion-input",5),p(),f(5,"ion-item")(6,"ion-label"),y(7,"Programme avion"),p(),S(8,"ion-input",5),p(),K()),i&2){let e=v();_(4),x("value",e.tool.designation),_(4),x("value",e.tool.programme.designation)}}var _r=(()=>{class i{toolInputService;disabled=!1;tool;constructor(e){this.toolInputService=e}ngOnInit(){this.toolInputService.inputTool$.subscribe(e=>{this.tool=e,this.onChange(e)})}onChange=e=>{};onTouched=()=>{};writeValue(e){this.tool=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}static \u0275fac=function(n){return new(n||i)(P(yr))};static \u0275cmp=O({type:i,selectors:[["app-tool-input"]],standalone:!0,features:[hi([{provide:oo,multi:!0,useExisting:i}]),L],decls:7,vars:3,consts:[["toolInput","","placeholder","n\xB0OT SAP ou n\xB0 Equipement SAP"],[4,"ngIf"],["slot","end","name","checkmark","color","success",4,"ngIf"],["slot","end","name","close-outline","color","danger"],["slot","end","name","checkmark","color","success"],["type","text","disabled","true",3,"value"]],template:function(n,o){n&1&&(f(0,"ion-item")(1,"ion-label"),y(2,"Outillage SAP : "),p(),S(3,"ion-input",0),M(4,x1,2,0,"ng-container",1)(5,b1,1,0,"ion-icon",2),p(),M(6,C1,9,2,"ng-container",1)),n&2&&(_(4),x("ngIf",!o.tool),_(),x("ngIf",o.tool),_(),x("ngIf",o.tool))},dependencies:[J,we,At,Pe,Me,Rt,Uu,Y]})}return i})();function v1(i,t){if(i&1){let e=H();f(0,"ion-content")(1,"ion-datetime",19,2),E("ionChange",function(){R(e);let o=v();return A(o.maintenanceItem.dateReal=o.maintenanceItemForm.controls.delaiAction.value)}),f(3,"div",20),y(4,"Date de r\xE9alisation de la maintenance"),p()()()}}function S1(i,t){if(i&1){let e=H();f(0,"ion-button",21),E("click",function(){R(e);let o=v();return A(o.validateMaintenance())}),S(1,"ion-icon",22),y(2," Effectu\xE9e "),p()}if(i&2){let e=v();x("disabled",e.maintenanceItemForm.invalid)}}var Wu=(()=>{class i{uploadImage(e){throw new Error("Method not implemented.")}maintenanceItem;evRemoveItem=new ie;validate=!1;maintenanceItemForm=new yi({nonConformite:new Te,rep:new Te,actionsCorrectives:new Te,delaiAction:new Te(new Date),dateReal:new Te});alertController=T(la);removeItemClick(){return br(this,null,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Alerte confirmation",message:"Message <strong>Et\xEAs vous s\xFBr de vouloir supprimer cette maintenance?</strong>!!!",buttons:[{text:"Non",role:"cancel",cssClass:"secondary",id:"cancel-button",handler:()=>{}},{text:"OUI",id:"confirm-button",handler:n=>{this.confirmRemoveItem()}}]})).present()})}confirmRemoveItem(){this.evRemoveItem.emit(this.maintenanceItem)}validateMaintenance(){}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-maintenance-item-form"]],inputs:{maintenanceItem:"maintenanceItem"},outputs:{evRemoveItem:"evRemoveItem"},standalone:!0,features:[L],decls:44,vars:8,consts:[["nonConformite",""],["actionsCorrectives",""],["dateReal",""],[3,"formGroup"],["color","danger"],["autoGrow","","required","","type","text","formControlName","nonConformite",3,"change"],["autoGrow","","required","","type","text","formControlName","actionsCorrectives",3,"change"],["lines","full","button",""],["name","image","slot","start"],["type","file",3,"change"],["href","file:///T:/Tarbes/DIAE-C-MC/DONNEES TECHNIQUES PREPARATION SERIE",1,"item"],["slot","primary"],["slot","end",3,"click"],["slot","start","name","trash-outline"],["button","",3,"id"],["slot","end","icon","calendar-outline"],["slot","end"],[3,"trigger"],["slot","start",3,"disabled","click",4,"ngIf"],["presentation","date","formControlName","delaiAction","display-format","DD.MM.YYYY",3,"ionChange"],["slot","title"],["slot","start",3,"click","disabled"],["slot","start","name","checkmark"]],template:function(n,o){if(n&1){let r=H();f(0,"form",3)(1,"ion-item")(2,"ion-label"),y(3,"Non conformit\xE9 "),f(4,"ion-text",4),y(5,"*"),p()(),f(6,"ion-textarea",5,0),E("change",function(){R(r);let l=gt(7);return A(o.maintenanceItem.nonConformite=l.value)}),p()(),f(8,"ion-item")(9,"ion-label"),y(10,"Action corrective "),f(11,"ion-text",4),y(12,"*"),p()(),f(13,"ion-textarea",6,1),E("change",function(){R(r);let l=gt(14);return A(o.maintenanceItem.actionsCorrectives=l.value)}),p()(),f(15,"ion-item",7),S(16,"ion-icon",8),f(17,"ion-input",9),E("change",function(l){return R(r),A(o.uploadImage(l))}),p(),f(18,"ion-label"),y(19,"Joindre une image"),p()(),f(20,"ion-item",7)(21,"ion-label"),y(22,"Joindre une image"),p(),f(23,"a",10),y(24,"Lien test vers r\xE9seau DAHER"),p()(),f(25,"ion-buttons",11)(26,"ion-button",12),E("click",function(){return R(r),A(o.removeItemClick())}),S(27,"ion-icon",13),y(28," Supprimer Item "),p()(),f(29,"ion-item-group")(30,"ion-item-divider")(31,"ion-label"),y(32,"R\xE9alisation"),p()(),f(33,"ion-item",14)(34,"ion-label"),y(35,"Date de r\xE9alisation"),p(),S(36,"ion-icon",15),f(37,"ion-text",16),y(38),D(39,"date"),p(),f(40,"ion-modal",17),M(41,v1,5,0,"ng-template"),p()(),f(42,"ion-buttons",11),M(43,S1,3,1,"ion-button",18),p()()()}n&2&&(x("formGroup",o.maintenanceItemForm),_(33),x("id","open-date-real"+o.maintenanceItem.rep),_(5),F(" ",Tt(39,5,o.maintenanceItem.dateReal,"dd/MM/yyyy"),""),_(2),x("trigger","open-date-real"+o.maintenanceItem.rep),_(3),x("ngIf",!o.maintenanceItem.dateReal))},dependencies:[tt,Qe,Je,Ye,kn,Xe,Ze,J,Ae,An,rt,Ql,we,At,Pe,Zl,ea,Me,Co,ia,ra,Nt,Rt,Y,Ot]})}return i})();var Gu=(()=>{class i{requestService;uploadFile(e){let n=new FormData;return n.append("file",e,e.name),this.requestService.createPostRequest("file/img/tooling",n)}constructor(e){this.requestService=e}static \u0275fac=function(n){return new(n||i)(Cn(da))};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function M1(i,t){i&1&&S(0,"ion-icon",4)}var Ku=(()=>{class i{uploadFileService;maintenanceItem;canUpdate;evValidateItem=new ie;evRemoveItem=new ie;maintenanceRealisee=!1;constructor(e){this.uploadFileService=e}ngOnChanges(e){}ionViewWillEnter(){}ngOnInit(){console.log("onInit")}dateValue(e){return new Date(e)}validateRealMaintClick(){this.maintenanceRealisee=!0}uploadImage(e){console.log(e);let n=e.target.files[0];n&&this.uploadFileService.uploadFile(n).subscribe({next:o=>{}})}static \u0275fac=function(n){return new(n||i)(P(Gu))};static \u0275cmp=O({type:i,selectors:[["app-maintenance-item"]],inputs:{maintenanceItem:"maintenanceItem",canUpdate:"canUpdate"},outputs:{evValidateItem:"evValidateItem",evRemoveItem:"evRemoveItem"},standalone:!0,features:[Et,L],decls:7,vars:3,consts:[[1,"ion-margin-top",3,"color"],[1,"flex-row"],["color","secondary"],["name","checkmark","color","success","size","large",4,"ngIf"],["name","checkmark","color","success","size","large"]],template:function(n,o){n&1&&(f(0,"ion-card",0)(1,"ion-card-header",1)(2,"ion-card-title",2),y(3),p(),M(4,M1,1,0,"ion-icon",3),p(),f(5,"ion-card-content"),S(6,"app-maintenance-item-form"),p()()),n&2&&(x("color",o.maintenanceRealisee?"success":""),_(3),F("Maintenance n\xB0",o.maintenanceItem.rep," "),_(),x("ngIf",o.maintenanceRealisee))},dependencies:[J,nt,it,ot,Pn,we,Y,Wu],styles:[".flex-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}ion-card[_ngcontent-%COMP%]{width:100%}"]})}return i})();function I1(i,t){i&1&&(G(0,14),f(1,"ion-list-header")(2,"ion-label"),y(3,"Sans n\xB0OT"),p()(),f(4,"ion-item")(5,"ion-label"),y(6,"Programme avion"),p(),S(7,"ion-input",15),p(),f(8,"ion-item")(9,"ion-label"),y(10,"Description outillage (texte libre)"),p(),S(11,"ion-input",16),p(),f(12,"ion-item")(13,"ion-label"),y(14,"Localisation (texte libre)"),p(),S(15,"ion-input",17),p(),K())}function E1(i,t){if(i&1){let e=H();f(0,"ion-item",19),E("click",function(){let o=R(e).$implicit,r=v(2);return A(r.selectedItem=o)}),f(1,"ion-label"),y(2),p()()}if(i&2){let e=t.$implicit;_(2),ee(e.rep)}}function k1(i,t){if(i&1&&(G(0),M(1,E1,3,1,"ion-item",18),K()),i&2){let e=v();_(),x("ngForOf",e.maintForm.controls.itemActionCorrective.value.reverse())}}function T1(i,t){if(i&1){let e=H();G(0,20),f(1,"ion-card",2)(2,"ion-card-header",9)(3,"ion-card-title",3),y(4,"DETAIL MAINTENANCE"),p()(),f(5,"ion-card-content")(6,"app-maintenance-item",21),E("evRemoveItem",function(o){R(e);let r=v();return A(r.onRemoveItem(o,r.selectedItem))}),p()()(),K()}if(i&2){let e=v();_(6),x("maintenanceItem",e.selectedItem)("canUpdate",e.requestState.canUpdate)}}var Ju=(()=>{class i{requestState={canManage:!1,canUpdate:!1,canEdit:!1};toolRequestForm;toolRequestFormChange=new ie;maintForm;maintFormChange=new ie;selectedItem;constructor(){}ngOnInit(){}ngOnChanges(e){console.log(e),e.maintForm&&this.maintFormChange.emit(this.maintForm),e.toolRequestForm&&this.toolRequestFormChange.emit(this.toolRequestForm)}addMaintenanceItemClick(){}onRemoveItem(e,n){}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-maint-repair-form"]],inputs:{requestState:"requestState",toolRequestForm:"toolRequestForm",maintForm:"maintForm"},outputs:{toolRequestFormChange:"toolRequestFormChange",maintFormChange:"maintFormChange"},standalone:!0,features:[Et,L],decls:34,vars:4,consts:[[1,"main-form",3,"formGroup"],["size","6"],["color","light"],[1,"ion-text-uppercase"],["lines","none"],["formControlName","outillage"],["formGroupName","outillNoRefSAP",4,"ngIf"],["formControlName","bloquantProd","slot","end"],["color","light",1,"maintenance-list"],["color","light",1,"flex-row"],["size","small",3,"click"],["slot","start","name","add"],[4,"ngIf"],["class","righSide",4,"ngIf"],["formGroupName","outillNoRefSAP"],["formControlName","identification","type","text","placeholder","Renseigner le programme"],["formControlName","description","type","text","placeholder","Description de l'outillage"],["formControlName","localisation","type","text","placeholder","Description de l'outillage"],["button","","lines","full",3,"click",4,"ngFor","ngForOf"],["button","","lines","full",3,"click"],[1,"righSide"],[3,"evRemoveItem","maintenanceItem","canUpdate"]],template:function(n,o){n&1&&(f(0,"form",0)(1,"ion-grid")(2,"ion-row")(3,"ion-col",1)(4,"ion-card")(5,"ion-card-header",2)(6,"ion-card-title",3),y(7,"L'outillage"),p()(),f(8,"ion-card-content")(9,"ion-list",4)(10,"ion-list-header")(11,"ion-label"),y(12,"Avec n\xB0OT"),p()(),S(13,"app-tool-input",5),M(14,I1,16,0,"ng-container",6),p(),f(15,"ion-item")(16,"ion-label"),y(17,"Bloquant Prod"),p(),S(18,"ion-toggle",7),p()()(),f(19,"ion-card",8)(20,"ion-card-header",9)(21,"ion-card-title",3),y(22,"La maintenance"),p(),f(23,"ion-button",10),E("click",function(){return o.addMaintenanceItemClick()}),S(24,"ion-icon",11),y(25," Ajouter maintenance "),p()(),f(26,"ion-card-content")(27,"ion-list")(28,"ion-list-header")(29,"ion-label"),y(30,"Liste des maitenances"),p()(),M(31,k1,2,1,"ng-container",12),p()()()(),f(32,"ion-col",1),M(33,T1,7,2,"ng-container",13),p()()()()),n&2&&(x("formGroup",o.maintForm),_(14),x("ngIf",!o.maintForm.controls.outillage.value),_(17),x("ngIf",o.maintForm.controls.itemActionCorrective),_(2),x("ngIf",o.selectedItem))},dependencies:[tt,Qe,Je,Ye,Xe,Ze,En,J,Ae,nt,it,ot,Pn,Fn,Ln,we,At,Pe,Me,zn,ta,qn,oa,Yl,Rt,_r,Y,re,Ku]})}return i})();var Yu=(()=>{class i{constructor(){}makePdf(e){}openPDF(e,n){}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function N1(i,t){if(i&1&&(f(0,"ion-select-option",7),y(1),p()),i&2){let e=t.$implicit;x("value",e),_(),F(" ",e.libelle,"")}}function R1(i,t){if(i&1){let e=H();f(0,"ion-item")(1,"ion-label"),y(2,"Affecter"),p(),f(3,"ion-select",5),E("ionChange",function(o){R(e);let r=v();return A(r.affectationChange(o))}),M(4,N1,2,2,"ion-select-option",6),p()()}if(i&2){let e=v();_(4),x("ngForOf",e.affectationGroups)}}function A1(i,t){if(i&1){let e=H();f(0,"ion-item")(1,"ion-label"),y(2,"Changer le statut"),p(),f(3,"ion-select",8,0),E("ionChange",function(o){R(e);let r=v();return A(r.statusChange(o))}),f(5,"ion-select-option",9),y(6,"Nouvelle"),p(),f(7,"ion-select-option",10),y(8,"Refuser"),p(),f(9,"ion-select-option",11),y(10,"Accepter"),p(),f(11,"ion-select-option",12),y(12,"Annuler"),p(),f(13,"ion-select-option",13),y(14,"En cours de r\xE9alisation"),p(),f(15,"ion-select-option",14),y(16,"Termin\xE9e"),p(),f(17,"ion-select-option",15),y(18,"Cloturer"),p(),f(19,"ion-select-option",16),y(20,"Attente de fourniture ext\xE9rieure"),p(),f(21,"ion-select-option",17),y(22,"Demande externalis\xE9e"),p()()()}}function P1(i,t){if(i&1){let e=H();f(0,"ion-button",18),E("click",function(){R(e);let o=v();return A(o.submitClick())}),S(1,"ion-icon",19),y(2," Envoyer "),p()}}function F1(i,t){if(i&1){let e=H();f(0,"ion-button",18),E("click",function(){R(e);let o=v();return A(o.updateClick())}),S(1,"ion-icon",19),y(2," Mettre \xE0 jour "),p()}}var xr=(()=>{class i{userService;pdfService;canManage;canUpdate;evStatusChange=new ie;evAffectationChange=new ie;evSubmit=new ie;evUpdate=new ie;userList;affectationGroups;constructor(e,n){this.userService=e,this.pdfService=n}ngOnInit(){this.loadUsers(),this.loadAffectationGroups()}loadUsers(){this.userService.getUsers().subscribe(e=>{this.userList=e})}loadAffectationGroups(){this.userService.getGroups().subscribe(e=>{this.affectationGroups=e})}affectationChange(e){this.evAffectationChange.emit(e.target.value)}statusChange(e){this.evStatusChange.emit(e.target.value)}pdfExportClick(){console.log(document.getElementById("toExport")),this.pdfService.openPDF(document.getElementById("toExport"),"test impression")}submitClick(){this.evSubmit.emit(null)}updateClick(){this.evUpdate.emit(null)}static \u0275fac=function(n){return new(n||i)(P(Un),P(Yu))};static \u0275cmp=O({type:i,selectors:[["app-tool-request-footer"]],inputs:{canManage:"canManage",canUpdate:"canUpdate"},outputs:{evStatusChange:"evStatusChange",evAffectationChange:"evAffectationChange",evSubmit:"evSubmit",evUpdate:"evUpdate"},standalone:!0,features:[L],decls:8,vars:4,consts:[["statut",""],[4,"ngIf"],["slot","end",3,"click"],["slot","end","name","document-attach-outline"],["slot","end","block","","color","success",3,"click",4,"ngIf"],["multiple","true","placeholder","S\xE9l\xE9ctionner une personne",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["multiple","false","placeholder","S\xE9l\xE9ctionner un statut",3,"ionChange"],["value","NOUVELLE"],["value","REFUSEE"],["value","ACCEPTEE"],["value","ANNULEE"],["value","EN COURS DE REALISATION"],["value","TERMINEE"],["value","CLOTUREE"],["value","ATTENTE FOURNITURE EXT"],["value","DEM EXT"],["slot","end","block","","color","success",3,"click"],["slot","end","name","send-outline"]],template:function(n,o){n&1&&(f(0,"ion-toolbar"),M(1,R1,5,1,"ion-item",1)(2,A1,23,0,"ion-item",1),f(3,"ion-button",2),E("click",function(){return o.pdfExportClick()}),S(4,"ion-icon",3),y(5," Exporter pdf "),p(),M(6,P1,3,0,"ion-button",4)(7,F1,3,0,"ion-button",4),p()),n&2&&(_(),x("ngIf",o.canManage),_(),x("ngIf",o.canManage),_(4),x("ngIf",!o.canUpdate),_(),x("ngIf",o.canUpdate))},dependencies:[J,Ae,we,Pe,Me,Vn,Hn,st,Nt,Y,re]})}return i})();var rl=(()=>{class i{route=T(no);router=T(io);navCtrl=T(Tn);formBuilder=T(hr);maintenanceService=T($u);toolRequestService=T(ke);alertService=T(jn);toolRequestManager=T(gr);mode=Q("create");toolRequest=Q(null);maintenance=Q(null);requestState=Q(null);isLoading=Q(!0);isSubmitting=Q(!1);errorMessage=Q(null);toolRequestId=null;toolRequestForm;maintenanceForm;pageTitle=Ke(()=>{let e=this.mode(),n=this.toolRequest()?.id;return e==="create"?"Nouvelle demande Maintenance et R\xE9paration":e==="edit"?`Modification demande de maintenance : ID ${n}`:`Demande de maintenance : ID ${n}`});canEdit=Ke(()=>{let e=this.requestState();return this.mode()==="create"?!0:e?.canEdit??!1});canManage=Ke(()=>this.requestState()?.canManage??!1);canSubmit=Ke(()=>!this.isSubmitting()&&this.toolRequestForm?.valid&&this.maintenanceForm?.valid);ngOnInit(){this.toolRequestId=this.route.snapshot.paramMap.get("id"),this.toolRequestId?(this.mode.set("edit"),this.loadMaintenanceData(this.toolRequestId)):(this.mode.set("create"),this.initializeFormsForCreation(),this.isLoading.set(!1))}initializeFormsForCreation(){this.toolRequestForm=this.formBuilder.createToolRequestForm({bloquantProd:!1}),this.maintenanceForm=this.formBuilder.createSpecMaintenanceForm()}initializeFormsForEdition(e,n){this.toolRequestForm=this.formBuilder.createToolRequestForm({type:e.type,bloquantProd:e.bloquantProd,dateBesoin:e.dateBesoin,groupeAffectation:e.groupeAffectation?.id,toolingNote:e.toolingNote}),this.maintenanceForm=this.formBuilder.createSpecMaintenanceForm({outillage:n.outillage?.id,outillNoRefSAP:n.outillNoRefSAP,sigle:n.sigle,dateValid:n.dateValid,userValideur:n.userValideur?.id,itemActionCorrective:n.itemActionCorrective}),this.toolRequest.set(e),this.maintenance.set(n)}loadMaintenanceData(e){this.isLoading.set(!0),this.errorMessage.set(null),this.maintenanceService.loadMaintenanceData(e).pipe(ye(n=>{console.log("\u2705 Donn\xE9es charg\xE9es:",n);let o=this.toolRequestManager.getStatus(n.toolRequest.statut);this.requestState.set(o),this.initializeFormsForEdition(n.toolRequest,n.specMaintenance)}),Se(n=>(console.error("\u274C Erreur chargement:",n),this.errorMessage.set("Impossible de charger la demande de maintenance"),this.alertService.simpleAlert("Erreur","Chargement","Impossible de charger la demande. Retour \xE0 la liste.").then(()=>{this.navigateToList()}),ji))).subscribe(()=>{this.isLoading.set(!1)})}onSubmitCreate(){if(!this.canSubmit()){this.toolRequestForm.markAllAsTouched(),this.maintenanceForm.markAllAsTouched(),this.errorMessage.set("Veuillez remplir tous les champs obligatoires");return}this.isSubmitting.set(!0),this.errorMessage.set(null);let e=this.buildMaintenanceFromForm();this.maintenanceService.createMaintenanceRequest(e).pipe(ye(n=>{console.log("\u2705 Demande cr\xE9\xE9e:",n)}),Se(n=>(console.error("\u274C Erreur cr\xE9ation:",n),this.errorMessage.set("Erreur lors de la cr\xE9ation de la demande"),this.isSubmitting.set(!1),ji))).subscribe(n=>{this.isSubmitting.set(!1),this.alertService.simpleAlert("Succ\xE8s","Cr\xE9ation d'une demande","La demande a bien \xE9t\xE9 cr\xE9\xE9e. Vous allez \xEAtre redirig\xE9 vers la liste des demandes").then(()=>{this.navigateToList()})})}onSubmitUpdate(){if(!this.canSubmit()||!this.toolRequestId){this.toolRequestForm.markAllAsTouched(),this.maintenanceForm.markAllAsTouched(),this.errorMessage.set("Veuillez remplir tous les champs obligatoires");return}this.isSubmitting.set(!0),this.errorMessage.set(null);let e=V(V({},this.toolRequest()),this.toolRequestForm.value),n=V(V({},this.maintenance()),this.buildMaintenanceFromForm());this.toolRequestService.updateToolRequest(e).pipe(pi(()=>this.maintenanceService.updateMaintenanceRequest(n)),ye(o=>{console.log("\u2705 Demande mise \xE0 jour:",o)}),Se(o=>(console.error("\u274C Erreur mise \xE0 jour:",o),this.errorMessage.set("Erreur lors de la mise \xE0 jour de la demande"),this.isSubmitting.set(!1),this.alertService.simpleAlert("Erreur","Mise \xE0 jour d'une demande","La demande n'a pas pu \xEAtre modifi\xE9e. V\xE9rifiez les donn\xE9es"),ji))).subscribe(()=>{this.isSubmitting.set(!1),this.alertService.simpleAlert("Succ\xE8s","Mise \xE0 jour d'une demande","La demande a bien \xE9t\xE9 modifi\xE9e. Vous allez \xEAtre redirig\xE9 vers la liste des demandes").then(()=>{this.navigateToList()})})}onStatutChange(e){this.toolRequestForm.patchValue({statut:e})}onAffectationChange(e){this.toolRequestForm.patchValue({groupeAffectation:e})}onCancel(){this.alertService.presentAlertConfirm("Confirmation","\xCAtes-vous s\xFBr de vouloir annuler ? Les modifications seront perdues.").then(e=>{e&&this.navigateToList()})}navigateToList(){this.navCtrl.navigateForward("tooling/tool-request-list")}buildMaintenanceFromForm(){let e=this.maintenanceForm.getRawValue();return{outillage:e.outillage,outillNoRefSAP:e.outillNoRefSAP,itemActionCorrective:e.itemActionCorrective,sigle:e.sigle,dateValid:e.dateValid,userValideur:e.userValideur,rep:e.rep}}formatDate(e){return e?new Date(e).toLocaleDateString("fr-FR"):"-"}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-maintenance-reparation"]],standalone:!0,features:[L],decls:10,vars:6,consts:[["color","dark"],[3,"fullscreen"],[1,"content-container"],[1,"left-side"],[3,"maintFormChange","toolRequestFormChange","maintForm","toolRequestForm"],[3,"evStatusChange","evSubmit","evUpdate","evAffectationChange","canManage","canUpdate"]],template:function(n,o){n&1&&(f(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),y(3),p()()(),f(4,"ion-content",1)(5,"div",2)(6,"div",3)(7,"app-maint-repair-form",4),vl("maintFormChange",function(s){return Er(o.maintenanceForm,s)||(o.maintenanceForm=s),s})("toolRequestFormChange",function(s){return Er(o.toolRequestForm,s)||(o.toolRequestForm=s),s}),p()()()(),f(8,"ion-footer")(9,"app-tool-request-footer",5),E("evStatusChange",function(s){return o.onStatutChange(s)})("evSubmit",function(){return o.onSubmitCreate()})("evUpdate",function(){return o.onSubmitUpdate()})("evAffectationChange",function(s){return o.onAffectationChange(s.id)}),p()()),n&2&&(_(3),ee(o.pageTitle()),_(),x("fullscreen",!0),_(3),Cl("maintForm",o.maintenanceForm)("toolRequestForm",o.toolRequestForm),_(2),x("canManage",o.requestState().canManage)("canUpdate",o.requestState().canUpdate))},dependencies:[J,rt,Xl,Bn,Pt,st,Ju,xr],styles:[".flex-row[_ngcontent-%COMP%]{display:flex;flex-direction:column}.flex-row[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{align-items:center}.content-container[_ngcontent-%COMP%]{display:flex;height:100%;overflow:hidden}.main-form[_ngcontent-%COMP%]{overflow-y:auto}.left-side[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;justify-content:flex-start;align-content:stretch}.left-side[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{height:100%}"]})}return i})();var L1=()=>({plugins:"lists link image table wordcount",toolbar:"bold italic underline strikethrough forecolor fontsize styles | alignleft aligncenter alignright alignjustify | bullist numlist | h1 h2 h3 |",menubar:!1,statusbar:!1,object_resizing:!0,placeholder:"Descriptif de la mesure demand\xE9e (contr\xF4le r\xE9ception, suite \xE0 choc, d\xE9m\xE9nagement d\u2019outillage ou autre)",height:150,inline:!1}),B1=()=>({plugins:"lists link image table wordcount",menubar:!1,statusbar:!1,placeholder:"lieux, r\xE9f\xE9rentiel...",height:150}),z1=()=>({plugins:"lists link image table wordcount",menubar:!1,statusbar:!1,placeholder:"IT plans et sp\xE9cifications de d\xE9finition",height:150}),q1=()=>({plugins:"lists link image table wordcount",menubar:!1,statusbar:!1,placeholder:"Information compl\xE9mentaire",height:150});function V1(i,t){i&1&&(G(0,40),f(1,"ion-list-header")(2,"ion-label"),y(3,"Sans n\xB0OT"),p()(),f(4,"ion-item")(5,"ion-label"),y(6,"Programme avion"),p(),S(7,"ion-input",41),p(),f(8,"ion-item")(9,"ion-label"),y(10,"Description outillage (texte libre)"),p(),S(11,"ion-input",42),p(),f(12,"ion-item")(13,"ion-label"),y(14,"Localisation (texte libre)"),p(),S(15,"ion-input",43),p(),K())}function H1(i,t){if(i&1){let e=H();f(0,"ion-content")(1,"ion-datetime",44,6),E("ionChange",function(){R(e);let o=gt(2),r=v();return A(r.controlForm.value.dispoOut=o.value)}),f(3,"div",45),y(4,"Date de mise \xE0 disposition au service outillage"),p()()()}}function $1(i,t){i&1&&(f(0,"ion-content")(1,"ion-datetime",46,7)(3,"div",45),y(4,"Date butoir demand\xE9e"),p()()())}function j1(i,t){if(i&1&&(f(0,"ion-select-option",47),y(1),p()),i&2){let e=t.$implicit;x("value",e.value),_(),F("",e.value," ")}}function U1(i,t){i&1&&(f(0,"ion-content")(1,"ion-datetime",54,10)(3,"div",45),y(4,"Date d'intervention"),p()()())}function W1(i,t){if(i&1&&(f(0,"ion-select-option",47),y(1),p()),i&2){let e=t.$implicit;x("value",e.value),_(),F("",e.value," ")}}function G1(i,t){if(i&1&&(f(0,"ion-card")(1,"ion-card-header",13)(2,"ion-card-title",14),y(3,"La Mesure"),p()(),f(4,"ion-item")(5,"ion-label",48),y(6,"Dur\xE9e d'immobilisation estim\xE9e de l'outillage"),p(),S(7,"ion-input",49),f(8,"ion-note",20),y(9,"en jours"),p()(),f(10,"ion-item",50)(11,"ion-label"),y(12,"Date d'intervention"),p(),S(13,"ion-icon",21),f(14,"ion-text",20),y(15),D(16,"date"),p(),f(17,"ion-modal",51),M(18,U1,5,0,"ng-template"),p()(),f(19,"div",34)(20,"ion-item")(21,"ion-label"),y(22,"Informations compl\xE9mentaires "),f(23,"ion-text",25),y(24,"*"),p()()(),S(25,"editor",52,8),p(),f(27,"ion-item")(28,"ion-label"),y(29,"Moyen de mesure"),p(),f(30,"ion-select",53,9),M(32,W1,2,2,"ion-select-option",33),D(33,"keyvalue"),p()()()),i&2){let e=v();_(15),F(" ",Tt(16,3,e.controlForm.value.interventionDate,"dd/MM/yyyy"),""),_(10),x("init",mi(8,q1)),_(7),x("ngForOf",B(33,6,e.moyenMesure))}}var Qu=(()=>{class i{fb=T(ro);toolRequest=Gt(null);requestState=Gt({canManage:!1,canUpdate:!1,canEdit:!1});submit=vn();update=vn();statusChange=vn();moyenMesure=Oa;typeRapport=Ta;toolRequestForm;controlForm;outillNoRefSAPForm;isEditMode=Ke(()=>!!this.toolRequest()?.id);formValid=Q(!1);editorConfig={plugins:"lists link image table wordcount",toolbar:"bold italic underline strikethrough forecolor fontsize styles | alignleft aligncenter alignright alignjustify | bullist numlist | h1 h2 h3",menubar:!1,statusbar:!1,object_resizing:!0,height:150,inline:!1};constructor(){this.outillNoRefSAPForm=this.fb.group({identification:[""],description:[""],localisation:[""]}),this.toolRequestForm=this.fb.group({id:[null],statut:[""]}),this.controlForm=this.fb.group({id:[null],outillage:[null],outillNoRefSAP:[this.outillNoRefSAPForm],bloquantProd:[!1],dispoOut:[null],refPlan:["",$.required],indPlan:["",$.required],cheminCAO:[""],dateBesoin:[null],ligneBudgetaire:["",$.required],typeRapport:[""],description:["",$.required],detailsControle:["",$.required],tolerances:["",$.required],immobilisationOutillage:[null],interventionDate:[null],infosComplementaire:[""],moyenMesure:[""],visaControleur:[""]}),Mn(()=>{console.log("hello from effect ctrl3D");let e=this.toolRequest(),n=e.typeData;e&&this.toolRequestForm.patchValue(e,{emitEvent:!1}),n&&this.controlForm.patchValue(n,{emitEvent:!1})}),Mn(()=>{this.formValid.set(this.controlForm.valid&&this.toolRequestForm.valid)})}onToolSelected(e){this.controlForm.patchValue({outillage:e})}formatDate(e){return new Date(e)}handleSubmit(){if(this.controlForm.valid){let e=ae(V({},this.toolRequestForm.value),{typeData:this.controlForm.value});this.isEditMode()?this.update.emit(e):this.submit.emit(e)}}handleStatusChange(e){this.statusChange.emit(e),this.toolRequestForm.patchValue({statut:e})}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-control3-dform"]],inputs:{toolRequest:[1,"toolRequest"],requestState:[1,"requestState"]},outputs:{submit:"submit",update:"update",statusChange:"statusChange"},standalone:!0,features:[L],decls:113,vars:20,consts:[["refPlan",""],["indPlan",""],["caoPath",""],["ligneBudgetaire",""],["typeRapportSelect",""],["ctrlReasons",""],["dispoOut",""],["needDate",""],["infosComplementaire",""],["moyenMesureSelect",""],["interventionDate",""],[1,"main-form",3,"formGroup"],["size","6"],["color","light"],[1,"ion-text-uppercase"],["lines","none"],["formControlName","outillage"],["formGroupName","outillNoRefSAP",4,"ngIf"],["slot","end","formControlName","bloquantProd"],["button","","id","open-modal"],["slot","end"],["slot","end","icon","calendar-outline"],["trigger","open-modal"],[1,"flex-row"],["position","floating"],["color","danger"],["required","","formControlName","refPlan","type","text","placeholder","indiquer n\xB0 de plan"],["required","","formControlName","indPlan","type","text","placeholder","indiquer l 'indice du plan"],["formControlName","cheminCAO","type","text","placeholder","Fournir CAO et / ou chemin d\u2019acc\xE8s"],["button","","id","open-date-butoir"],["trigger","open-date-butoir"],["required","","formControlName","ligneBudgetaire","type","text","placeholder","Indiquez le n\xB0 pour imputation"],["required","","formControlName","typeRapport"],[3,"value",4,"ngFor","ngForOf"],[1,"vertical"],["slot","","formControlName","description",3,"init"],["slot","","formControlName","detailsControle",3,"init"],["slot","","formControlName","tolerances",3,"init"],["size","12"],[4,"ngIf"],["formGroupName","outillNoRefSAP"],["formControlName","identification","type","text","placeholder","Renseigner le programme"],["formControlName","description","type","text","placeholder","Description de l'outillage"],["formControlName","localisation","type","text","placeholder","Description de l'outillage"],["presentation","date","formControlName","dispoOut","display-format","EEEE DD.MMMM.YYYY",3,"ionChange"],["slot","title"],["presentation","date","formControlName","dateBesoin","display-format","EEEE DD.MMMM.YYYY"],[3,"value"],["position","stacked"],["type","number","formControlName","immobilisationOutillage"],["button","","id","open-date-interv"],["trigger","open-date-interv"],["slot","","formControlName","infosComplementaire",3,"init"],["formControlName","moyenMesure"],["presentation","date","formControlName","interventionDate","display-format","EEEE DD.MMMM.YYYY"]],template:function(n,o){n&1&&(f(0,"form",11)(1,"ion-grid")(2,"ion-row")(3,"ion-col",12)(4,"ion-card")(5,"ion-card-header",13)(6,"ion-card-title",14),y(7,"L'outillage"),p()(),f(8,"ion-card-content")(9,"ion-list",15)(10,"ion-list-header")(11,"ion-label"),y(12,"Avec n\xB0OT"),p()(),S(13,"app-tool-input",16),M(14,V1,16,0,"ng-container",17),p()()(),f(15,"ion-card")(16,"ion-card-header",13)(17,"ion-card-title",14),y(18,"Compl\xE9ment"),p()(),f(19,"ion-card-content")(20,"ion-item")(21,"ion-label"),y(22,"Bloquant Prod"),p(),S(23,"ion-toggle",18),p(),f(24,"ion-item",19)(25,"ion-label"),y(26,"Date de mise \xE0 disposition au service outillage"),p(),f(27,"ion-text",20),y(28),D(29,"date"),p(),S(30,"ion-icon",21),f(31,"ion-modal",22),M(32,H1,5,0,"ng-template"),p()(),f(33,"div",23)(34,"ion-item")(35,"ion-label",24),y(36,"R\xE9f\xE9rence pi\xE8ce "),f(37,"ion-text",25),y(38,"*"),p()(),S(39,"ion-input",26,0),p(),f(41,"ion-item")(42,"ion-label",24),y(43,"Indice plan "),f(44,"ion-text",25),y(45,"*"),p()(),S(46,"ion-input",27,1),p()(),f(48,"ion-item")(49,"ion-label",24),y(50,"Format du mod\xE8le 3D fourni si n\xE9cessaire "),p(),S(51,"ion-input",28,2),p()()(),f(53,"ion-card")(54,"ion-card-header",13)(55,"ion-card-title",14),y(56,"Le rapport"),p()(),f(57,"ion-item",29)(58,"ion-label"),y(59,"Date butoir demand\xE9e"),p(),S(60,"ion-icon",21),f(61,"ion-text",20),y(62),D(63,"date"),p(),f(64,"ion-modal",30),M(65,$1,5,0,"ng-template"),p()(),f(66,"ion-item")(67,"ion-label"),y(68,"Oi ou Eotp "),f(69,"ion-text",25),y(70,"*"),p()(),S(71,"ion-input",31,3),p(),f(73,"ion-item")(74,"ion-label"),y(75,"Types de rapport"),p(),f(76,"ion-select",32,4),M(78,j1,2,2,"ion-select-option",33),D(79,"keyvalue"),p()()()(),f(80,"ion-col",12)(81,"ion-card")(82,"ion-card-header",13)(83,"ion-card-title",14),y(84,"Le contr\xF4le"),p()(),f(85,"ion-card-content")(86,"div",34)(87,"ion-item",15)(88,"ion-label"),y(89,"But du contr\xF4le, de l'essai ou de l 'expertise "),f(90,"ion-text",25),y(91,"*"),p()()(),S(92,"editor",35,5),p(),f(94,"div",34)(95,"ion-item",15)(96,"ion-label"),y(97,"D\xE9tails de la mesure "),f(98,"ion-text",25),y(99,"*"),p()()(),S(100,"editor",36,5),p(),f(102,"div",34)(103,"ion-item",15)(104,"ion-label"),y(105,"Pr\xE9cision demand\xE9e et attendue "),f(106,"ion-text",25),y(107,"*"),p()()(),S(108,"editor",37,5),p()()()()(),f(110,"ion-row")(111,"ion-col",38),M(112,G1,34,9,"ion-card",39),p()()()()),n&2&&(x("formGroup",o.controlForm),_(14),x("ngIf",!o.controlForm.controls.outillage.value),_(14),F(" ",Tt(29,9,o.controlForm.value.dispoOut,"dd/MM/yyyy"),""),_(34),F(" ",Tt(63,12,o.controlForm.value.dateBesoin,"dd/MM/yyyy"),""),_(16),x("ngForOf",B(79,15,o.typeRapport)),_(14),x("init",mi(17,L1)),_(8),x("init",mi(18,B1)),_(8),x("init",mi(19,z1)),_(4),x("ngIf",o.requestState))},dependencies:[ql,tt,Qe,Je,Ye,kn,Xe,Ze,En,_r,Y,re,aa,Ot,to,co,fo,lo,_o,Ll,zl,Bl,po,Hl,Nn,Dn,mo,yo,Rl,Re,ho,Ul,xo,Wl,go],styles:['ion-list-header[_ngcontent-%COMP%] > ion-label[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:700;text-decoration:underline}ion-list-header[_ngcontent-%COMP%] > ion-label[_ngcontent-%COMP%]:after{content:" :"}']})}return i})();function sl(i){i||(hl(sl),i=T(ml));let t=new al(e=>i.onDestroy(e.next.bind(e)));return e=>e.pipe(Ui(t))}var ll=(()=>{class i{toolRequestService=T(ke);toolRequestManager=T(gr);loaderService=T($n);alertService=T(jn);navCtrl=T(Tn);route=T(no);toolRequest=Q(null);requestState=Q(new mr);pageTitle=Q("Nouvelle demande de contr\xF4le 3D");toolRequestId;constructor(){this.toolRequestId=this.route.snapshot.paramMap.get("id"),Mn(()=>{let e=this.toolRequest();e?.id&&this.pageTitle.set(`Modification demande de contr\xF4le 3D : ID ${e.id}`)})}ionViewCanEnter(){this.toolRequestService.getToolRequest(this.toolRequestId).pipe(sl()).subscribe({next:e=>{this.toolRequest.set(e),this.requestState.set(this.toolRequestManager.getStatus(e.statut))},error:e=>this.handleError("Chargement de la demande",e)})}onSubmit(e){this.loaderService.startLoading("Cr\xE9ation de la demande"),this.toolRequestService.createToolRequest(e).subscribe({next:()=>{this.alertService.simpleAlert("Succ\xE8s","Cr\xE9ation d'une demande","La demande a bien \xE9t\xE9 cr\xE9\xE9e. Vous allez \xEAtre redirig\xE9 vers la liste des demandes").then(()=>{this.navCtrl.navigateRoot("tooling/tool-request-list")})},error:n=>this.handleError("Cr\xE9ation de la demande",n),complete:()=>this.loaderService.stopLoading()})}onUpdate(e){this.loaderService.startLoading("Mise \xE0 jour de la demande"),this.toolRequestService.updateToolRequest(e).subscribe({next:()=>{this.alertService.simpleAlert("Succ\xE8s","Mise \xE0 jour d'une demande","La demande a bien \xE9t\xE9 modifi\xE9e. Vous allez \xEAtre redirig\xE9 vers la liste des demandes").then(()=>{this.navCtrl.navigateRoot("tooling/tool-request-list")})},error:n=>this.handleError("Mise \xE0 jour de la demande",n),complete:()=>this.loaderService.stopLoading()})}onStatusChange(e){let n=this.toolRequest();n&&this.toolRequest.set(ae(V({},n),{statut:e}))}handleError(e,n){console.error(`[Control3DPage] ${e}:`,n),this.alertService.simpleAlert("Erreur",e,"Une erreur est survenue. Veuillez v\xE9rifier les donn\xE9es et r\xE9essayer."),this.loaderService.stopLoading()}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-control"]],standalone:!0,features:[L],decls:10,vars:5,consts:[["color","dark","no-padding",""],["color","light"],[1,"content-container"],[1,"control-form"],[3,"submit","update","statusChange","toolRequest","requestState"],[3,"evStatusChange","evSubmit","evUpdate","canManage","canUpdate"]],template:function(n,o){n&1&&(f(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),y(3),p()()(),f(4,"ion-content",1)(5,"div",2)(6,"div",3)(7,"app-control3-dform",4),E("submit",function(s){return o.onSubmit(s)})("update",function(s){return o.onUpdate(s)})("statusChange",function(s){return o.onStatusChange(s)}),p()()()(),f(8,"ion-footer")(9,"app-tool-request-footer",5),E("evStatusChange",function(s){return o.onStatusChange(s)})("evSubmit",function(s){return o.onSubmit(s)})("evUpdate",function(s){return o.onUpdate(s)}),p()()),n&2&&(_(3),ee(o.pageTitle()),_(4),x("toolRequest",o.toolRequest())("requestState",o.requestState()),_(2),x("canManage",o.requestState().canManage)("canUpdate",o.requestState().canUpdate))},dependencies:[Qu,xr,On,Dt,Rn,Re,ao],styles:[".main-form[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-around}.main-form[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]{max-width:30%}.main-form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:auto;height:auto}.flex-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.print-preview[_ngcontent-%COMP%]{overflow-y:auto}.vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column}.vertical[_ngcontent-%COMP%]   *[contentEditable=true][_ngcontent-%COMP%]:focus, .vertical[_ngcontent-%COMP%]   *[contentEditable=true][_ngcontent-%COMP%]:hover{outline:2px solid #1976d2}"]})}return i})();function K1(i,t){if(i&1){let e=H();f(0,"ion-content"),y(1,"Cr\xE9er un groupe"),p(),S(2,"ion-input",28,1),f(4,"ion-button",29),E("click",function(){R(e);let o=gt(3),r=v();return A(r.addGroupClick(o.value.toString()))}),y(5," Ajouter "),p()}}function J1(i,t){if(i&1&&(f(0,"ion-item")(1,"ion-label"),y(2),p()()),i&2){let e=t.$implicit;_(2),F(" ",e.libelle," ")}}function Y1(i,t){if(i&1){let e=H();f(0,"ion-button",30),E("click",function(){R(e);let o=v();return A(o.removeUsersOfTeam(o.selection.selected))}),y(1," Faire sortir de l'\xE9quipe "),p()}}function Q1(i,t){i&1&&(f(0,"th",31),y(1," Nom "),p())}function X1(i,t){if(i&1&&(f(0,"td",32),y(1),p()),i&2){let e=t.$implicit;_(),F(" ",e.nom," ")}}function Z1(i,t){i&1&&(f(0,"th",31),y(1," Pr\xE9nom "),p())}function ey(i,t){if(i&1&&(f(0,"td",32),y(1),p()),i&2){let e=t.$implicit;_(),F(" ",e.prenom," ")}}function ty(i,t){i&1&&(f(0,"th",31),y(1," Groupe "),p())}function ny(i,t){if(i&1&&(f(0,"ion-label"),y(1),p()),i&2){let e=t.$implicit;_(),F(" ",e.libelle," ")}}function iy(i,t){if(i&1&&(f(0,"ion-list"),M(1,ny,2,1,"ion-label",10),p()),i&2){let e=v().$implicit;_(),x("ngForOf",e.groupeAffected)}}function oy(i,t){if(i&1&&(f(0,"ion-select-option",39),y(1),p()),i&2){let e=t.$implicit;x("value",e),_(),F(" ",e.libelle,"")}}function ry(i,t){if(i&1){let e=H();f(0,"ion-select",37,2),E("ionChange",function(){R(e);let o=gt(1),r=v(2).$implicit,s=v();return A(s.addGroupToUser(o.value,r))}),M(2,oy,2,2,"ion-select-option",38),p()}if(i&2){let e=v(3);_(2),x("ngForOf",e.groups)}}function sy(i,t){if(i&1&&(f(0,"ion-item",35),M(1,ry,3,1,"ion-select",36),p()),i&2){let e=v().$implicit;_(),x("ngIf",e.groupeAffected.length===0)}}function ly(i,t){if(i&1&&(f(0,"td",32),M(1,iy,2,1,"ion-list",33)(2,sy,2,1,"ion-item",34),p()),i&2){let e=t.$implicit;_(),x("ngIf",e.groupeAffected.length>0),_(),x("ngIf",e.groupeAffected.length===0)}}function ay(i,t){i&1&&(f(0,"th",31),y(1," Programme avion "),p())}function cy(i,t){if(i&1&&(f(0,"td",32),y(1),p()),i&2){let e=t.$implicit;_(),F(" ",e.programmeAvion," ")}}function dy(i,t){i&1&&(f(0,"th",31),y(1," Derni\xE8re connexion "),p())}function uy(i,t){if(i&1&&(f(0,"td",32),y(1),D(2,"date"),p()),i&2){let e=t.$implicit;_(),F(" ",Tt(2,1,e.lastCon,"EEE dd/MM/yy")," ")}}function py(i,t){i&1&&S(0,"th",31)}function fy(i,t){if(i&1){let e=H();f(0,"ion-button",42),E("click",function(){R(e);let o=v().$implicit,r=v();return A(r.updateUser(o))}),S(1,"ion-icon",43),p()}}function hy(i,t){if(i&1){let e=H();f(0,"ion-button",44),E("click",function(){R(e);let o=v().$implicit;return A(o.isActive=!0)}),y(1," Accepter "),p()}}function my(i,t){if(i&1&&(f(0,"td",32),M(1,fy,2,0,"ion-button",40)(2,hy,2,0,"ion-button",41),p()),i&2){let e=t.$implicit;_(),x("ngIf",e.isUpdated),_(),x("ngIf",!e.isActive)}}function gy(i,t){i&1&&S(0,"tr",45)}function yy(i,t){if(i&1){let e=H();f(0,"tr",46),E("click",function(){let o=R(e).$implicit,r=v();return A(r.selection.toggle(o))}),p()}if(i&2){let e=t.$implicit,n=v();je(n.selection.isSelected(e)?"row-selected":"")}}var Xu=(()=>{class i{userService;programService;page={title:"G\xE9rer l'\xE9quipe"};toolsUserDataSource=new ka;selection=new ya(!0,[]);displayedColumns=["nom","prenom","groupeAffectation","lastCon","buttons"];groups;programs;constructor(e,n){this.userService=e,this.programService=n}ngOnInit(){this.getGroups(),this.getToolUsers()}getToolUsers(){return this.userService.getUsers({service:"OUTILLAGE"}).subscribe(e=>this.toolsUserDataSource.data=e.filter(n=>n.service.nom==="OUTILLAGE"))}getPrograms(){return new Promise((e,n)=>{this.programService.getPrograms().subscribe(o=>{this.programs=o,e()})})}getGroups(){this.userService.getGroups().subscribe(e=>{this.groups=e})}addGroupClick(e){if(e){let n={libelle:e};this.userService.createGroup(n).subscribe(o=>{this.groups.push(o)})}}addGroupToUser(e,n){n.groupeAffected=e,n.isUpdated=!0}updateUser(e){}removeUsersOfTeam(e){}static \u0275fac=function(n){return new(n||i)(P(Un),P(So))};static \u0275cmp=O({type:i,selectors:[["app-manage-team"]],standalone:!0,features:[L],decls:52,vars:8,consts:[["table",""],["inputGroup",""],["select",""],["color","dark"],[1,"content",3,"fullscreen"],["trigger","trigger-button","triggerAction","click","side","top","alignment","center","component","toolInputComponent"],[1,"content"],["color","light"],["slot","end","size","small","id","trigger-button"],["slot","start","name","add"],[4,"ngFor","ngForOf"],[1,"table-card"],[1,"table-card-content"],[1,"table"],["slot","end"],["size","small"],["slot","end","size","small","color","success","fill","solid",3,"click",4,"ngIf"],["mat-table","",1,"ion-margin",3,"dataSource"],["matColumnDef","nom"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","prenom"],["matColumnDef","groupeAffectation"],["matColumnDef","progAvion"],["matColumnDef","lastCon"],["matColumnDef","buttons"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["type","text","placeholder","Nom du groupe"],["expand","block","color","primary",3,"click"],["slot","end","size","small","color","success","fill","solid",3,"click"],["mat-header-cell",""],["mat-cell",""],[4,"ngIf"],["lines","none","color","light",4,"ngIf"],["lines","none","color","light"],["multiple","true","placeholder","Selectionner un groupe",3,"ionChange",4,"ngIf"],["multiple","true","placeholder","Selectionner un groupe",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["size","small","color","secondary",3,"click",4,"ngIf"],["size","small",3,"click",4,"ngIf"],["size","small","color","secondary",3,"click"],["slot","icon-only","name","save-outline"],["size","small",3,"click"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,o){n&1&&(f(0,"ion-header")(1,"ion-toolbar",3)(2,"ion-title"),y(3),p()()(),f(4,"ion-content",4)(5,"ion-popover",5),M(6,K1,6,0,"ng-template"),p(),f(7,"div",6)(8,"ion-card")(9,"ion-card-header",7)(10,"ion-card-title"),y(11,"Groupes d'affectations "),p()(),f(12,"ion-card-content")(13,"ion-toolbar")(14,"ion-button",8),S(15,"ion-icon",9),y(16," Cr\xE9er "),p()(),f(17,"ion-list"),M(18,J1,3,1,"ion-item",10),p()()(),f(19,"ion-card",11)(20,"ion-card-header",7)(21,"ion-card-title"),y(22,"Liste des utilisateurs"),p()(),f(23,"ion-card-content",12)(24,"div",13)(25,"ion-toolbar")(26,"ion-buttons",14)(27,"ion-button",15),y(28," Tout "),p(),M(29,Y1,2,0,"ion-button",16),p()(),f(30,"table",17,0),G(32,18),M(33,Q1,2,0,"th",19)(34,X1,2,1,"td",20),K(),G(35,21),M(36,Z1,2,0,"th",19)(37,ey,2,1,"td",20),K(),G(38,22),M(39,ty,2,0,"th",19)(40,ly,3,2,"td",20),K(),G(41,23),M(42,ay,2,0,"th",19)(43,cy,2,1,"td",20),K(),G(44,24),M(45,dy,2,0,"th",19)(46,uy,3,4,"td",20),K(),G(47,25),M(48,py,1,0,"th",19)(49,my,3,2,"td",20),K(),M(50,gy,1,0,"tr",26)(51,yy,1,2,"tr",27),p()()()()()()),n&2&&(_(3),ee(o.page.title),_(),x("fullscreen",!1),_(14),x("ngForOf",o.groups),_(11),x("ngIf",!o.selection.isEmpty()),_(),x("dataSource",o.toolsUserDataSource),_(20),x("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),_(),x("matRowDefColumns",o.displayedColumns))},dependencies:[J,Ae,An,nt,it,ot,Pn,rt,Bn,we,At,Pe,Me,zn,Vn,Hn,Pt,st,sa,Nt,Rt,re,Y,_a,Ca,ba,va,xa,Sa,wa,Ia,Ma,Ea,Ot],styles:[".content[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{max-height:100%;flex-grow:1}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%], .content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   .table-card-content[_ngcontent-%COMP%]{width:100%;height:100%;overflow:auto}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%], .content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   .table-card-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.content[_ngcontent-%COMP%]   .table-card[_ngcontent-%COMP%]{flex-grow:4}.row-selected[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{color:var(--ion-color-danger)}tr[_ngcontent-%COMP%]:hover > td[_ngcontent-%COMP%]{color:var(--ion-color-danger)}"]})}return i})();var _y=["canvas"],Zu=(()=>{class i{indicator;canvas;pieChart;constructor(){}ngAfterViewInit(){console.log(this.indicator),this.pieChart=new pa(this.canvas.nativeElement,{type:"pie",data:{labels:Object.entries(this.indicator.repartitionObj).map(e=>e[0]),datasets:[{label:`Prefix-${this.indicator.name}`,backgroundColor:["#505F69","#6EB4CD"],borderColor:"#E1E1D7",borderWidth:1,borderJoinStyle:"miter",data:Object.entries(this.indicator.repartitionObj).map(e=>e[1])}]},options:{plugins:{}}}),this.pieChart.update()}ngOnInit(){console.log("init",this.indicator)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-indicator-graph"]],viewQuery:function(n,o){if(n&1&&Ue(_y,5),n&2){let r;We(r=Ge())&&(o.canvas=r.first)}},inputs:{indicator:"indicator"},standalone:!0,features:[L],decls:7,vars:1,consts:[["canvas",""],["color","primary",1,"ion-no-padding"]],template:function(n,o){n&1&&(f(0,"ion-card",1)(1,"ion-card-header")(2,"ion-card-subtitle"),y(3),p()(),f(4,"ion-card-content"),S(5,"canvas",null,0),p()()),n&2&&(_(3),F(" ",o.indicator.name," "))},dependencies:[J,nt,it,ot,bo]})}return i})();var ep=(()=>{class i{indicator;constructor(){}ngOnInit(){}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=O({type:i,selectors:[["app-indicator-number"]],inputs:{indicator:"indicator"},standalone:!0,features:[L],decls:7,vars:2,consts:[["color","primary"]],template:function(n,o){n&1&&(f(0,"ion-card",0)(1,"ion-card-header")(2,"ion-card-subtitle"),y(3),p()(),f(4,"ion-card-content")(5,"ion-text"),y(6),p()()()),n&2&&(_(3),ee(o.indicator.name),_(3),F(" ",o.indicator.value," "))},dependencies:[J,nt,it,ot,bo,Co],styles:["ion-text[_ngcontent-%COMP%]{font-size:500%;color:var(--ion-color-primary-contrast)}ion-card-content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}"]})}return i})();var xy=["repartitionDemandesCanvas"],by=i=>({name:"En cours",value:i}),Cy=i=>({name:"Ouvertes",value:i}),vy=i=>({name:"R\xE9partition",repartitionObj:i});function Sy(i,t){if(i&1&&S(0,"app-indicator-graph",3),i&2){let e=v();x("indicator",Jt(1,vy,e.requestTypeDistribution))}}var tp=(()=>{class i{toolRequestService;repartitionDemandesCanvas;openRequestCount=0;onGoingRequestCount=0;requestTypeDistribution;constructor(e){this.toolRequestService=e}ngOnInit(){}ionViewWillEnter(){}static \u0275fac=function(n){return new(n||i)(P(ke))};static \u0275cmp=O({type:i,selectors:[["app-indicators"]],viewQuery:function(n,o){if(n&1&&Ue(xy,5),n&2){let r;We(r=Ge())&&(o.repartitionDemandesCanvas=r.first)}},standalone:!0,features:[L],decls:5,vars:8,consts:[[3,"fullscreen"],[1,"graph"],[3,"indicator",4,"ngIf"],[3,"indicator"]],template:function(n,o){n&1&&(f(0,"ion-content",0)(1,"div",1),M(2,Sy,1,3,"app-indicator-graph",2),S(3,"app-indicator-number",3)(4,"app-indicator-number",3),p()()),n&2&&(x("fullscreen",!0),_(2),x("ngIf",o.requestTypeDistribution),_(),x("indicator",Jt(4,by,o.onGoingRequestCount)),_(),x("indicator",Jt(6,Cy,o.openRequestCount)))},dependencies:[J,rt,Y,Zu,ep],styles:[".graph[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;overflow:hidden}.graph[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{min-width:25%;max-width:50%;max-height:50%;min-height:1/3}"]})}return i})();var hS=[{path:"",component:Ra,children:[{path:"new-tool",component:Au},{path:"requests",component:Vu},{path:"list",canActivate:[lt],data:{expectedRole:["ROLE_ADMIN","ROLE_RESP_OUTIL"]},component:Hu},{path:"repair",component:rl},{path:"repair/:id",component:rl},{path:"3d",component:ll},{path:"3d/:id",component:ll},{path:"manage-team",canActivate:[lt],data:{expectedRole:["ROLE_ADMIN","ROLE_RESP_OUTIL","ROLE_CE_OUTIL"]},component:Xu},{path:"indicators",canActivate:[lt],data:{expectedRole:["ROLE_ADMIN","ROLE_RESP_OUTIL","ROLE_CE_OUTIL"]},component:tp}]}];export{hS as TOOLING_ROUTES};
